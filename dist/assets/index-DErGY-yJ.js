(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(r){if(r.ep)return;r.ep=!0;const a=e(r);fetch(r.href,a)}})();function Cp(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var Pc={exports:{}},na={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jg;function IS(){if(Jg)return na;Jg=1;var u=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function e(s,r,a){var o=null;if(a!==void 0&&(o=""+a),r.key!==void 0&&(o=""+r.key),"key"in r){a={};for(var f in r)f!=="key"&&(a[f]=r[f])}else a=r;return r=a.ref,{$$typeof:u,type:s,key:o,ref:r!==void 0?r:null,props:a}}return na.Fragment=t,na.jsx=e,na.jsxs=e,na}var tm;function CS(){return tm||(tm=1,Pc.exports=IS()),Pc.exports}var C=CS(),Uc={exports:{}},xt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var em;function kS(){if(em)return xt;em=1;var u=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),o=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),v=Symbol.iterator;function E(I){return I===null||typeof I!="object"?null:(I=v&&I[v]||I["@@iterator"],typeof I=="function"?I:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},A=Object.assign,b={};function L(I,U,it){this.props=I,this.context=U,this.refs=b,this.updater=it||S}L.prototype.isReactComponent={},L.prototype.setState=function(I,U){if(typeof I!="object"&&typeof I!="function"&&I!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,I,U,"setState")},L.prototype.forceUpdate=function(I){this.updater.enqueueForceUpdate(this,I,"forceUpdate")};function _(){}_.prototype=L.prototype;function D(I,U,it){this.props=I,this.context=U,this.refs=b,this.updater=it||S}var k=D.prototype=new _;k.constructor=D,A(k,L.prototype),k.isPureReactComponent=!0;var w=Array.isArray;function V(){}var O={H:null,A:null,T:null,S:null},$=Object.prototype.hasOwnProperty;function G(I,U,it){var nt=it.ref;return{$$typeof:u,type:I,key:U,ref:nt!==void 0?nt:null,props:it}}function B(I,U){return G(I.type,U,I.props)}function Q(I){return typeof I=="object"&&I!==null&&I.$$typeof===u}function st(I){var U={"=":"=0",":":"=2"};return"$"+I.replace(/[=:]/g,function(it){return U[it]})}var ut=/\/+/g;function dt(I,U){return typeof I=="object"&&I!==null&&I.key!=null?st(""+I.key):U.toString(36)}function lt(I){switch(I.status){case"fulfilled":return I.value;case"rejected":throw I.reason;default:switch(typeof I.status=="string"?I.then(V,V):(I.status="pending",I.then(function(U){I.status==="pending"&&(I.status="fulfilled",I.value=U)},function(U){I.status==="pending"&&(I.status="rejected",I.reason=U)})),I.status){case"fulfilled":return I.value;case"rejected":throw I.reason}}throw I}function N(I,U,it,nt,at){var ft=typeof I;(ft==="undefined"||ft==="boolean")&&(I=null);var Et=!1;if(I===null)Et=!0;else switch(ft){case"bigint":case"string":case"number":Et=!0;break;case"object":switch(I.$$typeof){case u:case t:Et=!0;break;case g:return Et=I._init,N(Et(I._payload),U,it,nt,at)}}if(Et)return at=at(I),Et=nt===""?"."+dt(I,0):nt,w(at)?(it="",Et!=null&&(it=Et.replace(ut,"$&/")+"/"),N(at,U,it,"",function(De){return De})):at!=null&&(Q(at)&&(at=B(at,it+(at.key==null||I&&I.key===at.key?"":(""+at.key).replace(ut,"$&/")+"/")+Et)),U.push(at)),1;Et=0;var wt=nt===""?".":nt+":";if(w(I))for(var Mt=0;Mt<I.length;Mt++)nt=I[Mt],ft=wt+dt(nt,Mt),Et+=N(nt,U,it,ft,at);else if(Mt=E(I),typeof Mt=="function")for(I=Mt.call(I),Mt=0;!(nt=I.next()).done;)nt=nt.value,ft=wt+dt(nt,Mt++),Et+=N(nt,U,it,ft,at);else if(ft==="object"){if(typeof I.then=="function")return N(lt(I),U,it,nt,at);throw U=String(I),Error("Objects are not valid as a React child (found: "+(U==="[object Object]"?"object with keys {"+Object.keys(I).join(", ")+"}":U)+"). If you meant to render a collection of children, use an array instead.")}return Et}function X(I,U,it){if(I==null)return I;var nt=[],at=0;return N(I,nt,"","",function(ft){return U.call(it,ft,at++)}),nt}function Z(I){if(I._status===-1){var U=I._result;U=U(),U.then(function(it){(I._status===0||I._status===-1)&&(I._status=1,I._result=it)},function(it){(I._status===0||I._status===-1)&&(I._status=2,I._result=it)}),I._status===-1&&(I._status=0,I._result=U)}if(I._status===1)return I._result.default;throw I._result}var rt=typeof reportError=="function"?reportError:function(I){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var U=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof I=="object"&&I!==null&&typeof I.message=="string"?String(I.message):String(I),error:I});if(!window.dispatchEvent(U))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",I);return}console.error(I)},ot={map:X,forEach:function(I,U,it){X(I,function(){U.apply(this,arguments)},it)},count:function(I){var U=0;return X(I,function(){U++}),U},toArray:function(I){return X(I,function(U){return U})||[]},only:function(I){if(!Q(I))throw Error("React.Children.only expected to receive a single React element child.");return I}};return xt.Activity=p,xt.Children=ot,xt.Component=L,xt.Fragment=e,xt.Profiler=r,xt.PureComponent=D,xt.StrictMode=s,xt.Suspense=h,xt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=O,xt.__COMPILER_RUNTIME={__proto__:null,c:function(I){return O.H.useMemoCache(I)}},xt.cache=function(I){return function(){return I.apply(null,arguments)}},xt.cacheSignal=function(){return null},xt.cloneElement=function(I,U,it){if(I==null)throw Error("The argument must be a React element, but you passed "+I+".");var nt=A({},I.props),at=I.key;if(U!=null)for(ft in U.key!==void 0&&(at=""+U.key),U)!$.call(U,ft)||ft==="key"||ft==="__self"||ft==="__source"||ft==="ref"&&U.ref===void 0||(nt[ft]=U[ft]);var ft=arguments.length-2;if(ft===1)nt.children=it;else if(1<ft){for(var Et=Array(ft),wt=0;wt<ft;wt++)Et[wt]=arguments[wt+2];nt.children=Et}return G(I.type,at,nt)},xt.createContext=function(I){return I={$$typeof:o,_currentValue:I,_currentValue2:I,_threadCount:0,Provider:null,Consumer:null},I.Provider=I,I.Consumer={$$typeof:a,_context:I},I},xt.createElement=function(I,U,it){var nt,at={},ft=null;if(U!=null)for(nt in U.key!==void 0&&(ft=""+U.key),U)$.call(U,nt)&&nt!=="key"&&nt!=="__self"&&nt!=="__source"&&(at[nt]=U[nt]);var Et=arguments.length-2;if(Et===1)at.children=it;else if(1<Et){for(var wt=Array(Et),Mt=0;Mt<Et;Mt++)wt[Mt]=arguments[Mt+2];at.children=wt}if(I&&I.defaultProps)for(nt in Et=I.defaultProps,Et)at[nt]===void 0&&(at[nt]=Et[nt]);return G(I,ft,at)},xt.createRef=function(){return{current:null}},xt.forwardRef=function(I){return{$$typeof:f,render:I}},xt.isValidElement=Q,xt.lazy=function(I){return{$$typeof:g,_payload:{_status:-1,_result:I},_init:Z}},xt.memo=function(I,U){return{$$typeof:d,type:I,compare:U===void 0?null:U}},xt.startTransition=function(I){var U=O.T,it={};O.T=it;try{var nt=I(),at=O.S;at!==null&&at(it,nt),typeof nt=="object"&&nt!==null&&typeof nt.then=="function"&&nt.then(V,rt)}catch(ft){rt(ft)}finally{U!==null&&it.types!==null&&(U.types=it.types),O.T=U}},xt.unstable_useCacheRefresh=function(){return O.H.useCacheRefresh()},xt.use=function(I){return O.H.use(I)},xt.useActionState=function(I,U,it){return O.H.useActionState(I,U,it)},xt.useCallback=function(I,U){return O.H.useCallback(I,U)},xt.useContext=function(I){return O.H.useContext(I)},xt.useDebugValue=function(){},xt.useDeferredValue=function(I,U){return O.H.useDeferredValue(I,U)},xt.useEffect=function(I,U){return O.H.useEffect(I,U)},xt.useEffectEvent=function(I){return O.H.useEffectEvent(I)},xt.useId=function(){return O.H.useId()},xt.useImperativeHandle=function(I,U,it){return O.H.useImperativeHandle(I,U,it)},xt.useInsertionEffect=function(I,U){return O.H.useInsertionEffect(I,U)},xt.useLayoutEffect=function(I,U){return O.H.useLayoutEffect(I,U)},xt.useMemo=function(I,U){return O.H.useMemo(I,U)},xt.useOptimistic=function(I,U){return O.H.useOptimistic(I,U)},xt.useReducer=function(I,U,it){return O.H.useReducer(I,U,it)},xt.useRef=function(I){return O.H.useRef(I)},xt.useState=function(I){return O.H.useState(I)},xt.useSyncExternalStore=function(I,U,it){return O.H.useSyncExternalStore(I,U,it)},xt.useTransition=function(){return O.H.useTransition()},xt.version="19.2.0",xt}var im;function Of(){return im||(im=1,Uc.exports=kS()),Uc.exports}var Qt=Of();const OS=Cp(Qt);var Bc={exports:{}},ra={},Fc={exports:{}},$c={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sm;function MS(){return sm||(sm=1,(function(u){function t(N,X){var Z=N.length;N.push(X);t:for(;0<Z;){var rt=Z-1>>>1,ot=N[rt];if(0<r(ot,X))N[rt]=X,N[Z]=ot,Z=rt;else break t}}function e(N){return N.length===0?null:N[0]}function s(N){if(N.length===0)return null;var X=N[0],Z=N.pop();if(Z!==X){N[0]=Z;t:for(var rt=0,ot=N.length,I=ot>>>1;rt<I;){var U=2*(rt+1)-1,it=N[U],nt=U+1,at=N[nt];if(0>r(it,Z))nt<ot&&0>r(at,it)?(N[rt]=at,N[nt]=Z,rt=nt):(N[rt]=it,N[U]=Z,rt=U);else if(nt<ot&&0>r(at,Z))N[rt]=at,N[nt]=Z,rt=nt;else break t}}return X}function r(N,X){var Z=N.sortIndex-X.sortIndex;return Z!==0?Z:N.id-X.id}if(u.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;u.unstable_now=function(){return a.now()}}else{var o=Date,f=o.now();u.unstable_now=function(){return o.now()-f}}var h=[],d=[],g=1,p=null,v=3,E=!1,S=!1,A=!1,b=!1,L=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,D=typeof setImmediate<"u"?setImmediate:null;function k(N){for(var X=e(d);X!==null;){if(X.callback===null)s(d);else if(X.startTime<=N)s(d),X.sortIndex=X.expirationTime,t(h,X);else break;X=e(d)}}function w(N){if(A=!1,k(N),!S)if(e(h)!==null)S=!0,V||(V=!0,st());else{var X=e(d);X!==null&&lt(w,X.startTime-N)}}var V=!1,O=-1,$=5,G=-1;function B(){return b?!0:!(u.unstable_now()-G<$)}function Q(){if(b=!1,V){var N=u.unstable_now();G=N;var X=!0;try{t:{S=!1,A&&(A=!1,_(O),O=-1),E=!0;var Z=v;try{e:{for(k(N),p=e(h);p!==null&&!(p.expirationTime>N&&B());){var rt=p.callback;if(typeof rt=="function"){p.callback=null,v=p.priorityLevel;var ot=rt(p.expirationTime<=N);if(N=u.unstable_now(),typeof ot=="function"){p.callback=ot,k(N),X=!0;break e}p===e(h)&&s(h),k(N)}else s(h);p=e(h)}if(p!==null)X=!0;else{var I=e(d);I!==null&&lt(w,I.startTime-N),X=!1}}break t}finally{p=null,v=Z,E=!1}X=void 0}}finally{X?st():V=!1}}}var st;if(typeof D=="function")st=function(){D(Q)};else if(typeof MessageChannel<"u"){var ut=new MessageChannel,dt=ut.port2;ut.port1.onmessage=Q,st=function(){dt.postMessage(null)}}else st=function(){L(Q,0)};function lt(N,X){O=L(function(){N(u.unstable_now())},X)}u.unstable_IdlePriority=5,u.unstable_ImmediatePriority=1,u.unstable_LowPriority=4,u.unstable_NormalPriority=3,u.unstable_Profiling=null,u.unstable_UserBlockingPriority=2,u.unstable_cancelCallback=function(N){N.callback=null},u.unstable_forceFrameRate=function(N){0>N||125<N?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):$=0<N?Math.floor(1e3/N):5},u.unstable_getCurrentPriorityLevel=function(){return v},u.unstable_next=function(N){switch(v){case 1:case 2:case 3:var X=3;break;default:X=v}var Z=v;v=X;try{return N()}finally{v=Z}},u.unstable_requestPaint=function(){b=!0},u.unstable_runWithPriority=function(N,X){switch(N){case 1:case 2:case 3:case 4:case 5:break;default:N=3}var Z=v;v=N;try{return X()}finally{v=Z}},u.unstable_scheduleCallback=function(N,X,Z){var rt=u.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?rt+Z:rt):Z=rt,N){case 1:var ot=-1;break;case 2:ot=250;break;case 5:ot=1073741823;break;case 4:ot=1e4;break;default:ot=5e3}return ot=Z+ot,N={id:g++,callback:X,priorityLevel:N,startTime:Z,expirationTime:ot,sortIndex:-1},Z>rt?(N.sortIndex=Z,t(d,N),e(h)===null&&N===e(d)&&(A?(_(O),O=-1):A=!0,lt(w,Z-rt))):(N.sortIndex=ot,t(h,N),S||E||(S=!0,V||(V=!0,st()))),N},u.unstable_shouldYield=B,u.unstable_wrapCallback=function(N){var X=v;return function(){var Z=v;v=X;try{return N.apply(this,arguments)}finally{v=Z}}}})($c)),$c}var nm;function wS(){return nm||(nm=1,Fc.exports=MS()),Fc.exports}var Gc={exports:{}},Ie={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rm;function NS(){if(rm)return Ie;rm=1;var u=Of();function t(h){var d="https://react.dev/errors/"+h;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)d+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+h+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function e(){}var s={d:{f:e,r:function(){throw Error(t(522))},D:e,C:e,L:e,m:e,X:e,S:e,M:e},p:0,findDOMNode:null},r=Symbol.for("react.portal");function a(h,d,g){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:p==null?null:""+p,children:h,containerInfo:d,implementation:g}}var o=u.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function f(h,d){if(h==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return Ie.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,Ie.createPortal=function(h,d){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(t(299));return a(h,d,null,g)},Ie.flushSync=function(h){var d=o.T,g=s.p;try{if(o.T=null,s.p=2,h)return h()}finally{o.T=d,s.p=g,s.d.f()}},Ie.preconnect=function(h,d){typeof h=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,s.d.C(h,d))},Ie.prefetchDNS=function(h){typeof h=="string"&&s.d.D(h)},Ie.preinit=function(h,d){if(typeof h=="string"&&d&&typeof d.as=="string"){var g=d.as,p=f(g,d.crossOrigin),v=typeof d.integrity=="string"?d.integrity:void 0,E=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;g==="style"?s.d.S(h,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:p,integrity:v,fetchPriority:E}):g==="script"&&s.d.X(h,{crossOrigin:p,integrity:v,fetchPriority:E,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},Ie.preinitModule=function(h,d){if(typeof h=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var g=f(d.as,d.crossOrigin);s.d.M(h,{crossOrigin:g,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&s.d.M(h)},Ie.preload=function(h,d){if(typeof h=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var g=d.as,p=f(g,d.crossOrigin);s.d.L(h,g,{crossOrigin:p,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},Ie.preloadModule=function(h,d){if(typeof h=="string")if(d){var g=f(d.as,d.crossOrigin);s.d.m(h,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:g,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else s.d.m(h)},Ie.requestFormReset=function(h){s.d.r(h)},Ie.unstable_batchedUpdates=function(h,d){return h(d)},Ie.useFormState=function(h,d,g){return o.H.useFormState(h,d,g)},Ie.useFormStatus=function(){return o.H.useHostTransitionStatus()},Ie.version="19.2.0",Ie}var am;function PS(){if(am)return Gc.exports;am=1;function u(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(u)}catch(t){console.error(t)}}return u(),Gc.exports=NS(),Gc.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lm;function US(){if(lm)return ra;lm=1;var u=wS(),t=Of(),e=PS();function s(i){var n="https://react.dev/errors/"+i;if(1<arguments.length){n+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)n+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+i+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function a(i){var n=i,l=i;if(i.alternate)for(;n.return;)n=n.return;else{i=n;do n=i,(n.flags&4098)!==0&&(l=n.return),i=n.return;while(i)}return n.tag===3?l:null}function o(i){if(i.tag===13){var n=i.memoizedState;if(n===null&&(i=i.alternate,i!==null&&(n=i.memoizedState)),n!==null)return n.dehydrated}return null}function f(i){if(i.tag===31){var n=i.memoizedState;if(n===null&&(i=i.alternate,i!==null&&(n=i.memoizedState)),n!==null)return n.dehydrated}return null}function h(i){if(a(i)!==i)throw Error(s(188))}function d(i){var n=i.alternate;if(!n){if(n=a(i),n===null)throw Error(s(188));return n!==i?null:i}for(var l=i,c=n;;){var m=l.return;if(m===null)break;var y=m.alternate;if(y===null){if(c=m.return,c!==null){l=c;continue}break}if(m.child===y.child){for(y=m.child;y;){if(y===l)return h(m),i;if(y===c)return h(m),n;y=y.sibling}throw Error(s(188))}if(l.return!==c.return)l=m,c=y;else{for(var T=!1,R=m.child;R;){if(R===l){T=!0,l=m,c=y;break}if(R===c){T=!0,c=m,l=y;break}R=R.sibling}if(!T){for(R=y.child;R;){if(R===l){T=!0,l=y,c=m;break}if(R===c){T=!0,c=y,l=m;break}R=R.sibling}if(!T)throw Error(s(189))}}if(l.alternate!==c)throw Error(s(190))}if(l.tag!==3)throw Error(s(188));return l.stateNode.current===l?i:n}function g(i){var n=i.tag;if(n===5||n===26||n===27||n===6)return i;for(i=i.child;i!==null;){if(n=g(i),n!==null)return n;i=i.sibling}return null}var p=Object.assign,v=Symbol.for("react.element"),E=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),A=Symbol.for("react.fragment"),b=Symbol.for("react.strict_mode"),L=Symbol.for("react.profiler"),_=Symbol.for("react.consumer"),D=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),V=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),$=Symbol.for("react.lazy"),G=Symbol.for("react.activity"),B=Symbol.for("react.memo_cache_sentinel"),Q=Symbol.iterator;function st(i){return i===null||typeof i!="object"?null:(i=Q&&i[Q]||i["@@iterator"],typeof i=="function"?i:null)}var ut=Symbol.for("react.client.reference");function dt(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===ut?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case A:return"Fragment";case L:return"Profiler";case b:return"StrictMode";case w:return"Suspense";case V:return"SuspenseList";case G:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case S:return"Portal";case D:return i.displayName||"Context";case _:return(i._context.displayName||"Context")+".Consumer";case k:var n=i.render;return i=i.displayName,i||(i=n.displayName||n.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case O:return n=i.displayName||null,n!==null?n:dt(i.type)||"Memo";case $:n=i._payload,i=i._init;try{return dt(i(n))}catch{}}return null}var lt=Array.isArray,N=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,X=e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Z={pending:!1,data:null,method:null,action:null},rt=[],ot=-1;function I(i){return{current:i}}function U(i){0>ot||(i.current=rt[ot],rt[ot]=null,ot--)}function it(i,n){ot++,rt[ot]=i.current,i.current=n}var nt=I(null),at=I(null),ft=I(null),Et=I(null);function wt(i,n){switch(it(ft,n),it(at,i),it(nt,null),n.nodeType){case 9:case 11:i=(i=n.documentElement)&&(i=i.namespaceURI)?xg(i):0;break;default:if(i=n.tagName,n=n.namespaceURI)n=xg(n),i=Ag(n,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}U(nt),it(nt,i)}function Mt(){U(nt),U(at),U(ft)}function De(i){i.memoizedState!==null&&it(Et,i);var n=nt.current,l=Ag(n,i.type);n!==l&&(it(at,i),it(nt,l))}function si(i){at.current===i&&(U(nt),U(at)),Et.current===i&&(U(Et),ta._currentValue=Z)}var ur,cn;function pi(i){if(ur===void 0)try{throw Error()}catch(l){var n=l.stack.trim().match(/\n( *(at )?)/);ur=n&&n[1]||"",cn=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ur+i+cn}var Ea=!1;function It(i,n){if(!i||Ea)return"";Ea=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var c={DetermineComponentFrameRoot:function(){try{if(n){var et=function(){throw Error()};if(Object.defineProperty(et.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(et,[])}catch(q){var Y=q}Reflect.construct(i,[],et)}else{try{et.call()}catch(q){Y=q}i.call(et.prototype)}}else{try{throw Error()}catch(q){Y=q}(et=i())&&typeof et.catch=="function"&&et.catch(function(){})}}catch(q){if(q&&Y&&typeof q.stack=="string")return[q.stack,Y.stack]}return[null,null]}};c.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var m=Object.getOwnPropertyDescriptor(c.DetermineComponentFrameRoot,"name");m&&m.configurable&&Object.defineProperty(c.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var y=c.DetermineComponentFrameRoot(),T=y[0],R=y[1];if(T&&R){var M=T.split(`
`),j=R.split(`
`);for(m=c=0;c<M.length&&!M[c].includes("DetermineComponentFrameRoot");)c++;for(;m<j.length&&!j[m].includes("DetermineComponentFrameRoot");)m++;if(c===M.length||m===j.length)for(c=M.length-1,m=j.length-1;1<=c&&0<=m&&M[c]!==j[m];)m--;for(;1<=c&&0<=m;c--,m--)if(M[c]!==j[m]){if(c!==1||m!==1)do if(c--,m--,0>m||M[c]!==j[m]){var W=`
`+M[c].replace(" at new "," at ");return i.displayName&&W.includes("<anonymous>")&&(W=W.replace("<anonymous>",i.displayName)),W}while(1<=c&&0<=m);break}}}finally{Ea=!1,Error.prepareStackTrace=l}return(l=i?i.displayName||i.name:"")?pi(l):""}function me(i,n){switch(i.tag){case 26:case 27:case 5:return pi(i.type);case 16:return pi("Lazy");case 13:return i.child!==n&&n!==null?pi("Suspense Fallback"):pi("Suspense");case 19:return pi("SuspenseList");case 0:case 15:return It(i.type,!1);case 11:return It(i.type.render,!1);case 1:return It(i.type,!0);case 31:return pi("Activity");default:return""}}function Ce(i){try{var n="",l=null;do n+=me(i,l),l=i,i=i.return;while(i);return n}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}var yi=Object.prototype.hasOwnProperty,ke=u.unstable_scheduleCallback,bi=u.unstable_cancelCallback,Ui=u.unstable_shouldYield,Sa=u.unstable_requestPaint,pe=u.unstable_now,Ta=u.unstable_getCurrentPriorityLevel,as=u.unstable_ImmediatePriority,cr=u.unstable_UserBlockingPriority,fn=u.unstable_NormalPriority,xa=u.unstable_LowPriority,fr=u.unstable_IdlePriority,Fs=u.log,dv=u.unstable_setDisableYieldValue,dr=null,ze=null;function ls(i){if(typeof Fs=="function"&&dv(i),ze&&typeof ze.setStrictMode=="function")try{ze.setStrictMode(dr,i)}catch{}}var Ke=Math.clz32?Math.clz32:mv,hv=Math.log,gv=Math.LN2;function mv(i){return i>>>=0,i===0?32:31-(hv(i)/gv|0)|0}var Aa=256,ba=262144,La=4194304;function $s(i){var n=i&42;if(n!==0)return n;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return i&261888;case 262144:case 524288:case 1048576:case 2097152:return i&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function Ra(i,n,l){var c=i.pendingLanes;if(c===0)return 0;var m=0,y=i.suspendedLanes,T=i.pingedLanes;i=i.warmLanes;var R=c&134217727;return R!==0?(c=R&~y,c!==0?m=$s(c):(T&=R,T!==0?m=$s(T):l||(l=R&~i,l!==0&&(m=$s(l))))):(R=c&~y,R!==0?m=$s(R):T!==0?m=$s(T):l||(l=c&~i,l!==0&&(m=$s(l)))),m===0?0:n!==0&&n!==m&&(n&y)===0&&(y=m&-m,l=n&-n,y>=l||y===32&&(l&4194048)!==0)?n:m}function hr(i,n){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&n)===0}function pv(i,n){switch(i){case 1:case 2:case 4:case 8:case 64:return n+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function sd(){var i=La;return La<<=1,(La&62914560)===0&&(La=4194304),i}function bo(i){for(var n=[],l=0;31>l;l++)n.push(i);return n}function gr(i,n){i.pendingLanes|=n,n!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function yv(i,n,l,c,m,y){var T=i.pendingLanes;i.pendingLanes=l,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=l,i.entangledLanes&=l,i.errorRecoveryDisabledLanes&=l,i.shellSuspendCounter=0;var R=i.entanglements,M=i.expirationTimes,j=i.hiddenUpdates;for(l=T&~l;0<l;){var W=31-Ke(l),et=1<<W;R[W]=0,M[W]=-1;var Y=j[W];if(Y!==null)for(j[W]=null,W=0;W<Y.length;W++){var q=Y[W];q!==null&&(q.lane&=-536870913)}l&=~et}c!==0&&nd(i,c,0),y!==0&&m===0&&i.tag!==0&&(i.suspendedLanes|=y&~(T&~n))}function nd(i,n,l){i.pendingLanes|=n,i.suspendedLanes&=~n;var c=31-Ke(n);i.entangledLanes|=n,i.entanglements[c]=i.entanglements[c]|1073741824|l&261930}function rd(i,n){var l=i.entangledLanes|=n;for(i=i.entanglements;l;){var c=31-Ke(l),m=1<<c;m&n|i[c]&n&&(i[c]|=n),l&=~m}}function ad(i,n){var l=n&-n;return l=(l&42)!==0?1:Lo(l),(l&(i.suspendedLanes|n))!==0?0:l}function Lo(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function Ro(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function ld(){var i=X.p;return i!==0?i:(i=window.event,i===void 0?32:Vg(i.type))}function od(i,n){var l=X.p;try{return X.p=i,n()}finally{X.p=l}}var os=Math.random().toString(36).slice(2),Se="__reactFiber$"+os,we="__reactProps$"+os,dn="__reactContainer$"+os,_o="__reactEvents$"+os,vv="__reactListeners$"+os,Ev="__reactHandles$"+os,ud="__reactResources$"+os,mr="__reactMarker$"+os;function Do(i){delete i[Se],delete i[we],delete i[_o],delete i[vv],delete i[Ev]}function hn(i){var n=i[Se];if(n)return n;for(var l=i.parentNode;l;){if(n=l[dn]||l[Se]){if(l=n.alternate,n.child!==null||l!==null&&l.child!==null)for(i=Cg(i);i!==null;){if(l=i[Se])return l;i=Cg(i)}return n}i=l,l=i.parentNode}return null}function gn(i){if(i=i[Se]||i[dn]){var n=i.tag;if(n===5||n===6||n===13||n===31||n===26||n===27||n===3)return i}return null}function pr(i){var n=i.tag;if(n===5||n===26||n===27||n===6)return i.stateNode;throw Error(s(33))}function mn(i){var n=i[ud];return n||(n=i[ud]={hoistableStyles:new Map,hoistableScripts:new Map}),n}function ye(i){i[mr]=!0}var cd=new Set,fd={};function Gs(i,n){pn(i,n),pn(i+"Capture",n)}function pn(i,n){for(fd[i]=n,i=0;i<n.length;i++)cd.add(n[i])}var Sv=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),dd={},hd={};function Tv(i){return yi.call(hd,i)?!0:yi.call(dd,i)?!1:Sv.test(i)?hd[i]=!0:(dd[i]=!0,!1)}function _a(i,n,l){if(Tv(n))if(l===null)i.removeAttribute(n);else{switch(typeof l){case"undefined":case"function":case"symbol":i.removeAttribute(n);return;case"boolean":var c=n.toLowerCase().slice(0,5);if(c!=="data-"&&c!=="aria-"){i.removeAttribute(n);return}}i.setAttribute(n,""+l)}}function Da(i,n,l){if(l===null)i.removeAttribute(n);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(n);return}i.setAttribute(n,""+l)}}function Bi(i,n,l,c){if(c===null)i.removeAttribute(l);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(l);return}i.setAttributeNS(n,l,""+c)}}function ni(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function gd(i){var n=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function xv(i,n,l){var c=Object.getOwnPropertyDescriptor(i.constructor.prototype,n);if(!i.hasOwnProperty(n)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var m=c.get,y=c.set;return Object.defineProperty(i,n,{configurable:!0,get:function(){return m.call(this)},set:function(T){l=""+T,y.call(this,T)}}),Object.defineProperty(i,n,{enumerable:c.enumerable}),{getValue:function(){return l},setValue:function(T){l=""+T},stopTracking:function(){i._valueTracker=null,delete i[n]}}}}function Io(i){if(!i._valueTracker){var n=gd(i)?"checked":"value";i._valueTracker=xv(i,n,""+i[n])}}function md(i){if(!i)return!1;var n=i._valueTracker;if(!n)return!0;var l=n.getValue(),c="";return i&&(c=gd(i)?i.checked?"true":"false":i.value),i=c,i!==l?(n.setValue(i),!0):!1}function Ia(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var Av=/[\n"\\]/g;function ri(i){return i.replace(Av,function(n){return"\\"+n.charCodeAt(0).toString(16)+" "})}function Co(i,n,l,c,m,y,T,R){i.name="",T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"?i.type=T:i.removeAttribute("type"),n!=null?T==="number"?(n===0&&i.value===""||i.value!=n)&&(i.value=""+ni(n)):i.value!==""+ni(n)&&(i.value=""+ni(n)):T!=="submit"&&T!=="reset"||i.removeAttribute("value"),n!=null?ko(i,T,ni(n)):l!=null?ko(i,T,ni(l)):c!=null&&i.removeAttribute("value"),m==null&&y!=null&&(i.defaultChecked=!!y),m!=null&&(i.checked=m&&typeof m!="function"&&typeof m!="symbol"),R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"?i.name=""+ni(R):i.removeAttribute("name")}function pd(i,n,l,c,m,y,T,R){if(y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(i.type=y),n!=null||l!=null){if(!(y!=="submit"&&y!=="reset"||n!=null)){Io(i);return}l=l!=null?""+ni(l):"",n=n!=null?""+ni(n):l,R||n===i.value||(i.value=n),i.defaultValue=n}c=c??m,c=typeof c!="function"&&typeof c!="symbol"&&!!c,i.checked=R?i.checked:!!c,i.defaultChecked=!!c,T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"&&(i.name=T),Io(i)}function ko(i,n,l){n==="number"&&Ia(i.ownerDocument)===i||i.defaultValue===""+l||(i.defaultValue=""+l)}function yn(i,n,l,c){if(i=i.options,n){n={};for(var m=0;m<l.length;m++)n["$"+l[m]]=!0;for(l=0;l<i.length;l++)m=n.hasOwnProperty("$"+i[l].value),i[l].selected!==m&&(i[l].selected=m),m&&c&&(i[l].defaultSelected=!0)}else{for(l=""+ni(l),n=null,m=0;m<i.length;m++){if(i[m].value===l){i[m].selected=!0,c&&(i[m].defaultSelected=!0);return}n!==null||i[m].disabled||(n=i[m])}n!==null&&(n.selected=!0)}}function yd(i,n,l){if(n!=null&&(n=""+ni(n),n!==i.value&&(i.value=n),l==null)){i.defaultValue!==n&&(i.defaultValue=n);return}i.defaultValue=l!=null?""+ni(l):""}function vd(i,n,l,c){if(n==null){if(c!=null){if(l!=null)throw Error(s(92));if(lt(c)){if(1<c.length)throw Error(s(93));c=c[0]}l=c}l==null&&(l=""),n=l}l=ni(n),i.defaultValue=l,c=i.textContent,c===l&&c!==""&&c!==null&&(i.value=c),Io(i)}function vn(i,n){if(n){var l=i.firstChild;if(l&&l===i.lastChild&&l.nodeType===3){l.nodeValue=n;return}}i.textContent=n}var bv=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ed(i,n,l){var c=n.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?c?i.setProperty(n,""):n==="float"?i.cssFloat="":i[n]="":c?i.setProperty(n,l):typeof l!="number"||l===0||bv.has(n)?n==="float"?i.cssFloat=l:i[n]=(""+l).trim():i[n]=l+"px"}function Sd(i,n,l){if(n!=null&&typeof n!="object")throw Error(s(62));if(i=i.style,l!=null){for(var c in l)!l.hasOwnProperty(c)||n!=null&&n.hasOwnProperty(c)||(c.indexOf("--")===0?i.setProperty(c,""):c==="float"?i.cssFloat="":i[c]="");for(var m in n)c=n[m],n.hasOwnProperty(m)&&l[m]!==c&&Ed(i,m,c)}else for(var y in n)n.hasOwnProperty(y)&&Ed(i,y,n[y])}function Oo(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Lv=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Rv=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ca(i){return Rv.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}function Fi(){}var Mo=null;function wo(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var En=null,Sn=null;function Td(i){var n=gn(i);if(n&&(i=n.stateNode)){var l=i[we]||null;t:switch(i=n.stateNode,n.type){case"input":if(Co(i,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),n=l.name,l.type==="radio"&&n!=null){for(l=i;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+ri(""+n)+'"][type="radio"]'),n=0;n<l.length;n++){var c=l[n];if(c!==i&&c.form===i.form){var m=c[we]||null;if(!m)throw Error(s(90));Co(c,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name)}}for(n=0;n<l.length;n++)c=l[n],c.form===i.form&&md(c)}break t;case"textarea":yd(i,l.value,l.defaultValue);break t;case"select":n=l.value,n!=null&&yn(i,!!l.multiple,n,!1)}}}var No=!1;function xd(i,n,l){if(No)return i(n,l);No=!0;try{var c=i(n);return c}finally{if(No=!1,(En!==null||Sn!==null)&&(yl(),En&&(n=En,i=Sn,Sn=En=null,Td(n),i)))for(n=0;n<i.length;n++)Td(i[n])}}function yr(i,n){var l=i.stateNode;if(l===null)return null;var c=l[we]||null;if(c===null)return null;l=c[n];t:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(i=i.type,c=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!c;break t;default:i=!1}if(i)return null;if(l&&typeof l!="function")throw Error(s(231,n,typeof l));return l}var $i=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Po=!1;if($i)try{var vr={};Object.defineProperty(vr,"passive",{get:function(){Po=!0}}),window.addEventListener("test",vr,vr),window.removeEventListener("test",vr,vr)}catch{Po=!1}var us=null,Uo=null,ka=null;function Ad(){if(ka)return ka;var i,n=Uo,l=n.length,c,m="value"in us?us.value:us.textContent,y=m.length;for(i=0;i<l&&n[i]===m[i];i++);var T=l-i;for(c=1;c<=T&&n[l-c]===m[y-c];c++);return ka=m.slice(i,1<c?1-c:void 0)}function Oa(i){var n=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&n===13&&(i=13)):i=n,i===10&&(i=13),32<=i||i===13?i:0}function Ma(){return!0}function bd(){return!1}function Ne(i){function n(l,c,m,y,T){this._reactName=l,this._targetInst=m,this.type=c,this.nativeEvent=y,this.target=T,this.currentTarget=null;for(var R in i)i.hasOwnProperty(R)&&(l=i[R],this[R]=l?l(y):y[R]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?Ma:bd,this.isPropagationStopped=bd,this}return p(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Ma)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Ma)},persist:function(){},isPersistent:Ma}),n}var Hs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},wa=Ne(Hs),Er=p({},Hs,{view:0,detail:0}),_v=Ne(Er),Bo,Fo,Sr,Na=p({},Er,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Go,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==Sr&&(Sr&&i.type==="mousemove"?(Bo=i.screenX-Sr.screenX,Fo=i.screenY-Sr.screenY):Fo=Bo=0,Sr=i),Bo)},movementY:function(i){return"movementY"in i?i.movementY:Fo}}),Ld=Ne(Na),Dv=p({},Na,{dataTransfer:0}),Iv=Ne(Dv),Cv=p({},Er,{relatedTarget:0}),$o=Ne(Cv),kv=p({},Hs,{animationName:0,elapsedTime:0,pseudoElement:0}),Ov=Ne(kv),Mv=p({},Hs,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),wv=Ne(Mv),Nv=p({},Hs,{data:0}),Rd=Ne(Nv),Pv={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Uv={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Bv={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Fv(i){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(i):(i=Bv[i])?!!n[i]:!1}function Go(){return Fv}var $v=p({},Er,{key:function(i){if(i.key){var n=Pv[i.key]||i.key;if(n!=="Unidentified")return n}return i.type==="keypress"?(i=Oa(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?Uv[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Go,charCode:function(i){return i.type==="keypress"?Oa(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Oa(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),Gv=Ne($v),Hv=p({},Na,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),_d=Ne(Hv),zv=p({},Er,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Go}),Kv=Ne(zv),jv=p({},Hs,{propertyName:0,elapsedTime:0,pseudoElement:0}),Vv=Ne(jv),Yv=p({},Na,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),qv=Ne(Yv),Xv=p({},Hs,{newState:0,oldState:0}),Qv=Ne(Xv),Wv=[9,13,27,32],Ho=$i&&"CompositionEvent"in window,Tr=null;$i&&"documentMode"in document&&(Tr=document.documentMode);var Zv=$i&&"TextEvent"in window&&!Tr,Dd=$i&&(!Ho||Tr&&8<Tr&&11>=Tr),Id=" ",Cd=!1;function kd(i,n){switch(i){case"keyup":return Wv.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Od(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Tn=!1;function Jv(i,n){switch(i){case"compositionend":return Od(n);case"keypress":return n.which!==32?null:(Cd=!0,Id);case"textInput":return i=n.data,i===Id&&Cd?null:i;default:return null}}function tE(i,n){if(Tn)return i==="compositionend"||!Ho&&kd(i,n)?(i=Ad(),ka=Uo=us=null,Tn=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return Dd&&n.locale!=="ko"?null:n.data;default:return null}}var eE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Md(i){var n=i&&i.nodeName&&i.nodeName.toLowerCase();return n==="input"?!!eE[i.type]:n==="textarea"}function wd(i,n,l,c){En?Sn?Sn.push(c):Sn=[c]:En=c,n=bl(n,"onChange"),0<n.length&&(l=new wa("onChange","change",null,l,c),i.push({event:l,listeners:n}))}var xr=null,Ar=null;function iE(i){pg(i,0)}function Pa(i){var n=pr(i);if(md(n))return i}function Nd(i,n){if(i==="change")return n}var Pd=!1;if($i){var zo;if($i){var Ko="oninput"in document;if(!Ko){var Ud=document.createElement("div");Ud.setAttribute("oninput","return;"),Ko=typeof Ud.oninput=="function"}zo=Ko}else zo=!1;Pd=zo&&(!document.documentMode||9<document.documentMode)}function Bd(){xr&&(xr.detachEvent("onpropertychange",Fd),Ar=xr=null)}function Fd(i){if(i.propertyName==="value"&&Pa(Ar)){var n=[];wd(n,Ar,i,wo(i)),xd(iE,n)}}function sE(i,n,l){i==="focusin"?(Bd(),xr=n,Ar=l,xr.attachEvent("onpropertychange",Fd)):i==="focusout"&&Bd()}function nE(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Pa(Ar)}function rE(i,n){if(i==="click")return Pa(n)}function aE(i,n){if(i==="input"||i==="change")return Pa(n)}function lE(i,n){return i===n&&(i!==0||1/i===1/n)||i!==i&&n!==n}var je=typeof Object.is=="function"?Object.is:lE;function br(i,n){if(je(i,n))return!0;if(typeof i!="object"||i===null||typeof n!="object"||n===null)return!1;var l=Object.keys(i),c=Object.keys(n);if(l.length!==c.length)return!1;for(c=0;c<l.length;c++){var m=l[c];if(!yi.call(n,m)||!je(i[m],n[m]))return!1}return!0}function $d(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function Gd(i,n){var l=$d(i);i=0;for(var c;l;){if(l.nodeType===3){if(c=i+l.textContent.length,i<=n&&c>=n)return{node:l,offset:n-i};i=c}t:{for(;l;){if(l.nextSibling){l=l.nextSibling;break t}l=l.parentNode}l=void 0}l=$d(l)}}function Hd(i,n){return i&&n?i===n?!0:i&&i.nodeType===3?!1:n&&n.nodeType===3?Hd(i,n.parentNode):"contains"in i?i.contains(n):i.compareDocumentPosition?!!(i.compareDocumentPosition(n)&16):!1:!1}function zd(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var n=Ia(i.document);n instanceof i.HTMLIFrameElement;){try{var l=typeof n.contentWindow.location.href=="string"}catch{l=!1}if(l)i=n.contentWindow;else break;n=Ia(i.document)}return n}function jo(i){var n=i&&i.nodeName&&i.nodeName.toLowerCase();return n&&(n==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||n==="textarea"||i.contentEditable==="true")}var oE=$i&&"documentMode"in document&&11>=document.documentMode,xn=null,Vo=null,Lr=null,Yo=!1;function Kd(i,n,l){var c=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Yo||xn==null||xn!==Ia(c)||(c=xn,"selectionStart"in c&&jo(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),Lr&&br(Lr,c)||(Lr=c,c=bl(Vo,"onSelect"),0<c.length&&(n=new wa("onSelect","select",null,n,l),i.push({event:n,listeners:c}),n.target=xn)))}function zs(i,n){var l={};return l[i.toLowerCase()]=n.toLowerCase(),l["Webkit"+i]="webkit"+n,l["Moz"+i]="moz"+n,l}var An={animationend:zs("Animation","AnimationEnd"),animationiteration:zs("Animation","AnimationIteration"),animationstart:zs("Animation","AnimationStart"),transitionrun:zs("Transition","TransitionRun"),transitionstart:zs("Transition","TransitionStart"),transitioncancel:zs("Transition","TransitionCancel"),transitionend:zs("Transition","TransitionEnd")},qo={},jd={};$i&&(jd=document.createElement("div").style,"AnimationEvent"in window||(delete An.animationend.animation,delete An.animationiteration.animation,delete An.animationstart.animation),"TransitionEvent"in window||delete An.transitionend.transition);function Ks(i){if(qo[i])return qo[i];if(!An[i])return i;var n=An[i],l;for(l in n)if(n.hasOwnProperty(l)&&l in jd)return qo[i]=n[l];return i}var Vd=Ks("animationend"),Yd=Ks("animationiteration"),qd=Ks("animationstart"),uE=Ks("transitionrun"),cE=Ks("transitionstart"),fE=Ks("transitioncancel"),Xd=Ks("transitionend"),Qd=new Map,Xo="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Xo.push("scrollEnd");function vi(i,n){Qd.set(i,n),Gs(n,[i])}var Ua=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var n=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(n))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)},ai=[],bn=0,Qo=0;function Ba(){for(var i=bn,n=Qo=bn=0;n<i;){var l=ai[n];ai[n++]=null;var c=ai[n];ai[n++]=null;var m=ai[n];ai[n++]=null;var y=ai[n];if(ai[n++]=null,c!==null&&m!==null){var T=c.pending;T===null?m.next=m:(m.next=T.next,T.next=m),c.pending=m}y!==0&&Wd(l,m,y)}}function Fa(i,n,l,c){ai[bn++]=i,ai[bn++]=n,ai[bn++]=l,ai[bn++]=c,Qo|=c,i.lanes|=c,i=i.alternate,i!==null&&(i.lanes|=c)}function Wo(i,n,l,c){return Fa(i,n,l,c),$a(i)}function js(i,n){return Fa(i,null,null,n),$a(i)}function Wd(i,n,l){i.lanes|=l;var c=i.alternate;c!==null&&(c.lanes|=l);for(var m=!1,y=i.return;y!==null;)y.childLanes|=l,c=y.alternate,c!==null&&(c.childLanes|=l),y.tag===22&&(i=y.stateNode,i===null||i._visibility&1||(m=!0)),i=y,y=y.return;return i.tag===3?(y=i.stateNode,m&&n!==null&&(m=31-Ke(l),i=y.hiddenUpdates,c=i[m],c===null?i[m]=[n]:c.push(n),n.lane=l|536870912),y):null}function $a(i){if(50<Yr)throw Yr=0,ac=null,Error(s(185));for(var n=i.return;n!==null;)i=n,n=i.return;return i.tag===3?i.stateNode:null}var Ln={};function dE(i,n,l,c){this.tag=i,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ve(i,n,l,c){return new dE(i,n,l,c)}function Zo(i){return i=i.prototype,!(!i||!i.isReactComponent)}function Gi(i,n){var l=i.alternate;return l===null?(l=Ve(i.tag,n,i.key,i.mode),l.elementType=i.elementType,l.type=i.type,l.stateNode=i.stateNode,l.alternate=i,i.alternate=l):(l.pendingProps=n,l.type=i.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=i.flags&65011712,l.childLanes=i.childLanes,l.lanes=i.lanes,l.child=i.child,l.memoizedProps=i.memoizedProps,l.memoizedState=i.memoizedState,l.updateQueue=i.updateQueue,n=i.dependencies,l.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},l.sibling=i.sibling,l.index=i.index,l.ref=i.ref,l.refCleanup=i.refCleanup,l}function Zd(i,n){i.flags&=65011714;var l=i.alternate;return l===null?(i.childLanes=0,i.lanes=n,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=l.childLanes,i.lanes=l.lanes,i.child=l.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=l.memoizedProps,i.memoizedState=l.memoizedState,i.updateQueue=l.updateQueue,i.type=l.type,n=l.dependencies,i.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),i}function Ga(i,n,l,c,m,y){var T=0;if(c=i,typeof i=="function")Zo(i)&&(T=1);else if(typeof i=="string")T=yS(i,l,nt.current)?26:i==="html"||i==="head"||i==="body"?27:5;else t:switch(i){case G:return i=Ve(31,l,n,m),i.elementType=G,i.lanes=y,i;case A:return Vs(l.children,m,y,n);case b:T=8,m|=24;break;case L:return i=Ve(12,l,n,m|2),i.elementType=L,i.lanes=y,i;case w:return i=Ve(13,l,n,m),i.elementType=w,i.lanes=y,i;case V:return i=Ve(19,l,n,m),i.elementType=V,i.lanes=y,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case D:T=10;break t;case _:T=9;break t;case k:T=11;break t;case O:T=14;break t;case $:T=16,c=null;break t}T=29,l=Error(s(130,i===null?"null":typeof i,"")),c=null}return n=Ve(T,l,n,m),n.elementType=i,n.type=c,n.lanes=y,n}function Vs(i,n,l,c){return i=Ve(7,i,c,n),i.lanes=l,i}function Jo(i,n,l){return i=Ve(6,i,null,n),i.lanes=l,i}function Jd(i){var n=Ve(18,null,null,0);return n.stateNode=i,n}function tu(i,n,l){return n=Ve(4,i.children!==null?i.children:[],i.key,n),n.lanes=l,n.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},n}var th=new WeakMap;function li(i,n){if(typeof i=="object"&&i!==null){var l=th.get(i);return l!==void 0?l:(n={value:i,source:n,stack:Ce(n)},th.set(i,n),n)}return{value:i,source:n,stack:Ce(n)}}var Rn=[],_n=0,Ha=null,Rr=0,oi=[],ui=0,cs=null,Li=1,Ri="";function Hi(i,n){Rn[_n++]=Rr,Rn[_n++]=Ha,Ha=i,Rr=n}function eh(i,n,l){oi[ui++]=Li,oi[ui++]=Ri,oi[ui++]=cs,cs=i;var c=Li;i=Ri;var m=32-Ke(c)-1;c&=~(1<<m),l+=1;var y=32-Ke(n)+m;if(30<y){var T=m-m%5;y=(c&(1<<T)-1).toString(32),c>>=T,m-=T,Li=1<<32-Ke(n)+m|l<<m|c,Ri=y+i}else Li=1<<y|l<<m|c,Ri=i}function eu(i){i.return!==null&&(Hi(i,1),eh(i,1,0))}function iu(i){for(;i===Ha;)Ha=Rn[--_n],Rn[_n]=null,Rr=Rn[--_n],Rn[_n]=null;for(;i===cs;)cs=oi[--ui],oi[ui]=null,Ri=oi[--ui],oi[ui]=null,Li=oi[--ui],oi[ui]=null}function ih(i,n){oi[ui++]=Li,oi[ui++]=Ri,oi[ui++]=cs,Li=n.id,Ri=n.overflow,cs=i}var Te=null,Wt=null,Ot=!1,fs=null,ci=!1,su=Error(s(519));function ds(i){var n=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw _r(li(n,i)),su}function sh(i){var n=i.stateNode,l=i.type,c=i.memoizedProps;switch(n[Se]=i,n[we]=c,l){case"dialog":Dt("cancel",n),Dt("close",n);break;case"iframe":case"object":case"embed":Dt("load",n);break;case"video":case"audio":for(l=0;l<Xr.length;l++)Dt(Xr[l],n);break;case"source":Dt("error",n);break;case"img":case"image":case"link":Dt("error",n),Dt("load",n);break;case"details":Dt("toggle",n);break;case"input":Dt("invalid",n),pd(n,c.value,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name,!0);break;case"select":Dt("invalid",n);break;case"textarea":Dt("invalid",n),vd(n,c.value,c.defaultValue,c.children)}l=c.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||n.textContent===""+l||c.suppressHydrationWarning===!0||Sg(n.textContent,l)?(c.popover!=null&&(Dt("beforetoggle",n),Dt("toggle",n)),c.onScroll!=null&&Dt("scroll",n),c.onScrollEnd!=null&&Dt("scrollend",n),c.onClick!=null&&(n.onclick=Fi),n=!0):n=!1,n||ds(i,!0)}function nh(i){for(Te=i.return;Te;)switch(Te.tag){case 5:case 31:case 13:ci=!1;return;case 27:case 3:ci=!0;return;default:Te=Te.return}}function Dn(i){if(i!==Te)return!1;if(!Ot)return nh(i),Ot=!0,!1;var n=i.tag,l;if((l=n!==3&&n!==27)&&((l=n===5)&&(l=i.type,l=!(l!=="form"&&l!=="button")||Tc(i.type,i.memoizedProps)),l=!l),l&&Wt&&ds(i),nh(i),n===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(s(317));Wt=Ig(i)}else if(n===31){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(s(317));Wt=Ig(i)}else n===27?(n=Wt,Rs(i.type)?(i=Rc,Rc=null,Wt=i):Wt=n):Wt=Te?di(i.stateNode.nextSibling):null;return!0}function Ys(){Wt=Te=null,Ot=!1}function nu(){var i=fs;return i!==null&&(Fe===null?Fe=i:Fe.push.apply(Fe,i),fs=null),i}function _r(i){fs===null?fs=[i]:fs.push(i)}var ru=I(null),qs=null,zi=null;function hs(i,n,l){it(ru,n._currentValue),n._currentValue=l}function Ki(i){i._currentValue=ru.current,U(ru)}function au(i,n,l){for(;i!==null;){var c=i.alternate;if((i.childLanes&n)!==n?(i.childLanes|=n,c!==null&&(c.childLanes|=n)):c!==null&&(c.childLanes&n)!==n&&(c.childLanes|=n),i===l)break;i=i.return}}function lu(i,n,l,c){var m=i.child;for(m!==null&&(m.return=i);m!==null;){var y=m.dependencies;if(y!==null){var T=m.child;y=y.firstContext;t:for(;y!==null;){var R=y;y=m;for(var M=0;M<n.length;M++)if(R.context===n[M]){y.lanes|=l,R=y.alternate,R!==null&&(R.lanes|=l),au(y.return,l,i),c||(T=null);break t}y=R.next}}else if(m.tag===18){if(T=m.return,T===null)throw Error(s(341));T.lanes|=l,y=T.alternate,y!==null&&(y.lanes|=l),au(T,l,i),T=null}else T=m.child;if(T!==null)T.return=m;else for(T=m;T!==null;){if(T===i){T=null;break}if(m=T.sibling,m!==null){m.return=T.return,T=m;break}T=T.return}m=T}}function In(i,n,l,c){i=null;for(var m=n,y=!1;m!==null;){if(!y){if((m.flags&524288)!==0)y=!0;else if((m.flags&262144)!==0)break}if(m.tag===10){var T=m.alternate;if(T===null)throw Error(s(387));if(T=T.memoizedProps,T!==null){var R=m.type;je(m.pendingProps.value,T.value)||(i!==null?i.push(R):i=[R])}}else if(m===Et.current){if(T=m.alternate,T===null)throw Error(s(387));T.memoizedState.memoizedState!==m.memoizedState.memoizedState&&(i!==null?i.push(ta):i=[ta])}m=m.return}i!==null&&lu(n,i,l,c),n.flags|=262144}function za(i){for(i=i.firstContext;i!==null;){if(!je(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function Xs(i){qs=i,zi=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function xe(i){return rh(qs,i)}function Ka(i,n){return qs===null&&Xs(i),rh(i,n)}function rh(i,n){var l=n._currentValue;if(n={context:n,memoizedValue:l,next:null},zi===null){if(i===null)throw Error(s(308));zi=n,i.dependencies={lanes:0,firstContext:n},i.flags|=524288}else zi=zi.next=n;return l}var hE=typeof AbortController<"u"?AbortController:function(){var i=[],n=this.signal={aborted:!1,addEventListener:function(l,c){i.push(c)}};this.abort=function(){n.aborted=!0,i.forEach(function(l){return l()})}},gE=u.unstable_scheduleCallback,mE=u.unstable_NormalPriority,oe={$$typeof:D,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function ou(){return{controller:new hE,data:new Map,refCount:0}}function Dr(i){i.refCount--,i.refCount===0&&gE(mE,function(){i.controller.abort()})}var Ir=null,uu=0,Cn=0,kn=null;function pE(i,n){if(Ir===null){var l=Ir=[];uu=0,Cn=dc(),kn={status:"pending",value:void 0,then:function(c){l.push(c)}}}return uu++,n.then(ah,ah),n}function ah(){if(--uu===0&&Ir!==null){kn!==null&&(kn.status="fulfilled");var i=Ir;Ir=null,Cn=0,kn=null;for(var n=0;n<i.length;n++)(0,i[n])()}}function yE(i,n){var l=[],c={status:"pending",value:null,reason:null,then:function(m){l.push(m)}};return i.then(function(){c.status="fulfilled",c.value=n;for(var m=0;m<l.length;m++)(0,l[m])(n)},function(m){for(c.status="rejected",c.reason=m,m=0;m<l.length;m++)(0,l[m])(void 0)}),c}var lh=N.S;N.S=function(i,n){K0=pe(),typeof n=="object"&&n!==null&&typeof n.then=="function"&&pE(i,n),lh!==null&&lh(i,n)};var Qs=I(null);function cu(){var i=Qs.current;return i!==null?i:Yt.pooledCache}function ja(i,n){n===null?it(Qs,Qs.current):it(Qs,n.pool)}function oh(){var i=cu();return i===null?null:{parent:oe._currentValue,pool:i}}var On=Error(s(460)),fu=Error(s(474)),Va=Error(s(542)),Ya={then:function(){}};function uh(i){return i=i.status,i==="fulfilled"||i==="rejected"}function ch(i,n,l){switch(l=i[l],l===void 0?i.push(n):l!==n&&(n.then(Fi,Fi),n=l),n.status){case"fulfilled":return n.value;case"rejected":throw i=n.reason,dh(i),i;default:if(typeof n.status=="string")n.then(Fi,Fi);else{if(i=Yt,i!==null&&100<i.shellSuspendCounter)throw Error(s(482));i=n,i.status="pending",i.then(function(c){if(n.status==="pending"){var m=n;m.status="fulfilled",m.value=c}},function(c){if(n.status==="pending"){var m=n;m.status="rejected",m.reason=c}})}switch(n.status){case"fulfilled":return n.value;case"rejected":throw i=n.reason,dh(i),i}throw Zs=n,On}}function Ws(i){try{var n=i._init;return n(i._payload)}catch(l){throw l!==null&&typeof l=="object"&&typeof l.then=="function"?(Zs=l,On):l}}var Zs=null;function fh(){if(Zs===null)throw Error(s(459));var i=Zs;return Zs=null,i}function dh(i){if(i===On||i===Va)throw Error(s(483))}var Mn=null,Cr=0;function qa(i){var n=Cr;return Cr+=1,Mn===null&&(Mn=[]),ch(Mn,i,n)}function kr(i,n){n=n.props.ref,i.ref=n!==void 0?n:null}function Xa(i,n){throw n.$$typeof===v?Error(s(525)):(i=Object.prototype.toString.call(n),Error(s(31,i==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":i)))}function hh(i){function n(F,P){if(i){var K=F.deletions;K===null?(F.deletions=[P],F.flags|=16):K.push(P)}}function l(F,P){if(!i)return null;for(;P!==null;)n(F,P),P=P.sibling;return null}function c(F){for(var P=new Map;F!==null;)F.key!==null?P.set(F.key,F):P.set(F.index,F),F=F.sibling;return P}function m(F,P){return F=Gi(F,P),F.index=0,F.sibling=null,F}function y(F,P,K){return F.index=K,i?(K=F.alternate,K!==null?(K=K.index,K<P?(F.flags|=67108866,P):K):(F.flags|=67108866,P)):(F.flags|=1048576,P)}function T(F){return i&&F.alternate===null&&(F.flags|=67108866),F}function R(F,P,K,tt){return P===null||P.tag!==6?(P=Jo(K,F.mode,tt),P.return=F,P):(P=m(P,K),P.return=F,P)}function M(F,P,K,tt){var yt=K.type;return yt===A?W(F,P,K.props.children,tt,K.key):P!==null&&(P.elementType===yt||typeof yt=="object"&&yt!==null&&yt.$$typeof===$&&Ws(yt)===P.type)?(P=m(P,K.props),kr(P,K),P.return=F,P):(P=Ga(K.type,K.key,K.props,null,F.mode,tt),kr(P,K),P.return=F,P)}function j(F,P,K,tt){return P===null||P.tag!==4||P.stateNode.containerInfo!==K.containerInfo||P.stateNode.implementation!==K.implementation?(P=tu(K,F.mode,tt),P.return=F,P):(P=m(P,K.children||[]),P.return=F,P)}function W(F,P,K,tt,yt){return P===null||P.tag!==7?(P=Vs(K,F.mode,tt,yt),P.return=F,P):(P=m(P,K),P.return=F,P)}function et(F,P,K){if(typeof P=="string"&&P!==""||typeof P=="number"||typeof P=="bigint")return P=Jo(""+P,F.mode,K),P.return=F,P;if(typeof P=="object"&&P!==null){switch(P.$$typeof){case E:return K=Ga(P.type,P.key,P.props,null,F.mode,K),kr(K,P),K.return=F,K;case S:return P=tu(P,F.mode,K),P.return=F,P;case $:return P=Ws(P),et(F,P,K)}if(lt(P)||st(P))return P=Vs(P,F.mode,K,null),P.return=F,P;if(typeof P.then=="function")return et(F,qa(P),K);if(P.$$typeof===D)return et(F,Ka(F,P),K);Xa(F,P)}return null}function Y(F,P,K,tt){var yt=P!==null?P.key:null;if(typeof K=="string"&&K!==""||typeof K=="number"||typeof K=="bigint")return yt!==null?null:R(F,P,""+K,tt);if(typeof K=="object"&&K!==null){switch(K.$$typeof){case E:return K.key===yt?M(F,P,K,tt):null;case S:return K.key===yt?j(F,P,K,tt):null;case $:return K=Ws(K),Y(F,P,K,tt)}if(lt(K)||st(K))return yt!==null?null:W(F,P,K,tt,null);if(typeof K.then=="function")return Y(F,P,qa(K),tt);if(K.$$typeof===D)return Y(F,P,Ka(F,K),tt);Xa(F,K)}return null}function q(F,P,K,tt,yt){if(typeof tt=="string"&&tt!==""||typeof tt=="number"||typeof tt=="bigint")return F=F.get(K)||null,R(P,F,""+tt,yt);if(typeof tt=="object"&&tt!==null){switch(tt.$$typeof){case E:return F=F.get(tt.key===null?K:tt.key)||null,M(P,F,tt,yt);case S:return F=F.get(tt.key===null?K:tt.key)||null,j(P,F,tt,yt);case $:return tt=Ws(tt),q(F,P,K,tt,yt)}if(lt(tt)||st(tt))return F=F.get(K)||null,W(P,F,tt,yt,null);if(typeof tt.then=="function")return q(F,P,K,qa(tt),yt);if(tt.$$typeof===D)return q(F,P,K,Ka(P,tt),yt);Xa(P,tt)}return null}function gt(F,P,K,tt){for(var yt=null,Nt=null,mt=P,bt=P=0,kt=null;mt!==null&&bt<K.length;bt++){mt.index>bt?(kt=mt,mt=null):kt=mt.sibling;var Pt=Y(F,mt,K[bt],tt);if(Pt===null){mt===null&&(mt=kt);break}i&&mt&&Pt.alternate===null&&n(F,mt),P=y(Pt,P,bt),Nt===null?yt=Pt:Nt.sibling=Pt,Nt=Pt,mt=kt}if(bt===K.length)return l(F,mt),Ot&&Hi(F,bt),yt;if(mt===null){for(;bt<K.length;bt++)mt=et(F,K[bt],tt),mt!==null&&(P=y(mt,P,bt),Nt===null?yt=mt:Nt.sibling=mt,Nt=mt);return Ot&&Hi(F,bt),yt}for(mt=c(mt);bt<K.length;bt++)kt=q(mt,F,bt,K[bt],tt),kt!==null&&(i&&kt.alternate!==null&&mt.delete(kt.key===null?bt:kt.key),P=y(kt,P,bt),Nt===null?yt=kt:Nt.sibling=kt,Nt=kt);return i&&mt.forEach(function(ks){return n(F,ks)}),Ot&&Hi(F,bt),yt}function vt(F,P,K,tt){if(K==null)throw Error(s(151));for(var yt=null,Nt=null,mt=P,bt=P=0,kt=null,Pt=K.next();mt!==null&&!Pt.done;bt++,Pt=K.next()){mt.index>bt?(kt=mt,mt=null):kt=mt.sibling;var ks=Y(F,mt,Pt.value,tt);if(ks===null){mt===null&&(mt=kt);break}i&&mt&&ks.alternate===null&&n(F,mt),P=y(ks,P,bt),Nt===null?yt=ks:Nt.sibling=ks,Nt=ks,mt=kt}if(Pt.done)return l(F,mt),Ot&&Hi(F,bt),yt;if(mt===null){for(;!Pt.done;bt++,Pt=K.next())Pt=et(F,Pt.value,tt),Pt!==null&&(P=y(Pt,P,bt),Nt===null?yt=Pt:Nt.sibling=Pt,Nt=Pt);return Ot&&Hi(F,bt),yt}for(mt=c(mt);!Pt.done;bt++,Pt=K.next())Pt=q(mt,F,bt,Pt.value,tt),Pt!==null&&(i&&Pt.alternate!==null&&mt.delete(Pt.key===null?bt:Pt.key),P=y(Pt,P,bt),Nt===null?yt=Pt:Nt.sibling=Pt,Nt=Pt);return i&&mt.forEach(function(DS){return n(F,DS)}),Ot&&Hi(F,bt),yt}function Kt(F,P,K,tt){if(typeof K=="object"&&K!==null&&K.type===A&&K.key===null&&(K=K.props.children),typeof K=="object"&&K!==null){switch(K.$$typeof){case E:t:{for(var yt=K.key;P!==null;){if(P.key===yt){if(yt=K.type,yt===A){if(P.tag===7){l(F,P.sibling),tt=m(P,K.props.children),tt.return=F,F=tt;break t}}else if(P.elementType===yt||typeof yt=="object"&&yt!==null&&yt.$$typeof===$&&Ws(yt)===P.type){l(F,P.sibling),tt=m(P,K.props),kr(tt,K),tt.return=F,F=tt;break t}l(F,P);break}else n(F,P);P=P.sibling}K.type===A?(tt=Vs(K.props.children,F.mode,tt,K.key),tt.return=F,F=tt):(tt=Ga(K.type,K.key,K.props,null,F.mode,tt),kr(tt,K),tt.return=F,F=tt)}return T(F);case S:t:{for(yt=K.key;P!==null;){if(P.key===yt)if(P.tag===4&&P.stateNode.containerInfo===K.containerInfo&&P.stateNode.implementation===K.implementation){l(F,P.sibling),tt=m(P,K.children||[]),tt.return=F,F=tt;break t}else{l(F,P);break}else n(F,P);P=P.sibling}tt=tu(K,F.mode,tt),tt.return=F,F=tt}return T(F);case $:return K=Ws(K),Kt(F,P,K,tt)}if(lt(K))return gt(F,P,K,tt);if(st(K)){if(yt=st(K),typeof yt!="function")throw Error(s(150));return K=yt.call(K),vt(F,P,K,tt)}if(typeof K.then=="function")return Kt(F,P,qa(K),tt);if(K.$$typeof===D)return Kt(F,P,Ka(F,K),tt);Xa(F,K)}return typeof K=="string"&&K!==""||typeof K=="number"||typeof K=="bigint"?(K=""+K,P!==null&&P.tag===6?(l(F,P.sibling),tt=m(P,K),tt.return=F,F=tt):(l(F,P),tt=Jo(K,F.mode,tt),tt.return=F,F=tt),T(F)):l(F,P)}return function(F,P,K,tt){try{Cr=0;var yt=Kt(F,P,K,tt);return Mn=null,yt}catch(mt){if(mt===On||mt===Va)throw mt;var Nt=Ve(29,mt,null,F.mode);return Nt.lanes=tt,Nt.return=F,Nt}finally{}}}var Js=hh(!0),gh=hh(!1),gs=!1;function du(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function hu(i,n){i=i.updateQueue,n.updateQueue===i&&(n.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function ms(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function ps(i,n,l){var c=i.updateQueue;if(c===null)return null;if(c=c.shared,(Ut&2)!==0){var m=c.pending;return m===null?n.next=n:(n.next=m.next,m.next=n),c.pending=n,n=$a(i),Wd(i,null,l),n}return Fa(i,c,n,l),$a(i)}function Or(i,n,l){if(n=n.updateQueue,n!==null&&(n=n.shared,(l&4194048)!==0)){var c=n.lanes;c&=i.pendingLanes,l|=c,n.lanes=l,rd(i,l)}}function gu(i,n){var l=i.updateQueue,c=i.alternate;if(c!==null&&(c=c.updateQueue,l===c)){var m=null,y=null;if(l=l.firstBaseUpdate,l!==null){do{var T={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};y===null?m=y=T:y=y.next=T,l=l.next}while(l!==null);y===null?m=y=n:y=y.next=n}else m=y=n;l={baseState:c.baseState,firstBaseUpdate:m,lastBaseUpdate:y,shared:c.shared,callbacks:c.callbacks},i.updateQueue=l;return}i=l.lastBaseUpdate,i===null?l.firstBaseUpdate=n:i.next=n,l.lastBaseUpdate=n}var mu=!1;function Mr(){if(mu){var i=kn;if(i!==null)throw i}}function wr(i,n,l,c){mu=!1;var m=i.updateQueue;gs=!1;var y=m.firstBaseUpdate,T=m.lastBaseUpdate,R=m.shared.pending;if(R!==null){m.shared.pending=null;var M=R,j=M.next;M.next=null,T===null?y=j:T.next=j,T=M;var W=i.alternate;W!==null&&(W=W.updateQueue,R=W.lastBaseUpdate,R!==T&&(R===null?W.firstBaseUpdate=j:R.next=j,W.lastBaseUpdate=M))}if(y!==null){var et=m.baseState;T=0,W=j=M=null,R=y;do{var Y=R.lane&-536870913,q=Y!==R.lane;if(q?(Ct&Y)===Y:(c&Y)===Y){Y!==0&&Y===Cn&&(mu=!0),W!==null&&(W=W.next={lane:0,tag:R.tag,payload:R.payload,callback:null,next:null});t:{var gt=i,vt=R;Y=n;var Kt=l;switch(vt.tag){case 1:if(gt=vt.payload,typeof gt=="function"){et=gt.call(Kt,et,Y);break t}et=gt;break t;case 3:gt.flags=gt.flags&-65537|128;case 0:if(gt=vt.payload,Y=typeof gt=="function"?gt.call(Kt,et,Y):gt,Y==null)break t;et=p({},et,Y);break t;case 2:gs=!0}}Y=R.callback,Y!==null&&(i.flags|=64,q&&(i.flags|=8192),q=m.callbacks,q===null?m.callbacks=[Y]:q.push(Y))}else q={lane:Y,tag:R.tag,payload:R.payload,callback:R.callback,next:null},W===null?(j=W=q,M=et):W=W.next=q,T|=Y;if(R=R.next,R===null){if(R=m.shared.pending,R===null)break;q=R,R=q.next,q.next=null,m.lastBaseUpdate=q,m.shared.pending=null}}while(!0);W===null&&(M=et),m.baseState=M,m.firstBaseUpdate=j,m.lastBaseUpdate=W,y===null&&(m.shared.lanes=0),Ts|=T,i.lanes=T,i.memoizedState=et}}function mh(i,n){if(typeof i!="function")throw Error(s(191,i));i.call(n)}function ph(i,n){var l=i.callbacks;if(l!==null)for(i.callbacks=null,i=0;i<l.length;i++)mh(l[i],n)}var wn=I(null),Qa=I(0);function yh(i,n){i=Ji,it(Qa,i),it(wn,n),Ji=i|n.baseLanes}function pu(){it(Qa,Ji),it(wn,wn.current)}function yu(){Ji=Qa.current,U(wn),U(Qa)}var Ye=I(null),fi=null;function ys(i){var n=i.alternate;it(re,re.current&1),it(Ye,i),fi===null&&(n===null||wn.current!==null||n.memoizedState!==null)&&(fi=i)}function vu(i){it(re,re.current),it(Ye,i),fi===null&&(fi=i)}function vh(i){i.tag===22?(it(re,re.current),it(Ye,i),fi===null&&(fi=i)):vs()}function vs(){it(re,re.current),it(Ye,Ye.current)}function qe(i){U(Ye),fi===i&&(fi=null),U(re)}var re=I(0);function Wa(i){for(var n=i;n!==null;){if(n.tag===13){var l=n.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||bc(l)||Lc(l)))return n}else if(n.tag===19&&(n.memoizedProps.revealOrder==="forwards"||n.memoizedProps.revealOrder==="backwards"||n.memoizedProps.revealOrder==="unstable_legacy-backwards"||n.memoizedProps.revealOrder==="together")){if((n.flags&128)!==0)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===i)break;for(;n.sibling===null;){if(n.return===null||n.return===i)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var ji=0,At=null,Ht=null,ue=null,Za=!1,Nn=!1,tn=!1,Ja=0,Nr=0,Pn=null,vE=0;function ie(){throw Error(s(321))}function Eu(i,n){if(n===null)return!1;for(var l=0;l<n.length&&l<i.length;l++)if(!je(i[l],n[l]))return!1;return!0}function Su(i,n,l,c,m,y){return ji=y,At=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,N.H=i===null||i.memoizedState===null?e0:Nu,tn=!1,y=l(c,m),tn=!1,Nn&&(y=Sh(n,l,c,m)),Eh(i),y}function Eh(i){N.H=Br;var n=Ht!==null&&Ht.next!==null;if(ji=0,ue=Ht=At=null,Za=!1,Nr=0,Pn=null,n)throw Error(s(300));i===null||ce||(i=i.dependencies,i!==null&&za(i)&&(ce=!0))}function Sh(i,n,l,c){At=i;var m=0;do{if(Nn&&(Pn=null),Nr=0,Nn=!1,25<=m)throw Error(s(301));if(m+=1,ue=Ht=null,i.updateQueue!=null){var y=i.updateQueue;y.lastEffect=null,y.events=null,y.stores=null,y.memoCache!=null&&(y.memoCache.index=0)}N.H=i0,y=n(l,c)}while(Nn);return y}function EE(){var i=N.H,n=i.useState()[0];return n=typeof n.then=="function"?Pr(n):n,i=i.useState()[0],(Ht!==null?Ht.memoizedState:null)!==i&&(At.flags|=1024),n}function Tu(){var i=Ja!==0;return Ja=0,i}function xu(i,n,l){n.updateQueue=i.updateQueue,n.flags&=-2053,i.lanes&=~l}function Au(i){if(Za){for(i=i.memoizedState;i!==null;){var n=i.queue;n!==null&&(n.pending=null),i=i.next}Za=!1}ji=0,ue=Ht=At=null,Nn=!1,Nr=Ja=0,Pn=null}function Oe(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ue===null?At.memoizedState=ue=i:ue=ue.next=i,ue}function ae(){if(Ht===null){var i=At.alternate;i=i!==null?i.memoizedState:null}else i=Ht.next;var n=ue===null?At.memoizedState:ue.next;if(n!==null)ue=n,Ht=i;else{if(i===null)throw At.alternate===null?Error(s(467)):Error(s(310));Ht=i,i={memoizedState:Ht.memoizedState,baseState:Ht.baseState,baseQueue:Ht.baseQueue,queue:Ht.queue,next:null},ue===null?At.memoizedState=ue=i:ue=ue.next=i}return ue}function tl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Pr(i){var n=Nr;return Nr+=1,Pn===null&&(Pn=[]),i=ch(Pn,i,n),n=At,(ue===null?n.memoizedState:ue.next)===null&&(n=n.alternate,N.H=n===null||n.memoizedState===null?e0:Nu),i}function el(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return Pr(i);if(i.$$typeof===D)return xe(i)}throw Error(s(438,String(i)))}function bu(i){var n=null,l=At.updateQueue;if(l!==null&&(n=l.memoCache),n==null){var c=At.alternate;c!==null&&(c=c.updateQueue,c!==null&&(c=c.memoCache,c!=null&&(n={data:c.data.map(function(m){return m.slice()}),index:0})))}if(n==null&&(n={data:[],index:0}),l===null&&(l=tl(),At.updateQueue=l),l.memoCache=n,l=n.data[n.index],l===void 0)for(l=n.data[n.index]=Array(i),c=0;c<i;c++)l[c]=B;return n.index++,l}function Vi(i,n){return typeof n=="function"?n(i):n}function il(i){var n=ae();return Lu(n,Ht,i)}function Lu(i,n,l){var c=i.queue;if(c===null)throw Error(s(311));c.lastRenderedReducer=l;var m=i.baseQueue,y=c.pending;if(y!==null){if(m!==null){var T=m.next;m.next=y.next,y.next=T}n.baseQueue=m=y,c.pending=null}if(y=i.baseState,m===null)i.memoizedState=y;else{n=m.next;var R=T=null,M=null,j=n,W=!1;do{var et=j.lane&-536870913;if(et!==j.lane?(Ct&et)===et:(ji&et)===et){var Y=j.revertLane;if(Y===0)M!==null&&(M=M.next={lane:0,revertLane:0,gesture:null,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null}),et===Cn&&(W=!0);else if((ji&Y)===Y){j=j.next,Y===Cn&&(W=!0);continue}else et={lane:0,revertLane:j.revertLane,gesture:null,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null},M===null?(R=M=et,T=y):M=M.next=et,At.lanes|=Y,Ts|=Y;et=j.action,tn&&l(y,et),y=j.hasEagerState?j.eagerState:l(y,et)}else Y={lane:et,revertLane:j.revertLane,gesture:j.gesture,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null},M===null?(R=M=Y,T=y):M=M.next=Y,At.lanes|=et,Ts|=et;j=j.next}while(j!==null&&j!==n);if(M===null?T=y:M.next=R,!je(y,i.memoizedState)&&(ce=!0,W&&(l=kn,l!==null)))throw l;i.memoizedState=y,i.baseState=T,i.baseQueue=M,c.lastRenderedState=y}return m===null&&(c.lanes=0),[i.memoizedState,c.dispatch]}function Ru(i){var n=ae(),l=n.queue;if(l===null)throw Error(s(311));l.lastRenderedReducer=i;var c=l.dispatch,m=l.pending,y=n.memoizedState;if(m!==null){l.pending=null;var T=m=m.next;do y=i(y,T.action),T=T.next;while(T!==m);je(y,n.memoizedState)||(ce=!0),n.memoizedState=y,n.baseQueue===null&&(n.baseState=y),l.lastRenderedState=y}return[y,c]}function Th(i,n,l){var c=At,m=ae(),y=Ot;if(y){if(l===void 0)throw Error(s(407));l=l()}else l=n();var T=!je((Ht||m).memoizedState,l);if(T&&(m.memoizedState=l,ce=!0),m=m.queue,Iu(bh.bind(null,c,m,i),[i]),m.getSnapshot!==n||T||ue!==null&&ue.memoizedState.tag&1){if(c.flags|=2048,Un(9,{destroy:void 0},Ah.bind(null,c,m,l,n),null),Yt===null)throw Error(s(349));y||(ji&127)!==0||xh(c,n,l)}return l}function xh(i,n,l){i.flags|=16384,i={getSnapshot:n,value:l},n=At.updateQueue,n===null?(n=tl(),At.updateQueue=n,n.stores=[i]):(l=n.stores,l===null?n.stores=[i]:l.push(i))}function Ah(i,n,l,c){n.value=l,n.getSnapshot=c,Lh(n)&&Rh(i)}function bh(i,n,l){return l(function(){Lh(n)&&Rh(i)})}function Lh(i){var n=i.getSnapshot;i=i.value;try{var l=n();return!je(i,l)}catch{return!0}}function Rh(i){var n=js(i,2);n!==null&&$e(n,i,2)}function _u(i){var n=Oe();if(typeof i=="function"){var l=i;if(i=l(),tn){ls(!0);try{l()}finally{ls(!1)}}}return n.memoizedState=n.baseState=i,n.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Vi,lastRenderedState:i},n}function _h(i,n,l,c){return i.baseState=l,Lu(i,Ht,typeof c=="function"?c:Vi)}function SE(i,n,l,c,m){if(rl(i))throw Error(s(485));if(i=n.action,i!==null){var y={payload:m,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(T){y.listeners.push(T)}};N.T!==null?l(!0):y.isTransition=!1,c(y),l=n.pending,l===null?(y.next=n.pending=y,Dh(n,y)):(y.next=l.next,n.pending=l.next=y)}}function Dh(i,n){var l=n.action,c=n.payload,m=i.state;if(n.isTransition){var y=N.T,T={};N.T=T;try{var R=l(m,c),M=N.S;M!==null&&M(T,R),Ih(i,n,R)}catch(j){Du(i,n,j)}finally{y!==null&&T.types!==null&&(y.types=T.types),N.T=y}}else try{y=l(m,c),Ih(i,n,y)}catch(j){Du(i,n,j)}}function Ih(i,n,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(c){Ch(i,n,c)},function(c){return Du(i,n,c)}):Ch(i,n,l)}function Ch(i,n,l){n.status="fulfilled",n.value=l,kh(n),i.state=l,n=i.pending,n!==null&&(l=n.next,l===n?i.pending=null:(l=l.next,n.next=l,Dh(i,l)))}function Du(i,n,l){var c=i.pending;if(i.pending=null,c!==null){c=c.next;do n.status="rejected",n.reason=l,kh(n),n=n.next;while(n!==c)}i.action=null}function kh(i){i=i.listeners;for(var n=0;n<i.length;n++)(0,i[n])()}function Oh(i,n){return n}function Mh(i,n){if(Ot){var l=Yt.formState;if(l!==null){t:{var c=At;if(Ot){if(Wt){e:{for(var m=Wt,y=ci;m.nodeType!==8;){if(!y){m=null;break e}if(m=di(m.nextSibling),m===null){m=null;break e}}y=m.data,m=y==="F!"||y==="F"?m:null}if(m){Wt=di(m.nextSibling),c=m.data==="F!";break t}}ds(c)}c=!1}c&&(n=l[0])}}return l=Oe(),l.memoizedState=l.baseState=n,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Oh,lastRenderedState:n},l.queue=c,l=Zh.bind(null,At,c),c.dispatch=l,c=_u(!1),y=wu.bind(null,At,!1,c.queue),c=Oe(),m={state:n,dispatch:null,action:i,pending:null},c.queue=m,l=SE.bind(null,At,m,y,l),m.dispatch=l,c.memoizedState=i,[n,l,!1]}function wh(i){var n=ae();return Nh(n,Ht,i)}function Nh(i,n,l){if(n=Lu(i,n,Oh)[0],i=il(Vi)[0],typeof n=="object"&&n!==null&&typeof n.then=="function")try{var c=Pr(n)}catch(T){throw T===On?Va:T}else c=n;n=ae();var m=n.queue,y=m.dispatch;return l!==n.memoizedState&&(At.flags|=2048,Un(9,{destroy:void 0},TE.bind(null,m,l),null)),[c,y,i]}function TE(i,n){i.action=n}function Ph(i){var n=ae(),l=Ht;if(l!==null)return Nh(n,l,i);ae(),n=n.memoizedState,l=ae();var c=l.queue.dispatch;return l.memoizedState=i,[n,c,!1]}function Un(i,n,l,c){return i={tag:i,create:l,deps:c,inst:n,next:null},n=At.updateQueue,n===null&&(n=tl(),At.updateQueue=n),l=n.lastEffect,l===null?n.lastEffect=i.next=i:(c=l.next,l.next=i,i.next=c,n.lastEffect=i),i}function Uh(){return ae().memoizedState}function sl(i,n,l,c){var m=Oe();At.flags|=i,m.memoizedState=Un(1|n,{destroy:void 0},l,c===void 0?null:c)}function nl(i,n,l,c){var m=ae();c=c===void 0?null:c;var y=m.memoizedState.inst;Ht!==null&&c!==null&&Eu(c,Ht.memoizedState.deps)?m.memoizedState=Un(n,y,l,c):(At.flags|=i,m.memoizedState=Un(1|n,y,l,c))}function Bh(i,n){sl(8390656,8,i,n)}function Iu(i,n){nl(2048,8,i,n)}function xE(i){At.flags|=4;var n=At.updateQueue;if(n===null)n=tl(),At.updateQueue=n,n.events=[i];else{var l=n.events;l===null?n.events=[i]:l.push(i)}}function Fh(i){var n=ae().memoizedState;return xE({ref:n,nextImpl:i}),function(){if((Ut&2)!==0)throw Error(s(440));return n.impl.apply(void 0,arguments)}}function $h(i,n){return nl(4,2,i,n)}function Gh(i,n){return nl(4,4,i,n)}function Hh(i,n){if(typeof n=="function"){i=i();var l=n(i);return function(){typeof l=="function"?l():n(null)}}if(n!=null)return i=i(),n.current=i,function(){n.current=null}}function zh(i,n,l){l=l!=null?l.concat([i]):null,nl(4,4,Hh.bind(null,n,i),l)}function Cu(){}function Kh(i,n){var l=ae();n=n===void 0?null:n;var c=l.memoizedState;return n!==null&&Eu(n,c[1])?c[0]:(l.memoizedState=[i,n],i)}function jh(i,n){var l=ae();n=n===void 0?null:n;var c=l.memoizedState;if(n!==null&&Eu(n,c[1]))return c[0];if(c=i(),tn){ls(!0);try{i()}finally{ls(!1)}}return l.memoizedState=[c,n],c}function ku(i,n,l){return l===void 0||(ji&1073741824)!==0&&(Ct&261930)===0?i.memoizedState=n:(i.memoizedState=l,i=V0(),At.lanes|=i,Ts|=i,l)}function Vh(i,n,l,c){return je(l,n)?l:wn.current!==null?(i=ku(i,l,c),je(i,n)||(ce=!0),i):(ji&42)===0||(ji&1073741824)!==0&&(Ct&261930)===0?(ce=!0,i.memoizedState=l):(i=V0(),At.lanes|=i,Ts|=i,n)}function Yh(i,n,l,c,m){var y=X.p;X.p=y!==0&&8>y?y:8;var T=N.T,R={};N.T=R,wu(i,!1,n,l);try{var M=m(),j=N.S;if(j!==null&&j(R,M),M!==null&&typeof M=="object"&&typeof M.then=="function"){var W=yE(M,c);Ur(i,n,W,We(i))}else Ur(i,n,c,We(i))}catch(et){Ur(i,n,{then:function(){},status:"rejected",reason:et},We())}finally{X.p=y,T!==null&&R.types!==null&&(T.types=R.types),N.T=T}}function AE(){}function Ou(i,n,l,c){if(i.tag!==5)throw Error(s(476));var m=qh(i).queue;Yh(i,m,n,Z,l===null?AE:function(){return Xh(i),l(c)})}function qh(i){var n=i.memoizedState;if(n!==null)return n;n={memoizedState:Z,baseState:Z,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Vi,lastRenderedState:Z},next:null};var l={};return n.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Vi,lastRenderedState:l},next:null},i.memoizedState=n,i=i.alternate,i!==null&&(i.memoizedState=n),n}function Xh(i){var n=qh(i);n.next===null&&(n=i.alternate.memoizedState),Ur(i,n.next.queue,{},We())}function Mu(){return xe(ta)}function Qh(){return ae().memoizedState}function Wh(){return ae().memoizedState}function bE(i){for(var n=i.return;n!==null;){switch(n.tag){case 24:case 3:var l=We();i=ms(l);var c=ps(n,i,l);c!==null&&($e(c,n,l),Or(c,n,l)),n={cache:ou()},i.payload=n;return}n=n.return}}function LE(i,n,l){var c=We();l={lane:c,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},rl(i)?Jh(n,l):(l=Wo(i,n,l,c),l!==null&&($e(l,i,c),t0(l,n,c)))}function Zh(i,n,l){var c=We();Ur(i,n,l,c)}function Ur(i,n,l,c){var m={lane:c,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null};if(rl(i))Jh(n,m);else{var y=i.alternate;if(i.lanes===0&&(y===null||y.lanes===0)&&(y=n.lastRenderedReducer,y!==null))try{var T=n.lastRenderedState,R=y(T,l);if(m.hasEagerState=!0,m.eagerState=R,je(R,T))return Fa(i,n,m,0),Yt===null&&Ba(),!1}catch{}finally{}if(l=Wo(i,n,m,c),l!==null)return $e(l,i,c),t0(l,n,c),!0}return!1}function wu(i,n,l,c){if(c={lane:2,revertLane:dc(),gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},rl(i)){if(n)throw Error(s(479))}else n=Wo(i,l,c,2),n!==null&&$e(n,i,2)}function rl(i){var n=i.alternate;return i===At||n!==null&&n===At}function Jh(i,n){Nn=Za=!0;var l=i.pending;l===null?n.next=n:(n.next=l.next,l.next=n),i.pending=n}function t0(i,n,l){if((l&4194048)!==0){var c=n.lanes;c&=i.pendingLanes,l|=c,n.lanes=l,rd(i,l)}}var Br={readContext:xe,use:el,useCallback:ie,useContext:ie,useEffect:ie,useImperativeHandle:ie,useLayoutEffect:ie,useInsertionEffect:ie,useMemo:ie,useReducer:ie,useRef:ie,useState:ie,useDebugValue:ie,useDeferredValue:ie,useTransition:ie,useSyncExternalStore:ie,useId:ie,useHostTransitionStatus:ie,useFormState:ie,useActionState:ie,useOptimistic:ie,useMemoCache:ie,useCacheRefresh:ie};Br.useEffectEvent=ie;var e0={readContext:xe,use:el,useCallback:function(i,n){return Oe().memoizedState=[i,n===void 0?null:n],i},useContext:xe,useEffect:Bh,useImperativeHandle:function(i,n,l){l=l!=null?l.concat([i]):null,sl(4194308,4,Hh.bind(null,n,i),l)},useLayoutEffect:function(i,n){return sl(4194308,4,i,n)},useInsertionEffect:function(i,n){sl(4,2,i,n)},useMemo:function(i,n){var l=Oe();n=n===void 0?null:n;var c=i();if(tn){ls(!0);try{i()}finally{ls(!1)}}return l.memoizedState=[c,n],c},useReducer:function(i,n,l){var c=Oe();if(l!==void 0){var m=l(n);if(tn){ls(!0);try{l(n)}finally{ls(!1)}}}else m=n;return c.memoizedState=c.baseState=m,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:m},c.queue=i,i=i.dispatch=LE.bind(null,At,i),[c.memoizedState,i]},useRef:function(i){var n=Oe();return i={current:i},n.memoizedState=i},useState:function(i){i=_u(i);var n=i.queue,l=Zh.bind(null,At,n);return n.dispatch=l,[i.memoizedState,l]},useDebugValue:Cu,useDeferredValue:function(i,n){var l=Oe();return ku(l,i,n)},useTransition:function(){var i=_u(!1);return i=Yh.bind(null,At,i.queue,!0,!1),Oe().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,n,l){var c=At,m=Oe();if(Ot){if(l===void 0)throw Error(s(407));l=l()}else{if(l=n(),Yt===null)throw Error(s(349));(Ct&127)!==0||xh(c,n,l)}m.memoizedState=l;var y={value:l,getSnapshot:n};return m.queue=y,Bh(bh.bind(null,c,y,i),[i]),c.flags|=2048,Un(9,{destroy:void 0},Ah.bind(null,c,y,l,n),null),l},useId:function(){var i=Oe(),n=Yt.identifierPrefix;if(Ot){var l=Ri,c=Li;l=(c&~(1<<32-Ke(c)-1)).toString(32)+l,n="_"+n+"R_"+l,l=Ja++,0<l&&(n+="H"+l.toString(32)),n+="_"}else l=vE++,n="_"+n+"r_"+l.toString(32)+"_";return i.memoizedState=n},useHostTransitionStatus:Mu,useFormState:Mh,useActionState:Mh,useOptimistic:function(i){var n=Oe();n.memoizedState=n.baseState=i;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return n.queue=l,n=wu.bind(null,At,!0,l),l.dispatch=n,[i,n]},useMemoCache:bu,useCacheRefresh:function(){return Oe().memoizedState=bE.bind(null,At)},useEffectEvent:function(i){var n=Oe(),l={impl:i};return n.memoizedState=l,function(){if((Ut&2)!==0)throw Error(s(440));return l.impl.apply(void 0,arguments)}}},Nu={readContext:xe,use:el,useCallback:Kh,useContext:xe,useEffect:Iu,useImperativeHandle:zh,useInsertionEffect:$h,useLayoutEffect:Gh,useMemo:jh,useReducer:il,useRef:Uh,useState:function(){return il(Vi)},useDebugValue:Cu,useDeferredValue:function(i,n){var l=ae();return Vh(l,Ht.memoizedState,i,n)},useTransition:function(){var i=il(Vi)[0],n=ae().memoizedState;return[typeof i=="boolean"?i:Pr(i),n]},useSyncExternalStore:Th,useId:Qh,useHostTransitionStatus:Mu,useFormState:wh,useActionState:wh,useOptimistic:function(i,n){var l=ae();return _h(l,Ht,i,n)},useMemoCache:bu,useCacheRefresh:Wh};Nu.useEffectEvent=Fh;var i0={readContext:xe,use:el,useCallback:Kh,useContext:xe,useEffect:Iu,useImperativeHandle:zh,useInsertionEffect:$h,useLayoutEffect:Gh,useMemo:jh,useReducer:Ru,useRef:Uh,useState:function(){return Ru(Vi)},useDebugValue:Cu,useDeferredValue:function(i,n){var l=ae();return Ht===null?ku(l,i,n):Vh(l,Ht.memoizedState,i,n)},useTransition:function(){var i=Ru(Vi)[0],n=ae().memoizedState;return[typeof i=="boolean"?i:Pr(i),n]},useSyncExternalStore:Th,useId:Qh,useHostTransitionStatus:Mu,useFormState:Ph,useActionState:Ph,useOptimistic:function(i,n){var l=ae();return Ht!==null?_h(l,Ht,i,n):(l.baseState=i,[i,l.queue.dispatch])},useMemoCache:bu,useCacheRefresh:Wh};i0.useEffectEvent=Fh;function Pu(i,n,l,c){n=i.memoizedState,l=l(c,n),l=l==null?n:p({},n,l),i.memoizedState=l,i.lanes===0&&(i.updateQueue.baseState=l)}var Uu={enqueueSetState:function(i,n,l){i=i._reactInternals;var c=We(),m=ms(c);m.payload=n,l!=null&&(m.callback=l),n=ps(i,m,c),n!==null&&($e(n,i,c),Or(n,i,c))},enqueueReplaceState:function(i,n,l){i=i._reactInternals;var c=We(),m=ms(c);m.tag=1,m.payload=n,l!=null&&(m.callback=l),n=ps(i,m,c),n!==null&&($e(n,i,c),Or(n,i,c))},enqueueForceUpdate:function(i,n){i=i._reactInternals;var l=We(),c=ms(l);c.tag=2,n!=null&&(c.callback=n),n=ps(i,c,l),n!==null&&($e(n,i,l),Or(n,i,l))}};function s0(i,n,l,c,m,y,T){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(c,y,T):n.prototype&&n.prototype.isPureReactComponent?!br(l,c)||!br(m,y):!0}function n0(i,n,l,c){i=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(l,c),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(l,c),n.state!==i&&Uu.enqueueReplaceState(n,n.state,null)}function en(i,n){var l=n;if("ref"in n){l={};for(var c in n)c!=="ref"&&(l[c]=n[c])}if(i=i.defaultProps){l===n&&(l=p({},l));for(var m in i)l[m]===void 0&&(l[m]=i[m])}return l}function r0(i){Ua(i)}function a0(i){console.error(i)}function l0(i){Ua(i)}function al(i,n){try{var l=i.onUncaughtError;l(n.value,{componentStack:n.stack})}catch(c){setTimeout(function(){throw c})}}function o0(i,n,l){try{var c=i.onCaughtError;c(l.value,{componentStack:l.stack,errorBoundary:n.tag===1?n.stateNode:null})}catch(m){setTimeout(function(){throw m})}}function Bu(i,n,l){return l=ms(l),l.tag=3,l.payload={element:null},l.callback=function(){al(i,n)},l}function u0(i){return i=ms(i),i.tag=3,i}function c0(i,n,l,c){var m=l.type.getDerivedStateFromError;if(typeof m=="function"){var y=c.value;i.payload=function(){return m(y)},i.callback=function(){o0(n,l,c)}}var T=l.stateNode;T!==null&&typeof T.componentDidCatch=="function"&&(i.callback=function(){o0(n,l,c),typeof m!="function"&&(xs===null?xs=new Set([this]):xs.add(this));var R=c.stack;this.componentDidCatch(c.value,{componentStack:R!==null?R:""})})}function RE(i,n,l,c,m){if(l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){if(n=l.alternate,n!==null&&In(n,l,m,!0),l=Ye.current,l!==null){switch(l.tag){case 31:case 13:return fi===null?vl():l.alternate===null&&se===0&&(se=3),l.flags&=-257,l.flags|=65536,l.lanes=m,c===Ya?l.flags|=16384:(n=l.updateQueue,n===null?l.updateQueue=new Set([c]):n.add(c),uc(i,c,m)),!1;case 22:return l.flags|=65536,c===Ya?l.flags|=16384:(n=l.updateQueue,n===null?(n={transitions:null,markerInstances:null,retryQueue:new Set([c])},l.updateQueue=n):(l=n.retryQueue,l===null?n.retryQueue=new Set([c]):l.add(c)),uc(i,c,m)),!1}throw Error(s(435,l.tag))}return uc(i,c,m),vl(),!1}if(Ot)return n=Ye.current,n!==null?((n.flags&65536)===0&&(n.flags|=256),n.flags|=65536,n.lanes=m,c!==su&&(i=Error(s(422),{cause:c}),_r(li(i,l)))):(c!==su&&(n=Error(s(423),{cause:c}),_r(li(n,l))),i=i.current.alternate,i.flags|=65536,m&=-m,i.lanes|=m,c=li(c,l),m=Bu(i.stateNode,c,m),gu(i,m),se!==4&&(se=2)),!1;var y=Error(s(520),{cause:c});if(y=li(y,l),Vr===null?Vr=[y]:Vr.push(y),se!==4&&(se=2),n===null)return!0;c=li(c,l),l=n;do{switch(l.tag){case 3:return l.flags|=65536,i=m&-m,l.lanes|=i,i=Bu(l.stateNode,c,i),gu(l,i),!1;case 1:if(n=l.type,y=l.stateNode,(l.flags&128)===0&&(typeof n.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(xs===null||!xs.has(y))))return l.flags|=65536,m&=-m,l.lanes|=m,m=u0(m),c0(m,i,l,c),gu(l,m),!1}l=l.return}while(l!==null);return!1}var Fu=Error(s(461)),ce=!1;function Ae(i,n,l,c){n.child=i===null?gh(n,null,l,c):Js(n,i.child,l,c)}function f0(i,n,l,c,m){l=l.render;var y=n.ref;if("ref"in c){var T={};for(var R in c)R!=="ref"&&(T[R]=c[R])}else T=c;return Xs(n),c=Su(i,n,l,T,y,m),R=Tu(),i!==null&&!ce?(xu(i,n,m),Yi(i,n,m)):(Ot&&R&&eu(n),n.flags|=1,Ae(i,n,c,m),n.child)}function d0(i,n,l,c,m){if(i===null){var y=l.type;return typeof y=="function"&&!Zo(y)&&y.defaultProps===void 0&&l.compare===null?(n.tag=15,n.type=y,h0(i,n,y,c,m)):(i=Ga(l.type,null,c,n,n.mode,m),i.ref=n.ref,i.return=n,n.child=i)}if(y=i.child,!Yu(i,m)){var T=y.memoizedProps;if(l=l.compare,l=l!==null?l:br,l(T,c)&&i.ref===n.ref)return Yi(i,n,m)}return n.flags|=1,i=Gi(y,c),i.ref=n.ref,i.return=n,n.child=i}function h0(i,n,l,c,m){if(i!==null){var y=i.memoizedProps;if(br(y,c)&&i.ref===n.ref)if(ce=!1,n.pendingProps=c=y,Yu(i,m))(i.flags&131072)!==0&&(ce=!0);else return n.lanes=i.lanes,Yi(i,n,m)}return $u(i,n,l,c,m)}function g0(i,n,l,c){var m=c.children,y=i!==null?i.memoizedState:null;if(i===null&&n.stateNode===null&&(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),c.mode==="hidden"){if((n.flags&128)!==0){if(y=y!==null?y.baseLanes|l:l,i!==null){for(c=n.child=i.child,m=0;c!==null;)m=m|c.lanes|c.childLanes,c=c.sibling;c=m&~y}else c=0,n.child=null;return m0(i,n,y,l,c)}if((l&536870912)!==0)n.memoizedState={baseLanes:0,cachePool:null},i!==null&&ja(n,y!==null?y.cachePool:null),y!==null?yh(n,y):pu(),vh(n);else return c=n.lanes=536870912,m0(i,n,y!==null?y.baseLanes|l:l,l,c)}else y!==null?(ja(n,y.cachePool),yh(n,y),vs(),n.memoizedState=null):(i!==null&&ja(n,null),pu(),vs());return Ae(i,n,m,l),n.child}function Fr(i,n){return i!==null&&i.tag===22||n.stateNode!==null||(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.sibling}function m0(i,n,l,c,m){var y=cu();return y=y===null?null:{parent:oe._currentValue,pool:y},n.memoizedState={baseLanes:l,cachePool:y},i!==null&&ja(n,null),pu(),vh(n),i!==null&&In(i,n,c,!0),n.childLanes=m,null}function ll(i,n){return n=ul({mode:n.mode,children:n.children},i.mode),n.ref=i.ref,i.child=n,n.return=i,n}function p0(i,n,l){return Js(n,i.child,null,l),i=ll(n,n.pendingProps),i.flags|=2,qe(n),n.memoizedState=null,i}function _E(i,n,l){var c=n.pendingProps,m=(n.flags&128)!==0;if(n.flags&=-129,i===null){if(Ot){if(c.mode==="hidden")return i=ll(n,c),n.lanes=536870912,Fr(null,i);if(vu(n),(i=Wt)?(i=Dg(i,ci),i=i!==null&&i.data==="&"?i:null,i!==null&&(n.memoizedState={dehydrated:i,treeContext:cs!==null?{id:Li,overflow:Ri}:null,retryLane:536870912,hydrationErrors:null},l=Jd(i),l.return=n,n.child=l,Te=n,Wt=null)):i=null,i===null)throw ds(n);return n.lanes=536870912,null}return ll(n,c)}var y=i.memoizedState;if(y!==null){var T=y.dehydrated;if(vu(n),m)if(n.flags&256)n.flags&=-257,n=p0(i,n,l);else if(n.memoizedState!==null)n.child=i.child,n.flags|=128,n=null;else throw Error(s(558));else if(ce||In(i,n,l,!1),m=(l&i.childLanes)!==0,ce||m){if(c=Yt,c!==null&&(T=ad(c,l),T!==0&&T!==y.retryLane))throw y.retryLane=T,js(i,T),$e(c,i,T),Fu;vl(),n=p0(i,n,l)}else i=y.treeContext,Wt=di(T.nextSibling),Te=n,Ot=!0,fs=null,ci=!1,i!==null&&ih(n,i),n=ll(n,c),n.flags|=4096;return n}return i=Gi(i.child,{mode:c.mode,children:c.children}),i.ref=n.ref,n.child=i,i.return=n,i}function ol(i,n){var l=n.ref;if(l===null)i!==null&&i.ref!==null&&(n.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(s(284));(i===null||i.ref!==l)&&(n.flags|=4194816)}}function $u(i,n,l,c,m){return Xs(n),l=Su(i,n,l,c,void 0,m),c=Tu(),i!==null&&!ce?(xu(i,n,m),Yi(i,n,m)):(Ot&&c&&eu(n),n.flags|=1,Ae(i,n,l,m),n.child)}function y0(i,n,l,c,m,y){return Xs(n),n.updateQueue=null,l=Sh(n,c,l,m),Eh(i),c=Tu(),i!==null&&!ce?(xu(i,n,y),Yi(i,n,y)):(Ot&&c&&eu(n),n.flags|=1,Ae(i,n,l,y),n.child)}function v0(i,n,l,c,m){if(Xs(n),n.stateNode===null){var y=Ln,T=l.contextType;typeof T=="object"&&T!==null&&(y=xe(T)),y=new l(c,y),n.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=Uu,n.stateNode=y,y._reactInternals=n,y=n.stateNode,y.props=c,y.state=n.memoizedState,y.refs={},du(n),T=l.contextType,y.context=typeof T=="object"&&T!==null?xe(T):Ln,y.state=n.memoizedState,T=l.getDerivedStateFromProps,typeof T=="function"&&(Pu(n,l,T,c),y.state=n.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(T=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),T!==y.state&&Uu.enqueueReplaceState(y,y.state,null),wr(n,c,y,m),Mr(),y.state=n.memoizedState),typeof y.componentDidMount=="function"&&(n.flags|=4194308),c=!0}else if(i===null){y=n.stateNode;var R=n.memoizedProps,M=en(l,R);y.props=M;var j=y.context,W=l.contextType;T=Ln,typeof W=="object"&&W!==null&&(T=xe(W));var et=l.getDerivedStateFromProps;W=typeof et=="function"||typeof y.getSnapshotBeforeUpdate=="function",R=n.pendingProps!==R,W||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(R||j!==T)&&n0(n,y,c,T),gs=!1;var Y=n.memoizedState;y.state=Y,wr(n,c,y,m),Mr(),j=n.memoizedState,R||Y!==j||gs?(typeof et=="function"&&(Pu(n,l,et,c),j=n.memoizedState),(M=gs||s0(n,l,M,c,Y,j,T))?(W||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(n.flags|=4194308)):(typeof y.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=c,n.memoizedState=j),y.props=c,y.state=j,y.context=T,c=M):(typeof y.componentDidMount=="function"&&(n.flags|=4194308),c=!1)}else{y=n.stateNode,hu(i,n),T=n.memoizedProps,W=en(l,T),y.props=W,et=n.pendingProps,Y=y.context,j=l.contextType,M=Ln,typeof j=="object"&&j!==null&&(M=xe(j)),R=l.getDerivedStateFromProps,(j=typeof R=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(T!==et||Y!==M)&&n0(n,y,c,M),gs=!1,Y=n.memoizedState,y.state=Y,wr(n,c,y,m),Mr();var q=n.memoizedState;T!==et||Y!==q||gs||i!==null&&i.dependencies!==null&&za(i.dependencies)?(typeof R=="function"&&(Pu(n,l,R,c),q=n.memoizedState),(W=gs||s0(n,l,W,c,Y,q,M)||i!==null&&i.dependencies!==null&&za(i.dependencies))?(j||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(c,q,M),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(c,q,M)),typeof y.componentDidUpdate=="function"&&(n.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof y.componentDidUpdate!="function"||T===i.memoizedProps&&Y===i.memoizedState||(n.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||T===i.memoizedProps&&Y===i.memoizedState||(n.flags|=1024),n.memoizedProps=c,n.memoizedState=q),y.props=c,y.state=q,y.context=M,c=W):(typeof y.componentDidUpdate!="function"||T===i.memoizedProps&&Y===i.memoizedState||(n.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||T===i.memoizedProps&&Y===i.memoizedState||(n.flags|=1024),c=!1)}return y=c,ol(i,n),c=(n.flags&128)!==0,y||c?(y=n.stateNode,l=c&&typeof l.getDerivedStateFromError!="function"?null:y.render(),n.flags|=1,i!==null&&c?(n.child=Js(n,i.child,null,m),n.child=Js(n,null,l,m)):Ae(i,n,l,m),n.memoizedState=y.state,i=n.child):i=Yi(i,n,m),i}function E0(i,n,l,c){return Ys(),n.flags|=256,Ae(i,n,l,c),n.child}var Gu={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Hu(i){return{baseLanes:i,cachePool:oh()}}function zu(i,n,l){return i=i!==null?i.childLanes&~l:0,n&&(i|=Qe),i}function S0(i,n,l){var c=n.pendingProps,m=!1,y=(n.flags&128)!==0,T;if((T=y)||(T=i!==null&&i.memoizedState===null?!1:(re.current&2)!==0),T&&(m=!0,n.flags&=-129),T=(n.flags&32)!==0,n.flags&=-33,i===null){if(Ot){if(m?ys(n):vs(),(i=Wt)?(i=Dg(i,ci),i=i!==null&&i.data!=="&"?i:null,i!==null&&(n.memoizedState={dehydrated:i,treeContext:cs!==null?{id:Li,overflow:Ri}:null,retryLane:536870912,hydrationErrors:null},l=Jd(i),l.return=n,n.child=l,Te=n,Wt=null)):i=null,i===null)throw ds(n);return Lc(i)?n.lanes=32:n.lanes=536870912,null}var R=c.children;return c=c.fallback,m?(vs(),m=n.mode,R=ul({mode:"hidden",children:R},m),c=Vs(c,m,l,null),R.return=n,c.return=n,R.sibling=c,n.child=R,c=n.child,c.memoizedState=Hu(l),c.childLanes=zu(i,T,l),n.memoizedState=Gu,Fr(null,c)):(ys(n),Ku(n,R))}var M=i.memoizedState;if(M!==null&&(R=M.dehydrated,R!==null)){if(y)n.flags&256?(ys(n),n.flags&=-257,n=ju(i,n,l)):n.memoizedState!==null?(vs(),n.child=i.child,n.flags|=128,n=null):(vs(),R=c.fallback,m=n.mode,c=ul({mode:"visible",children:c.children},m),R=Vs(R,m,l,null),R.flags|=2,c.return=n,R.return=n,c.sibling=R,n.child=c,Js(n,i.child,null,l),c=n.child,c.memoizedState=Hu(l),c.childLanes=zu(i,T,l),n.memoizedState=Gu,n=Fr(null,c));else if(ys(n),Lc(R)){if(T=R.nextSibling&&R.nextSibling.dataset,T)var j=T.dgst;T=j,c=Error(s(419)),c.stack="",c.digest=T,_r({value:c,source:null,stack:null}),n=ju(i,n,l)}else if(ce||In(i,n,l,!1),T=(l&i.childLanes)!==0,ce||T){if(T=Yt,T!==null&&(c=ad(T,l),c!==0&&c!==M.retryLane))throw M.retryLane=c,js(i,c),$e(T,i,c),Fu;bc(R)||vl(),n=ju(i,n,l)}else bc(R)?(n.flags|=192,n.child=i.child,n=null):(i=M.treeContext,Wt=di(R.nextSibling),Te=n,Ot=!0,fs=null,ci=!1,i!==null&&ih(n,i),n=Ku(n,c.children),n.flags|=4096);return n}return m?(vs(),R=c.fallback,m=n.mode,M=i.child,j=M.sibling,c=Gi(M,{mode:"hidden",children:c.children}),c.subtreeFlags=M.subtreeFlags&65011712,j!==null?R=Gi(j,R):(R=Vs(R,m,l,null),R.flags|=2),R.return=n,c.return=n,c.sibling=R,n.child=c,Fr(null,c),c=n.child,R=i.child.memoizedState,R===null?R=Hu(l):(m=R.cachePool,m!==null?(M=oe._currentValue,m=m.parent!==M?{parent:M,pool:M}:m):m=oh(),R={baseLanes:R.baseLanes|l,cachePool:m}),c.memoizedState=R,c.childLanes=zu(i,T,l),n.memoizedState=Gu,Fr(i.child,c)):(ys(n),l=i.child,i=l.sibling,l=Gi(l,{mode:"visible",children:c.children}),l.return=n,l.sibling=null,i!==null&&(T=n.deletions,T===null?(n.deletions=[i],n.flags|=16):T.push(i)),n.child=l,n.memoizedState=null,l)}function Ku(i,n){return n=ul({mode:"visible",children:n},i.mode),n.return=i,i.child=n}function ul(i,n){return i=Ve(22,i,null,n),i.lanes=0,i}function ju(i,n,l){return Js(n,i.child,null,l),i=Ku(n,n.pendingProps.children),i.flags|=2,n.memoizedState=null,i}function T0(i,n,l){i.lanes|=n;var c=i.alternate;c!==null&&(c.lanes|=n),au(i.return,n,l)}function Vu(i,n,l,c,m,y){var T=i.memoizedState;T===null?i.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:c,tail:l,tailMode:m,treeForkCount:y}:(T.isBackwards=n,T.rendering=null,T.renderingStartTime=0,T.last=c,T.tail=l,T.tailMode=m,T.treeForkCount=y)}function x0(i,n,l){var c=n.pendingProps,m=c.revealOrder,y=c.tail;c=c.children;var T=re.current,R=(T&2)!==0;if(R?(T=T&1|2,n.flags|=128):T&=1,it(re,T),Ae(i,n,c,l),c=Ot?Rr:0,!R&&i!==null&&(i.flags&128)!==0)t:for(i=n.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&T0(i,l,n);else if(i.tag===19)T0(i,l,n);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===n)break t;for(;i.sibling===null;){if(i.return===null||i.return===n)break t;i=i.return}i.sibling.return=i.return,i=i.sibling}switch(m){case"forwards":for(l=n.child,m=null;l!==null;)i=l.alternate,i!==null&&Wa(i)===null&&(m=l),l=l.sibling;l=m,l===null?(m=n.child,n.child=null):(m=l.sibling,l.sibling=null),Vu(n,!1,m,l,y,c);break;case"backwards":case"unstable_legacy-backwards":for(l=null,m=n.child,n.child=null;m!==null;){if(i=m.alternate,i!==null&&Wa(i)===null){n.child=m;break}i=m.sibling,m.sibling=l,l=m,m=i}Vu(n,!0,l,null,y,c);break;case"together":Vu(n,!1,null,null,void 0,c);break;default:n.memoizedState=null}return n.child}function Yi(i,n,l){if(i!==null&&(n.dependencies=i.dependencies),Ts|=n.lanes,(l&n.childLanes)===0)if(i!==null){if(In(i,n,l,!1),(l&n.childLanes)===0)return null}else return null;if(i!==null&&n.child!==i.child)throw Error(s(153));if(n.child!==null){for(i=n.child,l=Gi(i,i.pendingProps),n.child=l,l.return=n;i.sibling!==null;)i=i.sibling,l=l.sibling=Gi(i,i.pendingProps),l.return=n;l.sibling=null}return n.child}function Yu(i,n){return(i.lanes&n)!==0?!0:(i=i.dependencies,!!(i!==null&&za(i)))}function DE(i,n,l){switch(n.tag){case 3:wt(n,n.stateNode.containerInfo),hs(n,oe,i.memoizedState.cache),Ys();break;case 27:case 5:De(n);break;case 4:wt(n,n.stateNode.containerInfo);break;case 10:hs(n,n.type,n.memoizedProps.value);break;case 31:if(n.memoizedState!==null)return n.flags|=128,vu(n),null;break;case 13:var c=n.memoizedState;if(c!==null)return c.dehydrated!==null?(ys(n),n.flags|=128,null):(l&n.child.childLanes)!==0?S0(i,n,l):(ys(n),i=Yi(i,n,l),i!==null?i.sibling:null);ys(n);break;case 19:var m=(i.flags&128)!==0;if(c=(l&n.childLanes)!==0,c||(In(i,n,l,!1),c=(l&n.childLanes)!==0),m){if(c)return x0(i,n,l);n.flags|=128}if(m=n.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),it(re,re.current),c)break;return null;case 22:return n.lanes=0,g0(i,n,l,n.pendingProps);case 24:hs(n,oe,i.memoizedState.cache)}return Yi(i,n,l)}function A0(i,n,l){if(i!==null)if(i.memoizedProps!==n.pendingProps)ce=!0;else{if(!Yu(i,l)&&(n.flags&128)===0)return ce=!1,DE(i,n,l);ce=(i.flags&131072)!==0}else ce=!1,Ot&&(n.flags&1048576)!==0&&eh(n,Rr,n.index);switch(n.lanes=0,n.tag){case 16:t:{var c=n.pendingProps;if(i=Ws(n.elementType),n.type=i,typeof i=="function")Zo(i)?(c=en(i,c),n.tag=1,n=v0(null,n,i,c,l)):(n.tag=0,n=$u(null,n,i,c,l));else{if(i!=null){var m=i.$$typeof;if(m===k){n.tag=11,n=f0(null,n,i,c,l);break t}else if(m===O){n.tag=14,n=d0(null,n,i,c,l);break t}}throw n=dt(i)||i,Error(s(306,n,""))}}return n;case 0:return $u(i,n,n.type,n.pendingProps,l);case 1:return c=n.type,m=en(c,n.pendingProps),v0(i,n,c,m,l);case 3:t:{if(wt(n,n.stateNode.containerInfo),i===null)throw Error(s(387));c=n.pendingProps;var y=n.memoizedState;m=y.element,hu(i,n),wr(n,c,null,l);var T=n.memoizedState;if(c=T.cache,hs(n,oe,c),c!==y.cache&&lu(n,[oe],l,!0),Mr(),c=T.element,y.isDehydrated)if(y={element:c,isDehydrated:!1,cache:T.cache},n.updateQueue.baseState=y,n.memoizedState=y,n.flags&256){n=E0(i,n,c,l);break t}else if(c!==m){m=li(Error(s(424)),n),_r(m),n=E0(i,n,c,l);break t}else{switch(i=n.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(Wt=di(i.firstChild),Te=n,Ot=!0,fs=null,ci=!0,l=gh(n,null,c,l),n.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling}else{if(Ys(),c===m){n=Yi(i,n,l);break t}Ae(i,n,c,l)}n=n.child}return n;case 26:return ol(i,n),i===null?(l=wg(n.type,null,n.pendingProps,null))?n.memoizedState=l:Ot||(l=n.type,i=n.pendingProps,c=Ll(ft.current).createElement(l),c[Se]=n,c[we]=i,be(c,l,i),ye(c),n.stateNode=c):n.memoizedState=wg(n.type,i.memoizedProps,n.pendingProps,i.memoizedState),null;case 27:return De(n),i===null&&Ot&&(c=n.stateNode=kg(n.type,n.pendingProps,ft.current),Te=n,ci=!0,m=Wt,Rs(n.type)?(Rc=m,Wt=di(c.firstChild)):Wt=m),Ae(i,n,n.pendingProps.children,l),ol(i,n),i===null&&(n.flags|=4194304),n.child;case 5:return i===null&&Ot&&((m=c=Wt)&&(c=nS(c,n.type,n.pendingProps,ci),c!==null?(n.stateNode=c,Te=n,Wt=di(c.firstChild),ci=!1,m=!0):m=!1),m||ds(n)),De(n),m=n.type,y=n.pendingProps,T=i!==null?i.memoizedProps:null,c=y.children,Tc(m,y)?c=null:T!==null&&Tc(m,T)&&(n.flags|=32),n.memoizedState!==null&&(m=Su(i,n,EE,null,null,l),ta._currentValue=m),ol(i,n),Ae(i,n,c,l),n.child;case 6:return i===null&&Ot&&((i=l=Wt)&&(l=rS(l,n.pendingProps,ci),l!==null?(n.stateNode=l,Te=n,Wt=null,i=!0):i=!1),i||ds(n)),null;case 13:return S0(i,n,l);case 4:return wt(n,n.stateNode.containerInfo),c=n.pendingProps,i===null?n.child=Js(n,null,c,l):Ae(i,n,c,l),n.child;case 11:return f0(i,n,n.type,n.pendingProps,l);case 7:return Ae(i,n,n.pendingProps,l),n.child;case 8:return Ae(i,n,n.pendingProps.children,l),n.child;case 12:return Ae(i,n,n.pendingProps.children,l),n.child;case 10:return c=n.pendingProps,hs(n,n.type,c.value),Ae(i,n,c.children,l),n.child;case 9:return m=n.type._context,c=n.pendingProps.children,Xs(n),m=xe(m),c=c(m),n.flags|=1,Ae(i,n,c,l),n.child;case 14:return d0(i,n,n.type,n.pendingProps,l);case 15:return h0(i,n,n.type,n.pendingProps,l);case 19:return x0(i,n,l);case 31:return _E(i,n,l);case 22:return g0(i,n,l,n.pendingProps);case 24:return Xs(n),c=xe(oe),i===null?(m=cu(),m===null&&(m=Yt,y=ou(),m.pooledCache=y,y.refCount++,y!==null&&(m.pooledCacheLanes|=l),m=y),n.memoizedState={parent:c,cache:m},du(n),hs(n,oe,m)):((i.lanes&l)!==0&&(hu(i,n),wr(n,null,null,l),Mr()),m=i.memoizedState,y=n.memoizedState,m.parent!==c?(m={parent:c,cache:c},n.memoizedState=m,n.lanes===0&&(n.memoizedState=n.updateQueue.baseState=m),hs(n,oe,c)):(c=y.cache,hs(n,oe,c),c!==m.cache&&lu(n,[oe],l,!0))),Ae(i,n,n.pendingProps.children,l),n.child;case 29:throw n.pendingProps}throw Error(s(156,n.tag))}function qi(i){i.flags|=4}function qu(i,n,l,c,m){if((n=(i.mode&32)!==0)&&(n=!1),n){if(i.flags|=16777216,(m&335544128)===m)if(i.stateNode.complete)i.flags|=8192;else if(Q0())i.flags|=8192;else throw Zs=Ya,fu}else i.flags&=-16777217}function b0(i,n){if(n.type!=="stylesheet"||(n.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!Fg(n))if(Q0())i.flags|=8192;else throw Zs=Ya,fu}function cl(i,n){n!==null&&(i.flags|=4),i.flags&16384&&(n=i.tag!==22?sd():536870912,i.lanes|=n,Gn|=n)}function $r(i,n){if(!Ot)switch(i.tailMode){case"hidden":n=i.tail;for(var l=null;n!==null;)n.alternate!==null&&(l=n),n=n.sibling;l===null?i.tail=null:l.sibling=null;break;case"collapsed":l=i.tail;for(var c=null;l!==null;)l.alternate!==null&&(c=l),l=l.sibling;c===null?n||i.tail===null?i.tail=null:i.tail.sibling=null:c.sibling=null}}function Zt(i){var n=i.alternate!==null&&i.alternate.child===i.child,l=0,c=0;if(n)for(var m=i.child;m!==null;)l|=m.lanes|m.childLanes,c|=m.subtreeFlags&65011712,c|=m.flags&65011712,m.return=i,m=m.sibling;else for(m=i.child;m!==null;)l|=m.lanes|m.childLanes,c|=m.subtreeFlags,c|=m.flags,m.return=i,m=m.sibling;return i.subtreeFlags|=c,i.childLanes=l,n}function IE(i,n,l){var c=n.pendingProps;switch(iu(n),n.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Zt(n),null;case 1:return Zt(n),null;case 3:return l=n.stateNode,c=null,i!==null&&(c=i.memoizedState.cache),n.memoizedState.cache!==c&&(n.flags|=2048),Ki(oe),Mt(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(i===null||i.child===null)&&(Dn(n)?qi(n):i===null||i.memoizedState.isDehydrated&&(n.flags&256)===0||(n.flags|=1024,nu())),Zt(n),null;case 26:var m=n.type,y=n.memoizedState;return i===null?(qi(n),y!==null?(Zt(n),b0(n,y)):(Zt(n),qu(n,m,null,c,l))):y?y!==i.memoizedState?(qi(n),Zt(n),b0(n,y)):(Zt(n),n.flags&=-16777217):(i=i.memoizedProps,i!==c&&qi(n),Zt(n),qu(n,m,i,c,l)),null;case 27:if(si(n),l=ft.current,m=n.type,i!==null&&n.stateNode!=null)i.memoizedProps!==c&&qi(n);else{if(!c){if(n.stateNode===null)throw Error(s(166));return Zt(n),null}i=nt.current,Dn(n)?sh(n):(i=kg(m,c,l),n.stateNode=i,qi(n))}return Zt(n),null;case 5:if(si(n),m=n.type,i!==null&&n.stateNode!=null)i.memoizedProps!==c&&qi(n);else{if(!c){if(n.stateNode===null)throw Error(s(166));return Zt(n),null}if(y=nt.current,Dn(n))sh(n);else{var T=Ll(ft.current);switch(y){case 1:y=T.createElementNS("http://www.w3.org/2000/svg",m);break;case 2:y=T.createElementNS("http://www.w3.org/1998/Math/MathML",m);break;default:switch(m){case"svg":y=T.createElementNS("http://www.w3.org/2000/svg",m);break;case"math":y=T.createElementNS("http://www.w3.org/1998/Math/MathML",m);break;case"script":y=T.createElement("div"),y.innerHTML="<script><\/script>",y=y.removeChild(y.firstChild);break;case"select":y=typeof c.is=="string"?T.createElement("select",{is:c.is}):T.createElement("select"),c.multiple?y.multiple=!0:c.size&&(y.size=c.size);break;default:y=typeof c.is=="string"?T.createElement(m,{is:c.is}):T.createElement(m)}}y[Se]=n,y[we]=c;t:for(T=n.child;T!==null;){if(T.tag===5||T.tag===6)y.appendChild(T.stateNode);else if(T.tag!==4&&T.tag!==27&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===n)break t;for(;T.sibling===null;){if(T.return===null||T.return===n)break t;T=T.return}T.sibling.return=T.return,T=T.sibling}n.stateNode=y;t:switch(be(y,m,c),m){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break t;case"img":c=!0;break t;default:c=!1}c&&qi(n)}}return Zt(n),qu(n,n.type,i===null?null:i.memoizedProps,n.pendingProps,l),null;case 6:if(i&&n.stateNode!=null)i.memoizedProps!==c&&qi(n);else{if(typeof c!="string"&&n.stateNode===null)throw Error(s(166));if(i=ft.current,Dn(n)){if(i=n.stateNode,l=n.memoizedProps,c=null,m=Te,m!==null)switch(m.tag){case 27:case 5:c=m.memoizedProps}i[Se]=n,i=!!(i.nodeValue===l||c!==null&&c.suppressHydrationWarning===!0||Sg(i.nodeValue,l)),i||ds(n,!0)}else i=Ll(i).createTextNode(c),i[Se]=n,n.stateNode=i}return Zt(n),null;case 31:if(l=n.memoizedState,i===null||i.memoizedState!==null){if(c=Dn(n),l!==null){if(i===null){if(!c)throw Error(s(318));if(i=n.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(s(557));i[Se]=n}else Ys(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;Zt(n),i=!1}else l=nu(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=l),i=!0;if(!i)return n.flags&256?(qe(n),n):(qe(n),null);if((n.flags&128)!==0)throw Error(s(558))}return Zt(n),null;case 13:if(c=n.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(m=Dn(n),c!==null&&c.dehydrated!==null){if(i===null){if(!m)throw Error(s(318));if(m=n.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(s(317));m[Se]=n}else Ys(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;Zt(n),m=!1}else m=nu(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=m),m=!0;if(!m)return n.flags&256?(qe(n),n):(qe(n),null)}return qe(n),(n.flags&128)!==0?(n.lanes=l,n):(l=c!==null,i=i!==null&&i.memoizedState!==null,l&&(c=n.child,m=null,c.alternate!==null&&c.alternate.memoizedState!==null&&c.alternate.memoizedState.cachePool!==null&&(m=c.alternate.memoizedState.cachePool.pool),y=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(y=c.memoizedState.cachePool.pool),y!==m&&(c.flags|=2048)),l!==i&&l&&(n.child.flags|=8192),cl(n,n.updateQueue),Zt(n),null);case 4:return Mt(),i===null&&pc(n.stateNode.containerInfo),Zt(n),null;case 10:return Ki(n.type),Zt(n),null;case 19:if(U(re),c=n.memoizedState,c===null)return Zt(n),null;if(m=(n.flags&128)!==0,y=c.rendering,y===null)if(m)$r(c,!1);else{if(se!==0||i!==null&&(i.flags&128)!==0)for(i=n.child;i!==null;){if(y=Wa(i),y!==null){for(n.flags|=128,$r(c,!1),i=y.updateQueue,n.updateQueue=i,cl(n,i),n.subtreeFlags=0,i=l,l=n.child;l!==null;)Zd(l,i),l=l.sibling;return it(re,re.current&1|2),Ot&&Hi(n,c.treeForkCount),n.child}i=i.sibling}c.tail!==null&&pe()>ml&&(n.flags|=128,m=!0,$r(c,!1),n.lanes=4194304)}else{if(!m)if(i=Wa(y),i!==null){if(n.flags|=128,m=!0,i=i.updateQueue,n.updateQueue=i,cl(n,i),$r(c,!0),c.tail===null&&c.tailMode==="hidden"&&!y.alternate&&!Ot)return Zt(n),null}else 2*pe()-c.renderingStartTime>ml&&l!==536870912&&(n.flags|=128,m=!0,$r(c,!1),n.lanes=4194304);c.isBackwards?(y.sibling=n.child,n.child=y):(i=c.last,i!==null?i.sibling=y:n.child=y,c.last=y)}return c.tail!==null?(i=c.tail,c.rendering=i,c.tail=i.sibling,c.renderingStartTime=pe(),i.sibling=null,l=re.current,it(re,m?l&1|2:l&1),Ot&&Hi(n,c.treeForkCount),i):(Zt(n),null);case 22:case 23:return qe(n),yu(),c=n.memoizedState!==null,i!==null?i.memoizedState!==null!==c&&(n.flags|=8192):c&&(n.flags|=8192),c?(l&536870912)!==0&&(n.flags&128)===0&&(Zt(n),n.subtreeFlags&6&&(n.flags|=8192)):Zt(n),l=n.updateQueue,l!==null&&cl(n,l.retryQueue),l=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(l=i.memoizedState.cachePool.pool),c=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(c=n.memoizedState.cachePool.pool),c!==l&&(n.flags|=2048),i!==null&&U(Qs),null;case 24:return l=null,i!==null&&(l=i.memoizedState.cache),n.memoizedState.cache!==l&&(n.flags|=2048),Ki(oe),Zt(n),null;case 25:return null;case 30:return null}throw Error(s(156,n.tag))}function CE(i,n){switch(iu(n),n.tag){case 1:return i=n.flags,i&65536?(n.flags=i&-65537|128,n):null;case 3:return Ki(oe),Mt(),i=n.flags,(i&65536)!==0&&(i&128)===0?(n.flags=i&-65537|128,n):null;case 26:case 27:case 5:return si(n),null;case 31:if(n.memoizedState!==null){if(qe(n),n.alternate===null)throw Error(s(340));Ys()}return i=n.flags,i&65536?(n.flags=i&-65537|128,n):null;case 13:if(qe(n),i=n.memoizedState,i!==null&&i.dehydrated!==null){if(n.alternate===null)throw Error(s(340));Ys()}return i=n.flags,i&65536?(n.flags=i&-65537|128,n):null;case 19:return U(re),null;case 4:return Mt(),null;case 10:return Ki(n.type),null;case 22:case 23:return qe(n),yu(),i!==null&&U(Qs),i=n.flags,i&65536?(n.flags=i&-65537|128,n):null;case 24:return Ki(oe),null;case 25:return null;default:return null}}function L0(i,n){switch(iu(n),n.tag){case 3:Ki(oe),Mt();break;case 26:case 27:case 5:si(n);break;case 4:Mt();break;case 31:n.memoizedState!==null&&qe(n);break;case 13:qe(n);break;case 19:U(re);break;case 10:Ki(n.type);break;case 22:case 23:qe(n),yu(),i!==null&&U(Qs);break;case 24:Ki(oe)}}function Gr(i,n){try{var l=n.updateQueue,c=l!==null?l.lastEffect:null;if(c!==null){var m=c.next;l=m;do{if((l.tag&i)===i){c=void 0;var y=l.create,T=l.inst;c=y(),T.destroy=c}l=l.next}while(l!==m)}}catch(R){Ft(n,n.return,R)}}function Es(i,n,l){try{var c=n.updateQueue,m=c!==null?c.lastEffect:null;if(m!==null){var y=m.next;c=y;do{if((c.tag&i)===i){var T=c.inst,R=T.destroy;if(R!==void 0){T.destroy=void 0,m=n;var M=l,j=R;try{j()}catch(W){Ft(m,M,W)}}}c=c.next}while(c!==y)}}catch(W){Ft(n,n.return,W)}}function R0(i){var n=i.updateQueue;if(n!==null){var l=i.stateNode;try{ph(n,l)}catch(c){Ft(i,i.return,c)}}}function _0(i,n,l){l.props=en(i.type,i.memoizedProps),l.state=i.memoizedState;try{l.componentWillUnmount()}catch(c){Ft(i,n,c)}}function Hr(i,n){try{var l=i.ref;if(l!==null){switch(i.tag){case 26:case 27:case 5:var c=i.stateNode;break;case 30:c=i.stateNode;break;default:c=i.stateNode}typeof l=="function"?i.refCleanup=l(c):l.current=c}}catch(m){Ft(i,n,m)}}function _i(i,n){var l=i.ref,c=i.refCleanup;if(l!==null)if(typeof c=="function")try{c()}catch(m){Ft(i,n,m)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(m){Ft(i,n,m)}else l.current=null}function D0(i){var n=i.type,l=i.memoizedProps,c=i.stateNode;try{t:switch(n){case"button":case"input":case"select":case"textarea":l.autoFocus&&c.focus();break t;case"img":l.src?c.src=l.src:l.srcSet&&(c.srcset=l.srcSet)}}catch(m){Ft(i,i.return,m)}}function Xu(i,n,l){try{var c=i.stateNode;ZE(c,i.type,l,n),c[we]=n}catch(m){Ft(i,i.return,m)}}function I0(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&Rs(i.type)||i.tag===4}function Qu(i){t:for(;;){for(;i.sibling===null;){if(i.return===null||I0(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&Rs(i.type)||i.flags&2||i.child===null||i.tag===4)continue t;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Wu(i,n,l){var c=i.tag;if(c===5||c===6)i=i.stateNode,n?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(i,n):(n=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,n.appendChild(i),l=l._reactRootContainer,l!=null||n.onclick!==null||(n.onclick=Fi));else if(c!==4&&(c===27&&Rs(i.type)&&(l=i.stateNode,n=null),i=i.child,i!==null))for(Wu(i,n,l),i=i.sibling;i!==null;)Wu(i,n,l),i=i.sibling}function fl(i,n,l){var c=i.tag;if(c===5||c===6)i=i.stateNode,n?l.insertBefore(i,n):l.appendChild(i);else if(c!==4&&(c===27&&Rs(i.type)&&(l=i.stateNode),i=i.child,i!==null))for(fl(i,n,l),i=i.sibling;i!==null;)fl(i,n,l),i=i.sibling}function C0(i){var n=i.stateNode,l=i.memoizedProps;try{for(var c=i.type,m=n.attributes;m.length;)n.removeAttributeNode(m[0]);be(n,c,l),n[Se]=i,n[we]=l}catch(y){Ft(i,i.return,y)}}var Xi=!1,fe=!1,Zu=!1,k0=typeof WeakSet=="function"?WeakSet:Set,ve=null;function kE(i,n){if(i=i.containerInfo,Ec=Ol,i=zd(i),jo(i)){if("selectionStart"in i)var l={start:i.selectionStart,end:i.selectionEnd};else t:{l=(l=i.ownerDocument)&&l.defaultView||window;var c=l.getSelection&&l.getSelection();if(c&&c.rangeCount!==0){l=c.anchorNode;var m=c.anchorOffset,y=c.focusNode;c=c.focusOffset;try{l.nodeType,y.nodeType}catch{l=null;break t}var T=0,R=-1,M=-1,j=0,W=0,et=i,Y=null;e:for(;;){for(var q;et!==l||m!==0&&et.nodeType!==3||(R=T+m),et!==y||c!==0&&et.nodeType!==3||(M=T+c),et.nodeType===3&&(T+=et.nodeValue.length),(q=et.firstChild)!==null;)Y=et,et=q;for(;;){if(et===i)break e;if(Y===l&&++j===m&&(R=T),Y===y&&++W===c&&(M=T),(q=et.nextSibling)!==null)break;et=Y,Y=et.parentNode}et=q}l=R===-1||M===-1?null:{start:R,end:M}}else l=null}l=l||{start:0,end:0}}else l=null;for(Sc={focusedElem:i,selectionRange:l},Ol=!1,ve=n;ve!==null;)if(n=ve,i=n.child,(n.subtreeFlags&1028)!==0&&i!==null)i.return=n,ve=i;else for(;ve!==null;){switch(n=ve,y=n.alternate,i=n.flags,n.tag){case 0:if((i&4)!==0&&(i=n.updateQueue,i=i!==null?i.events:null,i!==null))for(l=0;l<i.length;l++)m=i[l],m.ref.impl=m.nextImpl;break;case 11:case 15:break;case 1:if((i&1024)!==0&&y!==null){i=void 0,l=n,m=y.memoizedProps,y=y.memoizedState,c=l.stateNode;try{var gt=en(l.type,m);i=c.getSnapshotBeforeUpdate(gt,y),c.__reactInternalSnapshotBeforeUpdate=i}catch(vt){Ft(l,l.return,vt)}}break;case 3:if((i&1024)!==0){if(i=n.stateNode.containerInfo,l=i.nodeType,l===9)Ac(i);else if(l===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":Ac(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(s(163))}if(i=n.sibling,i!==null){i.return=n.return,ve=i;break}ve=n.return}}function O0(i,n,l){var c=l.flags;switch(l.tag){case 0:case 11:case 15:Wi(i,l),c&4&&Gr(5,l);break;case 1:if(Wi(i,l),c&4)if(i=l.stateNode,n===null)try{i.componentDidMount()}catch(T){Ft(l,l.return,T)}else{var m=en(l.type,n.memoizedProps);n=n.memoizedState;try{i.componentDidUpdate(m,n,i.__reactInternalSnapshotBeforeUpdate)}catch(T){Ft(l,l.return,T)}}c&64&&R0(l),c&512&&Hr(l,l.return);break;case 3:if(Wi(i,l),c&64&&(i=l.updateQueue,i!==null)){if(n=null,l.child!==null)switch(l.child.tag){case 27:case 5:n=l.child.stateNode;break;case 1:n=l.child.stateNode}try{ph(i,n)}catch(T){Ft(l,l.return,T)}}break;case 27:n===null&&c&4&&C0(l);case 26:case 5:Wi(i,l),n===null&&c&4&&D0(l),c&512&&Hr(l,l.return);break;case 12:Wi(i,l);break;case 31:Wi(i,l),c&4&&N0(i,l);break;case 13:Wi(i,l),c&4&&P0(i,l),c&64&&(i=l.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(l=$E.bind(null,l),aS(i,l))));break;case 22:if(c=l.memoizedState!==null||Xi,!c){n=n!==null&&n.memoizedState!==null||fe,m=Xi;var y=fe;Xi=c,(fe=n)&&!y?Zi(i,l,(l.subtreeFlags&8772)!==0):Wi(i,l),Xi=m,fe=y}break;case 30:break;default:Wi(i,l)}}function M0(i){var n=i.alternate;n!==null&&(i.alternate=null,M0(n)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(n=i.stateNode,n!==null&&Do(n)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var Jt=null,Pe=!1;function Qi(i,n,l){for(l=l.child;l!==null;)w0(i,n,l),l=l.sibling}function w0(i,n,l){if(ze&&typeof ze.onCommitFiberUnmount=="function")try{ze.onCommitFiberUnmount(dr,l)}catch{}switch(l.tag){case 26:fe||_i(l,n),Qi(i,n,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:fe||_i(l,n);var c=Jt,m=Pe;Rs(l.type)&&(Jt=l.stateNode,Pe=!1),Qi(i,n,l),Wr(l.stateNode),Jt=c,Pe=m;break;case 5:fe||_i(l,n);case 6:if(c=Jt,m=Pe,Jt=null,Qi(i,n,l),Jt=c,Pe=m,Jt!==null)if(Pe)try{(Jt.nodeType===9?Jt.body:Jt.nodeName==="HTML"?Jt.ownerDocument.body:Jt).removeChild(l.stateNode)}catch(y){Ft(l,n,y)}else try{Jt.removeChild(l.stateNode)}catch(y){Ft(l,n,y)}break;case 18:Jt!==null&&(Pe?(i=Jt,Rg(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,l.stateNode),Xn(i)):Rg(Jt,l.stateNode));break;case 4:c=Jt,m=Pe,Jt=l.stateNode.containerInfo,Pe=!0,Qi(i,n,l),Jt=c,Pe=m;break;case 0:case 11:case 14:case 15:Es(2,l,n),fe||Es(4,l,n),Qi(i,n,l);break;case 1:fe||(_i(l,n),c=l.stateNode,typeof c.componentWillUnmount=="function"&&_0(l,n,c)),Qi(i,n,l);break;case 21:Qi(i,n,l);break;case 22:fe=(c=fe)||l.memoizedState!==null,Qi(i,n,l),fe=c;break;default:Qi(i,n,l)}}function N0(i,n){if(n.memoizedState===null&&(i=n.alternate,i!==null&&(i=i.memoizedState,i!==null))){i=i.dehydrated;try{Xn(i)}catch(l){Ft(n,n.return,l)}}}function P0(i,n){if(n.memoizedState===null&&(i=n.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{Xn(i)}catch(l){Ft(n,n.return,l)}}function OE(i){switch(i.tag){case 31:case 13:case 19:var n=i.stateNode;return n===null&&(n=i.stateNode=new k0),n;case 22:return i=i.stateNode,n=i._retryCache,n===null&&(n=i._retryCache=new k0),n;default:throw Error(s(435,i.tag))}}function dl(i,n){var l=OE(i);n.forEach(function(c){if(!l.has(c)){l.add(c);var m=GE.bind(null,i,c);c.then(m,m)}})}function Ue(i,n){var l=n.deletions;if(l!==null)for(var c=0;c<l.length;c++){var m=l[c],y=i,T=n,R=T;t:for(;R!==null;){switch(R.tag){case 27:if(Rs(R.type)){Jt=R.stateNode,Pe=!1;break t}break;case 5:Jt=R.stateNode,Pe=!1;break t;case 3:case 4:Jt=R.stateNode.containerInfo,Pe=!0;break t}R=R.return}if(Jt===null)throw Error(s(160));w0(y,T,m),Jt=null,Pe=!1,y=m.alternate,y!==null&&(y.return=null),m.return=null}if(n.subtreeFlags&13886)for(n=n.child;n!==null;)U0(n,i),n=n.sibling}var Ei=null;function U0(i,n){var l=i.alternate,c=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:Ue(n,i),Be(i),c&4&&(Es(3,i,i.return),Gr(3,i),Es(5,i,i.return));break;case 1:Ue(n,i),Be(i),c&512&&(fe||l===null||_i(l,l.return)),c&64&&Xi&&(i=i.updateQueue,i!==null&&(c=i.callbacks,c!==null&&(l=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=l===null?c:l.concat(c))));break;case 26:var m=Ei;if(Ue(n,i),Be(i),c&512&&(fe||l===null||_i(l,l.return)),c&4){var y=l!==null?l.memoizedState:null;if(c=i.memoizedState,l===null)if(c===null)if(i.stateNode===null){t:{c=i.type,l=i.memoizedProps,m=m.ownerDocument||m;e:switch(c){case"title":y=m.getElementsByTagName("title")[0],(!y||y[mr]||y[Se]||y.namespaceURI==="http://www.w3.org/2000/svg"||y.hasAttribute("itemprop"))&&(y=m.createElement(c),m.head.insertBefore(y,m.querySelector("head > title"))),be(y,c,l),y[Se]=i,ye(y),c=y;break t;case"link":var T=Ug("link","href",m).get(c+(l.href||""));if(T){for(var R=0;R<T.length;R++)if(y=T[R],y.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&y.getAttribute("rel")===(l.rel==null?null:l.rel)&&y.getAttribute("title")===(l.title==null?null:l.title)&&y.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){T.splice(R,1);break e}}y=m.createElement(c),be(y,c,l),m.head.appendChild(y);break;case"meta":if(T=Ug("meta","content",m).get(c+(l.content||""))){for(R=0;R<T.length;R++)if(y=T[R],y.getAttribute("content")===(l.content==null?null:""+l.content)&&y.getAttribute("name")===(l.name==null?null:l.name)&&y.getAttribute("property")===(l.property==null?null:l.property)&&y.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&y.getAttribute("charset")===(l.charSet==null?null:l.charSet)){T.splice(R,1);break e}}y=m.createElement(c),be(y,c,l),m.head.appendChild(y);break;default:throw Error(s(468,c))}y[Se]=i,ye(y),c=y}i.stateNode=c}else Bg(m,i.type,i.stateNode);else i.stateNode=Pg(m,c,i.memoizedProps);else y!==c?(y===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):y.count--,c===null?Bg(m,i.type,i.stateNode):Pg(m,c,i.memoizedProps)):c===null&&i.stateNode!==null&&Xu(i,i.memoizedProps,l.memoizedProps)}break;case 27:Ue(n,i),Be(i),c&512&&(fe||l===null||_i(l,l.return)),l!==null&&c&4&&Xu(i,i.memoizedProps,l.memoizedProps);break;case 5:if(Ue(n,i),Be(i),c&512&&(fe||l===null||_i(l,l.return)),i.flags&32){m=i.stateNode;try{vn(m,"")}catch(gt){Ft(i,i.return,gt)}}c&4&&i.stateNode!=null&&(m=i.memoizedProps,Xu(i,m,l!==null?l.memoizedProps:m)),c&1024&&(Zu=!0);break;case 6:if(Ue(n,i),Be(i),c&4){if(i.stateNode===null)throw Error(s(162));c=i.memoizedProps,l=i.stateNode;try{l.nodeValue=c}catch(gt){Ft(i,i.return,gt)}}break;case 3:if(Dl=null,m=Ei,Ei=Rl(n.containerInfo),Ue(n,i),Ei=m,Be(i),c&4&&l!==null&&l.memoizedState.isDehydrated)try{Xn(n.containerInfo)}catch(gt){Ft(i,i.return,gt)}Zu&&(Zu=!1,B0(i));break;case 4:c=Ei,Ei=Rl(i.stateNode.containerInfo),Ue(n,i),Be(i),Ei=c;break;case 12:Ue(n,i),Be(i);break;case 31:Ue(n,i),Be(i),c&4&&(c=i.updateQueue,c!==null&&(i.updateQueue=null,dl(i,c)));break;case 13:Ue(n,i),Be(i),i.child.flags&8192&&i.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(gl=pe()),c&4&&(c=i.updateQueue,c!==null&&(i.updateQueue=null,dl(i,c)));break;case 22:m=i.memoizedState!==null;var M=l!==null&&l.memoizedState!==null,j=Xi,W=fe;if(Xi=j||m,fe=W||M,Ue(n,i),fe=W,Xi=j,Be(i),c&8192)t:for(n=i.stateNode,n._visibility=m?n._visibility&-2:n._visibility|1,m&&(l===null||M||Xi||fe||sn(i)),l=null,n=i;;){if(n.tag===5||n.tag===26){if(l===null){M=l=n;try{if(y=M.stateNode,m)T=y.style,typeof T.setProperty=="function"?T.setProperty("display","none","important"):T.display="none";else{R=M.stateNode;var et=M.memoizedProps.style,Y=et!=null&&et.hasOwnProperty("display")?et.display:null;R.style.display=Y==null||typeof Y=="boolean"?"":(""+Y).trim()}}catch(gt){Ft(M,M.return,gt)}}}else if(n.tag===6){if(l===null){M=n;try{M.stateNode.nodeValue=m?"":M.memoizedProps}catch(gt){Ft(M,M.return,gt)}}}else if(n.tag===18){if(l===null){M=n;try{var q=M.stateNode;m?_g(q,!0):_g(M.stateNode,!1)}catch(gt){Ft(M,M.return,gt)}}}else if((n.tag!==22&&n.tag!==23||n.memoizedState===null||n===i)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===i)break t;for(;n.sibling===null;){if(n.return===null||n.return===i)break t;l===n&&(l=null),n=n.return}l===n&&(l=null),n.sibling.return=n.return,n=n.sibling}c&4&&(c=i.updateQueue,c!==null&&(l=c.retryQueue,l!==null&&(c.retryQueue=null,dl(i,l))));break;case 19:Ue(n,i),Be(i),c&4&&(c=i.updateQueue,c!==null&&(i.updateQueue=null,dl(i,c)));break;case 30:break;case 21:break;default:Ue(n,i),Be(i)}}function Be(i){var n=i.flags;if(n&2){try{for(var l,c=i.return;c!==null;){if(I0(c)){l=c;break}c=c.return}if(l==null)throw Error(s(160));switch(l.tag){case 27:var m=l.stateNode,y=Qu(i);fl(i,y,m);break;case 5:var T=l.stateNode;l.flags&32&&(vn(T,""),l.flags&=-33);var R=Qu(i);fl(i,R,T);break;case 3:case 4:var M=l.stateNode.containerInfo,j=Qu(i);Wu(i,j,M);break;default:throw Error(s(161))}}catch(W){Ft(i,i.return,W)}i.flags&=-3}n&4096&&(i.flags&=-4097)}function B0(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var n=i;B0(n),n.tag===5&&n.flags&1024&&n.stateNode.reset(),i=i.sibling}}function Wi(i,n){if(n.subtreeFlags&8772)for(n=n.child;n!==null;)O0(i,n.alternate,n),n=n.sibling}function sn(i){for(i=i.child;i!==null;){var n=i;switch(n.tag){case 0:case 11:case 14:case 15:Es(4,n,n.return),sn(n);break;case 1:_i(n,n.return);var l=n.stateNode;typeof l.componentWillUnmount=="function"&&_0(n,n.return,l),sn(n);break;case 27:Wr(n.stateNode);case 26:case 5:_i(n,n.return),sn(n);break;case 22:n.memoizedState===null&&sn(n);break;case 30:sn(n);break;default:sn(n)}i=i.sibling}}function Zi(i,n,l){for(l=l&&(n.subtreeFlags&8772)!==0,n=n.child;n!==null;){var c=n.alternate,m=i,y=n,T=y.flags;switch(y.tag){case 0:case 11:case 15:Zi(m,y,l),Gr(4,y);break;case 1:if(Zi(m,y,l),c=y,m=c.stateNode,typeof m.componentDidMount=="function")try{m.componentDidMount()}catch(j){Ft(c,c.return,j)}if(c=y,m=c.updateQueue,m!==null){var R=c.stateNode;try{var M=m.shared.hiddenCallbacks;if(M!==null)for(m.shared.hiddenCallbacks=null,m=0;m<M.length;m++)mh(M[m],R)}catch(j){Ft(c,c.return,j)}}l&&T&64&&R0(y),Hr(y,y.return);break;case 27:C0(y);case 26:case 5:Zi(m,y,l),l&&c===null&&T&4&&D0(y),Hr(y,y.return);break;case 12:Zi(m,y,l);break;case 31:Zi(m,y,l),l&&T&4&&N0(m,y);break;case 13:Zi(m,y,l),l&&T&4&&P0(m,y);break;case 22:y.memoizedState===null&&Zi(m,y,l),Hr(y,y.return);break;case 30:break;default:Zi(m,y,l)}n=n.sibling}}function Ju(i,n){var l=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(l=i.memoizedState.cachePool.pool),i=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(i=n.memoizedState.cachePool.pool),i!==l&&(i!=null&&i.refCount++,l!=null&&Dr(l))}function tc(i,n){i=null,n.alternate!==null&&(i=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==i&&(n.refCount++,i!=null&&Dr(i))}function Si(i,n,l,c){if(n.subtreeFlags&10256)for(n=n.child;n!==null;)F0(i,n,l,c),n=n.sibling}function F0(i,n,l,c){var m=n.flags;switch(n.tag){case 0:case 11:case 15:Si(i,n,l,c),m&2048&&Gr(9,n);break;case 1:Si(i,n,l,c);break;case 3:Si(i,n,l,c),m&2048&&(i=null,n.alternate!==null&&(i=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==i&&(n.refCount++,i!=null&&Dr(i)));break;case 12:if(m&2048){Si(i,n,l,c),i=n.stateNode;try{var y=n.memoizedProps,T=y.id,R=y.onPostCommit;typeof R=="function"&&R(T,n.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(M){Ft(n,n.return,M)}}else Si(i,n,l,c);break;case 31:Si(i,n,l,c);break;case 13:Si(i,n,l,c);break;case 23:break;case 22:y=n.stateNode,T=n.alternate,n.memoizedState!==null?y._visibility&2?Si(i,n,l,c):zr(i,n):y._visibility&2?Si(i,n,l,c):(y._visibility|=2,Bn(i,n,l,c,(n.subtreeFlags&10256)!==0||!1)),m&2048&&Ju(T,n);break;case 24:Si(i,n,l,c),m&2048&&tc(n.alternate,n);break;default:Si(i,n,l,c)}}function Bn(i,n,l,c,m){for(m=m&&((n.subtreeFlags&10256)!==0||!1),n=n.child;n!==null;){var y=i,T=n,R=l,M=c,j=T.flags;switch(T.tag){case 0:case 11:case 15:Bn(y,T,R,M,m),Gr(8,T);break;case 23:break;case 22:var W=T.stateNode;T.memoizedState!==null?W._visibility&2?Bn(y,T,R,M,m):zr(y,T):(W._visibility|=2,Bn(y,T,R,M,m)),m&&j&2048&&Ju(T.alternate,T);break;case 24:Bn(y,T,R,M,m),m&&j&2048&&tc(T.alternate,T);break;default:Bn(y,T,R,M,m)}n=n.sibling}}function zr(i,n){if(n.subtreeFlags&10256)for(n=n.child;n!==null;){var l=i,c=n,m=c.flags;switch(c.tag){case 22:zr(l,c),m&2048&&Ju(c.alternate,c);break;case 24:zr(l,c),m&2048&&tc(c.alternate,c);break;default:zr(l,c)}n=n.sibling}}var Kr=8192;function Fn(i,n,l){if(i.subtreeFlags&Kr)for(i=i.child;i!==null;)$0(i,n,l),i=i.sibling}function $0(i,n,l){switch(i.tag){case 26:Fn(i,n,l),i.flags&Kr&&i.memoizedState!==null&&vS(l,Ei,i.memoizedState,i.memoizedProps);break;case 5:Fn(i,n,l);break;case 3:case 4:var c=Ei;Ei=Rl(i.stateNode.containerInfo),Fn(i,n,l),Ei=c;break;case 22:i.memoizedState===null&&(c=i.alternate,c!==null&&c.memoizedState!==null?(c=Kr,Kr=16777216,Fn(i,n,l),Kr=c):Fn(i,n,l));break;default:Fn(i,n,l)}}function G0(i){var n=i.alternate;if(n!==null&&(i=n.child,i!==null)){n.child=null;do n=i.sibling,i.sibling=null,i=n;while(i!==null)}}function jr(i){var n=i.deletions;if((i.flags&16)!==0){if(n!==null)for(var l=0;l<n.length;l++){var c=n[l];ve=c,z0(c,i)}G0(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)H0(i),i=i.sibling}function H0(i){switch(i.tag){case 0:case 11:case 15:jr(i),i.flags&2048&&Es(9,i,i.return);break;case 3:jr(i);break;case 12:jr(i);break;case 22:var n=i.stateNode;i.memoizedState!==null&&n._visibility&2&&(i.return===null||i.return.tag!==13)?(n._visibility&=-3,hl(i)):jr(i);break;default:jr(i)}}function hl(i){var n=i.deletions;if((i.flags&16)!==0){if(n!==null)for(var l=0;l<n.length;l++){var c=n[l];ve=c,z0(c,i)}G0(i)}for(i=i.child;i!==null;){switch(n=i,n.tag){case 0:case 11:case 15:Es(8,n,n.return),hl(n);break;case 22:l=n.stateNode,l._visibility&2&&(l._visibility&=-3,hl(n));break;default:hl(n)}i=i.sibling}}function z0(i,n){for(;ve!==null;){var l=ve;switch(l.tag){case 0:case 11:case 15:Es(8,l,n);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var c=l.memoizedState.cachePool.pool;c!=null&&c.refCount++}break;case 24:Dr(l.memoizedState.cache)}if(c=l.child,c!==null)c.return=l,ve=c;else t:for(l=i;ve!==null;){c=ve;var m=c.sibling,y=c.return;if(M0(c),c===l){ve=null;break t}if(m!==null){m.return=y,ve=m;break t}ve=y}}}var ME={getCacheForType:function(i){var n=xe(oe),l=n.data.get(i);return l===void 0&&(l=i(),n.data.set(i,l)),l},cacheSignal:function(){return xe(oe).controller.signal}},wE=typeof WeakMap=="function"?WeakMap:Map,Ut=0,Yt=null,_t=null,Ct=0,Bt=0,Xe=null,Ss=!1,$n=!1,ec=!1,Ji=0,se=0,Ts=0,nn=0,ic=0,Qe=0,Gn=0,Vr=null,Fe=null,sc=!1,gl=0,K0=0,ml=1/0,pl=null,xs=null,de=0,As=null,Hn=null,ts=0,nc=0,rc=null,j0=null,Yr=0,ac=null;function We(){return(Ut&2)!==0&&Ct!==0?Ct&-Ct:N.T!==null?dc():ld()}function V0(){if(Qe===0)if((Ct&536870912)===0||Ot){var i=ba;ba<<=1,(ba&3932160)===0&&(ba=262144),Qe=i}else Qe=536870912;return i=Ye.current,i!==null&&(i.flags|=32),Qe}function $e(i,n,l){(i===Yt&&(Bt===2||Bt===9)||i.cancelPendingCommit!==null)&&(zn(i,0),bs(i,Ct,Qe,!1)),gr(i,l),((Ut&2)===0||i!==Yt)&&(i===Yt&&((Ut&2)===0&&(nn|=l),se===4&&bs(i,Ct,Qe,!1)),Di(i))}function Y0(i,n,l){if((Ut&6)!==0)throw Error(s(327));var c=!l&&(n&127)===0&&(n&i.expiredLanes)===0||hr(i,n),m=c?UE(i,n):oc(i,n,!0),y=c;do{if(m===0){$n&&!c&&bs(i,n,0,!1);break}else{if(l=i.current.alternate,y&&!NE(l)){m=oc(i,n,!1),y=!1;continue}if(m===2){if(y=n,i.errorRecoveryDisabledLanes&y)var T=0;else T=i.pendingLanes&-536870913,T=T!==0?T:T&536870912?536870912:0;if(T!==0){n=T;t:{var R=i;m=Vr;var M=R.current.memoizedState.isDehydrated;if(M&&(zn(R,T).flags|=256),T=oc(R,T,!1),T!==2){if(ec&&!M){R.errorRecoveryDisabledLanes|=y,nn|=y,m=4;break t}y=Fe,Fe=m,y!==null&&(Fe===null?Fe=y:Fe.push.apply(Fe,y))}m=T}if(y=!1,m!==2)continue}}if(m===1){zn(i,0),bs(i,n,0,!0);break}t:{switch(c=i,y=m,y){case 0:case 1:throw Error(s(345));case 4:if((n&4194048)!==n)break;case 6:bs(c,n,Qe,!Ss);break t;case 2:Fe=null;break;case 3:case 5:break;default:throw Error(s(329))}if((n&62914560)===n&&(m=gl+300-pe(),10<m)){if(bs(c,n,Qe,!Ss),Ra(c,0,!0)!==0)break t;ts=n,c.timeoutHandle=bg(q0.bind(null,c,l,Fe,pl,sc,n,Qe,nn,Gn,Ss,y,"Throttled",-0,0),m);break t}q0(c,l,Fe,pl,sc,n,Qe,nn,Gn,Ss,y,null,-0,0)}}break}while(!0);Di(i)}function q0(i,n,l,c,m,y,T,R,M,j,W,et,Y,q){if(i.timeoutHandle=-1,et=n.subtreeFlags,et&8192||(et&16785408)===16785408){et={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Fi},$0(n,y,et);var gt=(y&62914560)===y?gl-pe():(y&4194048)===y?K0-pe():0;if(gt=ES(et,gt),gt!==null){ts=y,i.cancelPendingCommit=gt(ig.bind(null,i,n,y,l,c,m,T,R,M,W,et,null,Y,q)),bs(i,y,T,!j);return}}ig(i,n,y,l,c,m,T,R,M)}function NE(i){for(var n=i;;){var l=n.tag;if((l===0||l===11||l===15)&&n.flags&16384&&(l=n.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var c=0;c<l.length;c++){var m=l[c],y=m.getSnapshot;m=m.value;try{if(!je(y(),m))return!1}catch{return!1}}if(l=n.child,n.subtreeFlags&16384&&l!==null)l.return=n,n=l;else{if(n===i)break;for(;n.sibling===null;){if(n.return===null||n.return===i)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function bs(i,n,l,c){n&=~ic,n&=~nn,i.suspendedLanes|=n,i.pingedLanes&=~n,c&&(i.warmLanes|=n),c=i.expirationTimes;for(var m=n;0<m;){var y=31-Ke(m),T=1<<y;c[y]=-1,m&=~T}l!==0&&nd(i,l,n)}function yl(){return(Ut&6)===0?(qr(0),!1):!0}function lc(){if(_t!==null){if(Bt===0)var i=_t.return;else i=_t,zi=qs=null,Au(i),Mn=null,Cr=0,i=_t;for(;i!==null;)L0(i.alternate,i),i=i.return;_t=null}}function zn(i,n){var l=i.timeoutHandle;l!==-1&&(i.timeoutHandle=-1,eS(l)),l=i.cancelPendingCommit,l!==null&&(i.cancelPendingCommit=null,l()),ts=0,lc(),Yt=i,_t=l=Gi(i.current,null),Ct=n,Bt=0,Xe=null,Ss=!1,$n=hr(i,n),ec=!1,Gn=Qe=ic=nn=Ts=se=0,Fe=Vr=null,sc=!1,(n&8)!==0&&(n|=n&32);var c=i.entangledLanes;if(c!==0)for(i=i.entanglements,c&=n;0<c;){var m=31-Ke(c),y=1<<m;n|=i[m],c&=~y}return Ji=n,Ba(),l}function X0(i,n){At=null,N.H=Br,n===On||n===Va?(n=fh(),Bt=3):n===fu?(n=fh(),Bt=4):Bt=n===Fu?8:n!==null&&typeof n=="object"&&typeof n.then=="function"?6:1,Xe=n,_t===null&&(se=1,al(i,li(n,i.current)))}function Q0(){var i=Ye.current;return i===null?!0:(Ct&4194048)===Ct?fi===null:(Ct&62914560)===Ct||(Ct&536870912)!==0?i===fi:!1}function W0(){var i=N.H;return N.H=Br,i===null?Br:i}function Z0(){var i=N.A;return N.A=ME,i}function vl(){se=4,Ss||(Ct&4194048)!==Ct&&Ye.current!==null||($n=!0),(Ts&134217727)===0&&(nn&134217727)===0||Yt===null||bs(Yt,Ct,Qe,!1)}function oc(i,n,l){var c=Ut;Ut|=2;var m=W0(),y=Z0();(Yt!==i||Ct!==n)&&(pl=null,zn(i,n)),n=!1;var T=se;t:do try{if(Bt!==0&&_t!==null){var R=_t,M=Xe;switch(Bt){case 8:lc(),T=6;break t;case 3:case 2:case 9:case 6:Ye.current===null&&(n=!0);var j=Bt;if(Bt=0,Xe=null,Kn(i,R,M,j),l&&$n){T=0;break t}break;default:j=Bt,Bt=0,Xe=null,Kn(i,R,M,j)}}PE(),T=se;break}catch(W){X0(i,W)}while(!0);return n&&i.shellSuspendCounter++,zi=qs=null,Ut=c,N.H=m,N.A=y,_t===null&&(Yt=null,Ct=0,Ba()),T}function PE(){for(;_t!==null;)J0(_t)}function UE(i,n){var l=Ut;Ut|=2;var c=W0(),m=Z0();Yt!==i||Ct!==n?(pl=null,ml=pe()+500,zn(i,n)):$n=hr(i,n);t:do try{if(Bt!==0&&_t!==null){n=_t;var y=Xe;e:switch(Bt){case 1:Bt=0,Xe=null,Kn(i,n,y,1);break;case 2:case 9:if(uh(y)){Bt=0,Xe=null,tg(n);break}n=function(){Bt!==2&&Bt!==9||Yt!==i||(Bt=7),Di(i)},y.then(n,n);break t;case 3:Bt=7;break t;case 4:Bt=5;break t;case 7:uh(y)?(Bt=0,Xe=null,tg(n)):(Bt=0,Xe=null,Kn(i,n,y,7));break;case 5:var T=null;switch(_t.tag){case 26:T=_t.memoizedState;case 5:case 27:var R=_t;if(T?Fg(T):R.stateNode.complete){Bt=0,Xe=null;var M=R.sibling;if(M!==null)_t=M;else{var j=R.return;j!==null?(_t=j,El(j)):_t=null}break e}}Bt=0,Xe=null,Kn(i,n,y,5);break;case 6:Bt=0,Xe=null,Kn(i,n,y,6);break;case 8:lc(),se=6;break t;default:throw Error(s(462))}}BE();break}catch(W){X0(i,W)}while(!0);return zi=qs=null,N.H=c,N.A=m,Ut=l,_t!==null?0:(Yt=null,Ct=0,Ba(),se)}function BE(){for(;_t!==null&&!Ui();)J0(_t)}function J0(i){var n=A0(i.alternate,i,Ji);i.memoizedProps=i.pendingProps,n===null?El(i):_t=n}function tg(i){var n=i,l=n.alternate;switch(n.tag){case 15:case 0:n=y0(l,n,n.pendingProps,n.type,void 0,Ct);break;case 11:n=y0(l,n,n.pendingProps,n.type.render,n.ref,Ct);break;case 5:Au(n);default:L0(l,n),n=_t=Zd(n,Ji),n=A0(l,n,Ji)}i.memoizedProps=i.pendingProps,n===null?El(i):_t=n}function Kn(i,n,l,c){zi=qs=null,Au(n),Mn=null,Cr=0;var m=n.return;try{if(RE(i,m,n,l,Ct)){se=1,al(i,li(l,i.current)),_t=null;return}}catch(y){if(m!==null)throw _t=m,y;se=1,al(i,li(l,i.current)),_t=null;return}n.flags&32768?(Ot||c===1?i=!0:$n||(Ct&536870912)!==0?i=!1:(Ss=i=!0,(c===2||c===9||c===3||c===6)&&(c=Ye.current,c!==null&&c.tag===13&&(c.flags|=16384))),eg(n,i)):El(n)}function El(i){var n=i;do{if((n.flags&32768)!==0){eg(n,Ss);return}i=n.return;var l=IE(n.alternate,n,Ji);if(l!==null){_t=l;return}if(n=n.sibling,n!==null){_t=n;return}_t=n=i}while(n!==null);se===0&&(se=5)}function eg(i,n){do{var l=CE(i.alternate,i);if(l!==null){l.flags&=32767,_t=l;return}if(l=i.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!n&&(i=i.sibling,i!==null)){_t=i;return}_t=i=l}while(i!==null);se=6,_t=null}function ig(i,n,l,c,m,y,T,R,M){i.cancelPendingCommit=null;do Sl();while(de!==0);if((Ut&6)!==0)throw Error(s(327));if(n!==null){if(n===i.current)throw Error(s(177));if(y=n.lanes|n.childLanes,y|=Qo,yv(i,l,y,T,R,M),i===Yt&&(_t=Yt=null,Ct=0),Hn=n,As=i,ts=l,nc=y,rc=m,j0=c,(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,HE(fn,function(){return lg(),null})):(i.callbackNode=null,i.callbackPriority=0),c=(n.flags&13878)!==0,(n.subtreeFlags&13878)!==0||c){c=N.T,N.T=null,m=X.p,X.p=2,T=Ut,Ut|=4;try{kE(i,n,l)}finally{Ut=T,X.p=m,N.T=c}}de=1,sg(),ng(),rg()}}function sg(){if(de===1){de=0;var i=As,n=Hn,l=(n.flags&13878)!==0;if((n.subtreeFlags&13878)!==0||l){l=N.T,N.T=null;var c=X.p;X.p=2;var m=Ut;Ut|=4;try{U0(n,i);var y=Sc,T=zd(i.containerInfo),R=y.focusedElem,M=y.selectionRange;if(T!==R&&R&&R.ownerDocument&&Hd(R.ownerDocument.documentElement,R)){if(M!==null&&jo(R)){var j=M.start,W=M.end;if(W===void 0&&(W=j),"selectionStart"in R)R.selectionStart=j,R.selectionEnd=Math.min(W,R.value.length);else{var et=R.ownerDocument||document,Y=et&&et.defaultView||window;if(Y.getSelection){var q=Y.getSelection(),gt=R.textContent.length,vt=Math.min(M.start,gt),Kt=M.end===void 0?vt:Math.min(M.end,gt);!q.extend&&vt>Kt&&(T=Kt,Kt=vt,vt=T);var F=Gd(R,vt),P=Gd(R,Kt);if(F&&P&&(q.rangeCount!==1||q.anchorNode!==F.node||q.anchorOffset!==F.offset||q.focusNode!==P.node||q.focusOffset!==P.offset)){var K=et.createRange();K.setStart(F.node,F.offset),q.removeAllRanges(),vt>Kt?(q.addRange(K),q.extend(P.node,P.offset)):(K.setEnd(P.node,P.offset),q.addRange(K))}}}}for(et=[],q=R;q=q.parentNode;)q.nodeType===1&&et.push({element:q,left:q.scrollLeft,top:q.scrollTop});for(typeof R.focus=="function"&&R.focus(),R=0;R<et.length;R++){var tt=et[R];tt.element.scrollLeft=tt.left,tt.element.scrollTop=tt.top}}Ol=!!Ec,Sc=Ec=null}finally{Ut=m,X.p=c,N.T=l}}i.current=n,de=2}}function ng(){if(de===2){de=0;var i=As,n=Hn,l=(n.flags&8772)!==0;if((n.subtreeFlags&8772)!==0||l){l=N.T,N.T=null;var c=X.p;X.p=2;var m=Ut;Ut|=4;try{O0(i,n.alternate,n)}finally{Ut=m,X.p=c,N.T=l}}de=3}}function rg(){if(de===4||de===3){de=0,Sa();var i=As,n=Hn,l=ts,c=j0;(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?de=5:(de=0,Hn=As=null,ag(i,i.pendingLanes));var m=i.pendingLanes;if(m===0&&(xs=null),Ro(l),n=n.stateNode,ze&&typeof ze.onCommitFiberRoot=="function")try{ze.onCommitFiberRoot(dr,n,void 0,(n.current.flags&128)===128)}catch{}if(c!==null){n=N.T,m=X.p,X.p=2,N.T=null;try{for(var y=i.onRecoverableError,T=0;T<c.length;T++){var R=c[T];y(R.value,{componentStack:R.stack})}}finally{N.T=n,X.p=m}}(ts&3)!==0&&Sl(),Di(i),m=i.pendingLanes,(l&261930)!==0&&(m&42)!==0?i===ac?Yr++:(Yr=0,ac=i):Yr=0,qr(0)}}function ag(i,n){(i.pooledCacheLanes&=n)===0&&(n=i.pooledCache,n!=null&&(i.pooledCache=null,Dr(n)))}function Sl(){return sg(),ng(),rg(),lg()}function lg(){if(de!==5)return!1;var i=As,n=nc;nc=0;var l=Ro(ts),c=N.T,m=X.p;try{X.p=32>l?32:l,N.T=null,l=rc,rc=null;var y=As,T=ts;if(de=0,Hn=As=null,ts=0,(Ut&6)!==0)throw Error(s(331));var R=Ut;if(Ut|=4,H0(y.current),F0(y,y.current,T,l),Ut=R,qr(0,!1),ze&&typeof ze.onPostCommitFiberRoot=="function")try{ze.onPostCommitFiberRoot(dr,y)}catch{}return!0}finally{X.p=m,N.T=c,ag(i,n)}}function og(i,n,l){n=li(l,n),n=Bu(i.stateNode,n,2),i=ps(i,n,2),i!==null&&(gr(i,2),Di(i))}function Ft(i,n,l){if(i.tag===3)og(i,i,l);else for(;n!==null;){if(n.tag===3){og(n,i,l);break}else if(n.tag===1){var c=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(xs===null||!xs.has(c))){i=li(l,i),l=u0(2),c=ps(n,l,2),c!==null&&(c0(l,c,n,i),gr(c,2),Di(c));break}}n=n.return}}function uc(i,n,l){var c=i.pingCache;if(c===null){c=i.pingCache=new wE;var m=new Set;c.set(n,m)}else m=c.get(n),m===void 0&&(m=new Set,c.set(n,m));m.has(l)||(ec=!0,m.add(l),i=FE.bind(null,i,n,l),n.then(i,i))}function FE(i,n,l){var c=i.pingCache;c!==null&&c.delete(n),i.pingedLanes|=i.suspendedLanes&l,i.warmLanes&=~l,Yt===i&&(Ct&l)===l&&(se===4||se===3&&(Ct&62914560)===Ct&&300>pe()-gl?(Ut&2)===0&&zn(i,0):ic|=l,Gn===Ct&&(Gn=0)),Di(i)}function ug(i,n){n===0&&(n=sd()),i=js(i,n),i!==null&&(gr(i,n),Di(i))}function $E(i){var n=i.memoizedState,l=0;n!==null&&(l=n.retryLane),ug(i,l)}function GE(i,n){var l=0;switch(i.tag){case 31:case 13:var c=i.stateNode,m=i.memoizedState;m!==null&&(l=m.retryLane);break;case 19:c=i.stateNode;break;case 22:c=i.stateNode._retryCache;break;default:throw Error(s(314))}c!==null&&c.delete(n),ug(i,l)}function HE(i,n){return ke(i,n)}var Tl=null,jn=null,cc=!1,xl=!1,fc=!1,Ls=0;function Di(i){i!==jn&&i.next===null&&(jn===null?Tl=jn=i:jn=jn.next=i),xl=!0,cc||(cc=!0,KE())}function qr(i,n){if(!fc&&xl){fc=!0;do for(var l=!1,c=Tl;c!==null;){if(i!==0){var m=c.pendingLanes;if(m===0)var y=0;else{var T=c.suspendedLanes,R=c.pingedLanes;y=(1<<31-Ke(42|i)+1)-1,y&=m&~(T&~R),y=y&201326741?y&201326741|1:y?y|2:0}y!==0&&(l=!0,hg(c,y))}else y=Ct,y=Ra(c,c===Yt?y:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),(y&3)===0||hr(c,y)||(l=!0,hg(c,y));c=c.next}while(l);fc=!1}}function zE(){cg()}function cg(){xl=cc=!1;var i=0;Ls!==0&&tS()&&(i=Ls);for(var n=pe(),l=null,c=Tl;c!==null;){var m=c.next,y=fg(c,n);y===0?(c.next=null,l===null?Tl=m:l.next=m,m===null&&(jn=l)):(l=c,(i!==0||(y&3)!==0)&&(xl=!0)),c=m}de!==0&&de!==5||qr(i),Ls!==0&&(Ls=0)}function fg(i,n){for(var l=i.suspendedLanes,c=i.pingedLanes,m=i.expirationTimes,y=i.pendingLanes&-62914561;0<y;){var T=31-Ke(y),R=1<<T,M=m[T];M===-1?((R&l)===0||(R&c)!==0)&&(m[T]=pv(R,n)):M<=n&&(i.expiredLanes|=R),y&=~R}if(n=Yt,l=Ct,l=Ra(i,i===n?l:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),c=i.callbackNode,l===0||i===n&&(Bt===2||Bt===9)||i.cancelPendingCommit!==null)return c!==null&&c!==null&&bi(c),i.callbackNode=null,i.callbackPriority=0;if((l&3)===0||hr(i,l)){if(n=l&-l,n===i.callbackPriority)return n;switch(c!==null&&bi(c),Ro(l)){case 2:case 8:l=cr;break;case 32:l=fn;break;case 268435456:l=fr;break;default:l=fn}return c=dg.bind(null,i),l=ke(l,c),i.callbackPriority=n,i.callbackNode=l,n}return c!==null&&c!==null&&bi(c),i.callbackPriority=2,i.callbackNode=null,2}function dg(i,n){if(de!==0&&de!==5)return i.callbackNode=null,i.callbackPriority=0,null;var l=i.callbackNode;if(Sl()&&i.callbackNode!==l)return null;var c=Ct;return c=Ra(i,i===Yt?c:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),c===0?null:(Y0(i,c,n),fg(i,pe()),i.callbackNode!=null&&i.callbackNode===l?dg.bind(null,i):null)}function hg(i,n){if(Sl())return null;Y0(i,n,!0)}function KE(){iS(function(){(Ut&6)!==0?ke(as,zE):cg()})}function dc(){if(Ls===0){var i=Cn;i===0&&(i=Aa,Aa<<=1,(Aa&261888)===0&&(Aa=256)),Ls=i}return Ls}function gg(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:Ca(""+i)}function mg(i,n){var l=n.ownerDocument.createElement("input");return l.name=n.name,l.value=n.value,i.id&&l.setAttribute("form",i.id),n.parentNode.insertBefore(l,n),i=new FormData(i),l.parentNode.removeChild(l),i}function jE(i,n,l,c,m){if(n==="submit"&&l&&l.stateNode===m){var y=gg((m[we]||null).action),T=c.submitter;T&&(n=(n=T[we]||null)?gg(n.formAction):T.getAttribute("formAction"),n!==null&&(y=n,T=null));var R=new wa("action","action",null,c,m);i.push({event:R,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(Ls!==0){var M=T?mg(m,T):new FormData(m);Ou(l,{pending:!0,data:M,method:m.method,action:y},null,M)}}else typeof y=="function"&&(R.preventDefault(),M=T?mg(m,T):new FormData(m),Ou(l,{pending:!0,data:M,method:m.method,action:y},y,M))},currentTarget:m}]})}}for(var hc=0;hc<Xo.length;hc++){var gc=Xo[hc],VE=gc.toLowerCase(),YE=gc[0].toUpperCase()+gc.slice(1);vi(VE,"on"+YE)}vi(Vd,"onAnimationEnd"),vi(Yd,"onAnimationIteration"),vi(qd,"onAnimationStart"),vi("dblclick","onDoubleClick"),vi("focusin","onFocus"),vi("focusout","onBlur"),vi(uE,"onTransitionRun"),vi(cE,"onTransitionStart"),vi(fE,"onTransitionCancel"),vi(Xd,"onTransitionEnd"),pn("onMouseEnter",["mouseout","mouseover"]),pn("onMouseLeave",["mouseout","mouseover"]),pn("onPointerEnter",["pointerout","pointerover"]),pn("onPointerLeave",["pointerout","pointerover"]),Gs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Gs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Gs("onBeforeInput",["compositionend","keypress","textInput","paste"]),Gs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Gs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Gs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Xr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),qE=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Xr));function pg(i,n){n=(n&4)!==0;for(var l=0;l<i.length;l++){var c=i[l],m=c.event;c=c.listeners;t:{var y=void 0;if(n)for(var T=c.length-1;0<=T;T--){var R=c[T],M=R.instance,j=R.currentTarget;if(R=R.listener,M!==y&&m.isPropagationStopped())break t;y=R,m.currentTarget=j;try{y(m)}catch(W){Ua(W)}m.currentTarget=null,y=M}else for(T=0;T<c.length;T++){if(R=c[T],M=R.instance,j=R.currentTarget,R=R.listener,M!==y&&m.isPropagationStopped())break t;y=R,m.currentTarget=j;try{y(m)}catch(W){Ua(W)}m.currentTarget=null,y=M}}}}function Dt(i,n){var l=n[_o];l===void 0&&(l=n[_o]=new Set);var c=i+"__bubble";l.has(c)||(yg(n,i,2,!1),l.add(c))}function mc(i,n,l){var c=0;n&&(c|=4),yg(l,i,c,n)}var Al="_reactListening"+Math.random().toString(36).slice(2);function pc(i){if(!i[Al]){i[Al]=!0,cd.forEach(function(l){l!=="selectionchange"&&(qE.has(l)||mc(l,!1,i),mc(l,!0,i))});var n=i.nodeType===9?i:i.ownerDocument;n===null||n[Al]||(n[Al]=!0,mc("selectionchange",!1,n))}}function yg(i,n,l,c){switch(Vg(n)){case 2:var m=xS;break;case 8:m=AS;break;default:m=kc}l=m.bind(null,n,l,i),m=void 0,!Po||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(m=!0),c?m!==void 0?i.addEventListener(n,l,{capture:!0,passive:m}):i.addEventListener(n,l,!0):m!==void 0?i.addEventListener(n,l,{passive:m}):i.addEventListener(n,l,!1)}function yc(i,n,l,c,m){var y=c;if((n&1)===0&&(n&2)===0&&c!==null)t:for(;;){if(c===null)return;var T=c.tag;if(T===3||T===4){var R=c.stateNode.containerInfo;if(R===m)break;if(T===4)for(T=c.return;T!==null;){var M=T.tag;if((M===3||M===4)&&T.stateNode.containerInfo===m)return;T=T.return}for(;R!==null;){if(T=hn(R),T===null)return;if(M=T.tag,M===5||M===6||M===26||M===27){c=y=T;continue t}R=R.parentNode}}c=c.return}xd(function(){var j=y,W=wo(l),et=[];t:{var Y=Qd.get(i);if(Y!==void 0){var q=wa,gt=i;switch(i){case"keypress":if(Oa(l)===0)break t;case"keydown":case"keyup":q=Gv;break;case"focusin":gt="focus",q=$o;break;case"focusout":gt="blur",q=$o;break;case"beforeblur":case"afterblur":q=$o;break;case"click":if(l.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":q=Ld;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":q=Iv;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":q=Kv;break;case Vd:case Yd:case qd:q=Ov;break;case Xd:q=Vv;break;case"scroll":case"scrollend":q=_v;break;case"wheel":q=qv;break;case"copy":case"cut":case"paste":q=wv;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":q=_d;break;case"toggle":case"beforetoggle":q=Qv}var vt=(n&4)!==0,Kt=!vt&&(i==="scroll"||i==="scrollend"),F=vt?Y!==null?Y+"Capture":null:Y;vt=[];for(var P=j,K;P!==null;){var tt=P;if(K=tt.stateNode,tt=tt.tag,tt!==5&&tt!==26&&tt!==27||K===null||F===null||(tt=yr(P,F),tt!=null&&vt.push(Qr(P,tt,K))),Kt)break;P=P.return}0<vt.length&&(Y=new q(Y,gt,null,l,W),et.push({event:Y,listeners:vt}))}}if((n&7)===0){t:{if(Y=i==="mouseover"||i==="pointerover",q=i==="mouseout"||i==="pointerout",Y&&l!==Mo&&(gt=l.relatedTarget||l.fromElement)&&(hn(gt)||gt[dn]))break t;if((q||Y)&&(Y=W.window===W?W:(Y=W.ownerDocument)?Y.defaultView||Y.parentWindow:window,q?(gt=l.relatedTarget||l.toElement,q=j,gt=gt?hn(gt):null,gt!==null&&(Kt=a(gt),vt=gt.tag,gt!==Kt||vt!==5&&vt!==27&&vt!==6)&&(gt=null)):(q=null,gt=j),q!==gt)){if(vt=Ld,tt="onMouseLeave",F="onMouseEnter",P="mouse",(i==="pointerout"||i==="pointerover")&&(vt=_d,tt="onPointerLeave",F="onPointerEnter",P="pointer"),Kt=q==null?Y:pr(q),K=gt==null?Y:pr(gt),Y=new vt(tt,P+"leave",q,l,W),Y.target=Kt,Y.relatedTarget=K,tt=null,hn(W)===j&&(vt=new vt(F,P+"enter",gt,l,W),vt.target=K,vt.relatedTarget=Kt,tt=vt),Kt=tt,q&&gt)e:{for(vt=XE,F=q,P=gt,K=0,tt=F;tt;tt=vt(tt))K++;tt=0;for(var yt=P;yt;yt=vt(yt))tt++;for(;0<K-tt;)F=vt(F),K--;for(;0<tt-K;)P=vt(P),tt--;for(;K--;){if(F===P||P!==null&&F===P.alternate){vt=F;break e}F=vt(F),P=vt(P)}vt=null}else vt=null;q!==null&&vg(et,Y,q,vt,!1),gt!==null&&Kt!==null&&vg(et,Kt,gt,vt,!0)}}t:{if(Y=j?pr(j):window,q=Y.nodeName&&Y.nodeName.toLowerCase(),q==="select"||q==="input"&&Y.type==="file")var Nt=Nd;else if(Md(Y))if(Pd)Nt=aE;else{Nt=nE;var mt=sE}else q=Y.nodeName,!q||q.toLowerCase()!=="input"||Y.type!=="checkbox"&&Y.type!=="radio"?j&&Oo(j.elementType)&&(Nt=Nd):Nt=rE;if(Nt&&(Nt=Nt(i,j))){wd(et,Nt,l,W);break t}mt&&mt(i,Y,j),i==="focusout"&&j&&Y.type==="number"&&j.memoizedProps.value!=null&&ko(Y,"number",Y.value)}switch(mt=j?pr(j):window,i){case"focusin":(Md(mt)||mt.contentEditable==="true")&&(xn=mt,Vo=j,Lr=null);break;case"focusout":Lr=Vo=xn=null;break;case"mousedown":Yo=!0;break;case"contextmenu":case"mouseup":case"dragend":Yo=!1,Kd(et,l,W);break;case"selectionchange":if(oE)break;case"keydown":case"keyup":Kd(et,l,W)}var bt;if(Ho)t:{switch(i){case"compositionstart":var kt="onCompositionStart";break t;case"compositionend":kt="onCompositionEnd";break t;case"compositionupdate":kt="onCompositionUpdate";break t}kt=void 0}else Tn?kd(i,l)&&(kt="onCompositionEnd"):i==="keydown"&&l.keyCode===229&&(kt="onCompositionStart");kt&&(Dd&&l.locale!=="ko"&&(Tn||kt!=="onCompositionStart"?kt==="onCompositionEnd"&&Tn&&(bt=Ad()):(us=W,Uo="value"in us?us.value:us.textContent,Tn=!0)),mt=bl(j,kt),0<mt.length&&(kt=new Rd(kt,i,null,l,W),et.push({event:kt,listeners:mt}),bt?kt.data=bt:(bt=Od(l),bt!==null&&(kt.data=bt)))),(bt=Zv?Jv(i,l):tE(i,l))&&(kt=bl(j,"onBeforeInput"),0<kt.length&&(mt=new Rd("onBeforeInput","beforeinput",null,l,W),et.push({event:mt,listeners:kt}),mt.data=bt)),jE(et,i,j,l,W)}pg(et,n)})}function Qr(i,n,l){return{instance:i,listener:n,currentTarget:l}}function bl(i,n){for(var l=n+"Capture",c=[];i!==null;){var m=i,y=m.stateNode;if(m=m.tag,m!==5&&m!==26&&m!==27||y===null||(m=yr(i,l),m!=null&&c.unshift(Qr(i,m,y)),m=yr(i,n),m!=null&&c.push(Qr(i,m,y))),i.tag===3)return c;i=i.return}return[]}function XE(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function vg(i,n,l,c,m){for(var y=n._reactName,T=[];l!==null&&l!==c;){var R=l,M=R.alternate,j=R.stateNode;if(R=R.tag,M!==null&&M===c)break;R!==5&&R!==26&&R!==27||j===null||(M=j,m?(j=yr(l,y),j!=null&&T.unshift(Qr(l,j,M))):m||(j=yr(l,y),j!=null&&T.push(Qr(l,j,M)))),l=l.return}T.length!==0&&i.push({event:n,listeners:T})}var QE=/\r\n?/g,WE=/\u0000|\uFFFD/g;function Eg(i){return(typeof i=="string"?i:""+i).replace(QE,`
`).replace(WE,"")}function Sg(i,n){return n=Eg(n),Eg(i)===n}function zt(i,n,l,c,m,y){switch(l){case"children":typeof c=="string"?n==="body"||n==="textarea"&&c===""||vn(i,c):(typeof c=="number"||typeof c=="bigint")&&n!=="body"&&vn(i,""+c);break;case"className":Da(i,"class",c);break;case"tabIndex":Da(i,"tabindex",c);break;case"dir":case"role":case"viewBox":case"width":case"height":Da(i,l,c);break;case"style":Sd(i,c,y);break;case"data":if(n!=="object"){Da(i,"data",c);break}case"src":case"href":if(c===""&&(n!=="a"||l!=="href")){i.removeAttribute(l);break}if(c==null||typeof c=="function"||typeof c=="symbol"||typeof c=="boolean"){i.removeAttribute(l);break}c=Ca(""+c),i.setAttribute(l,c);break;case"action":case"formAction":if(typeof c=="function"){i.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof y=="function"&&(l==="formAction"?(n!=="input"&&zt(i,n,"name",m.name,m,null),zt(i,n,"formEncType",m.formEncType,m,null),zt(i,n,"formMethod",m.formMethod,m,null),zt(i,n,"formTarget",m.formTarget,m,null)):(zt(i,n,"encType",m.encType,m,null),zt(i,n,"method",m.method,m,null),zt(i,n,"target",m.target,m,null)));if(c==null||typeof c=="symbol"||typeof c=="boolean"){i.removeAttribute(l);break}c=Ca(""+c),i.setAttribute(l,c);break;case"onClick":c!=null&&(i.onclick=Fi);break;case"onScroll":c!=null&&Dt("scroll",i);break;case"onScrollEnd":c!=null&&Dt("scrollend",i);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(s(61));if(l=c.__html,l!=null){if(m.children!=null)throw Error(s(60));i.innerHTML=l}}break;case"multiple":i.multiple=c&&typeof c!="function"&&typeof c!="symbol";break;case"muted":i.muted=c&&typeof c!="function"&&typeof c!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(c==null||typeof c=="function"||typeof c=="boolean"||typeof c=="symbol"){i.removeAttribute("xlink:href");break}l=Ca(""+c),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":c!=null&&typeof c!="function"&&typeof c!="symbol"?i.setAttribute(l,""+c):i.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":c&&typeof c!="function"&&typeof c!="symbol"?i.setAttribute(l,""):i.removeAttribute(l);break;case"capture":case"download":c===!0?i.setAttribute(l,""):c!==!1&&c!=null&&typeof c!="function"&&typeof c!="symbol"?i.setAttribute(l,c):i.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":c!=null&&typeof c!="function"&&typeof c!="symbol"&&!isNaN(c)&&1<=c?i.setAttribute(l,c):i.removeAttribute(l);break;case"rowSpan":case"start":c==null||typeof c=="function"||typeof c=="symbol"||isNaN(c)?i.removeAttribute(l):i.setAttribute(l,c);break;case"popover":Dt("beforetoggle",i),Dt("toggle",i),_a(i,"popover",c);break;case"xlinkActuate":Bi(i,"http://www.w3.org/1999/xlink","xlink:actuate",c);break;case"xlinkArcrole":Bi(i,"http://www.w3.org/1999/xlink","xlink:arcrole",c);break;case"xlinkRole":Bi(i,"http://www.w3.org/1999/xlink","xlink:role",c);break;case"xlinkShow":Bi(i,"http://www.w3.org/1999/xlink","xlink:show",c);break;case"xlinkTitle":Bi(i,"http://www.w3.org/1999/xlink","xlink:title",c);break;case"xlinkType":Bi(i,"http://www.w3.org/1999/xlink","xlink:type",c);break;case"xmlBase":Bi(i,"http://www.w3.org/XML/1998/namespace","xml:base",c);break;case"xmlLang":Bi(i,"http://www.w3.org/XML/1998/namespace","xml:lang",c);break;case"xmlSpace":Bi(i,"http://www.w3.org/XML/1998/namespace","xml:space",c);break;case"is":_a(i,"is",c);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=Lv.get(l)||l,_a(i,l,c))}}function vc(i,n,l,c,m,y){switch(l){case"style":Sd(i,c,y);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(s(61));if(l=c.__html,l!=null){if(m.children!=null)throw Error(s(60));i.innerHTML=l}}break;case"children":typeof c=="string"?vn(i,c):(typeof c=="number"||typeof c=="bigint")&&vn(i,""+c);break;case"onScroll":c!=null&&Dt("scroll",i);break;case"onScrollEnd":c!=null&&Dt("scrollend",i);break;case"onClick":c!=null&&(i.onclick=Fi);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!fd.hasOwnProperty(l))t:{if(l[0]==="o"&&l[1]==="n"&&(m=l.endsWith("Capture"),n=l.slice(2,m?l.length-7:void 0),y=i[we]||null,y=y!=null?y[l]:null,typeof y=="function"&&i.removeEventListener(n,y,m),typeof c=="function")){typeof y!="function"&&y!==null&&(l in i?i[l]=null:i.hasAttribute(l)&&i.removeAttribute(l)),i.addEventListener(n,c,m);break t}l in i?i[l]=c:c===!0?i.setAttribute(l,""):_a(i,l,c)}}}function be(i,n,l){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Dt("error",i),Dt("load",i);var c=!1,m=!1,y;for(y in l)if(l.hasOwnProperty(y)){var T=l[y];if(T!=null)switch(y){case"src":c=!0;break;case"srcSet":m=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,n));default:zt(i,n,y,T,l,null)}}m&&zt(i,n,"srcSet",l.srcSet,l,null),c&&zt(i,n,"src",l.src,l,null);return;case"input":Dt("invalid",i);var R=y=T=m=null,M=null,j=null;for(c in l)if(l.hasOwnProperty(c)){var W=l[c];if(W!=null)switch(c){case"name":m=W;break;case"type":T=W;break;case"checked":M=W;break;case"defaultChecked":j=W;break;case"value":y=W;break;case"defaultValue":R=W;break;case"children":case"dangerouslySetInnerHTML":if(W!=null)throw Error(s(137,n));break;default:zt(i,n,c,W,l,null)}}pd(i,y,R,M,j,T,m,!1);return;case"select":Dt("invalid",i),c=T=y=null;for(m in l)if(l.hasOwnProperty(m)&&(R=l[m],R!=null))switch(m){case"value":y=R;break;case"defaultValue":T=R;break;case"multiple":c=R;default:zt(i,n,m,R,l,null)}n=y,l=T,i.multiple=!!c,n!=null?yn(i,!!c,n,!1):l!=null&&yn(i,!!c,l,!0);return;case"textarea":Dt("invalid",i),y=m=c=null;for(T in l)if(l.hasOwnProperty(T)&&(R=l[T],R!=null))switch(T){case"value":c=R;break;case"defaultValue":m=R;break;case"children":y=R;break;case"dangerouslySetInnerHTML":if(R!=null)throw Error(s(91));break;default:zt(i,n,T,R,l,null)}vd(i,c,m,y);return;case"option":for(M in l)if(l.hasOwnProperty(M)&&(c=l[M],c!=null))switch(M){case"selected":i.selected=c&&typeof c!="function"&&typeof c!="symbol";break;default:zt(i,n,M,c,l,null)}return;case"dialog":Dt("beforetoggle",i),Dt("toggle",i),Dt("cancel",i),Dt("close",i);break;case"iframe":case"object":Dt("load",i);break;case"video":case"audio":for(c=0;c<Xr.length;c++)Dt(Xr[c],i);break;case"image":Dt("error",i),Dt("load",i);break;case"details":Dt("toggle",i);break;case"embed":case"source":case"link":Dt("error",i),Dt("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(j in l)if(l.hasOwnProperty(j)&&(c=l[j],c!=null))switch(j){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,n));default:zt(i,n,j,c,l,null)}return;default:if(Oo(n)){for(W in l)l.hasOwnProperty(W)&&(c=l[W],c!==void 0&&vc(i,n,W,c,l,void 0));return}}for(R in l)l.hasOwnProperty(R)&&(c=l[R],c!=null&&zt(i,n,R,c,l,null))}function ZE(i,n,l,c){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var m=null,y=null,T=null,R=null,M=null,j=null,W=null;for(q in l){var et=l[q];if(l.hasOwnProperty(q)&&et!=null)switch(q){case"checked":break;case"value":break;case"defaultValue":M=et;default:c.hasOwnProperty(q)||zt(i,n,q,null,c,et)}}for(var Y in c){var q=c[Y];if(et=l[Y],c.hasOwnProperty(Y)&&(q!=null||et!=null))switch(Y){case"type":y=q;break;case"name":m=q;break;case"checked":j=q;break;case"defaultChecked":W=q;break;case"value":T=q;break;case"defaultValue":R=q;break;case"children":case"dangerouslySetInnerHTML":if(q!=null)throw Error(s(137,n));break;default:q!==et&&zt(i,n,Y,q,c,et)}}Co(i,T,R,M,j,W,y,m);return;case"select":q=T=R=Y=null;for(y in l)if(M=l[y],l.hasOwnProperty(y)&&M!=null)switch(y){case"value":break;case"multiple":q=M;default:c.hasOwnProperty(y)||zt(i,n,y,null,c,M)}for(m in c)if(y=c[m],M=l[m],c.hasOwnProperty(m)&&(y!=null||M!=null))switch(m){case"value":Y=y;break;case"defaultValue":R=y;break;case"multiple":T=y;default:y!==M&&zt(i,n,m,y,c,M)}n=R,l=T,c=q,Y!=null?yn(i,!!l,Y,!1):!!c!=!!l&&(n!=null?yn(i,!!l,n,!0):yn(i,!!l,l?[]:"",!1));return;case"textarea":q=Y=null;for(R in l)if(m=l[R],l.hasOwnProperty(R)&&m!=null&&!c.hasOwnProperty(R))switch(R){case"value":break;case"children":break;default:zt(i,n,R,null,c,m)}for(T in c)if(m=c[T],y=l[T],c.hasOwnProperty(T)&&(m!=null||y!=null))switch(T){case"value":Y=m;break;case"defaultValue":q=m;break;case"children":break;case"dangerouslySetInnerHTML":if(m!=null)throw Error(s(91));break;default:m!==y&&zt(i,n,T,m,c,y)}yd(i,Y,q);return;case"option":for(var gt in l)if(Y=l[gt],l.hasOwnProperty(gt)&&Y!=null&&!c.hasOwnProperty(gt))switch(gt){case"selected":i.selected=!1;break;default:zt(i,n,gt,null,c,Y)}for(M in c)if(Y=c[M],q=l[M],c.hasOwnProperty(M)&&Y!==q&&(Y!=null||q!=null))switch(M){case"selected":i.selected=Y&&typeof Y!="function"&&typeof Y!="symbol";break;default:zt(i,n,M,Y,c,q)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var vt in l)Y=l[vt],l.hasOwnProperty(vt)&&Y!=null&&!c.hasOwnProperty(vt)&&zt(i,n,vt,null,c,Y);for(j in c)if(Y=c[j],q=l[j],c.hasOwnProperty(j)&&Y!==q&&(Y!=null||q!=null))switch(j){case"children":case"dangerouslySetInnerHTML":if(Y!=null)throw Error(s(137,n));break;default:zt(i,n,j,Y,c,q)}return;default:if(Oo(n)){for(var Kt in l)Y=l[Kt],l.hasOwnProperty(Kt)&&Y!==void 0&&!c.hasOwnProperty(Kt)&&vc(i,n,Kt,void 0,c,Y);for(W in c)Y=c[W],q=l[W],!c.hasOwnProperty(W)||Y===q||Y===void 0&&q===void 0||vc(i,n,W,Y,c,q);return}}for(var F in l)Y=l[F],l.hasOwnProperty(F)&&Y!=null&&!c.hasOwnProperty(F)&&zt(i,n,F,null,c,Y);for(et in c)Y=c[et],q=l[et],!c.hasOwnProperty(et)||Y===q||Y==null&&q==null||zt(i,n,et,Y,c,q)}function Tg(i){switch(i){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function JE(){if(typeof performance.getEntriesByType=="function"){for(var i=0,n=0,l=performance.getEntriesByType("resource"),c=0;c<l.length;c++){var m=l[c],y=m.transferSize,T=m.initiatorType,R=m.duration;if(y&&R&&Tg(T)){for(T=0,R=m.responseEnd,c+=1;c<l.length;c++){var M=l[c],j=M.startTime;if(j>R)break;var W=M.transferSize,et=M.initiatorType;W&&Tg(et)&&(M=M.responseEnd,T+=W*(M<R?1:(R-j)/(M-j)))}if(--c,n+=8*(y+T)/(m.duration/1e3),i++,10<i)break}}if(0<i)return n/i/1e6}return navigator.connection&&(i=navigator.connection.downlink,typeof i=="number")?i:5}var Ec=null,Sc=null;function Ll(i){return i.nodeType===9?i:i.ownerDocument}function xg(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Ag(i,n){if(i===0)switch(n){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&n==="foreignObject"?0:i}function Tc(i,n){return i==="textarea"||i==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.children=="bigint"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var xc=null;function tS(){var i=window.event;return i&&i.type==="popstate"?i===xc?!1:(xc=i,!0):(xc=null,!1)}var bg=typeof setTimeout=="function"?setTimeout:void 0,eS=typeof clearTimeout=="function"?clearTimeout:void 0,Lg=typeof Promise=="function"?Promise:void 0,iS=typeof queueMicrotask=="function"?queueMicrotask:typeof Lg<"u"?function(i){return Lg.resolve(null).then(i).catch(sS)}:bg;function sS(i){setTimeout(function(){throw i})}function Rs(i){return i==="head"}function Rg(i,n){var l=n,c=0;do{var m=l.nextSibling;if(i.removeChild(l),m&&m.nodeType===8)if(l=m.data,l==="/$"||l==="/&"){if(c===0){i.removeChild(m),Xn(n);return}c--}else if(l==="$"||l==="$?"||l==="$~"||l==="$!"||l==="&")c++;else if(l==="html")Wr(i.ownerDocument.documentElement);else if(l==="head"){l=i.ownerDocument.head,Wr(l);for(var y=l.firstChild;y;){var T=y.nextSibling,R=y.nodeName;y[mr]||R==="SCRIPT"||R==="STYLE"||R==="LINK"&&y.rel.toLowerCase()==="stylesheet"||l.removeChild(y),y=T}}else l==="body"&&Wr(i.ownerDocument.body);l=m}while(l);Xn(n)}function _g(i,n){var l=i;i=0;do{var c=l.nextSibling;if(l.nodeType===1?n?(l._stashedDisplay=l.style.display,l.style.display="none"):(l.style.display=l._stashedDisplay||"",l.getAttribute("style")===""&&l.removeAttribute("style")):l.nodeType===3&&(n?(l._stashedText=l.nodeValue,l.nodeValue=""):l.nodeValue=l._stashedText||""),c&&c.nodeType===8)if(l=c.data,l==="/$"){if(i===0)break;i--}else l!=="$"&&l!=="$?"&&l!=="$~"&&l!=="$!"||i++;l=c}while(l)}function Ac(i){var n=i.firstChild;for(n&&n.nodeType===10&&(n=n.nextSibling);n;){var l=n;switch(n=n.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":Ac(l),Do(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}i.removeChild(l)}}function nS(i,n,l,c){for(;i.nodeType===1;){var m=l;if(i.nodeName.toLowerCase()!==n.toLowerCase()){if(!c&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(c){if(!i[mr])switch(n){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(y=i.getAttribute("rel"),y==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(y!==m.rel||i.getAttribute("href")!==(m.href==null||m.href===""?null:m.href)||i.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin)||i.getAttribute("title")!==(m.title==null?null:m.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(y=i.getAttribute("src"),(y!==(m.src==null?null:m.src)||i.getAttribute("type")!==(m.type==null?null:m.type)||i.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin))&&y&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(n==="input"&&i.type==="hidden"){var y=m.name==null?null:""+m.name;if(m.type==="hidden"&&i.getAttribute("name")===y)return i}else return i;if(i=di(i.nextSibling),i===null)break}return null}function rS(i,n,l){if(n==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!l||(i=di(i.nextSibling),i===null))return null;return i}function Dg(i,n){for(;i.nodeType!==8;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!n||(i=di(i.nextSibling),i===null))return null;return i}function bc(i){return i.data==="$?"||i.data==="$~"}function Lc(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState!=="loading"}function aS(i,n){var l=i.ownerDocument;if(i.data==="$~")i._reactRetry=n;else if(i.data!=="$?"||l.readyState!=="loading")n();else{var c=function(){n(),l.removeEventListener("DOMContentLoaded",c)};l.addEventListener("DOMContentLoaded",c),i._reactRetry=c}}function di(i){for(;i!=null;i=i.nextSibling){var n=i.nodeType;if(n===1||n===3)break;if(n===8){if(n=i.data,n==="$"||n==="$!"||n==="$?"||n==="$~"||n==="&"||n==="F!"||n==="F")break;if(n==="/$"||n==="/&")return null}}return i}var Rc=null;function Ig(i){i=i.nextSibling;for(var n=0;i;){if(i.nodeType===8){var l=i.data;if(l==="/$"||l==="/&"){if(n===0)return di(i.nextSibling);n--}else l!=="$"&&l!=="$!"&&l!=="$?"&&l!=="$~"&&l!=="&"||n++}i=i.nextSibling}return null}function Cg(i){i=i.previousSibling;for(var n=0;i;){if(i.nodeType===8){var l=i.data;if(l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"){if(n===0)return i;n--}else l!=="/$"&&l!=="/&"||n++}i=i.previousSibling}return null}function kg(i,n,l){switch(n=Ll(l),i){case"html":if(i=n.documentElement,!i)throw Error(s(452));return i;case"head":if(i=n.head,!i)throw Error(s(453));return i;case"body":if(i=n.body,!i)throw Error(s(454));return i;default:throw Error(s(451))}}function Wr(i){for(var n=i.attributes;n.length;)i.removeAttributeNode(n[0]);Do(i)}var hi=new Map,Og=new Set;function Rl(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var es=X.d;X.d={f:lS,r:oS,D:uS,C:cS,L:fS,m:dS,X:gS,S:hS,M:mS};function lS(){var i=es.f(),n=yl();return i||n}function oS(i){var n=gn(i);n!==null&&n.tag===5&&n.type==="form"?Xh(n):es.r(i)}var Vn=typeof document>"u"?null:document;function Mg(i,n,l){var c=Vn;if(c&&typeof n=="string"&&n){var m=ri(n);m='link[rel="'+i+'"][href="'+m+'"]',typeof l=="string"&&(m+='[crossorigin="'+l+'"]'),Og.has(m)||(Og.add(m),i={rel:i,crossOrigin:l,href:n},c.querySelector(m)===null&&(n=c.createElement("link"),be(n,"link",i),ye(n),c.head.appendChild(n)))}}function uS(i){es.D(i),Mg("dns-prefetch",i,null)}function cS(i,n){es.C(i,n),Mg("preconnect",i,n)}function fS(i,n,l){es.L(i,n,l);var c=Vn;if(c&&i&&n){var m='link[rel="preload"][as="'+ri(n)+'"]';n==="image"&&l&&l.imageSrcSet?(m+='[imagesrcset="'+ri(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(m+='[imagesizes="'+ri(l.imageSizes)+'"]')):m+='[href="'+ri(i)+'"]';var y=m;switch(n){case"style":y=Yn(i);break;case"script":y=qn(i)}hi.has(y)||(i=p({rel:"preload",href:n==="image"&&l&&l.imageSrcSet?void 0:i,as:n},l),hi.set(y,i),c.querySelector(m)!==null||n==="style"&&c.querySelector(Zr(y))||n==="script"&&c.querySelector(Jr(y))||(n=c.createElement("link"),be(n,"link",i),ye(n),c.head.appendChild(n)))}}function dS(i,n){es.m(i,n);var l=Vn;if(l&&i){var c=n&&typeof n.as=="string"?n.as:"script",m='link[rel="modulepreload"][as="'+ri(c)+'"][href="'+ri(i)+'"]',y=m;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":y=qn(i)}if(!hi.has(y)&&(i=p({rel:"modulepreload",href:i},n),hi.set(y,i),l.querySelector(m)===null)){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(Jr(y)))return}c=l.createElement("link"),be(c,"link",i),ye(c),l.head.appendChild(c)}}}function hS(i,n,l){es.S(i,n,l);var c=Vn;if(c&&i){var m=mn(c).hoistableStyles,y=Yn(i);n=n||"default";var T=m.get(y);if(!T){var R={loading:0,preload:null};if(T=c.querySelector(Zr(y)))R.loading=5;else{i=p({rel:"stylesheet",href:i,"data-precedence":n},l),(l=hi.get(y))&&_c(i,l);var M=T=c.createElement("link");ye(M),be(M,"link",i),M._p=new Promise(function(j,W){M.onload=j,M.onerror=W}),M.addEventListener("load",function(){R.loading|=1}),M.addEventListener("error",function(){R.loading|=2}),R.loading|=4,_l(T,n,c)}T={type:"stylesheet",instance:T,count:1,state:R},m.set(y,T)}}}function gS(i,n){es.X(i,n);var l=Vn;if(l&&i){var c=mn(l).hoistableScripts,m=qn(i),y=c.get(m);y||(y=l.querySelector(Jr(m)),y||(i=p({src:i,async:!0},n),(n=hi.get(m))&&Dc(i,n),y=l.createElement("script"),ye(y),be(y,"link",i),l.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},c.set(m,y))}}function mS(i,n){es.M(i,n);var l=Vn;if(l&&i){var c=mn(l).hoistableScripts,m=qn(i),y=c.get(m);y||(y=l.querySelector(Jr(m)),y||(i=p({src:i,async:!0,type:"module"},n),(n=hi.get(m))&&Dc(i,n),y=l.createElement("script"),ye(y),be(y,"link",i),l.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},c.set(m,y))}}function wg(i,n,l,c){var m=(m=ft.current)?Rl(m):null;if(!m)throw Error(s(446));switch(i){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(n=Yn(l.href),l=mn(m).hoistableStyles,c=l.get(n),c||(c={type:"style",instance:null,count:0,state:null},l.set(n,c)),c):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){i=Yn(l.href);var y=mn(m).hoistableStyles,T=y.get(i);if(T||(m=m.ownerDocument||m,T={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},y.set(i,T),(y=m.querySelector(Zr(i)))&&!y._p&&(T.instance=y,T.state.loading=5),hi.has(i)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},hi.set(i,l),y||pS(m,i,l,T.state))),n&&c===null)throw Error(s(528,""));return T}if(n&&c!==null)throw Error(s(529,""));return null;case"script":return n=l.async,l=l.src,typeof l=="string"&&n&&typeof n!="function"&&typeof n!="symbol"?(n=qn(l),l=mn(m).hoistableScripts,c=l.get(n),c||(c={type:"script",instance:null,count:0,state:null},l.set(n,c)),c):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,i))}}function Yn(i){return'href="'+ri(i)+'"'}function Zr(i){return'link[rel="stylesheet"]['+i+"]"}function Ng(i){return p({},i,{"data-precedence":i.precedence,precedence:null})}function pS(i,n,l,c){i.querySelector('link[rel="preload"][as="style"]['+n+"]")?c.loading=1:(n=i.createElement("link"),c.preload=n,n.addEventListener("load",function(){return c.loading|=1}),n.addEventListener("error",function(){return c.loading|=2}),be(n,"link",l),ye(n),i.head.appendChild(n))}function qn(i){return'[src="'+ri(i)+'"]'}function Jr(i){return"script[async]"+i}function Pg(i,n,l){if(n.count++,n.instance===null)switch(n.type){case"style":var c=i.querySelector('style[data-href~="'+ri(l.href)+'"]');if(c)return n.instance=c,ye(c),c;var m=p({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return c=(i.ownerDocument||i).createElement("style"),ye(c),be(c,"style",m),_l(c,l.precedence,i),n.instance=c;case"stylesheet":m=Yn(l.href);var y=i.querySelector(Zr(m));if(y)return n.state.loading|=4,n.instance=y,ye(y),y;c=Ng(l),(m=hi.get(m))&&_c(c,m),y=(i.ownerDocument||i).createElement("link"),ye(y);var T=y;return T._p=new Promise(function(R,M){T.onload=R,T.onerror=M}),be(y,"link",c),n.state.loading|=4,_l(y,l.precedence,i),n.instance=y;case"script":return y=qn(l.src),(m=i.querySelector(Jr(y)))?(n.instance=m,ye(m),m):(c=l,(m=hi.get(y))&&(c=p({},l),Dc(c,m)),i=i.ownerDocument||i,m=i.createElement("script"),ye(m),be(m,"link",c),i.head.appendChild(m),n.instance=m);case"void":return null;default:throw Error(s(443,n.type))}else n.type==="stylesheet"&&(n.state.loading&4)===0&&(c=n.instance,n.state.loading|=4,_l(c,l.precedence,i));return n.instance}function _l(i,n,l){for(var c=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),m=c.length?c[c.length-1]:null,y=m,T=0;T<c.length;T++){var R=c[T];if(R.dataset.precedence===n)y=R;else if(y!==m)break}y?y.parentNode.insertBefore(i,y.nextSibling):(n=l.nodeType===9?l.head:l,n.insertBefore(i,n.firstChild))}function _c(i,n){i.crossOrigin==null&&(i.crossOrigin=n.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=n.referrerPolicy),i.title==null&&(i.title=n.title)}function Dc(i,n){i.crossOrigin==null&&(i.crossOrigin=n.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=n.referrerPolicy),i.integrity==null&&(i.integrity=n.integrity)}var Dl=null;function Ug(i,n,l){if(Dl===null){var c=new Map,m=Dl=new Map;m.set(l,c)}else m=Dl,c=m.get(l),c||(c=new Map,m.set(l,c));if(c.has(i))return c;for(c.set(i,null),l=l.getElementsByTagName(i),m=0;m<l.length;m++){var y=l[m];if(!(y[mr]||y[Se]||i==="link"&&y.getAttribute("rel")==="stylesheet")&&y.namespaceURI!=="http://www.w3.org/2000/svg"){var T=y.getAttribute(n)||"";T=i+T;var R=c.get(T);R?R.push(y):c.set(T,[y])}}return c}function Bg(i,n,l){i=i.ownerDocument||i,i.head.insertBefore(l,n==="title"?i.querySelector("head > title"):null)}function yS(i,n,l){if(l===1||n.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof n.precedence!="string"||typeof n.href!="string"||n.href==="")break;return!0;case"link":if(typeof n.rel!="string"||typeof n.href!="string"||n.href===""||n.onLoad||n.onError)break;switch(n.rel){case"stylesheet":return i=n.disabled,typeof n.precedence=="string"&&i==null;default:return!0}case"script":if(n.async&&typeof n.async!="function"&&typeof n.async!="symbol"&&!n.onLoad&&!n.onError&&n.src&&typeof n.src=="string")return!0}return!1}function Fg(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}function vS(i,n,l,c){if(l.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(l.state.loading&4)===0){if(l.instance===null){var m=Yn(c.href),y=n.querySelector(Zr(m));if(y){n=y._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(i.count++,i=Il.bind(i),n.then(i,i)),l.state.loading|=4,l.instance=y,ye(y);return}y=n.ownerDocument||n,c=Ng(c),(m=hi.get(m))&&_c(c,m),y=y.createElement("link"),ye(y);var T=y;T._p=new Promise(function(R,M){T.onload=R,T.onerror=M}),be(y,"link",c),l.instance=y}i.stylesheets===null&&(i.stylesheets=new Map),i.stylesheets.set(l,n),(n=l.state.preload)&&(l.state.loading&3)===0&&(i.count++,l=Il.bind(i),n.addEventListener("load",l),n.addEventListener("error",l))}}var Ic=0;function ES(i,n){return i.stylesheets&&i.count===0&&kl(i,i.stylesheets),0<i.count||0<i.imgCount?function(l){var c=setTimeout(function(){if(i.stylesheets&&kl(i,i.stylesheets),i.unsuspend){var y=i.unsuspend;i.unsuspend=null,y()}},6e4+n);0<i.imgBytes&&Ic===0&&(Ic=62500*JE());var m=setTimeout(function(){if(i.waitingForImages=!1,i.count===0&&(i.stylesheets&&kl(i,i.stylesheets),i.unsuspend)){var y=i.unsuspend;i.unsuspend=null,y()}},(i.imgBytes>Ic?50:800)+n);return i.unsuspend=l,function(){i.unsuspend=null,clearTimeout(c),clearTimeout(m)}}:null}function Il(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)kl(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var Cl=null;function kl(i,n){i.stylesheets=null,i.unsuspend!==null&&(i.count++,Cl=new Map,n.forEach(SS,i),Cl=null,Il.call(i))}function SS(i,n){if(!(n.state.loading&4)){var l=Cl.get(i);if(l)var c=l.get(null);else{l=new Map,Cl.set(i,l);for(var m=i.querySelectorAll("link[data-precedence],style[data-precedence]"),y=0;y<m.length;y++){var T=m[y];(T.nodeName==="LINK"||T.getAttribute("media")!=="not all")&&(l.set(T.dataset.precedence,T),c=T)}c&&l.set(null,c)}m=n.instance,T=m.getAttribute("data-precedence"),y=l.get(T)||c,y===c&&l.set(null,m),l.set(T,m),this.count++,c=Il.bind(this),m.addEventListener("load",c),m.addEventListener("error",c),y?y.parentNode.insertBefore(m,y.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(m,i.firstChild)),n.state.loading|=4}}var ta={$$typeof:D,Provider:null,Consumer:null,_currentValue:Z,_currentValue2:Z,_threadCount:0};function TS(i,n,l,c,m,y,T,R,M){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=bo(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=bo(0),this.hiddenUpdates=bo(null),this.identifierPrefix=c,this.onUncaughtError=m,this.onCaughtError=y,this.onRecoverableError=T,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=M,this.incompleteTransitions=new Map}function $g(i,n,l,c,m,y,T,R,M,j,W,et){return i=new TS(i,n,l,T,M,j,W,et,R),n=1,y===!0&&(n|=24),y=Ve(3,null,null,n),i.current=y,y.stateNode=i,n=ou(),n.refCount++,i.pooledCache=n,n.refCount++,y.memoizedState={element:c,isDehydrated:l,cache:n},du(y),i}function Gg(i){return i?(i=Ln,i):Ln}function Hg(i,n,l,c,m,y){m=Gg(m),c.context===null?c.context=m:c.pendingContext=m,c=ms(n),c.payload={element:l},y=y===void 0?null:y,y!==null&&(c.callback=y),l=ps(i,c,n),l!==null&&($e(l,i,n),Or(l,i,n))}function zg(i,n){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var l=i.retryLane;i.retryLane=l!==0&&l<n?l:n}}function Cc(i,n){zg(i,n),(i=i.alternate)&&zg(i,n)}function Kg(i){if(i.tag===13||i.tag===31){var n=js(i,67108864);n!==null&&$e(n,i,67108864),Cc(i,67108864)}}function jg(i){if(i.tag===13||i.tag===31){var n=We();n=Lo(n);var l=js(i,n);l!==null&&$e(l,i,n),Cc(i,n)}}var Ol=!0;function xS(i,n,l,c){var m=N.T;N.T=null;var y=X.p;try{X.p=2,kc(i,n,l,c)}finally{X.p=y,N.T=m}}function AS(i,n,l,c){var m=N.T;N.T=null;var y=X.p;try{X.p=8,kc(i,n,l,c)}finally{X.p=y,N.T=m}}function kc(i,n,l,c){if(Ol){var m=Oc(c);if(m===null)yc(i,n,c,Ml,l),Yg(i,c);else if(LS(m,i,n,l,c))c.stopPropagation();else if(Yg(i,c),n&4&&-1<bS.indexOf(i)){for(;m!==null;){var y=gn(m);if(y!==null)switch(y.tag){case 3:if(y=y.stateNode,y.current.memoizedState.isDehydrated){var T=$s(y.pendingLanes);if(T!==0){var R=y;for(R.pendingLanes|=2,R.entangledLanes|=2;T;){var M=1<<31-Ke(T);R.entanglements[1]|=M,T&=~M}Di(y),(Ut&6)===0&&(ml=pe()+500,qr(0))}}break;case 31:case 13:R=js(y,2),R!==null&&$e(R,y,2),yl(),Cc(y,2)}if(y=Oc(c),y===null&&yc(i,n,c,Ml,l),y===m)break;m=y}m!==null&&c.stopPropagation()}else yc(i,n,c,null,l)}}function Oc(i){return i=wo(i),Mc(i)}var Ml=null;function Mc(i){if(Ml=null,i=hn(i),i!==null){var n=a(i);if(n===null)i=null;else{var l=n.tag;if(l===13){if(i=o(n),i!==null)return i;i=null}else if(l===31){if(i=f(n),i!==null)return i;i=null}else if(l===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;i=null}else n!==i&&(i=null)}}return Ml=i,null}function Vg(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ta()){case as:return 2;case cr:return 8;case fn:case xa:return 32;case fr:return 268435456;default:return 32}default:return 32}}var wc=!1,_s=null,Ds=null,Is=null,ea=new Map,ia=new Map,Cs=[],bS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Yg(i,n){switch(i){case"focusin":case"focusout":_s=null;break;case"dragenter":case"dragleave":Ds=null;break;case"mouseover":case"mouseout":Is=null;break;case"pointerover":case"pointerout":ea.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":ia.delete(n.pointerId)}}function sa(i,n,l,c,m,y){return i===null||i.nativeEvent!==y?(i={blockedOn:n,domEventName:l,eventSystemFlags:c,nativeEvent:y,targetContainers:[m]},n!==null&&(n=gn(n),n!==null&&Kg(n)),i):(i.eventSystemFlags|=c,n=i.targetContainers,m!==null&&n.indexOf(m)===-1&&n.push(m),i)}function LS(i,n,l,c,m){switch(n){case"focusin":return _s=sa(_s,i,n,l,c,m),!0;case"dragenter":return Ds=sa(Ds,i,n,l,c,m),!0;case"mouseover":return Is=sa(Is,i,n,l,c,m),!0;case"pointerover":var y=m.pointerId;return ea.set(y,sa(ea.get(y)||null,i,n,l,c,m)),!0;case"gotpointercapture":return y=m.pointerId,ia.set(y,sa(ia.get(y)||null,i,n,l,c,m)),!0}return!1}function qg(i){var n=hn(i.target);if(n!==null){var l=a(n);if(l!==null){if(n=l.tag,n===13){if(n=o(l),n!==null){i.blockedOn=n,od(i.priority,function(){jg(l)});return}}else if(n===31){if(n=f(l),n!==null){i.blockedOn=n,od(i.priority,function(){jg(l)});return}}else if(n===3&&l.stateNode.current.memoizedState.isDehydrated){i.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}i.blockedOn=null}function wl(i){if(i.blockedOn!==null)return!1;for(var n=i.targetContainers;0<n.length;){var l=Oc(i.nativeEvent);if(l===null){l=i.nativeEvent;var c=new l.constructor(l.type,l);Mo=c,l.target.dispatchEvent(c),Mo=null}else return n=gn(l),n!==null&&Kg(n),i.blockedOn=l,!1;n.shift()}return!0}function Xg(i,n,l){wl(i)&&l.delete(n)}function RS(){wc=!1,_s!==null&&wl(_s)&&(_s=null),Ds!==null&&wl(Ds)&&(Ds=null),Is!==null&&wl(Is)&&(Is=null),ea.forEach(Xg),ia.forEach(Xg)}function Nl(i,n){i.blockedOn===n&&(i.blockedOn=null,wc||(wc=!0,u.unstable_scheduleCallback(u.unstable_NormalPriority,RS)))}var Pl=null;function Qg(i){Pl!==i&&(Pl=i,u.unstable_scheduleCallback(u.unstable_NormalPriority,function(){Pl===i&&(Pl=null);for(var n=0;n<i.length;n+=3){var l=i[n],c=i[n+1],m=i[n+2];if(typeof c!="function"){if(Mc(c||l)===null)continue;break}var y=gn(l);y!==null&&(i.splice(n,3),n-=3,Ou(y,{pending:!0,data:m,method:l.method,action:c},c,m))}}))}function Xn(i){function n(M){return Nl(M,i)}_s!==null&&Nl(_s,i),Ds!==null&&Nl(Ds,i),Is!==null&&Nl(Is,i),ea.forEach(n),ia.forEach(n);for(var l=0;l<Cs.length;l++){var c=Cs[l];c.blockedOn===i&&(c.blockedOn=null)}for(;0<Cs.length&&(l=Cs[0],l.blockedOn===null);)qg(l),l.blockedOn===null&&Cs.shift();if(l=(i.ownerDocument||i).$$reactFormReplay,l!=null)for(c=0;c<l.length;c+=3){var m=l[c],y=l[c+1],T=m[we]||null;if(typeof y=="function")T||Qg(l);else if(T){var R=null;if(y&&y.hasAttribute("formAction")){if(m=y,T=y[we]||null)R=T.formAction;else if(Mc(m)!==null)continue}else R=T.action;typeof R=="function"?l[c+1]=R:(l.splice(c,3),c-=3),Qg(l)}}}function Wg(){function i(y){y.canIntercept&&y.info==="react-transition"&&y.intercept({handler:function(){return new Promise(function(T){return m=T})},focusReset:"manual",scroll:"manual"})}function n(){m!==null&&(m(),m=null),c||setTimeout(l,20)}function l(){if(!c&&!navigation.transition){var y=navigation.currentEntry;y&&y.url!=null&&navigation.navigate(y.url,{state:y.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var c=!1,m=null;return navigation.addEventListener("navigate",i),navigation.addEventListener("navigatesuccess",n),navigation.addEventListener("navigateerror",n),setTimeout(l,100),function(){c=!0,navigation.removeEventListener("navigate",i),navigation.removeEventListener("navigatesuccess",n),navigation.removeEventListener("navigateerror",n),m!==null&&(m(),m=null)}}}function Nc(i){this._internalRoot=i}Ul.prototype.render=Nc.prototype.render=function(i){var n=this._internalRoot;if(n===null)throw Error(s(409));var l=n.current,c=We();Hg(l,c,i,n,null,null)},Ul.prototype.unmount=Nc.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var n=i.containerInfo;Hg(i.current,2,null,i,null,null),yl(),n[dn]=null}};function Ul(i){this._internalRoot=i}Ul.prototype.unstable_scheduleHydration=function(i){if(i){var n=ld();i={blockedOn:null,target:i,priority:n};for(var l=0;l<Cs.length&&n!==0&&n<Cs[l].priority;l++);Cs.splice(l,0,i),l===0&&qg(i)}};var Zg=t.version;if(Zg!=="19.2.0")throw Error(s(527,Zg,"19.2.0"));X.findDOMNode=function(i){var n=i._reactInternals;if(n===void 0)throw typeof i.render=="function"?Error(s(188)):(i=Object.keys(i).join(","),Error(s(268,i)));return i=d(n),i=i!==null?g(i):null,i=i===null?null:i.stateNode,i};var _S={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:N,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Bl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Bl.isDisabled&&Bl.supportsFiber)try{dr=Bl.inject(_S),ze=Bl}catch{}}return ra.createRoot=function(i,n){if(!r(i))throw Error(s(299));var l=!1,c="",m=r0,y=a0,T=l0;return n!=null&&(n.unstable_strictMode===!0&&(l=!0),n.identifierPrefix!==void 0&&(c=n.identifierPrefix),n.onUncaughtError!==void 0&&(m=n.onUncaughtError),n.onCaughtError!==void 0&&(y=n.onCaughtError),n.onRecoverableError!==void 0&&(T=n.onRecoverableError)),n=$g(i,1,!1,null,null,l,c,null,m,y,T,Wg),i[dn]=n.current,pc(i),new Nc(n)},ra.hydrateRoot=function(i,n,l){if(!r(i))throw Error(s(299));var c=!1,m="",y=r0,T=a0,R=l0,M=null;return l!=null&&(l.unstable_strictMode===!0&&(c=!0),l.identifierPrefix!==void 0&&(m=l.identifierPrefix),l.onUncaughtError!==void 0&&(y=l.onUncaughtError),l.onCaughtError!==void 0&&(T=l.onCaughtError),l.onRecoverableError!==void 0&&(R=l.onRecoverableError),l.formState!==void 0&&(M=l.formState)),n=$g(i,1,!0,n,l??null,c,m,M,y,T,R,Wg),n.context=Gg(null),l=n.current,c=We(),c=Lo(c),m=ms(c),m.callback=null,ps(l,m,c),l=c,n.current.lanes=l,gr(n,l),Di(n),i[dn]=n.current,pc(i),new Ul(n)},ra.version="19.2.0",ra}var om;function BS(){if(om)return Bc.exports;om=1;function u(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(u)}catch(t){console.error(t)}}return u(),Bc.exports=US(),Bc.exports}var FS=BS();const $S=Cp(FS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GS=u=>u.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),HS=u=>u.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,e,s)=>s?s.toUpperCase():e.toLowerCase()),um=u=>{const t=HS(u);return t.charAt(0).toUpperCase()+t.slice(1)},kp=(...u)=>u.filter((t,e,s)=>!!t&&t.trim()!==""&&s.indexOf(t)===e).join(" ").trim(),zS=u=>{for(const t in u)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var KS={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jS=Qt.forwardRef(({color:u="currentColor",size:t=24,strokeWidth:e=2,absoluteStrokeWidth:s,className:r="",children:a,iconNode:o,...f},h)=>Qt.createElement("svg",{ref:h,...KS,width:t,height:t,stroke:u,strokeWidth:s?Number(e)*24/Number(t):e,className:kp("lucide",r),...!a&&!zS(f)&&{"aria-hidden":"true"},...f},[...o.map(([d,g])=>Qt.createElement(d,g)),...Array.isArray(a)?a:[a]]));/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=(u,t)=>{const e=Qt.forwardRef(({className:s,...r},a)=>Qt.createElement(jS,{ref:a,iconNode:t,className:kp(`lucide-${GS(um(u))}`,`lucide-${u}`,s),...r}));return e.displayName=um(u),e};/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VS=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],YS=Vt("bell",VS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qS=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],XS=Vt("circle-check-big",qS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QS=[["path",{d:"M20.2 6 3 11l-.9-2.4c-.3-1.1.3-2.2 1.3-2.5l13.5-4c1.1-.3 2.2.3 2.5 1.3Z",key:"1tn4o7"}],["path",{d:"m6.2 5.3 3.1 3.9",key:"iuk76l"}],["path",{d:"m12.4 3.4 3.1 4",key:"6hsd6n"}],["path",{d:"M3 11h18v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2Z",key:"ltgou9"}]],WS=Vt("clapperboard",QS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZS=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]],JS=Vt("film",ZS);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tT=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],eT=Vt("heart",tT);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iT=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],sT=Vt("house",iT);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nT=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Op=Vt("info",nT);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rT=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],cm=Vt("link",rT);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aT=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],lT=Vt("maximize",aT);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oT=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],uT=Vt("menu",oT);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cT=[["path",{d:"M15.033 9.44a.647.647 0 0 1 0 1.12l-4.065 2.352a.645.645 0 0 1-.968-.56V7.648a.645.645 0 0 1 .967-.56z",key:"vbtd3f"}],["path",{d:"M12 17v4",key:"1riwvh"}],["path",{d:"M8 21h8",key:"1ev6f3"}],["rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",key:"x3v2xh"}]],fT=Vt("monitor-play",cT);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dT=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],hT=Vt("moon",dT);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gT=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],mT=Vt("pause",gT);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pT=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],fa=Vt("play",pT);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yT=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],vT=Vt("plus",yT);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ET=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],ST=Vt("power",ET);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TT=[["path",{d:"M16.247 7.761a6 6 0 0 1 0 8.478",key:"1fwjs5"}],["path",{d:"M19.075 4.933a10 10 0 0 1 0 14.134",key:"ehdyv1"}],["path",{d:"M4.925 19.067a10 10 0 0 1 0-14.134",key:"1q22gi"}],["path",{d:"M7.753 16.239a6 6 0 0 1 0-8.478",key:"r2q7qm"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],xT=Vt("radio",TT);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AT=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],bT=Vt("refresh-cw",AT);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LT=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],RT=Vt("search",LT);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _T=[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]],fm=Vt("server",_T);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DT=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Mp=Vt("settings",DT);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IT=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],CT=Vt("shield-alert",IT);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kT=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],OT=Vt("sun",kT);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MT=[["path",{d:"m17 2-5 5-5-5",key:"16satq"}],["rect",{width:"20",height:"15",x:"2",y:"7",rx:"2",key:"1e6viu"}]],wT=Vt("tv",MT);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NT=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],PT=Vt("user",NT);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UT=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],BT=Vt("volume-2",UT);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FT=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],$T=Vt("volume-x",FT);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GT=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],HT=Vt("x",GT),zT=({currentView:u,onChangeView:t,isMobileMenuOpen:e,setIsMobileMenuOpen:s})=>{const r=[{id:"home",icon:sT,label:"Accueil"},{id:"live",icon:wT,label:"Live TV"},{id:"movies",icon:JS,label:"Films"},{id:"series",icon:WS,label:"Sries"},{id:"favorites",icon:eT,label:"Favoris"},{id:"settings",icon:Mp,label:"Paramtres"},{id:"about",icon:Op,label:" Propos"}],a=o=>{t(o),s(!1)};return C.jsxs(C.Fragment,{children:[e&&C.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 lg:hidden backdrop-blur-sm",onClick:()=>s(!1)}),C.jsxs("div",{className:`
        fixed lg:static inset-y-0 left-0 z-50
        w-64 bg-white/95 dark:bg-[#020617]/95 border-r border-slate-200 dark:border-slate-800/50 backdrop-blur-xl
        transform transition-transform duration-300 ease-in-out
        ${e?"translate-x-0":"-translate-x-full lg:translate-x-0"}
        flex flex-col
      `,children:[C.jsxs("div",{className:"h-20 flex items-center px-8 border-b border-slate-200 dark:border-slate-800/50",children:[C.jsx(fT,{className:"w-8 h-8 text-blue-600 dark:text-blue-500 mr-3"}),C.jsx("span",{className:"text-2xl font-bold bg-gradient-to-r from-blue-600 to-blue-800 dark:from-blue-400 dark:to-blue-600 bg-clip-text text-transparent tracking-wide",children:"SEFINITY"})]}),C.jsx("nav",{className:"flex-1 py-6 px-4 space-y-2 overflow-y-auto",children:r.map(o=>{const f=o.icon,h=u===o.id;return C.jsxs("button",{onClick:()=>a(o.id),className:`
                  w-full flex items-center px-4 py-3.5 rounded-xl transition-all duration-200 group
                  ${h?"bg-blue-50 dark:bg-blue-600/10 text-blue-600 dark:text-blue-500 shadow-sm dark:shadow-[0_0_20px_rgba(37,99,235,0.15)]":"text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white hover:bg-slate-100 dark:hover:bg-slate-800/50"}
                `,children:[C.jsx(f,{size:20,className:`mr-3 transition-colors ${h?"text-blue-600 dark:text-blue-500":"text-slate-400 dark:text-slate-500 group-hover:text-slate-600 dark:group-hover:text-white"}`}),C.jsx("span",{className:"font-medium",children:o.label}),h&&C.jsx("div",{className:"ml-auto w-1.5 h-1.5 rounded-full bg-blue-600 dark:bg-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.8)]"})]},o.id)})}),C.jsx("div",{className:"p-6 border-t border-slate-200 dark:border-slate-800/50",children:C.jsxs("div",{className:"bg-slate-50 dark:bg-slate-900/50 rounded-lg p-3 text-xs text-slate-500 text-center border border-slate-200 dark:border-slate-800",children:[C.jsx("p",{children:"Premium Account"}),C.jsx("p",{className:"text-emerald-600 dark:text-emerald-500 mt-1",children:" Connected"})]})})]})]})},KT=({toggleMobileMenu:u})=>C.jsxs("header",{className:"sticky top-0 z-30 h-20 px-6 flex items-center justify-between bg-white/80 dark:bg-[#020617]/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-800/50 transition-colors duration-300",children:[C.jsxs("div",{className:"flex items-center flex-1 gap-4",children:[C.jsx("button",{onClick:u,className:"p-2 -ml-2 text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white lg:hidden",children:C.jsx(uT,{size:24})}),C.jsxs("div",{className:"relative group max-w-md w-full hidden sm:block",children:[C.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:C.jsx(RT,{size:18,className:"text-slate-400 dark:text-slate-500 group-focus-within:text-blue-500 transition-colors"})}),C.jsx("input",{type:"text",placeholder:"Rechercher des films, sries, chanes...",className:"block w-full pl-10 pr-3 py-2 border border-slate-200 dark:border-slate-800 rounded-full leading-5 bg-slate-100 dark:bg-slate-900/50 text-slate-800 dark:text-slate-300 placeholder-slate-400 dark:placeholder-slate-500 focus:outline-none focus:bg-white dark:focus:bg-slate-900 focus:border-blue-500/50 focus:ring-1 focus:ring-blue-500/50 sm:text-sm transition-all"})]})]}),C.jsxs("div",{className:"flex items-center gap-4",children:[C.jsxs("button",{className:"relative p-2 text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white transition-colors rounded-full hover:bg-slate-100 dark:hover:bg-slate-800/50",children:[C.jsx(YS,{size:20}),C.jsx("span",{className:"absolute top-2 right-2.5 w-2 h-2 bg-red-500 rounded-full border-2 border-white dark:border-[#020617]"})]}),C.jsxs("div",{className:"flex items-center gap-3 pl-4 border-l border-slate-200 dark:border-slate-800/50 cursor-pointer group",children:[C.jsxs("div",{className:"text-right hidden md:block",children:[C.jsx("p",{className:"text-sm font-medium text-slate-700 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",children:"John Doe"}),C.jsx("p",{className:"text-xs text-slate-500",children:"Premium"})]}),C.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 p-[2px]",children:C.jsx("div",{className:"w-full h-full rounded-full bg-slate-100 dark:bg-slate-900 flex items-center justify-center overflow-hidden",children:C.jsx(PT,{className:"text-slate-400 dark:text-slate-300",size:20})})})]})]})]}),jT=({item:u,onPlay:t})=>C.jsxs("div",{className:"relative w-full h-[65vh] sm:h-[80vh] overflow-hidden rounded-b-3xl sm:rounded-none",children:[C.jsx("div",{className:"absolute inset-0 bg-cover bg-center transition-transform duration-[10s] hover:scale-105",style:{backgroundImage:`url(${u.backdrop})`}}),C.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-50 via-slate-50/20 to-transparent dark:from-[#020617] dark:via-[#020617]/40 dark:to-transparent"}),C.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-slate-50/80 via-transparent to-transparent dark:from-[#020617]/90 dark:via-transparent dark:to-transparent"}),C.jsxs("div",{className:"absolute bottom-0 left-0 p-8 md:p-16 max-w-2xl flex flex-col gap-4",children:[C.jsx("span",{className:"inline-block px-3 py-1 bg-blue-600/80 backdrop-blur-sm text-white text-xs font-bold rounded uppercase tracking-wider w-fit",children:"Top #1 Today"}),C.jsx("h1",{className:"text-4xl md:text-6xl font-black text-slate-900 dark:text-white leading-tight drop-shadow-xl",children:u.title}),C.jsxs("div",{className:"flex items-center gap-3 text-slate-700 dark:text-slate-300 text-sm font-medium",children:[C.jsxs("span",{className:"text-emerald-600 dark:text-green-400 font-bold",children:[u.rating," Match"]}),C.jsx("span",{children:u.year}),C.jsx("span",{className:"border border-slate-400 dark:border-slate-500 px-1 rounded text-xs",children:"HD"}),C.jsx("span",{children:u.duration})]}),C.jsx("p",{className:"text-slate-700 dark:text-slate-300 text-base md:text-lg line-clamp-3 md:line-clamp-none drop-shadow-md max-w-lg",children:u.description}),C.jsxs("div",{className:"flex items-center gap-4 mt-4",children:[C.jsxs("button",{onClick:()=>t(u),className:"flex items-center gap-2 px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg shadow-blue-600/30",children:[C.jsx(fa,{size:24,fill:"currentColor"}),C.jsx("span",{children:"Regarder"})]}),C.jsxs("button",{className:"flex items-center gap-2 px-8 py-3 bg-white/60 dark:bg-slate-600/40 hover:bg-white/80 dark:hover:bg-slate-600/60 backdrop-blur-md text-slate-900 dark:text-white font-semibold rounded-lg transition-all duration-300",children:[C.jsx(Op,{size:24}),C.jsx("span",{children:"Plus d'infos"})]})]})]})]}),Fl=({item:u,onPlay:t})=>C.jsxs("div",{className:"group relative flex-none w-[160px] md:w-[220px] aspect-[2/3] bg-slate-200 dark:bg-slate-900 rounded-lg overflow-hidden transition-all duration-300 hover:z-20 hover:scale-105 hover:shadow-xl dark:hover:shadow-[0_0_20px_rgba(0,0,0,0.5)] cursor-pointer",onClick:()=>t(u),children:[C.jsx("img",{src:u.poster,alt:u.title,className:"w-full h-full object-cover transition-opacity duration-300 group-hover:opacity-40"}),C.jsxs("div",{className:"absolute inset-0 flex flex-col justify-end p-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-black/40",children:[C.jsx("div",{className:"absolute inset-0 flex items-center justify-center -translate-y-4",children:C.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-600 text-white flex items-center justify-center shadow-lg transform group-hover:scale-110 transition-transform",children:C.jsx(fa,{size:24,fill:"currentColor",className:"ml-1"})})}),C.jsxs("div",{className:"relative translate-y-2 group-hover:translate-y-0 transition-transform duration-300",children:[C.jsx("h3",{className:"text-white font-bold text-sm leading-tight mb-1 drop-shadow-md",children:u.title}),C.jsxs("div",{className:"flex items-center justify-between text-[10px] text-slate-200 font-medium",children:[C.jsx("span",{children:u.year}),C.jsx("span",{className:"px-1 py-0.5 border border-slate-400 rounded bg-black/50",children:u.rating})]}),C.jsx("div",{className:"mt-2 flex gap-2",children:C.jsxs("button",{className:"flex-1 py-1.5 bg-white/20 hover:bg-white/30 backdrop-blur-sm rounded text-[10px] text-white font-semibold flex items-center justify-center gap-1 transition-colors",children:[C.jsx(vT,{size:12})," List"]})})]})]})]}),ct=Number.isFinite||function(u){return typeof u=="number"&&isFinite(u)},VT=Number.isSafeInteger||function(u){return typeof u=="number"&&Math.abs(u)<=YT},YT=Number.MAX_SAFE_INTEGER||9007199254740991;let pt=(function(u){return u.NETWORK_ERROR="networkError",u.MEDIA_ERROR="mediaError",u.KEY_SYSTEM_ERROR="keySystemError",u.MUX_ERROR="muxError",u.OTHER_ERROR="otherError",u})({}),z=(function(u){return u.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",u.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",u.KEY_SYSTEM_NO_SESSION="keySystemNoSession",u.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",u.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",u.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",u.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",u.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",u.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",u.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",u.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",u.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",u.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",u.MANIFEST_LOAD_ERROR="manifestLoadError",u.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",u.MANIFEST_PARSING_ERROR="manifestParsingError",u.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",u.LEVEL_EMPTY_ERROR="levelEmptyError",u.LEVEL_LOAD_ERROR="levelLoadError",u.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",u.LEVEL_PARSING_ERROR="levelParsingError",u.LEVEL_SWITCH_ERROR="levelSwitchError",u.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",u.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",u.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",u.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",u.FRAG_LOAD_ERROR="fragLoadError",u.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",u.FRAG_DECRYPT_ERROR="fragDecryptError",u.FRAG_PARSING_ERROR="fragParsingError",u.FRAG_GAP="fragGap",u.REMUX_ALLOC_ERROR="remuxAllocError",u.KEY_LOAD_ERROR="keyLoadError",u.KEY_LOAD_TIMEOUT="keyLoadTimeOut",u.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",u.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",u.BUFFER_APPEND_ERROR="bufferAppendError",u.BUFFER_APPENDING_ERROR="bufferAppendingError",u.BUFFER_STALLED_ERROR="bufferStalledError",u.BUFFER_FULL_ERROR="bufferFullError",u.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",u.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",u.ASSET_LIST_LOAD_ERROR="assetListLoadError",u.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",u.ASSET_LIST_PARSING_ERROR="assetListParsingError",u.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",u.INTERNAL_EXCEPTION="internalException",u.INTERNAL_ABORTED="aborted",u.ATTACH_MEDIA_ERROR="attachMediaError",u.UNKNOWN="unknown",u})({}),x=(function(u){return u.MEDIA_ATTACHING="hlsMediaAttaching",u.MEDIA_ATTACHED="hlsMediaAttached",u.MEDIA_DETACHING="hlsMediaDetaching",u.MEDIA_DETACHED="hlsMediaDetached",u.MEDIA_ENDED="hlsMediaEnded",u.STALL_RESOLVED="hlsStallResolved",u.BUFFER_RESET="hlsBufferReset",u.BUFFER_CODECS="hlsBufferCodecs",u.BUFFER_CREATED="hlsBufferCreated",u.BUFFER_APPENDING="hlsBufferAppending",u.BUFFER_APPENDED="hlsBufferAppended",u.BUFFER_EOS="hlsBufferEos",u.BUFFERED_TO_END="hlsBufferedToEnd",u.BUFFER_FLUSHING="hlsBufferFlushing",u.BUFFER_FLUSHED="hlsBufferFlushed",u.MANIFEST_LOADING="hlsManifestLoading",u.MANIFEST_LOADED="hlsManifestLoaded",u.MANIFEST_PARSED="hlsManifestParsed",u.LEVEL_SWITCHING="hlsLevelSwitching",u.LEVEL_SWITCHED="hlsLevelSwitched",u.LEVEL_LOADING="hlsLevelLoading",u.LEVEL_LOADED="hlsLevelLoaded",u.LEVEL_UPDATED="hlsLevelUpdated",u.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",u.LEVELS_UPDATED="hlsLevelsUpdated",u.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",u.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",u.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",u.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",u.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",u.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",u.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",u.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",u.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",u.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",u.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",u.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",u.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",u.CUES_PARSED="hlsCuesParsed",u.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",u.INIT_PTS_FOUND="hlsInitPtsFound",u.FRAG_LOADING="hlsFragLoading",u.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",u.FRAG_LOADED="hlsFragLoaded",u.FRAG_DECRYPTED="hlsFragDecrypted",u.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",u.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",u.FRAG_PARSING_METADATA="hlsFragParsingMetadata",u.FRAG_PARSED="hlsFragParsed",u.FRAG_BUFFERED="hlsFragBuffered",u.FRAG_CHANGED="hlsFragChanged",u.FPS_DROP="hlsFpsDrop",u.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",u.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",u.ERROR="hlsError",u.DESTROYING="hlsDestroying",u.KEY_LOADING="hlsKeyLoading",u.KEY_LOADED="hlsKeyLoaded",u.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",u.BACK_BUFFER_REACHED="hlsBackBufferReached",u.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",u.ASSET_LIST_LOADING="hlsAssetListLoading",u.ASSET_LIST_LOADED="hlsAssetListLoaded",u.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",u.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",u.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",u.INTERSTITIAL_STARTED="hlsInterstitialStarted",u.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",u.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",u.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",u.INTERSTITIAL_ENDED="hlsInterstitialEnded",u.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",u.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",u.EVENT_CUE_ENTER="hlsEventCueEnter",u})({});var Rt={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},ht={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Qn{constructor(t,e=0,s=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=e,this.totalWeight_=s}sample(t,e){const s=Math.pow(this.alpha_,t);this.estimate_=e*(1-s)+s*this.estimate_,this.totalWeight_+=t}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_}}class qT{constructor(t,e,s,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Qn(t),this.fast_=new Qn(e),this.defaultTTFB_=r,this.ttfb_=new Qn(t)}update(t,e){const{slow_:s,fast_:r,ttfb_:a}=this;s.halfLife!==t&&(this.slow_=new Qn(t,s.getEstimate(),s.getTotalWeight())),r.halfLife!==e&&(this.fast_=new Qn(e,r.getEstimate(),r.getTotalWeight())),a.halfLife!==t&&(this.ttfb_=new Qn(t,a.getEstimate(),a.getTotalWeight()))}sample(t,e){t=Math.max(t,this.minDelayMs_);const s=8*e,r=t/1e3,a=s/r;this.fast_.sample(r,a),this.slow_.sample(r,a)}sampleTTFB(t){const e=t/1e3,s=Math.sqrt(2)*Math.exp(-Math.pow(e,2)/2);this.ttfb_.sample(s,Math.max(t,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function XT(u,t,e){return(t=WT(t))in u?Object.defineProperty(u,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):u[t]=e,u}function jt(){return jt=Object.assign?Object.assign.bind():function(u){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var s in e)({}).hasOwnProperty.call(e,s)&&(u[s]=e[s])}return u},jt.apply(null,arguments)}function dm(u,t){var e=Object.keys(u);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(u);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(u,r).enumerable})),e.push.apply(e,s)}return e}function $t(u){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?dm(Object(e),!0).forEach(function(s){XT(u,s,e[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(e)):dm(Object(e)).forEach(function(s){Object.defineProperty(u,s,Object.getOwnPropertyDescriptor(e,s))})}return u}function QT(u,t){if(typeof u!="object"||!u)return u;var e=u[Symbol.toPrimitive];if(e!==void 0){var s=e.call(u,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(u)}function WT(u){var t=QT(u,"string");return typeof t=="symbol"?t:t+""}class mi{constructor(t,e){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const s=`[${t}]:`;this.trace=ws,this.debug=e.debug.bind(null,s),this.log=e.log.bind(null,s),this.warn=e.warn.bind(null,s),this.info=e.info.bind(null,s),this.error=e.error.bind(null,s)}}const ws=function(){},ZT={trace:ws,debug:ws,log:ws,warn:ws,info:ws,error:ws};function hf(){return jt({},ZT)}function JT(u,t){const e=self.console[u];return e?e.bind(self.console,`${t?"["+t+"] ":""}[${u}] >`):ws}function hm(u,t,e){return t[u]?t[u].bind(t):JT(u,e)}const gf=hf();function tx(u,t,e){const s=hf();if(typeof console=="object"&&u===!0||typeof u=="object"){const r=["debug","log","info","warn","error"];r.forEach(a=>{s[a]=hm(a,u,e)});try{s.log(`Debug logs enabled for "${t}" in hls.js version 1.6.15`)}catch{return hf()}r.forEach(a=>{gf[a]=hm(a,u)})}else jt(gf,s);return s}const Gt=gf;function Us(u=!0){return typeof self>"u"?void 0:(u||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function ex(u){return typeof self<"u"&&u===self.ManagedMediaSource}function wp(u,t){const e=Object.keys(u),s=Object.keys(t),r=e.length,a=s.length;return!r||!a||r===a&&!e.some(o=>s.indexOf(o)===-1)}function ii(u,t=!1){if(typeof TextDecoder<"u"){const d=new TextDecoder("utf-8").decode(u);if(t){const g=d.indexOf("\0");return g!==-1?d.substring(0,g):d}return d.replace(/\0/g,"")}const e=u.length;let s,r,a,o="",f=0;for(;f<e;){if(s=u[f++],s===0&&t)return o;if(s===0||s===3)continue;switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(s);break;case 12:case 13:r=u[f++],o+=String.fromCharCode((s&31)<<6|r&63);break;case 14:r=u[f++],a=u[f++],o+=String.fromCharCode((s&15)<<12|(r&63)<<6|(a&63)<<0);break}}return o}function Re(u){let t="";for(let e=0;e<u.length;e++){let s=u[e].toString(16);s.length<2&&(s="0"+s),t+=s}return t}function Np(u){return Uint8Array.from(u.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function ix(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var Hc={exports:{}},gm;function sx(){return gm||(gm=1,(function(u,t){(function(e){var s=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,a=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,f={buildAbsoluteURL:function(h,d,g){if(g=g||{},h=h.trim(),d=d.trim(),!d){if(!g.alwaysNormalize)return h;var p=f.parseURL(h);if(!p)throw new Error("Error trying to parse base URL.");return p.path=f.normalizePath(p.path),f.buildURLFromParts(p)}var v=f.parseURL(d);if(!v)throw new Error("Error trying to parse relative URL.");if(v.scheme)return g.alwaysNormalize?(v.path=f.normalizePath(v.path),f.buildURLFromParts(v)):d;var E=f.parseURL(h);if(!E)throw new Error("Error trying to parse base URL.");if(!E.netLoc&&E.path&&E.path[0]!=="/"){var S=r.exec(E.path);E.netLoc=S[1],E.path=S[2]}E.netLoc&&!E.path&&(E.path="/");var A={scheme:E.scheme,netLoc:v.netLoc,path:null,params:v.params,query:v.query,fragment:v.fragment};if(!v.netLoc&&(A.netLoc=E.netLoc,v.path[0]!=="/"))if(!v.path)A.path=E.path,v.params||(A.params=E.params,v.query||(A.query=E.query));else{var b=E.path,L=b.substring(0,b.lastIndexOf("/")+1)+v.path;A.path=f.normalizePath(L)}return A.path===null&&(A.path=g.alwaysNormalize?f.normalizePath(v.path):v.path),f.buildURLFromParts(A)},parseURL:function(h){var d=s.exec(h);return d?{scheme:d[1]||"",netLoc:d[2]||"",path:d[3]||"",params:d[4]||"",query:d[5]||"",fragment:d[6]||""}:null},normalizePath:function(h){for(h=h.split("").reverse().join("").replace(a,"");h.length!==(h=h.replace(o,"")).length;);return h.split("").reverse().join("")},buildURLFromParts:function(h){return h.scheme+h.netLoc+h.path+h.params+h.query+h.fragment}};u.exports=f})()})(Hc)),Hc.exports}var Mf=sx();class wf{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var qt={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class Pp{constructor(t){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof t=="string"&&(t={url:t}),this.base=t,rx(this,"stats")}setByteRange(t,e){const s=t.split("@",2);let r;s.length===1?r=(e==null?void 0:e.byteRangeEndOffset)||0:r=parseInt(s[1]),this._byteRange=[r,parseInt(s[0])+r]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[qt.AUDIO]:null,[qt.VIDEO]:null,[qt.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(t){this._streams=t}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new wf),this._stats}set stats(t){this._stats=t}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Mf.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(t){this._url=t}clearElementaryStreamInfo(){const{elementaryStreams:t}=this;t[qt.AUDIO]=null,t[qt.VIDEO]=null,t[qt.AUDIOVIDEO]=null}}function le(u){return u.sn!=="initSegment"}class zc extends Pp{constructor(t,e){super(e),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=t}get byteLength(){if(this.hasStats){const t=this.stats.total;if(t)return t}if(this.byteRange.length){const t=this.byteRange[0],e=this.byteRange[1];if(ct(t)&&ct(e))return e-t}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(t){this._bitrate=t}get decryptdata(){var t;const{levelkeys:e}=this;if(!e||e.NONE)return null;if(e.identity)this._decryptdata||(this._decryptdata=e.identity.getDecryptData(this.sn));else if(!((t=this._decryptdata)!=null&&t.keyId)){const s=Object.keys(e);if(s.length===1){const r=this._decryptdata=e[s[0]]||null;r&&(this._decryptdata=r.getDecryptData(this.sn,e))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const t=ct(this.duration)?this.duration:0;return this.programDateTime+t*1e3}get encrypted(){var t;if((t=this._decryptdata)!=null&&t.encrypted)return!0;if(this.levelkeys){var e;const s=Object.keys(this.levelkeys),r=s.length;if(r>1||r===1&&(e=this.levelkeys[s[0]])!=null&&e.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(t){if(!ct(t)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=t}get ref(){return le(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(t){this.setStart(this.start+t)}setStart(t){this.start=t,this._ref&&(this._ref.start=t)}setDuration(t){this.duration=t,this._ref&&(this._ref.duration=t)}setKeyFormat(t){const e=this.levelkeys;if(e){var s;const r=e[t];r&&!((s=this._decryptdata)!=null&&s.keyId)&&(this._decryptdata=r.getDecryptData(this.sn,e))}}abortRequests(){var t,e;(t=this.loader)==null||t.abort(),(e=this.keyLoader)==null||e.abort()}setElementaryStreamInfo(t,e,s,r,a,o=!1){const{elementaryStreams:f}=this,h=f[t];if(!h){f[t]={startPTS:e,endPTS:s,startDTS:r,endDTS:a,partial:o};return}h.startPTS=Math.min(h.startPTS,e),h.endPTS=Math.max(h.endPTS,s),h.startDTS=Math.min(h.startDTS,r),h.endDTS=Math.max(h.endDTS,a)}}class nx extends Pp{constructor(t,e,s,r,a){super(s),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=t.decimalFloatingPoint("DURATION"),this.gap=t.bool("GAP"),this.independent=t.bool("INDEPENDENT"),this.relurl=t.enumeratedString("URI"),this.fragment=e,this.index=r;const o=t.enumeratedString("BYTERANGE");o&&this.setByteRange(o,a),a&&(this.fragOffset=a.fragOffset+a.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:t}=this;return!!(t.audio||t.video||t.audiovideo)}}function Up(u,t){const e=Object.getPrototypeOf(u);if(e){const s=Object.getOwnPropertyDescriptor(e,t);return s||Up(e,t)}}function rx(u,t){const e=Up(u,t);e&&(e.enumerable=!0,Object.defineProperty(u,t,e))}const mm=Math.pow(2,32)-1,ax=[].push,Bp={video:1,audio:2,id3:3,text:4};function he(u){return String.fromCharCode.apply(null,u)}function Fp(u,t){const e=u[t]<<8|u[t+1];return e<0?65536+e:e}function St(u,t){const e=$p(u,t);return e<0?4294967296+e:e}function pm(u,t){let e=St(u,t);return e*=Math.pow(2,32),e+=St(u,t+4),e}function $p(u,t){return u[t]<<24|u[t+1]<<16|u[t+2]<<8|u[t+3]}function lx(u){const t=u.byteLength;for(let e=0;e<t;){const s=St(u,e);if(s>8&&u[e+4]===109&&u[e+5]===111&&u[e+6]===111&&u[e+7]===102)return!0;e=s>1?e+s:t}return!1}function Lt(u,t){const e=[];if(!t.length)return e;const s=u.byteLength;for(let r=0;r<s;){const a=St(u,r),o=he(u.subarray(r+4,r+8)),f=a>1?r+a:s;if(o===t[0])if(t.length===1)e.push(u.subarray(r+8,f));else{const h=Lt(u.subarray(r+8,f),t.slice(1));h.length&&ax.apply(e,h)}r=f}return e}function ox(u){const t=[],e=u[0];let s=8;const r=St(u,s);s+=4;let a=0,o=0;e===0?(a=St(u,s),o=St(u,s+4),s+=8):(a=pm(u,s),o=pm(u,s+8),s+=16),s+=2;let f=u.length+o;const h=Fp(u,s);s+=2;for(let d=0;d<h;d++){let g=s;const p=St(u,g);g+=4;const v=p&2147483647;if((p&2147483648)>>>31===1)return Gt.warn("SIDX has hierarchical references (not supported)"),null;const S=St(u,g);g+=4,t.push({referenceSize:v,subsegmentDuration:S,info:{duration:S/r,start:f,end:f+v-1}}),f+=v,g+=4,s=g}return{earliestPresentationTime:a,timescale:r,version:e,referencesCount:h,references:t}}function Gp(u){const t=[],e=Lt(u,["moov","trak"]);for(let r=0;r<e.length;r++){const a=e[r],o=Lt(a,["tkhd"])[0];if(o){let f=o[0];const h=St(o,f===0?12:20),d=Lt(a,["mdia","mdhd"])[0];if(d){f=d[0];const g=St(d,f===0?12:20),p=Lt(a,["mdia","hdlr"])[0];if(p){const v=he(p.subarray(8,12)),E={soun:qt.AUDIO,vide:qt.VIDEO}[v],S=Lt(a,["mdia","minf","stbl","stsd"])[0],A=ux(S);E?(t[h]={timescale:g,type:E,stsd:A},t[E]=$t({timescale:g,id:h},A)):t[h]={timescale:g,type:v,stsd:A}}}}}return Lt(u,["moov","mvex","trex"]).forEach(r=>{const a=St(r,4),o=t[a];o&&(o.default={duration:St(r,12),flags:St(r,20)})}),t}function ux(u){const t=u.subarray(8),e=t.subarray(86),s=he(t.subarray(4,8));let r=s,a;const o=s==="enca"||s==="encv";if(o){const d=Lt(t,[s])[0].subarray(s==="enca"?28:78);Lt(d,["sinf"]).forEach(p=>{const v=Lt(p,["schm"])[0];if(v){const E=he(v.subarray(4,8));if(E==="cbcs"||E==="cenc"){const S=Lt(p,["frma"])[0];S&&(r=he(S))}}})}const f=r;switch(r){case"avc1":case"avc2":case"avc3":case"avc4":{const h=Lt(e,["avcC"])[0];h&&h.length>3&&(r+="."+Gl(h[1])+Gl(h[2])+Gl(h[3]),a=$l(f==="avc1"?"dva1":"dvav",e));break}case"mp4a":{const h=Lt(t,[s])[0],d=Lt(h.subarray(28),["esds"])[0];if(d&&d.length>7){let g=4;if(d[g++]!==3)break;g=Kc(d,g),g+=2;const p=d[g++];if(p&128&&(g+=2),p&64&&(g+=d[g++]),d[g++]!==4)break;g=Kc(d,g);const v=d[g++];if(v===64)r+="."+Gl(v);else break;if(g+=12,d[g++]!==5)break;g=Kc(d,g);const E=d[g++];let S=(E&248)>>3;S===31&&(S+=1+((E&7)<<3)+((d[g]&224)>>5)),r+="."+S}break}case"hvc1":case"hev1":{const h=Lt(e,["hvcC"])[0];if(h&&h.length>12){const d=h[1],g=["","A","B","C"][d>>6],p=d&31,v=St(h,2),E=(d&32)>>5?"H":"L",S=h[12],A=h.subarray(6,12);r+="."+g+p,r+="."+cx(v).toString(16).toUpperCase(),r+="."+E+S;let b="";for(let L=A.length;L--;){const _=A[L];(_||b)&&(b="."+_.toString(16).toUpperCase()+b)}r+=b}a=$l(f=="hev1"?"dvhe":"dvh1",e);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{r=$l(r,e)||r;break}case"vp09":{const h=Lt(e,["vpcC"])[0];if(h&&h.length>6){const d=h[4],g=h[5],p=h[6]>>4&15;r+="."+ki(d)+"."+ki(g)+"."+ki(p)}break}case"av01":{const h=Lt(e,["av1C"])[0];if(h&&h.length>2){const d=h[1]>>>5,g=h[1]&31,p=h[2]>>>7?"H":"M",v=(h[2]&64)>>6,E=(h[2]&32)>>5,S=d===2&&v?E?12:10:v?10:8,A=(h[2]&16)>>4,b=(h[2]&8)>>3,L=(h[2]&4)>>2,_=h[2]&3;r+="."+d+"."+ki(g)+p+"."+ki(S)+"."+A+"."+b+L+_+"."+ki(1)+"."+ki(1)+"."+ki(1)+"."+0,a=$l("dav1",e)}break}}return{codec:r,encrypted:o,supplemental:a}}function $l(u,t){const e=Lt(t,["dvvC"]),s=e.length?e[0]:Lt(t,["dvcC"])[0];if(s){const r=s[2]>>1&127,a=s[2]<<5&32|s[3]>>3&31;return u+"."+ki(r)+"."+ki(a)}}function cx(u){let t=0;for(let e=0;e<32;e++)t|=(u>>e&1)<<31-e;return t>>>0}function Kc(u,t){const e=t+5;for(;u[t++]&128&&t<e;);return t}function Gl(u){return("0"+u.toString(16).toUpperCase()).slice(-2)}function ki(u){return(u<10?"0":"")+u}function fx(u,t){if(!u||!t)return;const e=t.keyId;e&&t.isCommonEncryption&&Hp(u,(s,r)=>{const a=s.subarray(8,24);a.some(o=>o!==0)||(Gt.log(`[eme] Patching keyId in 'enc${r?"a":"v"}>sinf>>tenc' box: ${Re(a)} -> ${Re(e)}`),s.set(e,8))})}function dx(u){const t=[];return Hp(u,e=>t.push(e.subarray(8,24))),t}function Hp(u,t){Lt(u,["moov","trak"]).forEach(s=>{const r=Lt(s,["mdia","minf","stbl","stsd"])[0];if(!r)return;const a=r.subarray(8);let o=Lt(a,["enca"]);const f=o.length>0;f||(o=Lt(a,["encv"])),o.forEach(h=>{const d=f?h.subarray(28):h.subarray(78);Lt(d,["sinf"]).forEach(p=>{const v=zp(p);v&&t(v,f)})})})}function zp(u){const t=Lt(u,["schm"])[0];if(t){const e=he(t.subarray(4,8));if(e==="cbcs"||e==="cenc"){const s=Lt(u,["schi","tenc"])[0];if(s)return s}}}function hx(u,t,e){const s={},r=Lt(u,["moof","traf"]);for(let a=0;a<r.length;a++){const o=r[a],f=Lt(o,["tfhd"])[0],h=St(f,4),d=t[h];if(!d)continue;s[h]||(s[h]={start:NaN,duration:0,sampleCount:0,timescale:d.timescale,type:d.type});const g=s[h],p=Lt(o,["tfdt"])[0];if(p){const D=p[0];let k=St(p,4);D===1&&(k===mm?e.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(k*=mm+1,k+=St(p,8))),ct(k)&&(!ct(g.start)||k<g.start)&&(g.start=k)}const v=d.default,E=St(f,0)|(v==null?void 0:v.flags);let S=(v==null?void 0:v.duration)||0;E&8&&(E&2?S=St(f,12):S=St(f,8));const A=Lt(o,["trun"]);let b=g.start||0,L=0,_=S;for(let D=0;D<A.length;D++){const k=A[D],w=St(k,4),V=g.sampleCount;g.sampleCount+=w;const O=k[3]&1,$=k[3]&4,G=k[2]&1,B=k[2]&2,Q=k[2]&4,st=k[2]&8;let ut=8,dt=w;for(O&&(ut+=4),$&&w&&(!(k[ut+1]&1)&&g.keyFrameIndex===void 0&&(g.keyFrameIndex=V),ut+=4,G?(_=St(k,ut),ut+=4):_=S,B&&(ut+=4),st&&(ut+=4),b+=_,L+=_,dt--);dt--;)G?(_=St(k,ut),ut+=4):_=S,B&&(ut+=4),Q&&(k[ut+1]&1||g.keyFrameIndex===void 0&&(g.keyFrameIndex=g.sampleCount-(dt+1),g.keyFrameStart=b),ut+=4),st&&(ut+=4),b+=_,L+=_;!L&&S&&(L+=S*w)}g.duration+=L}if(!Object.keys(s).some(a=>s[a].duration)){let a=1/0,o=0;const f=Lt(u,["sidx"]);for(let h=0;h<f.length;h++){const d=ox(f[h]);if(d!=null&&d.references){a=Math.min(a,d.earliestPresentationTime/d.timescale);const g=d.references.reduce((p,v)=>p+v.info.duration||0,0);o=Math.max(o,g+d.earliestPresentationTime/d.timescale)}}o&&ct(o)&&Object.keys(s).forEach(h=>{s[h].duration||(s[h].duration=o*s[h].timescale-s[h].start)})}return s}function gx(u){const t={valid:null,remainder:null},e=Lt(u,["moof"]);if(e.length<2)return t.remainder=u,t;const s=e[e.length-1];return t.valid=u.slice(0,s.byteOffset-8),t.remainder=u.slice(s.byteOffset-8),t}function gi(u,t){const e=new Uint8Array(u.length+t.length);return e.set(u),e.set(t,u.length),e}function ym(u,t){const e=[],s=t.samples,r=t.timescale,a=t.id;let o=!1;return Lt(s,["moof"]).map(h=>{const d=h.byteOffset-8;Lt(h,["traf"]).map(p=>{const v=Lt(p,["tfdt"]).map(E=>{const S=E[0];let A=St(E,4);return S===1&&(A*=Math.pow(2,32),A+=St(E,8)),A/r})[0];return v!==void 0&&(u=v),Lt(p,["tfhd"]).map(E=>{const S=St(E,4),A=St(E,0)&16777215,b=(A&1)!==0,L=(A&2)!==0,_=(A&8)!==0;let D=0;const k=(A&16)!==0;let w=0;const V=(A&32)!==0;let O=8;S===a&&(b&&(O+=8),L&&(O+=4),_&&(D=St(E,O),O+=4),k&&(w=St(E,O),O+=4),V&&(O+=4),t.type==="video"&&(o=To(t.codec)),Lt(p,["trun"]).map($=>{const G=$[0],B=St($,0)&16777215,Q=(B&1)!==0;let st=0;const ut=(B&4)!==0,dt=(B&256)!==0;let lt=0;const N=(B&512)!==0;let X=0;const Z=(B&1024)!==0,rt=(B&2048)!==0;let ot=0;const I=St($,4);let U=8;Q&&(st=St($,U),U+=4),ut&&(U+=4);let it=st+d;for(let nt=0;nt<I;nt++){if(dt?(lt=St($,U),U+=4):lt=D,N?(X=St($,U),U+=4):X=w,Z&&(U+=4),rt&&(G===0?ot=St($,U):ot=$p($,U),U+=4),t.type===qt.VIDEO){let at=0;for(;at<X;){const ft=St(s,it);if(it+=4,mx(o,s[it])){const Et=s.subarray(it,it+ft);Nf(Et,o?2:1,u+ot/r,e)}it+=ft,at+=ft+4}}u+=lt/r}}))})})}),e}function To(u){if(!u)return!1;const t=u.substring(0,4);return t==="hvc1"||t==="hev1"||t==="dvh1"||t==="dvhe"}function mx(u,t){if(u){const e=t>>1&63;return e===39||e===40}else return(t&31)===6}function Nf(u,t,e,s){const r=Kp(u);let a=0;a+=t;let o=0,f=0,h=0;for(;a<r.length;){o=0;do{if(a>=r.length)break;h=r[a++],o+=h}while(h===255);f=0;do{if(a>=r.length)break;h=r[a++],f+=h}while(h===255);const d=r.length-a;let g=a;if(f<d)a+=f;else if(f>d){Gt.error(`Malformed SEI payload. ${f} is too small, only ${d} bytes left to parse.`);break}if(o===4){if(r[g++]===181){const v=Fp(r,g);if(g+=2,v===49){const E=St(r,g);if(g+=4,E===1195456820){const S=r[g++];if(S===3){const A=r[g++],b=31&A,L=64&A,_=L?2+b*3:0,D=new Uint8Array(_);if(L){D[0]=A;for(let k=1;k<_;k++)D[k]=r[g++]}s.push({type:S,payloadType:o,pts:e,bytes:D})}}}}}else if(o===5&&f>16){const p=[];for(let S=0;S<16;S++){const A=r[g++].toString(16);p.push(A.length==1?"0"+A:A),(S===3||S===5||S===7||S===9)&&p.push("-")}const v=f-16,E=new Uint8Array(v);for(let S=0;S<v;S++)E[S]=r[g++];s.push({payloadType:o,pts:e,uuid:p.join(""),userData:ii(E),userDataBytes:E})}}}function Kp(u){const t=u.byteLength,e=[];let s=1;for(;s<t-2;)u[s]===0&&u[s+1]===0&&u[s+2]===3?(e.push(s+2),s+=2):s++;if(e.length===0)return u;const r=t-e.length,a=new Uint8Array(r);let o=0;for(s=0;s<r;o++,s++)o===e[0]&&(o++,e.shift()),a[s]=u[o];return a}function px(u){const t=u[0];let e="",s="",r=0,a=0,o=0,f=0,h=0,d=0;if(t===0){for(;he(u.subarray(d,d+1))!=="\0";)e+=he(u.subarray(d,d+1)),d+=1;for(e+=he(u.subarray(d,d+1)),d+=1;he(u.subarray(d,d+1))!=="\0";)s+=he(u.subarray(d,d+1)),d+=1;s+=he(u.subarray(d,d+1)),d+=1,r=St(u,12),a=St(u,16),f=St(u,20),h=St(u,24),d=28}else if(t===1){d+=4,r=St(u,d),d+=4;const p=St(u,d);d+=4;const v=St(u,d);for(d+=4,o=2**32*p+v,VT(o)||(o=Number.MAX_SAFE_INTEGER,Gt.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),f=St(u,d),d+=4,h=St(u,d),d+=4;he(u.subarray(d,d+1))!=="\0";)e+=he(u.subarray(d,d+1)),d+=1;for(e+=he(u.subarray(d,d+1)),d+=1;he(u.subarray(d,d+1))!=="\0";)s+=he(u.subarray(d,d+1)),d+=1;s+=he(u.subarray(d,d+1)),d+=1}const g=u.subarray(d,u.byteLength);return{schemeIdUri:e,value:s,timeScale:r,presentationTime:o,presentationTimeDelta:a,eventDuration:f,id:h,payload:g}}function yx(u,...t){const e=t.length;let s=8,r=e;for(;r--;)s+=t[r].byteLength;const a=new Uint8Array(s);for(a[0]=s>>24&255,a[1]=s>>16&255,a[2]=s>>8&255,a[3]=s&255,a.set(u,4),r=0,s=8;r<e;r++)a.set(t[r],s),s+=t[r].byteLength;return a}function vx(u,t,e){if(u.byteLength!==16)throw new RangeError("Invalid system id");let s,r;s=0,r=new Uint8Array;let a;s>0?(a=new Uint8Array(4),t.length>0&&new DataView(a.buffer).setUint32(0,t.length,!1)):a=new Uint8Array;const o=new Uint8Array(4);return e.byteLength>0&&new DataView(o.buffer).setUint32(0,e.byteLength,!1),yx([112,115,115,104],new Uint8Array([s,0,0,0]),u,a,r,o,e)}function Ex(u){const t=[];if(u instanceof ArrayBuffer){const e=u.byteLength;let s=0;for(;s+32<e;){const r=new DataView(u,s),a=Sx(r);t.push(a),s+=a.size}}return t}function Sx(u){const t=u.getUint32(0),e=u.byteOffset,s=u.byteLength;if(s<t)return{offset:e,size:s};if(u.getUint32(4)!==1886614376)return{offset:e,size:t};const a=u.getUint32(8)>>>24;if(a!==0&&a!==1)return{offset:e,size:t};const o=u.buffer,f=Re(new Uint8Array(o,e+12,16));let h=null,d=null,g=0;if(a===0)g=28;else{const v=u.getUint32(28);if(!v||s<32+v*16)return{offset:e,size:t};h=[];for(let E=0;E<v;E++)h.push(new Uint8Array(o,e+32+E*16,16));g=32+v*16}if(!g)return{offset:e,size:t};const p=u.getUint32(g);return t-32<p?{offset:e,size:t}:(d=new Uint8Array(o,e+g+4,p),{version:a,systemId:f,kids:h,data:d,offset:e,size:t})}const jp=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),lr={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Pf(u,t){const e=lr[t];return!!e&&!!e[u.slice(0,4)]}function da(u,t,e=!0){return!u.split(",").some(s=>!Uf(s,t,e))}function Uf(u,t,e=!0){var s;const r=Us(e);return(s=r==null?void 0:r.isTypeSupported(ha(u,t)))!=null?s:!1}function ha(u,t){return`${t}/mp4;codecs=${u}`}function vm(u){if(u){const t=u.substring(0,4);return lr.video[t]}return 2}function uo(u){const t=jp();return u.split(",").reduce((e,s)=>{const a=t&&To(s)?9:lr.video[s];return a?(a*2+e)/(e?3:2):(lr.audio[s]+e)/(e?2:1)},0)}const jc={};function Tx(u,t=!0){if(jc[u])return jc[u];const e={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[u];for(let r=0;r<e.length;r++){var s;if(Uf(e[r],"audio",t))return jc[u]=e[r],e[r];if(e[r]==="mp3"&&(s=Us(t))!=null&&s.isTypeSupported("audio/mpeg"))return""}return u}const xx=/flac|opus|mp4a\.40\.34/i;function co(u,t=!0){return u.replace(xx,e=>Tx(e.toLowerCase(),t))}function Ax(u,t){const e=[];if(u){const s=u.split(",");for(let r=0;r<s.length;r++)Pf(s[r],"video")||e.push(s[r])}return t&&e.push(t),e.join(",")}function eo(u,t){if(u&&(u.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(u)!==-1)&&(Em(u,"audio")||Em(u,"video")))return u;if(t){const e=t.split(",");if(e.length>1){if(u){for(let s=e.length;s--;)if(e[s].substring(0,4)===u.substring(0,4))return e[s]}return e[0]}}return t||u}function Em(u,t){return Pf(u,t)&&Uf(u,t)}function bx(u){const t=u.split(",");for(let e=0;e<t.length;e++){const s=t[e].split(".");s.length>2&&s[0]==="avc1"&&(t[e]=`avc1.${parseInt(s[1]).toString(16)}${("000"+parseInt(s[2]).toString(16)).slice(-4)}`)}return t.join(",")}function Lx(u){if(u.startsWith("av01.")){const t=u.split("."),e=["0","111","01","01","01","0"];for(let s=t.length;s>4&&s<10;s++)t[s]=e[s-4];return t.join(".")}return u}function Sm(u){const t=Us(u)||{isTypeSupported:()=>!1};return{mpeg:t.isTypeSupported("audio/mpeg"),mp3:t.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:t.isTypeSupported('audio/mp4; codecs="ac-3"')}}function mf(u){return u.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const Rx={supported:!0,powerEfficient:!0,smooth:!0},_x={supported:!1,smooth:!1,powerEfficient:!1},Vp={supported:!0,configurations:[],decodingInfoResults:[Rx]};function Yp(u,t){return{supported:!1,configurations:t,decodingInfoResults:[_x],error:u}}function Dx(u,t,e,s,r,a){const o=u.videoCodec,f=u.audioCodec?u.audioGroups:null,h=a==null?void 0:a.audioCodec,d=a==null?void 0:a.channels,g=d?parseInt(d):h?1/0:2;let p=null;if(f!=null&&f.length)try{f.length===1&&f[0]?p=t.groups[f[0]].channels:p=f.reduce((v,E)=>{if(E){const S=t.groups[E];if(!S)throw new Error(`Audio track group ${E} not found`);Object.keys(S.channels).forEach(A=>{v[A]=(v[A]||0)+S.channels[A]})}return v},{2:0})}catch{return!0}return o!==void 0&&(o.split(",").some(v=>To(v))||u.width>1920&&u.height>1088||u.height>1920&&u.width>1088||u.frameRate>Math.max(s,30)||u.videoRange!=="SDR"&&u.videoRange!==e||u.bitrate>Math.max(r,8e6))||!!p&&ct(g)&&Object.keys(p).some(v=>parseInt(v)>g)}function qp(u,t,e,s={}){const r=u.videoCodec;if(!r&&!u.audioCodec||!e)return Promise.resolve(Vp);const a=[],o=Ix(u),f=o.length,h=Cx(u,t,f>0),d=h.length;for(let g=f||1*d||1;g--;){const p={type:"media-source"};if(f&&(p.video=o[g%f]),d){p.audio=h[g%d];const v=p.audio.bitrate;p.video&&v&&(p.video.bitrate-=v)}a.push(p)}if(r){const g=navigator.userAgent;if(r.split(",").some(p=>To(p))&&jp())return Promise.resolve(Yp(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${g})`),a))}return Promise.all(a.map(g=>{const p=Ox(g);return s[p]||(s[p]=e.decodingInfo(g))})).then(g=>({supported:!g.some(p=>!p.supported),configurations:a,decodingInfoResults:g})).catch(g=>({supported:!1,configurations:a,decodingInfoResults:[],error:g}))}function Ix(u){var t;const e=(t=u.videoCodec)==null?void 0:t.split(","),s=Xp(u),r=u.width||640,a=u.height||480,o=u.frameRate||30,f=u.videoRange.toLowerCase();return e?e.map(h=>{const d={contentType:ha(Lx(h),"video"),width:r,height:a,bitrate:s,framerate:o};return f!=="sdr"&&(d.transferFunction=f),d}):[]}function Cx(u,t,e){var s;const r=(s=u.audioCodec)==null?void 0:s.split(","),a=Xp(u);return r&&u.audioGroups?u.audioGroups.reduce((o,f)=>{var h;const d=f?(h=t.groups[f])==null?void 0:h.tracks:null;return d?d.reduce((g,p)=>{if(p.groupId===f){const v=parseFloat(p.channels||"");r.forEach(E=>{const S={contentType:ha(E,"audio"),bitrate:e?kx(E,a):a};v&&(S.channels=""+v),g.push(S)})}return g},o):o},[]):[]}function kx(u,t){if(t<=1)return 1;let e=128e3;return u==="ec-3"?e=768e3:u==="ac-3"&&(e=64e4),Math.min(t/2,e)}function Xp(u){return Math.ceil(Math.max(u.bitrate*.9,u.averageBitrate)/1e3)*1e3||1}function Ox(u){let t="";const{audio:e,video:s}=u;if(s){const r=mf(s.contentType);t+=`${r}_r${s.height}x${s.width}f${Math.ceil(s.framerate)}${s.transferFunction||"sd"}_${Math.ceil(s.bitrate/1e5)}`}if(e){const r=mf(e.contentType);t+=`${s?"_":""}${r}_c${e.channels}`}return t}const pf=["NONE","TYPE-0","TYPE-1",null];function Mx(u){return pf.indexOf(u)>-1}const fo=["SDR","PQ","HLG"];function wx(u){return!!u&&fo.indexOf(u)>-1}var io={No:"",Yes:"YES",v2:"v2"};function Tm(u){const{canSkipUntil:t,canSkipDateRanges:e,age:s}=u,r=s<t/2;return t&&r?e?io.v2:io.Yes:io.No}class xm{constructor(t,e,s){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=e,this.skip=s}addDirectives(t){const e=new self.URL(t);return this.msn!==void 0&&e.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href}}class ga{constructor(t){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[t.url],this._attrs=[t.attrs],this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.frameRate=t.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=t.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.codecSet=[t.videoCodec,t.audioCodec].filter(s=>!!s).map(s=>s.substring(0,4)).join(","),"supplemental"in t){var e;this.supplemental=t.supplemental;const s=(e=t.supplemental)==null?void 0:e.videoCodec;s&&s!==t.videoCodec&&(this.codecSet+=`,${s.substring(0,4)}`)}this.addGroupId("audio",t.attrs.AUDIO),this.addGroupId("text",t.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(t){return Am(this._audioGroups,t)}hasSubtitleGroup(t){return Am(this._subtitleGroups,t)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(t,e){if(e){if(t==="audio"){let s=this._audioGroups;s||(s=this._audioGroups=[]),s.indexOf(e)===-1&&s.push(e)}else if(t==="text"){let s=this._subtitleGroups;s||(s=this._subtitleGroups=[]),s.indexOf(e)===-1&&s.push(e)}}}get urlId(){return 0}set urlId(t){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var t;return(t=this.audioGroups)==null?void 0:t[0]}get textGroupId(){var t;return(t=this.subtitleGroups)==null?void 0:t[0]}addFallback(){}}function Am(u,t){return!t||!u?!1:u.indexOf(t)!==-1}function Nx(){if(typeof matchMedia=="function"){const u=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(u.media!==t.media)return u.matches===!0}return!1}function Px(u,t){let e=!1,s=[];if(u&&(e=u!=="SDR",s=[u]),t){s=t.allowedVideoRanges||fo.slice(0);const r=s.join("")!=="SDR"&&!t.videoCodec;e=t.preferHDR!==void 0?t.preferHDR:r&&Nx(),e||(s=["SDR"])}return{preferHDR:e,allowedVideoRanges:s}}const Ux=u=>{const t=new WeakSet;return(e,s)=>{if(u&&(s=u(e,s)),typeof s=="object"&&s!==null){if(t.has(s))return;t.add(s)}return s}},Xt=(u,t)=>JSON.stringify(u,Ux(t));function Bx(u,t,e,s,r){const a=Object.keys(u),o=s==null?void 0:s.channels,f=s==null?void 0:s.audioCodec,h=r==null?void 0:r.videoCodec,d=o&&parseInt(o)===2;let g=!1,p=!1,v=1/0,E=1/0,S=1/0,A=1/0,b=0,L=[];const{preferHDR:_,allowedVideoRanges:D}=Px(t,r);for(let $=a.length;$--;){const G=u[a[$]];g||(g=G.channels[2]>0),v=Math.min(v,G.minHeight),E=Math.min(E,G.minFramerate),S=Math.min(S,G.minBitrate),D.filter(Q=>G.videoRanges[Q]>0).length>0&&(p=!0)}v=ct(v)?v:0,E=ct(E)?E:0;const k=Math.max(1080,v),w=Math.max(30,E);S=ct(S)?S:e,e=Math.max(S,e),p||(t=void 0);const V=a.length>1;return{codecSet:a.reduce(($,G)=>{const B=u[G];if(G===$)return $;if(L=p?D.filter(Q=>B.videoRanges[Q]>0):[],V){if(B.minBitrate>e)return Ii(G,`min bitrate of ${B.minBitrate} > current estimate of ${e}`),$;if(!B.hasDefaultAudio)return Ii(G,"no renditions with default or auto-select sound found"),$;if(f&&G.indexOf(f.substring(0,4))%5!==0)return Ii(G,`audio codec preference "${f}" not found`),$;if(o&&!d){if(!B.channels[o])return Ii(G,`no renditions with ${o} channel sound found (channels options: ${Object.keys(B.channels)})`),$}else if((!f||d)&&g&&B.channels[2]===0)return Ii(G,"no renditions with stereo sound found"),$;if(B.minHeight>k)return Ii(G,`min resolution of ${B.minHeight} > maximum of ${k}`),$;if(B.minFramerate>w)return Ii(G,`min framerate of ${B.minFramerate} > maximum of ${w}`),$;if(!L.some(Q=>B.videoRanges[Q]>0))return Ii(G,`no variants with VIDEO-RANGE of ${Xt(L)} found`),$;if(h&&G.indexOf(h.substring(0,4))%5!==0)return Ii(G,`video codec preference "${h}" not found`),$;if(B.maxScore<b)return Ii(G,`max score of ${B.maxScore} < selected max of ${b}`),$}return $&&(uo(G)>=uo($)||B.fragmentError>u[$].fragmentError)?$:(A=B.minIndex,b=B.maxScore,G)},void 0),videoRanges:L,preferHDR:_,minFramerate:E,minBitrate:S,minIndex:A}}function Ii(u,t){Gt.log(`[abr] start candidates with "${u}" ignored because ${t}`)}function Qp(u){return u.reduce((t,e)=>{let s=t.groups[e.groupId];s||(s=t.groups[e.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),s.tracks.push(e);const r=e.channels||"2";return s.channels[r]=(s.channels[r]||0)+1,s.hasDefault=s.hasDefault||e.default,s.hasAutoSelect=s.hasAutoSelect||e.autoselect,s.hasDefault&&(t.hasDefaultAudio=!0),s.hasAutoSelect&&(t.hasAutoSelectAudio=!0),t},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function Fx(u,t,e,s){return u.slice(e,s+1).reduce((r,a,o)=>{if(!a.codecSet)return r;const f=a.audioGroups;let h=r[a.codecSet];h||(r[a.codecSet]=h={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!f,fragmentError:0}),h.minBitrate=Math.min(h.minBitrate,a.bitrate);const d=Math.min(a.height,a.width);return h.minHeight=Math.min(h.minHeight,d),h.minFramerate=Math.min(h.minFramerate,a.frameRate),h.minIndex=Math.min(h.minIndex,o),h.maxScore=Math.max(h.maxScore,a.score),h.fragmentError+=a.fragmentError,h.videoRanges[a.videoRange]=(h.videoRanges[a.videoRange]||0)+1,f&&f.forEach(g=>{if(!g)return;const p=t.groups[g];p&&(h.hasDefaultAudio=h.hasDefaultAudio||t.hasDefaultAudio?p.hasDefault:p.hasAutoSelect||!t.hasDefaultAudio&&!t.hasAutoSelectAudio,Object.keys(p.channels).forEach(v=>{h.channels[v]=(h.channels[v]||0)+p.channels[v]}))}),r},{})}function bm(u){if(!u)return u;const{lang:t,assocLang:e,characteristics:s,channels:r,audioCodec:a}=u;return{lang:t,assocLang:e,characteristics:s,channels:r,audioCodec:a}}function Mi(u,t,e){if("attrs"in u){const s=t.indexOf(u);if(s!==-1)return s}for(let s=0;s<t.length;s++){const r=t[s];if(on(u,r,e))return s}return-1}function on(u,t,e){const{groupId:s,name:r,lang:a,assocLang:o,default:f}=u,h=u.forced;return(s===void 0||t.groupId===s)&&(r===void 0||t.name===r)&&(a===void 0||$x(a,t.lang))&&(a===void 0||t.assocLang===o)&&(f===void 0||t.default===f)&&(h===void 0||t.forced===h)&&(!("characteristics"in u)||Gx(u.characteristics||"",t.characteristics))&&(e===void 0||e(u,t))}function $x(u,t="--"){return u.length===t.length?u===t:u.startsWith(t)||t.startsWith(u)}function Gx(u,t=""){const e=u.split(","),s=t.split(",");return e.length===s.length&&!e.some(r=>s.indexOf(r)===-1)}function ln(u,t){const{audioCodec:e,channels:s}=u;return(e===void 0||(t.audioCodec||"").substring(0,4)===e.substring(0,4))&&(s===void 0||s===(t.channels||"2"))}function Hx(u,t,e,s,r){const a=t[s],f=t.reduce((v,E,S)=>{const A=E.uri;return(v[A]||(v[A]=[])).push(S),v},{})[a.uri];f.length>1&&(s=Math.max.apply(Math,f));const h=a.videoRange,d=a.frameRate,g=a.codecSet.substring(0,4),p=Lm(t,s,v=>{if(v.videoRange!==h||v.frameRate!==d||v.codecSet.substring(0,4)!==g)return!1;const E=v.audioGroups,S=e.filter(A=>!E||E.indexOf(A.groupId)!==-1);return Mi(u,S,r)>-1});return p>-1?p:Lm(t,s,v=>{const E=v.audioGroups,S=e.filter(A=>!E||E.indexOf(A.groupId)!==-1);return Mi(u,S,r)>-1})}function Lm(u,t,e){for(let s=t;s>-1;s--)if(e(u[s]))return s;for(let s=t+1;s<u.length;s++)if(e(u[s]))return s;return-1}function ho(u,t){var e;return!!u&&u!==((e=t.loadLevelObj)==null?void 0:e.uri)}class zx extends mi{constructor(t){super("abr",t.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=e=>{var s;const{fragCurrent:r,partCurrent:a,hls:o}=this,{autoLevelEnabled:f,media:h}=o;if(!r||!h)return;const d=performance.now(),g=a?a.stats:r.stats,p=a?a.duration:r.duration,v=d-g.loading.start,E=o.minAutoLevel,S=r.level,A=this._nextAutoLevel;if(g.aborted||g.loaded&&g.loaded===g.total||S<=E){this.clearTimer(),this._nextAutoLevel=-1;return}if(!f)return;const b=A>-1&&A!==S,L=!!e||b;if(!L&&(h.paused||!h.playbackRate||!h.readyState))return;const _=o.mainForwardBufferInfo;if(!L&&_===null)return;const D=this.bwEstimator.getEstimateTTFB(),k=Math.abs(h.playbackRate);if(v<=Math.max(D,1e3*(p/(k*2))))return;const w=_?_.len/k:0,V=g.loading.first?g.loading.first-g.loading.start:-1,O=g.loaded&&V>-1,$=this.getBwEstimate(),G=o.levels,B=G[S],Q=Math.max(g.loaded,Math.round(p*(r.bitrate||B.averageBitrate)/8));let st=O?v-V:v;st<1&&O&&(st=Math.min(v,g.loaded*8/$));const ut=O?g.loaded*1e3/st:0,dt=D/1e3,lt=ut?(Q-g.loaded)/ut:Q*8/$+dt;if(lt<=w)return;const N=ut?ut*8:$,X=((s=(e==null?void 0:e.details)||this.hls.latestLevelDetails)==null?void 0:s.live)===!0,Z=this.hls.config.abrBandWidthUpFactor;let rt=Number.POSITIVE_INFINITY,ot;for(ot=S-1;ot>E;ot--){const nt=G[ot].maxBitrate,at=!G[ot].details||X;if(rt=this.getTimeToLoadFrag(dt,N,p*nt,at),rt<Math.min(w,p+dt))break}if(rt>=lt||rt>p*10)return;O?this.bwEstimator.sample(v-Math.min(D,V),g.loaded):this.bwEstimator.sampleTTFB(v);const I=G[ot].maxBitrate;this.getBwEstimate()*Z>I&&this.resetEstimator(I);const U=this.findBestLevel(I,E,ot,0,w,1,1);U>-1&&(ot=U),this.warn(`Fragment ${r.sn}${a?" part "+a.index:""} of level ${S} is loading too slowly;
      Fragment duration: ${r.duration.toFixed(3)}
      Time to underbuffer: ${w.toFixed(3)} s
      Estimated load time for current fragment: ${lt.toFixed(3)} s
      Estimated load time for down switch fragment: ${rt.toFixed(3)} s
      TTFB estimate: ${V|0} ms
      Current BW estimate: ${ct($)?$|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${ot} @ ${I|0} bps`),o.nextLoadLevel=o.nextAutoLevel=ot,this.clearTimer();const it=()=>{if(this.clearTimer(),this.fragCurrent===r&&this.hls.loadLevel===ot&&ot>0){const nt=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${ot>0?"and switching down":""}
      Fragment duration: ${r.duration.toFixed(3)} s
      Time to underbuffer: ${nt.toFixed(3)} s`),r.abortRequests(),this.fragCurrent=this.partCurrent=null,ot>E){let at=this.findBestLevel(this.hls.levels[E].bitrate,E,ot,0,nt,1,1);at===-1&&(at=E),this.hls.nextLoadLevel=this.hls.nextAutoLevel=at,this.resetEstimator(this.hls.levels[at].bitrate)}}};b||lt>rt*2?it():this.timer=self.setInterval(it,rt*1e3),o.trigger(x.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:a,stats:g})},this.hls=t,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(t){t&&(this.log(`setting initial bwe to ${t}`),this.hls.config.abrEwmaDefaultEstimate=t),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const t=this.hls.config;return new qT(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate)}registerListeners(){const{hls:t}=this;t.on(x.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.FRAG_LOADING,this.onFragLoading,this),t.on(x.FRAG_LOADED,this.onFragLoaded,this),t.on(x.FRAG_BUFFERED,this.onFragBuffered,this),t.on(x.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(x.LEVEL_LOADED,this.onLevelLoaded,this),t.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(x.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),t.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t&&(t.off(x.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.FRAG_LOADING,this.onFragLoading,this),t.off(x.FRAG_LOADED,this.onFragLoaded,this),t.off(x.FRAG_BUFFERED,this.onFragBuffered,this),t.off(x.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(x.LEVEL_LOADED,this.onLevelLoaded,this),t.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(x.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),t.off(x.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(t,e){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(t,e){const s=e.frag;if(!this.ignoreFragment(s)){if(!s.bitrateTest){var r;this.fragCurrent=s,this.partCurrent=(r=e.part)!=null?r:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(t,e){this.clearTimer()}onError(t,e){if(!e.fatal)switch(e.details){case z.BUFFER_ADD_CODEC_ERROR:case z.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case z.FRAG_LOAD_TIMEOUT:{const s=e.frag,{fragCurrent:r,partCurrent:a}=this;if(s&&r&&s.sn===r.sn&&s.level===r.level){const o=performance.now(),f=a?a.stats:s.stats,h=o-f.loading.start,d=f.loading.first?f.loading.first-f.loading.start:-1;if(f.loaded&&d>-1){const p=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(h-Math.min(p,d),f.loaded)}else this.bwEstimator.sampleTTFB(h)}break}}}getTimeToLoadFrag(t,e,s,r){const a=t+s/e,o=r?t+this.lastLevelLoadSec:0;return a+o}onLevelLoaded(t,e){const s=this.hls.config,{loading:r}=e.stats,a=r.end-r.first;ct(a)&&(this.lastLevelLoadSec=a/1e3),e.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(e.levelInfo)}onFragLoaded(t,{frag:e,part:s}){const r=s?s.stats:e.stats;if(e.type===ht.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(e)){if(this.clearTimer(),e.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const a=s?s.duration:e.duration,o=this.hls.levels[e.level],f=(o.loaded?o.loaded.bytes:0)+r.loaded,h=(o.loaded?o.loaded.duration:0)+a;o.loaded={bytes:f,duration:h},o.realBitrate=Math.round(8*f/h)}if(e.bitrateTest){const a={stats:r,frag:e,part:s,id:e.type};this.onFragBuffered(x.FRAG_BUFFERED,a),e.bitrateTest=!1}else this.lastLoadedFragLevel=e.level}}onFragBuffered(t,e){const{frag:s,part:r}=e,a=r!=null&&r.stats.loaded?r.stats:s.stats;if(a.aborted||this.ignoreFragment(s))return;const o=a.parsing.end-a.loading.start-Math.min(a.loading.first-a.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,a.loaded),a.bwEstimate=this.getBwEstimate(),s.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(t){return t.type!==ht.MAIN||t.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:t,minAutoLevel:e}=this.hls,s=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,a=this.findBestLevel(s,e,t,0,r,1,1);if(a>-1)return a;const o=this.hls.firstLevel,f=Math.min(Math.max(o,e),t);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${f}`),f}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const t=this.forcedAutoLevel,s=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(t!==-1&&(!s||!r||this.nextAutoLevelKey===this.getAutoLevelKey()))return t;const a=s&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(t!==-1){const o=this.hls.levels;if(o.length>Math.max(t,a)&&o[t].loadError<=o[a].loadError)return t}return this._nextAutoLevel=a,this.nextAutoLevelKey=this.getAutoLevelKey(),a}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:t,partCurrent:e,hls:s}=this;if(s.levels.length<=1)return s.loadLevel;const{maxAutoLevel:r,config:a,minAutoLevel:o}=s,f=e?e.duration:t?t.duration:0,h=this.getBwEstimate(),d=this.getStarvationDelay();let g=a.abrBandWidthFactor,p=a.abrBandWidthUpFactor;if(d){const b=this.findBestLevel(h,o,r,d,0,g,p);if(b>=0)return this.rebufferNotice=-1,b}let v=f?Math.min(f,a.maxStarvationDelay):a.maxStarvationDelay;if(!d){const b=this.bitrateTestDelay;b&&(v=(f?Math.min(f,a.maxLoadingDelay):a.maxLoadingDelay)-b,this.info(`bitrate test took ${Math.round(1e3*b)}ms, set first fragment max fetchDuration to ${Math.round(1e3*v)} ms`),g=p=1)}const E=this.findBestLevel(h,o,r,d,v,g,p);if(this.rebufferNotice!==E&&(this.rebufferNotice=E,this.info(`${d?"rebuffering expected":"buffer is empty"}, optimal quality level ${E}`)),E>-1)return E;const S=s.levels[o],A=s.loadLevelObj;return A&&(S==null?void 0:S.bitrate)<A.bitrate?o:s.loadLevel}getStarvationDelay(){const t=this.hls,e=t.media;if(!e)return 1/0;const s=e&&e.playbackRate!==0?Math.abs(e.playbackRate):1,r=t.mainForwardBufferInfo;return(r?r.len:0)/s}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(t,e,s,r,a,o,f){var h;const d=r+a,g=this.lastLoadedFragLevel,p=g===-1?this.hls.firstLevel:g,{fragCurrent:v,partCurrent:E}=this,{levels:S,allAudioTracks:A,loadLevel:b,config:L}=this.hls;if(S.length===1)return 0;const _=S[p],D=!!((h=this.hls.latestLevelDetails)!=null&&h.live),k=b===-1||g===-1;let w,V="SDR",O=(_==null?void 0:_.frameRate)||0;const{audioPreference:$,videoPreference:G}=L,B=this.audioTracksByGroup||(this.audioTracksByGroup=Qp(A));let Q=-1;if(k){if(this.firstSelection!==-1)return this.firstSelection;const N=this.codecTiers||(this.codecTiers=Fx(S,B,e,s)),X=Bx(N,V,t,$,G),{codecSet:Z,videoRanges:rt,minFramerate:ot,minBitrate:I,minIndex:U,preferHDR:it}=X;Q=U,w=Z,V=it?rt[rt.length-1]:rt[0],O=ot,t=Math.max(t,I),this.log(`picked start tier ${Xt(X)}`)}else w=_==null?void 0:_.codecSet,V=_==null?void 0:_.videoRange;const st=E?E.duration:v?v.duration:0,ut=this.bwEstimator.getEstimateTTFB()/1e3,dt=[];for(let N=s;N>=e;N--){var lt;const X=S[N],Z=N>p;if(!X)continue;if(L.useMediaCapabilities&&!X.supportedResult&&!X.supportedPromise){const at=navigator.mediaCapabilities;typeof(at==null?void 0:at.decodingInfo)=="function"&&Dx(X,B,V,O,t,$)?(X.supportedPromise=qp(X,B,at,this.supportedCache),X.supportedPromise.then(ft=>{if(!this.hls)return;X.supportedResult=ft;const Et=this.hls.levels,wt=Et.indexOf(X);ft.error?this.warn(`MediaCapabilities decodingInfo error: "${ft.error}" for level ${wt} ${Xt(ft)}`):ft.supported?ft.decodingInfoResults.some(Mt=>Mt.smooth===!1||Mt.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${wt} not smooth or powerEfficient: ${Xt(ft)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${wt} ${Xt(ft)}`),wt>-1&&Et.length>1&&(this.log(`Removing unsupported level ${wt}`),this.hls.removeLevel(wt),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(ft=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${ft}`)})):X.supportedResult=Vp}if((w&&X.codecSet!==w||V&&X.videoRange!==V||Z&&O>X.frameRate||!Z&&O>0&&O<X.frameRate||(lt=X.supportedResult)!=null&&(lt=lt.decodingInfoResults)!=null&&lt.some(at=>at.smooth===!1))&&(!k||N!==Q)){dt.push(N);continue}const rt=X.details,ot=(E?rt==null?void 0:rt.partTarget:rt==null?void 0:rt.averagetargetduration)||st;let I;Z?I=f*t:I=o*t;const U=st&&r>=st*2&&a===0?X.averageBitrate:X.maxBitrate,it=this.getTimeToLoadFrag(ut,I,U*ot,rt===void 0);if(I>=U&&(N===g||X.loadError===0&&X.fragmentError===0)&&(it<=ut||!ct(it)||D&&!this.bitrateTestDelay||it<d)){const at=this.forcedAutoLevel;return N!==b&&(at===-1||at!==b)&&(dt.length&&this.trace(`Skipped level(s) ${dt.join(",")} of ${s} max with CODECS and VIDEO-RANGE:"${S[dt[0]].codecs}" ${S[dt[0]].videoRange}; not compatible with "${w}" ${V}`),this.info(`switch candidate:${p}->${N} adjustedbw(${Math.round(I)})-bitrate=${Math.round(I-U)} ttfb:${ut.toFixed(1)} avgDuration:${ot.toFixed(1)} maxFetchDuration:${d.toFixed(1)} fetchDuration:${it.toFixed(1)} firstSelection:${k} codecSet:${X.codecSet} videoRange:${X.videoRange} hls.loadLevel:${b}`)),k&&(this.firstSelection=N),N}}return-1}set nextAutoLevel(t){const e=this.deriveNextAutoLevel(t);this._nextAutoLevel!==e&&(this.nextAutoLevelKey="",this._nextAutoLevel=e)}deriveNextAutoLevel(t){const{maxAutoLevel:e,minAutoLevel:s}=this.hls;return Math.min(Math.max(t,s),e)}}const Wp={search:function(u,t){let e=0,s=u.length-1,r=null,a=null;for(;e<=s;){r=(e+s)/2|0,a=u[r];const o=t(a);if(o>0)e=r+1;else if(o<0)s=r-1;else return a}return null}};function Kx(u,t,e){if(t===null||!Array.isArray(u)||!u.length||!ct(t))return null;const s=u[0].programDateTime;if(t<(s||0))return null;const r=u[u.length-1].endProgramDateTime;if(t>=(r||0))return null;for(let a=0;a<u.length;++a){const o=u[a];if(Vx(t,e,o))return o}return null}function un(u,t,e=0,s=0,r=.005){let a=null;if(u){a=t[1+u.sn-t[0].sn]||null;const f=u.endDTS-e;f>0&&f<15e-7&&(e+=15e-7),a&&u.level!==a.level&&a.end<=u.end&&(a=t[2+u.sn-t[0].sn]||null)}else e===0&&t[0].start===0&&(a=t[0]);if(a&&((!u||u.level===a.level)&&Rm(e,s,a)===0||jx(a,u,Math.min(r,s))))return a;const o=Wp.search(t,Rm.bind(null,e,s));return o&&(o!==u||!a)?o:a}function jx(u,t,e){if(t&&t.start===0&&t.level<u.level&&(t.endPTS||0)>0){const s=t.tagList.reduce((r,a)=>(a[0]==="INF"&&(r+=parseFloat(a[1])),r),e);return u.start<=s}return!1}function Rm(u=0,t=0,e){if(e.start<=u&&e.start+e.duration>u)return 0;const s=Math.min(t,e.duration+(e.deltaPTS?e.deltaPTS:0));return e.start+e.duration-s<=u?1:e.start-s>u&&e.start?-1:0}function Vx(u,t,e){const s=Math.min(t,e.duration+(e.deltaPTS?e.deltaPTS:0))*1e3;return(e.endProgramDateTime||0)-s>u}function Zp(u,t,e){if(u&&u.startCC<=t&&u.endCC>=t){let s=u.fragments;const{fragmentHint:r}=u;r&&(s=s.concat(r));let a;return Wp.search(s,o=>o.cc<t?1:o.cc>t?-1:(a=o,o.end<=e?1:o.start>e?-1:0)),a||null}return null}function go(u){switch(u.details){case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_TIMEOUT:case z.LEVEL_LOAD_TIMEOUT:case z.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Jp(u){return u.details.startsWith("key")}function ty(u){return Jp(u)&&!!u.frag&&!u.frag.decryptdata}function _m(u,t){const e=go(t);return u.default[`${e?"timeout":"error"}Retry`]}function Bf(u,t){const e=u.backoff==="linear"?1:Math.pow(2,t);return Math.min(e*u.retryDelayMs,u.maxRetryDelayMs)}function Dm(u){return $t($t({},u),{errorRetry:null,timeoutRetry:null})}function mo(u,t,e,s){if(!u)return!1;const r=s==null?void 0:s.code,a=t<u.maxNumRetry&&(Yx(r)||!!e);return u.shouldRetry?u.shouldRetry(u,t,e,s,a):a}function Yx(u){return yf(u)||!!u&&(u<400||u>499)}function yf(u){return u===0&&navigator.onLine===!1}var Le={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Je={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class qx extends mi{constructor(t){super("error-controller",t.logger),this.hls=void 0,this.playlistError=0,this.hls=t,this.registerListeners()}registerListeners(){const t=this.hls;t.on(x.ERROR,this.onError,this),t.on(x.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const t=this.hls;t&&(t.off(x.ERROR,this.onError,this),t.off(x.ERROR,this.onErrorOut,this),t.off(x.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(t){}stopLoad(){this.playlistError=0}getVariantLevelIndex(t){return(t==null?void 0:t.type)===ht.MAIN?t.level:this.getVariantIndex()}getVariantIndex(){var t;const e=this.hls,s=e.currentLevel;return(t=e.loadLevelObj)!=null&&t.details||s===-1?e.loadLevel:s}variantHasKey(t,e){if(t){var s;if((s=t.details)!=null&&s.hasKey(e))return!0;const r=t.audioGroups;if(r)return this.hls.allAudioTracks.filter(o=>r.indexOf(o.groupId)>=0).some(o=>{var f;return(f=o.details)==null?void 0:f.hasKey(e)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(t,e){var s;if(e.fatal)return;const r=this.hls,a=e.context;switch(e.details){case z.FRAG_LOAD_ERROR:case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_ERROR:case z.KEY_LOAD_TIMEOUT:e.errorAction=this.getFragRetryOrSwitchAction(e);return;case z.FRAG_PARSING_ERROR:if((s=e.frag)!=null&&s.gap){e.errorAction=sr();return}case z.FRAG_GAP:case z.FRAG_DECRYPT_ERROR:{e.errorAction=this.getFragRetryOrSwitchAction(e),e.errorAction.action=Le.SendAlternateToPenaltyBox;return}case z.LEVEL_EMPTY_ERROR:case z.LEVEL_PARSING_ERROR:{var o;const h=e.parent===ht.MAIN?e.level:r.loadLevel;e.details===z.LEVEL_EMPTY_ERROR&&((o=e.context)!=null&&(o=o.levelDetails)!=null&&o.live)?e.errorAction=this.getPlaylistRetryOrSwitchAction(e,h):(e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,h))}return;case z.LEVEL_LOAD_ERROR:case z.LEVEL_LOAD_TIMEOUT:typeof(a==null?void 0:a.level)=="number"&&(e.errorAction=this.getPlaylistRetryOrSwitchAction(e,a.level));return;case z.AUDIO_TRACK_LOAD_ERROR:case z.AUDIO_TRACK_LOAD_TIMEOUT:case z.SUBTITLE_LOAD_ERROR:case z.SUBTITLE_TRACK_LOAD_TIMEOUT:if(a){const h=r.loadLevelObj;if(h&&(a.type===Rt.AUDIO_TRACK&&h.hasAudioGroup(a.groupId)||a.type===Rt.SUBTITLE_TRACK&&h.hasSubtitleGroup(a.groupId))){e.errorAction=this.getPlaylistRetryOrSwitchAction(e,r.loadLevel),e.errorAction.action=Le.SendAlternateToPenaltyBox,e.errorAction.flags=Je.MoveAllAlternatesMatchingHost;return}}return;case z.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:e.errorAction={action:Le.SendAlternateToPenaltyBox,flags:Je.MoveAllAlternatesMatchingHDCP};return;case z.KEY_SYSTEM_SESSION_UPDATE_FAILED:case z.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case z.KEY_SYSTEM_NO_SESSION:e.errorAction={action:Le.SendAlternateToPenaltyBox,flags:Je.MoveAllAlternatesMatchingKey};return;case z.BUFFER_ADD_CODEC_ERROR:case z.REMUX_ALLOC_ERROR:case z.BUFFER_APPEND_ERROR:if(!e.errorAction){var f;e.errorAction=this.getLevelSwitchAction(e,(f=e.level)!=null?f:r.loadLevel)}return;case z.INTERNAL_EXCEPTION:case z.BUFFER_APPENDING_ERROR:case z.BUFFER_FULL_ERROR:case z.LEVEL_SWITCH_ERROR:case z.BUFFER_STALLED_ERROR:case z.BUFFER_SEEK_OVER_HOLE:case z.BUFFER_NUDGE_ON_STALL:e.errorAction=sr();return}e.type===pt.KEY_SYSTEM_ERROR&&(e.levelRetry=!1,e.errorAction=sr())}getPlaylistRetryOrSwitchAction(t,e){const s=this.hls,r=_m(s.config.playlistLoadPolicy,t),a=this.playlistError++;if(mo(r,a,go(t),t.response))return{action:Le.RetryRequest,flags:Je.None,retryConfig:r,retryCount:a};const f=this.getLevelSwitchAction(t,e);return r&&(f.retryConfig=r,f.retryCount=a),f}getFragRetryOrSwitchAction(t){const e=this.hls,s=this.getVariantLevelIndex(t.frag),r=e.levels[s],{fragLoadPolicy:a,keyLoadPolicy:o}=e.config,f=_m(Jp(t)?o:a,t),h=e.levels.reduce((g,p)=>g+p.fragmentError,0);if(r&&(t.details!==z.FRAG_GAP&&r.fragmentError++,!ty(t)&&mo(f,h,go(t),t.response)))return{action:Le.RetryRequest,flags:Je.None,retryConfig:f,retryCount:h};const d=this.getLevelSwitchAction(t,s);return f&&(d.retryConfig=f,d.retryCount=h),d}getLevelSwitchAction(t,e){const s=this.hls;e==null&&(e=s.loadLevel);const r=this.hls.levels[e];if(r){var a,o;const d=t.details;r.loadError++,d===z.BUFFER_APPEND_ERROR&&r.fragmentError++;let g=-1;const{levels:p,loadLevel:v,minAutoLevel:E,maxAutoLevel:S}=s;!s.autoLevelEnabled&&!s.config.preserveManualLevelOnError&&(s.loadLevel=-1);const A=(a=t.frag)==null?void 0:a.type,L=(A===ht.AUDIO&&d===z.FRAG_PARSING_ERROR||t.sourceBufferName==="audio"&&(d===z.BUFFER_ADD_CODEC_ERROR||d===z.BUFFER_APPEND_ERROR))&&p.some(({audioCodec:V})=>r.audioCodec!==V),D=t.sourceBufferName==="video"&&(d===z.BUFFER_ADD_CODEC_ERROR||d===z.BUFFER_APPEND_ERROR)&&p.some(({codecSet:V,audioCodec:O})=>r.codecSet!==V&&r.audioCodec===O),{type:k,groupId:w}=(o=t.context)!=null?o:{};for(let V=p.length;V--;){const O=(V+v)%p.length;if(O!==v&&O>=E&&O<=S&&p[O].loadError===0){var f,h;const $=p[O];if(d===z.FRAG_GAP&&A===ht.MAIN&&t.frag){const G=p[O].details;if(G){const B=un(t.frag,G.fragments,t.frag.start);if(B!=null&&B.gap)continue}}else{if(k===Rt.AUDIO_TRACK&&$.hasAudioGroup(w)||k===Rt.SUBTITLE_TRACK&&$.hasSubtitleGroup(w))continue;if(A===ht.AUDIO&&(f=r.audioGroups)!=null&&f.some(G=>$.hasAudioGroup(G))||A===ht.SUBTITLE&&(h=r.subtitleGroups)!=null&&h.some(G=>$.hasSubtitleGroup(G))||L&&r.audioCodec===$.audioCodec||D&&r.codecSet===$.codecSet||!L&&r.codecSet!==$.codecSet)continue}g=O;break}}if(g>-1&&s.loadLevel!==g)return t.levelRetry=!0,this.playlistError=0,{action:Le.SendAlternateToPenaltyBox,flags:Je.None,nextAutoLevel:g}}return{action:Le.SendAlternateToPenaltyBox,flags:Je.MoveAllAlternatesMatchingHost}}onErrorOut(t,e){var s;switch((s=e.errorAction)==null?void 0:s.action){case Le.DoNothing:break;case Le.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(e),!e.errorAction.resolved&&e.details!==z.FRAG_GAP?e.fatal=!0:/MediaSource readyState: ended/.test(e.error.message)&&(this.warn(`MediaSource ended after "${e.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(e.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(t){const e=this.hls,s=t.errorAction;if(!s)return;const{flags:r}=s,a=s.nextAutoLevel;switch(r){case Je.None:this.switchLevel(t,a);break;case Je.MoveAllAlternatesMatchingHDCP:{const h=this.getVariantLevelIndex(t.frag),d=e.levels[h],g=d==null?void 0:d.attrs["HDCP-LEVEL"];if(s.hdcpLevel=g,g==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(g){e.maxHdcpLevel=pf[pf.indexOf(g)-1],s.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${e.maxHdcpLevel}" or lower`);break}}case Je.MoveAllAlternatesMatchingKey:{const h=t.decryptdata;if(h){const d=this.hls.levels,g=d.length;for(let v=g;v--;)if(this.variantHasKey(d[v],h)){var o,f;this.log(`Banned key found in level ${v} (${d[v].bitrate}bps) or audio group "${(o=d[v].audioGroups)==null?void 0:o.join(",")}" (${(f=t.frag)==null?void 0:f.type} fragment) ${Re(h.keyId||[])}`),d[v].fragmentError++,d[v].loadError++,this.log(`Removing level ${v} with key error (${t.error})`),this.hls.removeLevel(v)}const p=t.frag;if(this.hls.levels.length<g)s.resolved=!0;else if(p&&p.type!==ht.MAIN){const v=p.decryptdata;v&&!h.matches(v)&&(s.resolved=!0)}}break}}s.resolved||this.switchLevel(t,a)}switchLevel(t,e){if(e!==void 0&&t.errorAction&&(this.warn(`switching to level ${e} after ${t.details}`),this.hls.nextAutoLevel=e,t.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,t.details===z.BUFFER_ADD_CODEC_ERROR&&t.mimeType&&t.sourceBufferName!=="audiovideo")){const s=mf(t.mimeType),r=this.hls.levels;for(let a=r.length;a--;)r[a][`${t.sourceBufferName}Codec`]===s&&(this.log(`Removing level ${a} for ${t.details} ("${s}" not supported)`),this.hls.removeLevel(a))}}}function sr(u){const t={action:Le.DoNothing,flags:Je.None};return u&&(t.resolved=!0),t}var ge={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class Xx{constructor(t){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=t,this._registerListeners()}_registerListeners(){const{hls:t}=this;t&&(t.on(x.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.BUFFER_APPENDED,this.onBufferAppended,this),t.on(x.FRAG_BUFFERED,this.onFragBuffered,this),t.on(x.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:t}=this;t&&(t.off(x.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.BUFFER_APPENDED,this.onBufferAppended,this),t.off(x.FRAG_BUFFERED,this.onFragBuffered,this),t.off(x.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(t,e){const s=this.activePartLists[e];if(s)for(let r=s.length;r--;){const a=s[r];if(!a)break;if(a.start<=t&&t<=a.end&&a.loaded)return a}return this.getBufferedFrag(t,e)}getBufferedFrag(t,e){return this.getFragAtPos(t,e,!0)}getFragAtPos(t,e,s){const{fragments:r}=this,a=Object.keys(r);for(let o=a.length;o--;){const f=r[a[o]];if((f==null?void 0:f.body.type)===e&&(!s||f.buffered)){const h=f.body;if(h.start<=t&&t<=h.end)return h}}return null}detectEvictedFragments(t,e,s,r,a){this.timeRanges&&(this.timeRanges[t]=e);const o=(r==null?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach(f=>{const h=this.fragments[f];if(!h||o>=h.body.sn)return;if(!h.buffered&&(!h.loaded||a)){h.body.type===s&&this.removeFragment(h.body);return}const d=h.range[t];if(d){if(d.time.length===0){this.removeFragment(h.body);return}d.time.some(g=>{const p=!this.isTimeBuffered(g.startPTS,g.endPTS,e);return p&&this.removeFragment(h.body),p})}})}detectPartialFragments(t){const e=this.timeRanges;if(!e||t.frag.sn==="initSegment")return;const s=t.frag,r=Wn(s),a=this.fragments[r];if(!a||a.buffered&&s.gap)return;const o=!s.relurl;Object.keys(e).forEach(f=>{const h=s.elementaryStreams[f];if(!h)return;const d=e[f],g=o||h.partial===!0;a.range[f]=this.getBufferedTimes(s,t.part,g,d)}),a.loaded=null,Object.keys(a.range).length?(this.bufferedEnd(a,s),Hl(a)||this.removeParts(s.sn-1,s.type)):this.removeFragment(a.body)}bufferedEnd(t,e){t.buffered=!0,(t.body.endList=e.endList||t.body.endList)&&(this.endListFragments[t.body.type]=t)}removeParts(t,e){const s=this.activePartLists[e];s&&(this.activePartLists[e]=Im(s,r=>r.fragment.sn>=t))}fragBuffered(t,e){const s=Wn(t);let r=this.fragments[s];!r&&e&&(r=this.fragments[s]={body:t,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},t.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,this.bufferedEnd(r,t))}getBufferedTimes(t,e,s,r){const a={time:[],partial:s},o=t.start,f=t.end,h=t.minEndPTS||f,d=t.maxStartPTS||o;for(let g=0;g<r.length;g++){const p=r.start(g)-this.bufferPadding,v=r.end(g)+this.bufferPadding;if(d>=p&&h<=v){a.time.push({startPTS:Math.max(o,r.start(g)),endPTS:Math.min(f,r.end(g))});break}else if(o<v&&f>p){const E=Math.max(o,r.start(g)),S=Math.min(f,r.end(g));S>E&&(a.partial=!0,a.time.push({startPTS:E,endPTS:S}))}else if(f<=p)break}return a}getPartialFragment(t){let e=null,s,r,a,o=0;const{bufferPadding:f,fragments:h}=this;return Object.keys(h).forEach(d=>{const g=h[d];g&&Hl(g)&&(r=g.body.start-f,a=g.body.end+f,t>=r&&t<=a&&(s=Math.min(t-r,a-t),o<=s&&(e=g.body,o=s)))}),e}isEndListAppended(t){const e=this.endListFragments[t];return e!==void 0&&(e.buffered||Hl(e))}getState(t){const e=Wn(t),s=this.fragments[e];return s?s.buffered?Hl(s)?ge.PARTIAL:ge.OK:ge.APPENDING:ge.NOT_LOADED}isTimeBuffered(t,e,s){let r,a;for(let o=0;o<s.length;o++){if(r=s.start(o)-this.bufferPadding,a=s.end(o)+this.bufferPadding,t>=r&&e<=a)return!0;if(e<=r)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(t,e){if(e.frag.sn==="initSegment"||e.frag.bitrateTest)return;const s=e.frag,r=e.part?null:e,a=Wn(s);this.fragments[a]={body:s,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(t,e){const{frag:s,part:r,timeRanges:a,type:o}=e;if(s.sn==="initSegment")return;const f=s.type;if(r){let d=this.activePartLists[f];d||(this.activePartLists[f]=d=[]),d.push(r)}this.timeRanges=a;const h=a[o];this.detectEvictedFragments(o,h,f,r)}onFragBuffered(t,e){this.detectPartialFragments(e)}hasFragment(t){const e=Wn(t);return!!this.fragments[e]}hasFragments(t){const{fragments:e}=this,s=Object.keys(e);if(!t)return s.length>0;for(let r=s.length;r--;){const a=e[s[r]];if((a==null?void 0:a.body.type)===t)return!0}return!1}hasParts(t){var e;return!!((e=this.activePartLists[t])!=null&&e.length)}removeFragmentsInRange(t,e,s,r,a){r&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const f=this.fragments[o];if(!f)return;const h=f.body;h.type!==s||r&&!h.gap||h.start<e&&h.end>t&&(f.buffered||a)&&this.removeFragment(h)})}removeFragment(t){const e=Wn(t);t.clearElementaryStreamInfo();const s=this.activePartLists[t.type];if(s){const r=t.sn;this.activePartLists[t.type]=Im(s,a=>a.fragment.sn!==r)}delete this.fragments[e],t.endList&&delete this.endListFragments[t.type]}removeAllFragments(){var t;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const e=(t=this.hls)==null||(t=t.latestLevelDetails)==null?void 0:t.partList;e&&e.forEach(s=>s.clearElementaryStreamInfo())}}function Hl(u){var t,e,s;return u.buffered&&!!(u.body.gap||(t=u.range.video)!=null&&t.partial||(e=u.range.audio)!=null&&e.partial||(s=u.range.audiovideo)!=null&&s.partial)}function Wn(u){return`${u.type}_${u.level}_${u.sn}`}function Im(u,t){return u.filter(e=>{const s=t(e);return s||e.clearElementaryStreamInfo(),s})}var Bs={cbc:0,ctr:1};class Qx{constructor(t,e,s){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=t,this.aesIV=e,this.aesMode=s}decrypt(t,e){switch(this.aesMode){case Bs.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t);case Bs.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},e,t);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function Wx(u){const t=u.byteLength,e=t&&new DataView(u.buffer).getUint8(t-1);return e?u.slice(0,t-e):u}class Zx{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(t){const e=new DataView(t),s=new Uint32Array(4);for(let r=0;r<4;r++)s[r]=e.getUint32(r*4);return s}initTable(){const t=this.sBox,e=this.invSBox,s=this.subMix,r=s[0],a=s[1],o=s[2],f=s[3],h=this.invSubMix,d=h[0],g=h[1],p=h[2],v=h[3],E=new Uint32Array(256);let S=0,A=0,b=0;for(b=0;b<256;b++)b<128?E[b]=b<<1:E[b]=b<<1^283;for(b=0;b<256;b++){let L=A^A<<1^A<<2^A<<3^A<<4;L=L>>>8^L&255^99,t[S]=L,e[L]=S;const _=E[S],D=E[_],k=E[D];let w=E[L]*257^L*16843008;r[S]=w<<24|w>>>8,a[S]=w<<16|w>>>16,o[S]=w<<8|w>>>24,f[S]=w,w=k*16843009^D*65537^_*257^S*16843008,d[L]=w<<24|w>>>8,g[L]=w<<16|w>>>16,p[L]=w<<8|w>>>24,v[L]=w,S?(S=_^E[E[E[k^_]]],A^=E[E[A]]):S=A=1}}expandKey(t){const e=this.uint8ArrayToUint32Array_(t);let s=!0,r=0;for(;r<e.length&&s;)s=e[r]===this.key[r],r++;if(s)return;this.key=e;const a=this.keySize=e.length;if(a!==4&&a!==6&&a!==8)throw new Error("Invalid aes key size="+a);const o=this.ksRows=(a+6+1)*4;let f,h;const d=this.keySchedule=new Uint32Array(o),g=this.invKeySchedule=new Uint32Array(o),p=this.sBox,v=this.rcon,E=this.invSubMix,S=E[0],A=E[1],b=E[2],L=E[3];let _,D;for(f=0;f<o;f++){if(f<a){_=d[f]=e[f];continue}D=_,f%a===0?(D=D<<8|D>>>24,D=p[D>>>24]<<24|p[D>>>16&255]<<16|p[D>>>8&255]<<8|p[D&255],D^=v[f/a|0]<<24):a>6&&f%a===4&&(D=p[D>>>24]<<24|p[D>>>16&255]<<16|p[D>>>8&255]<<8|p[D&255]),d[f]=_=(d[f-a]^D)>>>0}for(h=0;h<o;h++)f=o-h,h&3?D=d[f]:D=d[f-4],h<4||f<=4?g[h]=D:g[h]=S[p[D>>>24]]^A[p[D>>>16&255]]^b[p[D>>>8&255]]^L[p[D&255]],g[h]=g[h]>>>0}networkToHostOrderSwap(t){return t<<24|(t&65280)<<8|(t&16711680)>>8|t>>>24}decrypt(t,e,s){const r=this.keySize+6,a=this.invKeySchedule,o=this.invSBox,f=this.invSubMix,h=f[0],d=f[1],g=f[2],p=f[3],v=this.uint8ArrayToUint32Array_(s);let E=v[0],S=v[1],A=v[2],b=v[3];const L=new Int32Array(t),_=new Int32Array(L.length);let D,k,w,V,O,$,G,B,Q,st,ut,dt,lt,N;const X=this.networkToHostOrderSwap;for(;e<L.length;){for(Q=X(L[e]),st=X(L[e+1]),ut=X(L[e+2]),dt=X(L[e+3]),O=Q^a[0],$=dt^a[1],G=ut^a[2],B=st^a[3],lt=4,N=1;N<r;N++)D=h[O>>>24]^d[$>>16&255]^g[G>>8&255]^p[B&255]^a[lt],k=h[$>>>24]^d[G>>16&255]^g[B>>8&255]^p[O&255]^a[lt+1],w=h[G>>>24]^d[B>>16&255]^g[O>>8&255]^p[$&255]^a[lt+2],V=h[B>>>24]^d[O>>16&255]^g[$>>8&255]^p[G&255]^a[lt+3],O=D,$=k,G=w,B=V,lt=lt+4;D=o[O>>>24]<<24^o[$>>16&255]<<16^o[G>>8&255]<<8^o[B&255]^a[lt],k=o[$>>>24]<<24^o[G>>16&255]<<16^o[B>>8&255]<<8^o[O&255]^a[lt+1],w=o[G>>>24]<<24^o[B>>16&255]<<16^o[O>>8&255]<<8^o[$&255]^a[lt+2],V=o[B>>>24]<<24^o[O>>16&255]<<16^o[$>>8&255]<<8^o[G&255]^a[lt+3],_[e]=X(D^E),_[e+1]=X(V^S),_[e+2]=X(w^A),_[e+3]=X(k^b),E=Q,S=st,A=ut,b=dt,e=e+4}return _.buffer}}class Jx{constructor(t,e,s){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=t,this.key=e,this.aesMode=s}expandKey(){const t=tA(this.aesMode);return this.subtle.importKey("raw",this.key,{name:t},!1,["encrypt","decrypt"])}}function tA(u){switch(u){case Bs.cbc:return"AES-CBC";case Bs.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${u}`)}}const eA=16;class Ff{constructor(t,{removePKCS7Padding:e=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=t.enableSoftwareAES,this.removePKCS7Padding=e,e)try{const s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:t,remainderData:e}=this;if(!t||e)return this.reset(),null;const s=new Uint8Array(t);return this.reset(),this.removePKCS7Padding?Wx(s):s}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(t,e,s,r){return this.useSoftware?new Promise((a,o)=>{const f=ArrayBuffer.isView(t)?t:new Uint8Array(t);this.softwareDecrypt(f,e,s,r);const h=this.flush();h?a(h.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(t),e,s,r)}softwareDecrypt(t,e,s,r){const{currentIV:a,currentResult:o,remainderData:f}=this;if(r!==Bs.cbc||e.byteLength!==16)return Gt.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),f&&(t=gi(f,t),this.remainderData=null);const h=this.getValidChunk(t);if(!h.length)return null;a&&(s=a);let d=this.softwareDecrypter;d||(d=this.softwareDecrypter=new Zx),d.expandKey(e);const g=o;return this.currentResult=d.decrypt(h.buffer,0,s),this.currentIV=h.slice(-16).buffer,g||null}webCryptoDecrypt(t,e,s,r){if(this.key!==e||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(t,e,s,r));this.key=e,this.fastAesKey=new Jx(this.subtle,e,r)}return this.fastAesKey.expandKey().then(a=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new Qx(this.subtle,new Uint8Array(s),r).decrypt(t.buffer,a)):Promise.reject(new Error("web crypto not initialized"))).catch(a=>(Gt.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${a.name}: ${a.message}`),this.onWebCryptoError(t,e,s,r)))}onWebCryptoError(t,e,s,r){const a=this.enableSoftwareAES;if(a){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(t,e,s,r);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(a?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(t){let e=t;const s=t.length-t.length%eA;return s!==t.length&&(e=t.slice(0,s),this.remainderData=t.slice(s)),e}logOnce(t){this.logEnabled&&(Gt.log(`[decrypter]: ${t}`),this.logEnabled=!1)}}const Cm=Math.pow(2,17);class iA{constructor(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(t,e){const s=t.url;if(!s)return Promise.reject(new ns({type:pt.NETWORK_ERROR,details:z.FRAG_LOAD_ERROR,fatal:!1,frag:t,error:new Error(`Fragment does not have a ${s?"part list":"url"}`),networkDetails:null}));this.abort();const r=this.config,a=r.fLoader,o=r.loader;return new Promise((f,h)=>{if(this.loader&&this.loader.destroy(),t.gap)if(t.tagList.some(S=>S[0]==="GAP")){h(Om(t));return}else t.gap=!1;const d=this.loader=a?new a(r):new o(r),g=km(t);t.loader=d;const p=Dm(r.fragLoadPolicy.default),v={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:t.sn==="initSegment"?1/0:Cm};t.stats=d.stats;const E={onSuccess:(S,A,b,L)=>{this.resetLoader(t,d);let _=S.data;b.resetIV&&t.decryptdata&&(t.decryptdata.iv=new Uint8Array(_.slice(0,16)),_=_.slice(16)),f({frag:t,part:null,payload:_,networkDetails:L})},onError:(S,A,b,L)=>{this.resetLoader(t,d),h(new ns({type:pt.NETWORK_ERROR,details:z.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:$t({url:s,data:void 0},S),error:new Error(`HTTP Error ${S.code} ${S.text}`),networkDetails:b,stats:L}))},onAbort:(S,A,b)=>{this.resetLoader(t,d),h(new ns({type:pt.NETWORK_ERROR,details:z.INTERNAL_ABORTED,fatal:!1,frag:t,error:new Error("Aborted"),networkDetails:b,stats:S}))},onTimeout:(S,A,b)=>{this.resetLoader(t,d),h(new ns({type:pt.NETWORK_ERROR,details:z.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,error:new Error(`Timeout after ${v.timeout}ms`),networkDetails:b,stats:S}))}};e&&(E.onProgress=(S,A,b,L)=>e({frag:t,part:null,payload:b,networkDetails:L})),d.load(g,v,E)})}loadPart(t,e,s){this.abort();const r=this.config,a=r.fLoader,o=r.loader;return new Promise((f,h)=>{if(this.loader&&this.loader.destroy(),t.gap||e.gap){h(Om(t,e));return}const d=this.loader=a?new a(r):new o(r),g=km(t,e);t.loader=d;const p=Dm(r.fragLoadPolicy.default),v={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Cm};e.stats=d.stats,d.load(g,v,{onSuccess:(E,S,A,b)=>{this.resetLoader(t,d),this.updateStatsFromPart(t,e);const L={frag:t,part:e,payload:E.data,networkDetails:b};s(L),f(L)},onError:(E,S,A,b)=>{this.resetLoader(t,d),h(new ns({type:pt.NETWORK_ERROR,details:z.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:e,response:$t({url:g.url,data:void 0},E),error:new Error(`HTTP Error ${E.code} ${E.text}`),networkDetails:A,stats:b}))},onAbort:(E,S,A)=>{t.stats.aborted=e.stats.aborted,this.resetLoader(t,d),h(new ns({type:pt.NETWORK_ERROR,details:z.INTERNAL_ABORTED,fatal:!1,frag:t,part:e,error:new Error("Aborted"),networkDetails:A,stats:E}))},onTimeout:(E,S,A)=>{this.resetLoader(t,d),h(new ns({type:pt.NETWORK_ERROR,details:z.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:e,error:new Error(`Timeout after ${v.timeout}ms`),networkDetails:A,stats:E}))}})})}updateStatsFromPart(t,e){const s=t.stats,r=e.stats,a=r.total;if(s.loaded+=r.loaded,a){const h=Math.round(t.duration/e.duration),d=Math.min(Math.round(s.loaded/a),h),p=(h-d)*Math.round(s.loaded/d);s.total=s.loaded+p}else s.total=Math.max(s.loaded,s.total);const o=s.loading,f=r.loading;o.start?o.first+=f.first-f.start:(o.start=f.start,o.first=f.first),o.end=f.end}resetLoader(t,e){t.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()}}function km(u,t=null){const e=t||u,s={frag:u,part:t,responseType:"arraybuffer",url:e.url,headers:{},rangeStart:0,rangeEnd:0},r=e.byteRangeStartOffset,a=e.byteRangeEndOffset;if(ct(r)&&ct(a)){var o;let f=r,h=a;if(u.sn==="initSegment"&&sA((o=u.decryptdata)==null?void 0:o.method)){const d=a-r;d%16&&(h=a+(16-d%16)),r!==0&&(s.resetIV=!0,f=r-16)}s.rangeStart=f,s.rangeEnd=h}return s}function Om(u,t){const e=new Error(`GAP ${u.gap?"tag":"attribute"} found`),s={type:pt.MEDIA_ERROR,details:z.FRAG_GAP,fatal:!1,frag:u,error:e,networkDetails:null};return t&&(s.part=t),(t||u).stats.aborted=!0,new ns(s)}function sA(u){return u==="AES-128"||u==="AES-256"}class ns extends Error{constructor(t){super(t.error.message),this.data=void 0,this.data=t}}class ey extends mi{constructor(t,e){super(t,e),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(t){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,t),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class $f{constructor(t,e,s,r=0,a=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=zl(),this.buffering={audio:zl(),video:zl(),audiovideo:zl()},this.level=t,this.sn=e,this.id=s,this.size=r,this.part=a,this.partial=o}}function zl(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Mm={length:0,start:()=>0,end:()=>0};class Tt{static isBuffered(t,e){if(t){const s=Tt.getBuffered(t);for(let r=s.length;r--;)if(e>=s.start(r)&&e<=s.end(r))return!0}return!1}static bufferedRanges(t){if(t){const e=Tt.getBuffered(t);return Tt.timeRangesToArray(e)}return[]}static timeRangesToArray(t){const e=[];for(let s=0;s<t.length;s++)e.push({start:t.start(s),end:t.end(s)});return e}static bufferInfo(t,e,s){if(t){const r=Tt.bufferedRanges(t);if(r.length)return Tt.bufferedInfo(r,e,s)}return{len:0,start:e,end:e,bufferedIndex:-1}}static bufferedInfo(t,e,s){e=Math.max(0,e),t.length>1&&t.sort((g,p)=>g.start-p.start||p.end-g.end);let r=-1,a=[];if(s)for(let g=0;g<t.length;g++){e>=t[g].start&&e<=t[g].end&&(r=g);const p=a.length;if(p){const v=a[p-1].end;t[g].start-v<s?t[g].end>v&&(a[p-1].end=t[g].end):a.push(t[g])}else a.push(t[g])}else a=t;let o=0,f,h=e,d=e;for(let g=0;g<a.length;g++){const p=a[g].start,v=a[g].end;if(r===-1&&e>=p&&e<=v&&(r=g),e+s>=p&&e<v)h=p,d=v,o=d-e;else if(e+s<p){f=p;break}}return{len:o,start:h||0,end:d||0,nextStart:f,buffered:t,bufferedIndex:r}}static getBuffered(t){try{return t.buffered||Mm}catch(e){return Gt.log("failed to get media.buffered",e),Mm}}}const iy=/\{\$([a-zA-Z0-9-_]+)\}/g;function wm(u){return iy.test(u)}function vf(u,t){if(u.variableList!==null||u.hasVariableRefs){const e=u.variableList;return t.replace(iy,s=>{const r=s.substring(2,s.length-1),a=e==null?void 0:e[r];return a===void 0?(u.playlistParsingError||(u.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),s):a})}return t}function Nm(u,t,e){let s=u.variableList;s||(u.variableList=s={});let r,a;if("QUERYPARAM"in t){r=t.QUERYPARAM;try{const o=new self.URL(e).searchParams;if(o.has(r))a=o.get(r);else throw new Error(`"${r}" does not match any query parameter in URI: "${e}"`)}catch(o){u.playlistParsingError||(u.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else r=t.NAME,a=t.VALUE;r in s?u.playlistParsingError||(u.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):s[r]=a||""}function nA(u,t,e){const s=t.IMPORT;if(e&&s in e){let r=u.variableList;r||(u.variableList=r={}),r[s]=e[s]}else u.playlistParsingError||(u.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${s}"`))}const rA=/^(\d+)x(\d+)$/,Pm=/(.+?)=(".*?"|.*?)(?:,|$)/g;class te{constructor(t,e){typeof t=="string"&&(t=te.parseAttrList(t,e)),jt(this,t)}get clientAttrs(){return Object.keys(this).filter(t=>t.substring(0,2)==="X-")}decimalInteger(t){const e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e}hexadecimalInteger(t){if(this[t]){let e=(this[t]||"0x").slice(2);e=(e.length&1?"0":"")+e;const s=new Uint8Array(e.length/2);for(let r=0;r<e.length/2;r++)s[r]=parseInt(e.slice(r*2,r*2+2),16);return s}return null}hexadecimalIntegerAsNumber(t){const e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e}decimalFloatingPoint(t){return parseFloat(this[t])}optionalFloat(t,e){const s=this[t];return s?parseFloat(s):e}enumeratedString(t){return this[t]}enumeratedStringList(t,e){const s=this[t];return(s?s.split(/[ ,]+/):[]).reduce((r,a)=>(r[a.toLowerCase()]=!0,r),e)}bool(t){return this[t]==="YES"}decimalResolution(t){const e=rA.exec(this[t]);if(e!==null)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}}static parseAttrList(t,e){let s;const r={};for(Pm.lastIndex=0;(s=Pm.exec(t))!==null;){const o=s[1].trim();let f=s[2];const h=f.indexOf('"')===0&&f.lastIndexOf('"')===f.length-1;let d=!1;if(h)f=f.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":d=!0}if(e&&(h||d))f=vf(e,f);else if(!d&&!h)switch(o){case"CLOSED-CAPTIONS":if(f==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Gt.warn(`${t}: attribute ${o} is missing quotes`)}r[o]=f}return r}}const aA="com.apple.hls.interstitial";function lA(u){return u!=="ID"&&u!=="CLASS"&&u!=="CUE"&&u!=="START-DATE"&&u!=="DURATION"&&u!=="END-DATE"&&u!=="END-ON-NEXT"}function oA(u){return u==="SCTE35-OUT"||u==="SCTE35-IN"||u==="SCTE35-CMD"}class sy{constructor(t,e,s=0){var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(e==null?void 0:e.tagAnchor)||null,this.tagOrder=(r=e==null?void 0:e.tagOrder)!=null?r:s,e){const a=e.attr;for(const o in a)if(Object.prototype.hasOwnProperty.call(t,o)&&t[o]!==a[o]){Gt.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${t.ID}"`),this._badValueForSameId=o;break}t=jt(new te({}),a,t)}if(this.attr=t,e?(this._startDate=e._startDate,this._cue=e._cue,this._endDate=e._endDate,this._dateAtEnd=e._dateAtEnd):this._startDate=new Date(t["START-DATE"]),"END-DATE"in this.attr){const a=(e==null?void 0:e.endDate)||new Date(this.attr["END-DATE"]);ct(a.getTime())&&(this._endDate=a)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const t=this._cue;return t===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):t}get startTime(){const{tagAnchor:t}=this;return t===null||t.programDateTime===null?(Gt.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${t}`),NaN):t.start+(this.startDate.getTime()-t.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const t=this._endDate||this._dateAtEnd;if(t)return t;const e=this.duration;return e!==null?this._dateAtEnd=new Date(this._startDate.getTime()+e*1e3):null}get duration(){if("DURATION"in this.attr){const t=this.attr.decimalFloatingPoint("DURATION");if(ct(t))return t}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===aA}get isValid(){return!!this.id&&!this._badValueForSameId&&ct(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const uA=10;class cA{constructor(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=t}reloaded(t){if(!t){this.advanced=!0,this.updated=!0;return}const e=this.lastPartSn-t.lastPartSn,s=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!s||!!e||!this.live,this.advanced=this.endSN>t.endSN||e>0||e===0&&s>0,this.updated||this.advanced?this.misses=Math.floor(t.misses*.6):this.misses=t.misses+1}hasKey(t){return this.encryptedFragments.some(e=>{let s=e.decryptdata;return s||(e.setKeyFormat(t.keyFormat),s=e.decryptdata),!!s&&t.matches(s)})}get hasProgramDateTime(){return this.fragments.length?ct(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||uA}get drift(){const t=this.driftEndTime-this.driftStartTime;return t>0?(this.driftEnd-this.driftStart)*1e3/t:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var t;return(t=this.partList)!=null&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var t;return(t=this.partList)!=null&&t.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const t=this.partList;if(t){const e=this.lastPartIndex;if(e!==-1){for(let s=t.length;s--;)if(t[s].index>e)return t[s].index;return e}}return 0}get lastPartSn(){var t;return(t=this.partList)!=null&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const t=this.partEnd-this.fragmentStart;return this.age>Math.max(t,this.totalduration)+this.levelTargetDuration}return!1}}function po(u,t){return u.length===t.length?!u.some((e,s)=>e!==t[s]):!1}function Um(u,t){return!u&&!t?!0:!u||!t?!1:po(u,t)}function nr(u){return u==="AES-128"||u==="AES-256"||u==="AES-256-CTR"}function Gf(u){switch(u){case"AES-128":case"AES-256":return Bs.cbc;case"AES-256-CTR":return Bs.ctr;default:throw new Error(`invalid full segment method ${u}`)}}function Hf(u){return Uint8Array.from(atob(u),t=>t.charCodeAt(0))}function Ef(u){return Uint8Array.from(unescape(encodeURIComponent(u)),t=>t.charCodeAt(0))}function fA(u){const t=Ef(u).subarray(0,16),e=new Uint8Array(16);return e.set(t,16-t.length),e}function ny(u){const t=function(s,r,a){const o=s[r];s[r]=s[a],s[a]=o};t(u,0,3),t(u,1,2),t(u,4,5),t(u,6,7)}function ry(u){const t=u.split(":");let e=null;if(t[0]==="data"&&t.length===2){const s=t[1].split(";"),r=s[s.length-1].split(",");if(r.length===2){const a=r[0]==="base64",o=r[1];a?(s.splice(-1,1),e=Hf(o)):e=fA(o)}}return e}const yo=typeof self<"u"?self:void 0;var ee={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},_e={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function so(u){switch(u){case _e.FAIRPLAY:return ee.FAIRPLAY;case _e.PLAYREADY:return ee.PLAYREADY;case _e.WIDEVINE:return ee.WIDEVINE;case _e.CLEARKEY:return ee.CLEARKEY}}function Vc(u){switch(u){case ee.FAIRPLAY:return _e.FAIRPLAY;case ee.PLAYREADY:return _e.PLAYREADY;case ee.WIDEVINE:return _e.WIDEVINE;case ee.CLEARKEY:return _e.CLEARKEY}}function la(u){const{drmSystems:t,widevineLicenseUrl:e}=u,s=t?[ee.FAIRPLAY,ee.WIDEVINE,ee.PLAYREADY,ee.CLEARKEY].filter(r=>!!t[r]):[];return!s[ee.WIDEVINE]&&e&&s.push(ee.WIDEVINE),s}const ay=(function(u){return yo!=null&&(u=yo.navigator)!=null&&u.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function dA(u,t,e,s){let r;switch(u){case ee.FAIRPLAY:r=["cenc","sinf"];break;case ee.WIDEVINE:case ee.PLAYREADY:r=["cenc"];break;case ee.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${u}`)}return hA(r,t,e,s)}function hA(u,t,e,s){return[{initDataTypes:u,persistentState:s.persistentState||"optional",distinctiveIdentifier:s.distinctiveIdentifier||"optional",sessionTypes:s.sessionTypes||[s.sessionType||"temporary"],audioCapabilities:t.map(a=>({contentType:`audio/mp4; codecs=${a}`,robustness:s.audioRobustness||"",encryptionScheme:s.audioEncryptionScheme||null})),videoCapabilities:e.map(a=>({contentType:`video/mp4; codecs=${a}`,robustness:s.videoRobustness||"",encryptionScheme:s.videoEncryptionScheme||null}))}]}function gA(u){var t;return!!u&&(u.sessionType==="persistent-license"||!!((t=u.sessionTypes)!=null&&t.some(e=>e==="persistent-license")))}function ly(u){const t=new Uint16Array(u.buffer,u.byteOffset,u.byteLength/2),e=String.fromCharCode.apply(null,Array.from(t)),s=e.substring(e.indexOf("<"),e.length),o=new DOMParser().parseFromString(s,"text/xml").getElementsByTagName("KID")[0];if(o){const f=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(f){const h=Hf(f).subarray(0,16);return ny(h),h}}return null}let Zn={};class Ps{static clearKeyUriToKeyIdMap(){Zn={}}static setKeyIdForUri(t,e){Zn[t]=e}static addKeyIdForUri(t){const e=Object.keys(Zn).length%Number.MAX_SAFE_INTEGER,s=new Uint8Array(16);return new DataView(s.buffer,12,4).setUint32(0,e),Zn[t]=s,s}constructor(t,e,s,r=[1],a=null,o){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=t,this.uri=e,this.keyFormat=s,this.keyFormatVersions=r,this.iv=a,this.encrypted=t?t!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!nr(t),o!=null&&o.startsWith("0x")&&(this.keyId=new Uint8Array(Np(o)))}matches(t){return t.uri===this.uri&&t.method===this.method&&t.encrypted===this.encrypted&&t.keyFormat===this.keyFormat&&po(t.keyFormatVersions,this.keyFormatVersions)&&Um(t.iv,this.iv)&&Um(t.keyId,this.keyId)}isSupported(){if(this.method){if(nr(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case _e.FAIRPLAY:case _e.WIDEVINE:case _e.PLAYREADY:case _e.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(t,e){if(!this.encrypted||!this.uri)return null;if(nr(this.method)){let a=this.iv;return a||(typeof t!="number"&&(Gt.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),t=0),a=pA(t)),new Ps(this.method,this.uri,"identity",this.keyFormatVersions,a)}if(this.keyId){const a=Zn[this.uri];if(a&&!po(this.keyId,a)&&Ps.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const s=ry(this.uri);if(s)switch(this.keyFormat){case _e.WIDEVINE:if(this.pssh=s,!this.keyId){const a=Ex(s.buffer);if(a.length){var r;const o=a[0];this.keyId=(r=o.kids)!=null&&r.length?o.kids[0]:null}}this.keyId||(this.keyId=Bm(e));break;case _e.PLAYREADY:{const a=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=vx(a,null,s),this.keyId=ly(s);break}default:{let a=s.subarray(0,16);if(a.length!==16){const o=new Uint8Array(16);o.set(a,16-a.length),a=o}this.keyId=a;break}}if(!this.keyId||this.keyId.byteLength!==16){let a;a=mA(e),a||(a=Bm(e),a||(a=Zn[this.uri])),a&&(this.keyId=a,Ps.setKeyIdForUri(this.uri,a))}return this}}function mA(u){const t=u==null?void 0:u[_e.WIDEVINE];return t?t.keyId:null}function Bm(u){const t=u==null?void 0:u[_e.PLAYREADY];if(t){const e=ry(t.uri);if(e)return ly(e)}return null}function pA(u){const t=new Uint8Array(16);for(let e=12;e<16;e++)t[e]=u>>8*(15-e)&255;return t}const Fm=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,$m=/#EXT-X-MEDIA:(.*)/g,yA=/^#EXT(?:INF|-X-TARGETDURATION):/m,Yc=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),vA=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class wi{static findGroup(t,e){for(let s=0;s<t.length;s++){const r=t[s];if(r.id===e)return r}}static resolve(t,e){return Mf.buildAbsoluteURL(e,t,{alwaysNormalize:!0})}static isMediaPlaylist(t){return yA.test(t)}static parseMasterPlaylist(t,e){const s=wm(t),r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:s},a=[];if(Fm.lastIndex=0,!t.startsWith("#EXTM3U"))return r.playlistParsingError=new Error("no EXTM3U delimiter"),r;let o;for(;(o=Fm.exec(t))!=null;)if(o[1]){var f;const d=new te(o[1],r),g=vf(r,o[2]),p={attrs:d,bitrate:d.decimalInteger("BANDWIDTH")||d.decimalInteger("AVERAGE-BANDWIDTH"),name:d.NAME,url:wi.resolve(g,e)},v=d.decimalResolution("RESOLUTION");v&&(p.width=v.width,p.height=v.height),zm(d.CODECS,p);const E=d["SUPPLEMENTAL-CODECS"];E&&(p.supplemental={},zm(E,p.supplemental)),(f=p.unknownCodecs)!=null&&f.length||a.push(p),r.levels.push(p)}else if(o[3]){const d=o[3],g=o[4];switch(d){case"SESSION-DATA":{const p=new te(g,r),v=p["DATA-ID"];v&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[v]=p);break}case"SESSION-KEY":{const p=Gm(g,e,r);p.encrypted&&p.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(p)):Gt.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${g}"`);break}case"DEFINE":{{const p=new te(g,r);Nm(r,p,e)}break}case"CONTENT-STEERING":{const p=new te(g,r);r.contentSteering={uri:wi.resolve(p["SERVER-URI"],e),pathwayId:p["PATHWAY-ID"]||"."};break}case"START":{r.startTimeOffset=Hm(g);break}}}const h=a.length>0&&a.length<r.levels.length;return r.levels=h?a:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(t,e,s){let r;const a={},o=s.levels,f={AUDIO:o.map(d=>({id:d.attrs.AUDIO,audioCodec:d.audioCodec})),SUBTITLES:o.map(d=>({id:d.attrs.SUBTITLES,textCodec:d.textCodec})),"CLOSED-CAPTIONS":[]};let h=0;for($m.lastIndex=0;(r=$m.exec(t))!==null;){const d=new te(r[1],s),g=d.TYPE;if(g){const p=f[g],v=a[g]||[];a[g]=v;const E=d.LANGUAGE,S=d["ASSOC-LANGUAGE"],A=d.CHANNELS,b=d.CHARACTERISTICS,L=d["INSTREAM-ID"],_={attrs:d,bitrate:0,id:h++,groupId:d["GROUP-ID"]||"",name:d.NAME||E||"",type:g,default:d.bool("DEFAULT"),autoselect:d.bool("AUTOSELECT"),forced:d.bool("FORCED"),lang:E,url:d.URI?wi.resolve(d.URI,e):""};if(S&&(_.assocLang=S),A&&(_.channels=A),b&&(_.characteristics=b),L&&(_.instreamId=L),p!=null&&p.length){const D=wi.findGroup(p,_.groupId)||p[0];Km(_,D,"audioCodec"),Km(_,D,"textCodec")}v.push(_)}}return a}static parseLevelPlaylist(t,e,s,r,a,o){var f;const h={url:e},d=new cA(e),g=d.fragments,p=[];let v=null,E=0,S=0,A=0,b=0,L=0,_=null,D=new zc(r,h),k,w,V,O=-1,$=!1,G=null,B;if(Yc.lastIndex=0,d.m3u8=t,d.hasVariableRefs=wm(t),((f=Yc.exec(t))==null?void 0:f[0])!=="#EXTM3U")return d.playlistParsingError=new Error("Missing format identifier #EXTM3U"),d;for(;(k=Yc.exec(t))!==null;){$&&($=!1,D=new zc(r,h),D.playlistOffset=A,D.setStart(A),D.sn=E,D.cc=b,L&&(D.bitrate=L),D.level=s,v&&(D.initSegment=v,v.rawProgramDateTime&&(D.rawProgramDateTime=v.rawProgramDateTime,v.rawProgramDateTime=null),G&&(D.setByteRange(G),G=null)));const dt=k[1];if(dt){D.duration=parseFloat(dt);const lt=(" "+k[2]).slice(1);D.title=lt||null,D.tagList.push(lt?["INF",dt,lt]:["INF",dt])}else if(k[3]){if(ct(D.duration)){D.playlistOffset=A,D.setStart(A),V&&Vm(D,V,d),D.sn=E,D.level=s,D.cc=b,g.push(D);const lt=(" "+k[3]).slice(1);D.relurl=vf(d,lt),Sf(D,_,p),_=D,A+=D.duration,E++,S=0,$=!0}}else{if(k=k[0].match(vA),!k){Gt.warn("No matches on slow regex match for level playlist!");continue}for(w=1;w<k.length&&k[w]===void 0;w++);const lt=(" "+k[w]).slice(1),N=(" "+k[w+1]).slice(1),X=k[w+2]?(" "+k[w+2]).slice(1):null;switch(lt){case"BYTERANGE":_?D.setByteRange(N,_):D.setByteRange(N);break;case"PROGRAM-DATE-TIME":D.rawProgramDateTime=N,D.tagList.push(["PROGRAM-DATE-TIME",N]),O===-1&&(O=g.length);break;case"PLAYLIST-TYPE":d.type&&is(d,lt,k),d.type=N.toUpperCase();break;case"MEDIA-SEQUENCE":d.startSN!==0?is(d,lt,k):g.length>0&&Ym(d,lt,k),E=d.startSN=parseInt(N);break;case"SKIP":{d.skippedSegments&&is(d,lt,k);const Z=new te(N,d),rt=Z.decimalInteger("SKIPPED-SEGMENTS");if(ct(rt)){d.skippedSegments+=rt;for(let I=rt;I--;)g.push(null);E+=rt}const ot=Z.enumeratedString("RECENTLY-REMOVED-DATERANGES");ot&&(d.recentlyRemovedDateranges=(d.recentlyRemovedDateranges||[]).concat(ot.split("	")));break}case"TARGETDURATION":d.targetduration!==0&&is(d,lt,k),d.targetduration=Math.max(parseInt(N),1);break;case"VERSION":d.version!==null&&is(d,lt,k),d.version=parseInt(N);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":d.live||is(d,lt,k),d.live=!1;break;case"#":(N||X)&&D.tagList.push(X?[N,X]:[N]);break;case"DISCONTINUITY":b++,D.tagList.push(["DIS"]);break;case"GAP":D.gap=!0,D.tagList.push([lt]);break;case"BITRATE":D.tagList.push([lt,N]),L=parseInt(N)*1e3,ct(L)?D.bitrate=L:L=0;break;case"DATERANGE":{const Z=new te(N,d),rt=new sy(Z,d.dateRanges[Z.ID],d.dateRangeTagCount);d.dateRangeTagCount++,rt.isValid||d.skippedSegments?d.dateRanges[rt.id]=rt:Gt.warn(`Ignoring invalid DATERANGE tag: "${N}"`),D.tagList.push(["EXT-X-DATERANGE",N]);break}case"DEFINE":{{const Z=new te(N,d);"IMPORT"in Z?nA(d,Z,o):Nm(d,Z,e)}break}case"DISCONTINUITY-SEQUENCE":d.startCC!==0?is(d,lt,k):g.length>0&&Ym(d,lt,k),d.startCC=b=parseInt(N);break;case"KEY":{const Z=Gm(N,e,d);if(Z.isSupported()){if(Z.method==="NONE"){V=void 0;break}V||(V={});const rt=V[Z.keyFormat];rt!=null&&rt.matches(Z)||(rt&&(V=jt({},V)),V[Z.keyFormat]=Z)}else Gt.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${N}"`);break}case"START":d.startTimeOffset=Hm(N);break;case"MAP":{const Z=new te(N,d);if(D.duration){const rt=new zc(r,h);jm(rt,Z,s,V),v=rt,D.initSegment=v,v.rawProgramDateTime&&!D.rawProgramDateTime&&(D.rawProgramDateTime=v.rawProgramDateTime)}else{const rt=D.byteRangeEndOffset;if(rt){const ot=D.byteRangeStartOffset;G=`${rt-ot}@${ot}`}else G=null;jm(D,Z,s,V),v=D,$=!0}v.cc=b;break}case"SERVER-CONTROL":{B&&is(d,lt,k),B=new te(N),d.canBlockReload=B.bool("CAN-BLOCK-RELOAD"),d.canSkipUntil=B.optionalFloat("CAN-SKIP-UNTIL",0),d.canSkipDateRanges=d.canSkipUntil>0&&B.bool("CAN-SKIP-DATERANGES"),d.partHoldBack=B.optionalFloat("PART-HOLD-BACK",0),d.holdBack=B.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{d.partTarget&&is(d,lt,k);const Z=new te(N);d.partTarget=Z.decimalFloatingPoint("PART-TARGET");break}case"PART":{let Z=d.partList;Z||(Z=d.partList=[]);const rt=S>0?Z[Z.length-1]:void 0,ot=S++,I=new te(N,d),U=new nx(I,D,h,ot,rt);Z.push(U),D.duration+=U.duration;break}case"PRELOAD-HINT":{const Z=new te(N,d);d.preloadHint=Z;break}case"RENDITION-REPORT":{const Z=new te(N,d);d.renditionReports=d.renditionReports||[],d.renditionReports.push(Z);break}default:Gt.warn(`line parsed but not handled: ${k}`);break}}}_&&!_.relurl?(g.pop(),A-=_.duration,d.partList&&(d.fragmentHint=_)):d.partList&&(Sf(D,_,p),D.cc=b,d.fragmentHint=D,V&&Vm(D,V,d)),d.targetduration||(d.playlistParsingError=new Error("Missing Target Duration"));const Q=g.length,st=g[0],ut=g[Q-1];if(A+=d.skippedSegments*d.targetduration,A>0&&Q&&ut){d.averagetargetduration=A/Q;const dt=ut.sn;d.endSN=dt!=="initSegment"?dt:0,d.live||(ut.endList=!0),O>0&&(SA(g,O),st&&p.unshift(st))}return d.fragmentHint&&(A+=d.fragmentHint.duration),d.totalduration=A,p.length&&d.dateRangeTagCount&&st&&oy(p,d),d.endCC=b,d}}function oy(u,t){let e=u.length;if(!e)if(t.hasProgramDateTime){const f=t.fragments[t.fragments.length-1];u.push(f),e++}else return;const s=u[e-1],r=t.live?1/0:t.totalduration,a=Object.keys(t.dateRanges);for(let f=a.length;f--;){const h=t.dateRanges[a[f]],d=h.startDate.getTime();h.tagAnchor=s.ref;for(let g=e;g--;){var o;if(((o=u[g])==null?void 0:o.sn)<t.startSN)break;const p=EA(t,d,u,g,r);if(p!==-1){h.tagAnchor=t.fragments[p].ref;break}}}}function EA(u,t,e,s,r){const a=e[s];if(a){const f=a.programDateTime;if(t>=f||s===0){var o;const h=(((o=e[s+1])==null?void 0:o.start)||r)-a.start;if(t<=f+h*1e3){const d=e[s].sn-u.startSN;if(d<0)return-1;const g=u.fragments;if(g.length>e.length){const v=(e[s+1]||g[g.length-1]).sn-u.startSN;for(let E=v;E>d;E--){const S=g[E].programDateTime;if(t>=S&&t<S+g[E].duration*1e3)return E}}return d}}}return-1}function Gm(u,t,e){var s,r;const a=new te(u,e),o=(s=a.METHOD)!=null?s:"",f=a.URI,h=a.hexadecimalInteger("IV"),d=a.KEYFORMATVERSIONS,g=(r=a.KEYFORMAT)!=null?r:"identity";f&&a.IV&&!h&&Gt.error(`Invalid IV: ${a.IV}`);const p=f?wi.resolve(f,t):"",v=(d||"1").split("/").map(Number).filter(Number.isFinite);return new Ps(o,p,g,v,h,a.KEYID)}function Hm(u){const e=new te(u).decimalFloatingPoint("TIME-OFFSET");return ct(e)?e:null}function zm(u,t){let e=(u||"").split(/[ ,]+/).filter(s=>s);["video","audio","text"].forEach(s=>{const r=e.filter(a=>Pf(a,s));r.length&&(t[`${s}Codec`]=r.map(a=>a.split("/")[0]).join(","),e=e.filter(a=>r.indexOf(a)===-1))}),t.unknownCodecs=e}function Km(u,t,e){const s=t[e];s&&(u[e]=s)}function SA(u,t){let e=u[t];for(let s=t;s--;){const r=u[s];if(!r)return;r.programDateTime=e.programDateTime-r.duration*1e3,e=r}}function Sf(u,t,e){u.rawProgramDateTime?e.push(u):t!=null&&t.programDateTime&&(u.programDateTime=t.endProgramDateTime)}function jm(u,t,e,s){u.relurl=t.URI,t.BYTERANGE&&u.setByteRange(t.BYTERANGE),u.level=e,u.sn="initSegment",s&&(u.levelkeys=s),u.initSegment=null}function Vm(u,t,e){u.levelkeys=t;const{encryptedFragments:s}=e;(!s.length||s[s.length-1].levelkeys!==t)&&Object.keys(t).some(r=>t[r].isCommonEncryption)&&s.push(u)}function is(u,t,e){u.playlistParsingError=new Error(`#EXT-X-${t} must not appear more than once (${e[0]})`)}function Ym(u,t,e){u.playlistParsingError=new Error(`#EXT-X-${t} must appear before the first Media Segment (${e[0]})`)}function qc(u,t){const e=t.startPTS;if(ct(e)){let s=0,r;t.sn>u.sn?(s=e-u.start,r=u):(s=u.start-e,r=t),r.duration!==s&&r.setDuration(s)}else t.sn>u.sn?u.cc===t.cc&&u.minEndPTS?t.setStart(u.start+(u.minEndPTS-u.start)):t.setStart(u.start+u.duration):t.setStart(Math.max(u.start-t.duration,0))}function uy(u,t,e,s,r,a,o){s-e<=0&&(o.warn("Fragment should have a positive duration",t),s=e+t.duration,a=r+t.duration);let h=e,d=s;const g=t.startPTS,p=t.endPTS;if(ct(g)){const L=Math.abs(g-e);u&&L>u.totalduration?o.warn(`media timestamps and playlist times differ by ${L}s for level ${t.level} ${u.url}`):ct(t.deltaPTS)?t.deltaPTS=Math.max(L,t.deltaPTS):t.deltaPTS=L,h=Math.max(e,g),e=Math.min(e,g),r=t.startDTS!==void 0?Math.min(r,t.startDTS):r,d=Math.min(s,p),s=Math.max(s,p),a=t.endDTS!==void 0?Math.max(a,t.endDTS):a}const v=e-t.start;t.start!==0&&t.setStart(e),t.setDuration(s-t.start),t.startPTS=e,t.maxStartPTS=h,t.startDTS=r,t.endPTS=s,t.minEndPTS=d,t.endDTS=a;const E=t.sn;if(!u||E<u.startSN||E>u.endSN)return 0;let S;const A=E-u.startSN,b=u.fragments;for(b[A]=t,S=A;S>0;S--)qc(b[S],b[S-1]);for(S=A;S<b.length-1;S++)qc(b[S],b[S+1]);return u.fragmentHint&&qc(b[b.length-1],u.fragmentHint),u.PTSKnown=u.alignedSliding=!0,v}function TA(u,t,e){if(u===t)return;let s=null;const r=u.fragments;for(let g=r.length-1;g>=0;g--){const p=r[g].initSegment;if(p){s=p;break}}u.fragmentHint&&delete u.fragmentHint.endPTS;let a;bA(u,t,(g,p,v,E)=>{if((!t.startCC||t.skippedSegments)&&p.cc!==g.cc){const S=g.cc-p.cc;for(let A=v;A<E.length;A++)E[A].cc+=S;t.endCC=E[E.length-1].cc}ct(g.startPTS)&&ct(g.endPTS)&&(p.setStart(p.startPTS=g.startPTS),p.startDTS=g.startDTS,p.maxStartPTS=g.maxStartPTS,p.endPTS=g.endPTS,p.endDTS=g.endDTS,p.minEndPTS=g.minEndPTS,p.setDuration(g.endPTS-g.startPTS),p.duration&&(a=p),t.PTSKnown=t.alignedSliding=!0),g.hasStreams&&(p.elementaryStreams=g.elementaryStreams),p.loader=g.loader,g.hasStats&&(p.stats=g.stats),g.initSegment&&(p.initSegment=g.initSegment,s=g.initSegment)});const o=t.fragments,f=t.fragmentHint?o.concat(t.fragmentHint):o;if(s&&f.forEach(g=>{var p;g&&(!g.initSegment||g.initSegment.relurl===((p=s)==null?void 0:p.relurl))&&(g.initSegment=s)}),t.skippedSegments){if(t.deltaUpdateFailed=o.some(g=>!g),t.deltaUpdateFailed){e.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let g=t.skippedSegments;g--;)o.shift();t.startSN=o[0].sn}else{t.canSkipDateRanges&&(t.dateRanges=xA(u.dateRanges,t,e));const g=u.fragments.filter(p=>p.rawProgramDateTime);if(u.hasProgramDateTime&&!t.hasProgramDateTime)for(let p=1;p<f.length;p++)f[p].programDateTime===null&&Sf(f[p],f[p-1],g);oy(g,t)}t.endCC=o[o.length-1].cc}if(!t.startCC){var h;const g=dy(u,t.startSN-1);t.startCC=(h=g==null?void 0:g.cc)!=null?h:o[0].cc}AA(u.partList,t.partList,(g,p)=>{p.elementaryStreams=g.elementaryStreams,p.stats=g.stats}),a?uy(t,a,a.startPTS,a.endPTS,a.startDTS,a.endDTS,e):cy(u,t),o.length&&(t.totalduration=t.edge-o[0].start),t.driftStartTime=u.driftStartTime,t.driftStart=u.driftStart;const d=t.advancedDateTime;if(t.advanced&&d){const g=t.edge;t.driftStart||(t.driftStartTime=d,t.driftStart=g),t.driftEndTime=d,t.driftEnd=g}else t.driftEndTime=u.driftEndTime,t.driftEnd=u.driftEnd,t.advancedDateTime=u.advancedDateTime;t.requestScheduled===-1&&(t.requestScheduled=u.requestScheduled)}function xA(u,t,e){const{dateRanges:s,recentlyRemovedDateranges:r}=t,a=jt({},u);r&&r.forEach(h=>{delete a[h]});const f=Object.keys(a).length;return f?(Object.keys(s).forEach(h=>{const d=a[h],g=new sy(s[h].attr,d);g.isValid?(a[h]=g,d||(g.tagOrder+=f)):e.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Xt(s[h].attr)}"`)}),a):s}function AA(u,t,e){if(u&&t){let s=0;for(let r=0,a=u.length;r<=a;r++){const o=u[r],f=t[r+s];o&&f&&o.index===f.index&&o.fragment.sn===f.fragment.sn?e(o,f):s--}}}function bA(u,t,e){const s=t.skippedSegments,r=Math.max(u.startSN,t.startSN)-t.startSN,a=(u.fragmentHint?1:0)+(s?t.endSN:Math.min(u.endSN,t.endSN))-t.startSN,o=t.startSN-u.startSN,f=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,h=u.fragmentHint?u.fragments.concat(u.fragmentHint):u.fragments;for(let d=r;d<=a;d++){const g=h[o+d];let p=f[d];if(s&&!p&&g&&(p=t.fragments[d]=g),g&&p){e(g,p,d,f);const v=g.relurl,E=p.relurl;if(v&&LA(v,E)){t.playlistParsingError=qm(`media sequence mismatch ${p.sn}:`,u,t,g,p);return}else if(g.cc!==p.cc){t.playlistParsingError=qm(`discontinuity sequence mismatch (${g.cc}!=${p.cc})`,u,t,g,p);return}}}}function qm(u,t,e,s,r){return new Error(`${u} ${r.url}
Playlist starting @${t.startSN}
${t.m3u8}

Playlist starting @${e.startSN}
${e.m3u8}`)}function cy(u,t,e=!0){const s=t.startSN+t.skippedSegments-u.startSN,r=u.fragments,a=s>=0;let o=0;if(a&&s<r.length)o=r[s].start;else if(a&&t.startSN===u.endSN+1)o=u.fragmentEnd;else if(a&&e)o=u.fragmentStart+s*t.levelTargetDuration;else if(!t.skippedSegments&&t.fragmentStart===0)o=u.fragmentStart;else return;Tf(t,o)}function Tf(u,t){if(t){const e=u.fragments;for(let s=u.skippedSegments;s<e.length;s++)e[s].addStart(t);u.fragmentHint&&u.fragmentHint.addStart(t)}}function fy(u,t=1/0){let e=1e3*u.targetduration;if(u.updated){const s=u.fragments;if(s.length&&e*4>t){const a=s[s.length-1].duration*1e3;a<e&&(e=a)}}else e/=2;return Math.round(e)}function dy(u,t,e){if(!u)return null;let s=u.fragments[t-u.startSN];return s||(s=u.fragmentHint,s&&s.sn===t)?s:t<u.startSN&&e&&e.sn===t?e:null}function Xm(u,t,e){return u?hy(u.partList,t,e):null}function hy(u,t,e){if(u)for(let s=u.length;s--;){const r=u[s];if(r.index===e&&r.fragment.sn===t)return r}return null}function gy(u){u.forEach((t,e)=>{var s;(s=t.details)==null||s.fragments.forEach(r=>{r.level=e,r.initSegment&&(r.initSegment.level=e)})})}function LA(u,t){return u!==t&&t?Qm(u)!==Qm(t):!1}function Qm(u){return u.replace(/\?[^?]*$/,"")}function oa(u,t){for(let s=0,r=u.length;s<r;s++){var e;if(((e=u[s])==null?void 0:e.cc)===t)return u[s]}return null}function RA(u,t){return!!(u&&t.startCC<u.endCC&&t.endCC>u.startCC)}function Wm(u,t){const e=u.start+t;u.startPTS=e,u.setStart(e),u.endPTS=e+u.duration}function my(u,t){const e=t.fragments;for(let s=0,r=e.length;s<r;s++)Wm(e[s],u);t.fragmentHint&&Wm(t.fragmentHint,u),t.alignedSliding=!0}function _A(u,t){u&&(py(t,u),t.alignedSliding||vo(t,u),!t.alignedSliding&&!t.skippedSegments&&cy(u,t,!1))}function py(u,t){if(!RA(t,u))return;const e=Math.min(t.endCC,u.endCC),s=oa(t.fragments,e),r=oa(u.fragments,e);if(!s||!r)return;Gt.log(`Aligning playlist at start of dicontinuity sequence ${e}`);const a=s.start-r.start;my(a,u)}function vo(u,t){if(!u.hasProgramDateTime||!t.hasProgramDateTime)return;const e=u.fragments,s=t.fragments;if(!e.length||!s.length)return;let r,a;const o=Math.min(t.endCC,u.endCC);t.startCC<o&&u.startCC<o&&(r=oa(s,o),a=oa(e,o)),(!r||!a)&&(r=s[Math.floor(s.length/2)],a=oa(e,r.cc)||e[Math.floor(e.length/2)]);const f=r.programDateTime,h=a.programDateTime;if(!f||!h)return;const d=(h-f)/1e3-(a.start-r.start);my(d,u)}function Me(u,t,e){He(u,t,e),u.addEventListener(t,e)}function He(u,t,e){u.removeEventListener(t,e)}const DA={toString:function(u){let t="";const e=u.length;for(let s=0;s<e;s++)t+=`[${u.start(s).toFixed(3)}-${u.end(s).toFixed(3)}]`;return t}},J={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class zf extends ey{constructor(t,e,s,r,a){super(r,t.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=J.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:f,media:h,mediaBuffer:d,state:g}=this,p=h?h.currentTime:0,v=Tt.bufferInfo(d||h,p,o.maxBufferHole),E=!v.len;if(this.log(`Media seeking to ${ct(p)?p.toFixed(3):p}, state: ${g}, ${E?"out of":"in"} buffer`),this.state===J.ENDED)this.resetLoadingState();else if(f){const S=o.maxFragLookUpTolerance,A=f.start-S,b=f.start+f.duration+S;if(E||b<v.start||A>v.end){const L=p>b;(p<A||L)&&(L&&f.loader&&(this.log(`Cancelling fragment load for seek (sn: ${f.sn})`),f.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(h){this.fragmentTracker.removeFragmentsInRange(p,1/0,this.playlistType,!0);const S=this.lastCurrentTime;if(p>S&&(this.lastCurrentTime=p),!this.loadingParts){const A=Math.max(v.end,p),b=this.shouldLoadParts(this.getLevelDetails(),A);b&&(this.log(`LL-Part loading ON after seeking to ${p.toFixed(2)} with buffer @${A.toFixed(2)}`),this.loadingParts=b)}}this.hls.hasEnoughToStart||(this.log(`Setting ${E?"startPosition":"nextLoadPosition"} to ${p} for seek without enough to start`),this.nextLoadPosition=p,E&&(this.startPosition=p)),E&&this.state===J.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=a,this.hls=t,this.fragmentLoader=new iA(t.config),this.keyLoader=s,this.fragmentTracker=e,this.config=t.config,this.decrypter=new Ff(t.config)}registerListeners(){const{hls:t}=this;t.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(x.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(x.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(x.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(t){}stopLoad(){if(this.state===J.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const t=this.fragCurrent;t!=null&&t.loader&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=J.STOPPED}get startPositionValue(){const{nextLoadPosition:t,startPosition:e}=this;return e===-1&&t?t:e}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(t,e){if(e.live||!this.media)return!1;const s=t.end||0,r=this.config.timelineOffset||0;if(s<=r)return!1;const a=t.buffered;this.config.maxBufferHole&&a&&a.length>1&&(t=Tt.bufferedInfo(a,t.start,0));const o=t.nextStart;if(o&&o>r&&o<e.edge||this.media.currentTime<t.start)return!1;const h=e.partList;if(h!=null&&h.length){const g=h[h.length-1];return Tt.isBuffered(this.media,g.start+g.duration/2)}const d=e.fragments[e.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(d)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const t=this.config.timelineOffset;if(t){var e;return((e=this.getLevelDetails())==null?void 0:e.appliedTimelineOffset)||t}return 0}onMediaAttached(t,e){const s=this.media=this.mediaBuffer=e.media;Me(s,"seeking",this.onMediaSeeking),Me(s,"ended",this.onMediaEnded);const r=this.config;this.levels&&r.autoStartLoad&&this.state===J.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(t,e){const s=!!e.transferMedia,r=this.media;if(r!==null){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),He(r,"seeking",this.onMediaSeeking),He(r,"ended",this.onMediaEnded),this.keyLoader&&!s&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,s){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(t,e){}onManifestLoaded(t,e){this.startTimeOffset=e.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=J.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(t,e,s){this.startFragRequested=!0,this._loadFragForPlayback(t,e,s)}_loadFragForPlayback(t,e,s){const r=a=>{const o=a.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${a.part?" part: "+a.part.index:""} of ${this.fragInfo(o,!1,a.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(a)};this._doFragLoad(t,e,s,r).then(a=>{if(!a)return;const o=this.state,f=a.frag;if(this.fragContextChanged(f)){(o===J.FRAG_LOADING||!this.fragCurrent&&o===J.PARSING)&&(this.fragmentTracker.removeFragment(f),this.state=J.IDLE);return}"payload"in a&&(this.log(`Loaded ${f.type} sn: ${f.sn} of ${this.playlistLabel()} ${f.level}`),this.hls.trigger(x.FRAG_LOADED,a)),this._handleFragmentLoadComplete(a)}).catch(a=>{this.state===J.STOPPED||this.state===J.ERROR||(this.warn(`Frag error: ${(a==null?void 0:a.message)||a}`),this.resetFragmentLoading(t))})}clearTrackerIfNeeded(t){var e;const{fragmentTracker:s}=this;if(s.getState(t)===ge.APPENDING){const a=t.type,o=this.getFwdBufferInfo(this.mediaBuffer,a),f=Math.max(t.duration,o?o.len:this.config.maxBufferLength),h=this.backtrackFragment;((h?t.sn-h.sn:0)===1||this.reduceMaxBufferLength(f,t.duration))&&s.removeFragment(t)}else((e=this.mediaBuffer)==null?void 0:e.buffered.length)===0?s.removeAllFragments():s.hasParts(t.type)&&(s.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type}),s.getState(t)===ge.PARTIAL&&s.removeFragment(t))}checkLiveUpdate(t){if(t.updated&&!t.live){const e=t.fragments[t.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type})}t.fragments[0]||(t.deltaUpdateFailed=!0)}waitForLive(t){const e=t.details;return(e==null?void 0:e.live)&&e.type!=="EVENT"&&(this.levelLastLoaded!==t||e.expired)}flushMainBuffer(t,e,s=null){if(!(t-e))return;const r={startOffset:t,endOffset:e,type:s};this.hls.trigger(x.BUFFER_FLUSHING,r)}_loadInitSegment(t,e){this._doFragLoad(t,e).then(s=>{const r=s==null?void 0:s.frag;if(!r||this.fragContextChanged(r)||!this.levels)throw new Error("init load aborted");return s}).then(s=>{const{hls:r}=this,{frag:a,payload:o}=s,f=a.decryptdata;if(o&&o.byteLength>0&&f!=null&&f.key&&f.iv&&nr(f.method)){const h=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),f.key.buffer,f.iv.buffer,Gf(f.method)).catch(d=>{throw r.trigger(x.ERROR,{type:pt.MEDIA_ERROR,details:z.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:a}),d}).then(d=>{const g=self.performance.now();return r.trigger(x.FRAG_DECRYPTED,{frag:a,payload:d,stats:{tstart:h,tdecrypt:g}}),s.payload=d,this.completeInitSegmentLoad(s)})}return this.completeInitSegmentLoad(s)}).catch(s=>{this.state===J.STOPPED||this.state===J.ERROR||(this.warn(s),this.resetFragmentLoading(t))})}completeInitSegmentLoad(t){const{levels:e}=this;if(!e)throw new Error("init load aborted, missing levels");const s=t.frag.stats;this.state!==J.STOPPED&&(this.state=J.IDLE),t.frag.data=new Uint8Array(t.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(t,e){var s,r;const a=t.tracks;if(a&&!e.encrypted&&((s=a.audio)!=null&&s.encrypted||(r=a.video)!=null&&r.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const o=this.media,f=new Error(`Encrypted track with no key in ${this.fragInfo(e)} (media ${o?"attached mediaKeys: "+o.mediaKeys:"detached"})`);return this.warn(f.message),!o||o.mediaKeys?!1:(this.hls.trigger(x.ERROR,{type:pt.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_KEYS,fatal:!1,error:f,frag:e}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(t){const{fragCurrent:e}=this;return!t||!e||t.sn!==e.sn||t.level!==e.level}fragBufferedComplete(t,e){const s=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${t.type} sn: ${t.sn}${e?" part: "+e.index:""} of ${this.fragInfo(t,!1,e)} > buffer:${s?DA.toString(Tt.getBuffered(s)):"(detached)"})`),le(t)){var r;if(t.type!==ht.SUBTITLE){const o=t.elementaryStreams;if(!Object.keys(o).some(f=>!!o[f])){this.state=J.IDLE;return}}const a=(r=this.levels)==null?void 0:r[t.level];a!=null&&a.fragmentError&&(this.log(`Resetting level fragment error count of ${a.fragmentError} on frag buffered`),a.fragmentError=0)}this.state=J.IDLE}_handleFragmentLoadComplete(t){const{transmuxer:e}=this;if(!e)return;const{frag:s,part:r,partsLoaded:a}=t,o=!a||a.length===0||a.some(h=>!h),f=new $f(s.level,s.sn,s.stats.chunkCount+1,0,r?r.index:-1,!o);e.flush(f)}_handleFragmentLoadProgress(t){}_doFragLoad(t,e,s=null,r){var a;this.fragCurrent=t;const o=e.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let f=null;if(t.encrypted&&!((a=t.decryptdata)!=null&&a.key)){if(this.log(`Loading key for ${t.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${t.level}`),this.state=J.KEY_LOADING,this.fragCurrent=t,f=this.keyLoader.load(t).then(v=>{if(!this.fragContextChanged(v.frag))return this.hls.trigger(x.KEY_LOADED,v),this.state===J.KEY_LOADING&&(this.state=J.IDLE),v}),this.hls.trigger(x.KEY_LOADING,{frag:t}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else t.encrypted||(f=this.keyLoader.loadClear(t,o.encryptedFragments,this.startFragRequested),f&&this.log("[eme] blocking frag load until media-keys acquired"));const h=this.fragPrevious;if(le(t)&&(!h||t.sn!==h.sn)){const v=this.shouldLoadParts(e.details,t.end);v!==this.loadingParts&&(this.log(`LL-Part loading ${v?"ON":"OFF"} loading sn ${h==null?void 0:h.sn}->${t.sn}`),this.loadingParts=v)}if(s=Math.max(t.start,s||0),this.loadingParts&&le(t)){const v=o.partList;if(v&&r){s>o.fragmentEnd&&o.fragmentHint&&(t=o.fragmentHint);const E=this.getNextPart(v,t,s);if(E>-1){const S=v[E];t=this.fragCurrent=S.fragment,this.log(`Loading ${t.type} sn: ${t.sn} part: ${S.index} (${E}/${v.length-1}) of ${this.fragInfo(t,!1,S)}) cc: ${t.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(s.toFixed(3))}`),this.nextLoadPosition=S.start+S.duration,this.state=J.FRAG_LOADING;let A;return f?A=f.then(b=>!b||this.fragContextChanged(b.frag)?null:this.doFragPartsLoad(t,S,e,r)).catch(b=>this.handleFragLoadError(b)):A=this.doFragPartsLoad(t,S,e,r).catch(b=>this.handleFragLoadError(b)),this.hls.trigger(x.FRAG_LOADING,{frag:t,part:S,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):A}else if(!t.url||this.loadedEndOfParts(v,s))return Promise.resolve(null)}}if(le(t)&&this.loadingParts){var d;this.log(`LL-Part loading OFF after next part miss @${s.toFixed(2)} Check buffer at sn: ${t.sn} loaded parts: ${(d=o.partList)==null?void 0:d.filter(v=>v.loaded).map(v=>`[${v.start}-${v.end}]`)}`),this.loadingParts=!1}else if(!t.url)return Promise.resolve(null);this.log(`Loading ${t.type} sn: ${t.sn} of ${this.fragInfo(t,!1)}) cc: ${t.cc} ${"["+o.startSN+"-"+o.endSN+"]"}, target: ${parseFloat(s.toFixed(3))}`),ct(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=J.FRAG_LOADING;const g=this.config.progressive&&t.type!==ht.SUBTITLE;let p;return g&&f?p=f.then(v=>!v||this.fragContextChanged(v.frag)?null:this.fragmentLoader.load(t,r)).catch(v=>this.handleFragLoadError(v)):p=Promise.all([this.fragmentLoader.load(t,g?r:void 0),f]).then(([v])=>(!g&&r&&r(v),v)).catch(v=>this.handleFragLoadError(v)),this.hls.trigger(x.FRAG_LOADING,{frag:t,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):p}doFragPartsLoad(t,e,s,r){return new Promise((a,o)=>{var f;const h=[],d=(f=s.details)==null?void 0:f.partList,g=p=>{this.fragmentLoader.loadPart(t,p,r).then(v=>{h[p.index]=v;const E=v.part;this.hls.trigger(x.FRAG_LOADED,v);const S=Xm(s.details,t.sn,p.index+1)||hy(d,t.sn,p.index+1);if(S)g(S);else return a({frag:t,part:E,partsLoaded:h})}).catch(o)};g(e)})}handleFragLoadError(t){if("data"in t){const e=t.data;e.frag&&e.details===z.INTERNAL_ABORTED?this.handleFragLoadAborted(e.frag,e.part):e.frag&&e.type===pt.KEY_SYSTEM_ERROR?(e.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(e.frag)):this.hls.trigger(x.ERROR,e)}else this.hls.trigger(x.ERROR,{type:pt.OTHER_ERROR,details:z.INTERNAL_EXCEPTION,err:t,error:t,fatal:!0});return null}_handleTransmuxerFlush(t){const e=this.getCurrentContext(t);if(!e||this.state!==J.PARSING){!this.fragCurrent&&this.state!==J.STOPPED&&this.state!==J.ERROR&&(this.state=J.IDLE);return}const{frag:s,part:r,level:a}=e,o=self.performance.now();s.stats.parsing.end=o,r&&(r.stats.parsing.end=o);const f=this.getLevelDetails(),d=f&&s.sn>f.endSN||this.shouldLoadParts(f,s.end);d!==this.loadingParts&&(this.log(`LL-Part loading ${d?"ON":"OFF"} after parsing segment ending @${s.end.toFixed(2)}`),this.loadingParts=d),this.updateLevelTiming(s,r,a,t.partial)}shouldLoadParts(t,e){if(this.config.lowLatencyMode){if(!t)return this.loadingParts;if(t.partList){var s;const a=t.partList[0];if(a.fragment.type===ht.SUBTITLE)return!1;const o=a.end+(((s=t.fragmentHint)==null?void 0:s.duration)||0);if(e>=o){var r;if((this.hls.hasEnoughToStart?((r=this.media)==null?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>a.start-a.fragment.duration)return!0}}}return!1}getCurrentContext(t){const{levels:e,fragCurrent:s}=this,{level:r,sn:a,part:o}=t;if(!(e!=null&&e[r]))return this.warn(`Levels object was unset while buffering fragment ${a} of ${this.playlistLabel()} ${r}. The current chunk will not be buffered.`),null;const f=e[r],h=f.details,d=o>-1?Xm(h,a,o):null,g=d?d.fragment:dy(h,a,s);return g?(s&&s!==g&&(g.stats=s.stats),{frag:g,part:d,level:f}):null}bufferFragmentData(t,e,s,r,a){if(this.state!==J.PARSING)return;const{data1:o,data2:f}=t;let h=o;if(f&&(h=gi(o,f)),!h.length)return;const d=this.initPTS[e.cc],g=d?-d.baseTime/d.timescale:void 0,p={type:t.type,frag:e,part:s,chunkMeta:r,offset:g,parent:e.type,data:h};if(this.hls.trigger(x.BUFFER_APPENDING,p),t.dropped&&t.independent&&!s){if(a)return;this.flushBufferGap(e)}}flushBufferGap(t){const e=this.media;if(!e)return;if(!Tt.isBuffered(e,e.currentTime)){this.flushMainBuffer(0,t.start);return}const s=e.currentTime,r=Tt.bufferInfo(e,s,0),a=t.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,a*.25),f=Math.max(Math.min(t.start-o,r.end-o),s+o);t.start-f>o&&this.flushMainBuffer(f,t.start)}getFwdBufferInfo(t,e){var s;const r=this.getLoadPosition();if(!ct(r))return null;const o=this.lastCurrentTime>r||(s=this.media)!=null&&s.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(t,r,e,o)}getFwdBufferInfoAtPos(t,e,s,r){const a=Tt.bufferInfo(t,e,r);if(a.len===0&&a.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(e,s);if(o&&(a.nextStart<=o.end||o.gap)){const f=Math.max(Math.min(a.nextStart,o.end)-e,r);return Tt.bufferInfo(t,e,f)}}return a}getMaxBufferLength(t){const{config:e}=this;let s;return t?s=Math.max(8*e.maxBufferSize/t,e.maxBufferLength):s=e.maxBufferLength,Math.min(s,e.maxMaxBufferLength)}reduceMaxBufferLength(t,e){const s=this.config,r=Math.max(Math.min(t-e,s.maxBufferLength),e),a=Math.max(t-e*3,s.maxMaxBufferLength/2,r);return a>=r?(s.maxMaxBufferLength=a,this.warn(`Reduce max buffer length to ${a}s`),!0):!1}getAppendedFrag(t,e=ht.MAIN){const s=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(t,e):null;return s&&"fragment"in s?s.fragment:s}getNextFragment(t,e){const s=e.fragments,r=s.length;if(!r)return null;const{config:a}=this,o=s[0].start,f=a.lowLatencyMode&&!!e.partList;let h=null;if(e.live){const p=a.initialLiveManifestSize;if(r<p)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${p})`),null;if(!e.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||t<o){var d;f&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),h=this.getInitialLiveFragment(e);const v=this.hls.startPosition,E=this.hls.liveSyncPosition,S=h?(v!==-1&&v>=o?v:E)||h.start:t;this.log(`Setting startPosition to ${S} to match start frag at live edge. mainStart: ${v} liveSyncPosition: ${E} frag.start: ${(d=h)==null?void 0:d.start}`),this.startPosition=this.nextLoadPosition=S}}else t<=o&&(h=s[0]);if(!h){const p=this.loadingParts?e.partEnd:e.fragmentEnd;h=this.getFragmentAtPosition(t,p,e)}let g=this.filterReplacedPrimary(h,e);if(!g&&h){const p=h.sn-e.startSN;g=this.filterReplacedPrimary(s[p+1]||null,e)}return this.mapToInitFragWhenRequired(g)}isLoopLoading(t,e){const s=this.fragmentTracker.getState(t);return(s===ge.OK||s===ge.PARTIAL&&!!t.gap)&&this.nextLoadPosition>e}getNextFragmentLoopLoading(t,e,s,r,a){let o=null;if(t.gap&&(o=this.getNextFragment(this.nextLoadPosition,e),o&&!o.gap&&s.nextStart)){const f=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,s.nextStart,r,0);if(f!==null&&s.len+f.len>=a){const h=o.sn;return this.loopSn!==h&&(this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${h}`),this.loopSn=h),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(Zm(this.config)){var t;if((t=this.hls.interstitialsManager)==null||(t=t.playingItem)==null?void 0:t.event)return!0}return!1}filterReplacedPrimary(t,e){if(!t)return t;if(Zm(this.config)&&t.type!==ht.SUBTITLE){const s=this.hls.interstitialsManager,r=s==null?void 0:s.bufferingItem;if(r){const o=r.event;if(o){if(o.appendInPlace||Math.abs(t.start-r.start)>1||r.start===0)return null}else if(t.end<=r.start&&(e==null?void 0:e.live)===!1||t.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||t.start-r.end>1))return null}const a=s==null?void 0:s.playerQueue;if(a)for(let o=a.length;o--;){const f=a[o].interstitial;if(f.appendInPlace&&t.start>=f.startTime&&t.end<=f.resumeTime)return null}}return t}mapToInitFragWhenRequired(t){return t!=null&&t.initSegment&&!t.initSegment.data&&!this.bitrateTest?t.initSegment:t}getNextPart(t,e,s){let r=-1,a=!1,o=!0;for(let f=0,h=t.length;f<h;f++){const d=t[f];if(o=o&&!d.independent,r>-1&&s<d.start)break;const g=d.loaded;g?r=-1:(a||(d.independent||o)&&d.fragment===e)&&(d.fragment!==e&&this.warn(`Need buffer at ${s} but next unloaded part starts at ${d.start}`),r=f),a=g}return r}loadedEndOfParts(t,e){let s;for(let r=t.length;r--;){if(s=t[r],!s.loaded)return!1;if(e>s.start)return!0}return!1}getInitialLiveFragment(t){const e=t.fragments,s=this.fragPrevious;let r=null;if(s){if(t.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${s.programDateTime}`),r=Kx(e,s.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const a=s.sn+1;if(a>=t.startSN&&a<=t.endSN){const o=e[a-t.startSN];s.cc===o.cc&&(r=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=Zp(t,s.cc,s.end),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const a=this.hls.liveSyncPosition;a!==null&&(r=this.getFragmentAtPosition(a,this.bitrateTest?t.fragmentEnd:t.edge,t))}return r}getFragmentAtPosition(t,e,s){const{config:r}=this;let{fragPrevious:a}=this,{fragments:o,endSN:f}=s;const{fragmentHint:h}=s,{maxFragLookUpTolerance:d}=r,g=s.partList,p=!!(this.loadingParts&&g!=null&&g.length&&h);p&&!this.bitrateTest&&g[g.length-1].fragment.sn===h.sn&&(o=o.concat(h),f=h.sn);let v;if(t<e){var E;const A=t<this.lastCurrentTime||t>e-d||(E=this.media)!=null&&E.paused||!this.startFragRequested?0:d;v=un(a,o,t,A)}else v=o[o.length-1];if(v){const S=v.sn-s.startSN,A=this.fragmentTracker.getState(v);if((A===ge.OK||A===ge.PARTIAL&&v.gap)&&(a=v),a&&v.sn===a.sn&&(!p||g[0].fragment.sn>v.sn||!s.live)&&v.level===a.level){const L=o[S+1];v.sn<f&&this.fragmentTracker.getState(L)!==ge.OK?v=L:v=null}}return v}alignPlaylists(t,e,s){const r=t.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const a=t.fragmentStart,o=!e,f=t.alignedSliding&&ct(a);if(o||!f&&!a){_A(s,t);const h=t.fragmentStart;return this.log(`Live playlist sliding: ${h.toFixed(2)} start-sn: ${e?e.startSN:"na"}->${t.startSN} fragments: ${r}`),h}return a}waitForCdnTuneIn(t){return t.live&&t.canBlockReload&&t.partTarget&&t.tuneInGoal>Math.max(t.partHoldBack,t.partTarget*3)}setStartPosition(t,e){let s=this.startPosition;s<e&&(s=-1);const r=this.timelineOffset;if(s===-1){const a=this.startTimeOffset!==null,o=a?this.startTimeOffset:t.startTimeOffset;o!==null&&ct(o)?(s=e+o,o<0&&(s+=t.edge),s=Math.min(Math.max(e,s),e+t.totalduration),this.log(`Setting startPosition to ${s} for start time offset ${o} found in ${a?"multivariant":"media"} playlist`),this.startPosition=s):t.live?(s=this.hls.liveSyncPosition||e,this.log(`Setting startPosition to -1 to start at live edge ${s}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=s=0),this.lastCurrentTime=s+r}this.nextLoadPosition=s+r}getLoadPosition(){var t;const{media:e}=this;let s=0;return(t=this.hls)!=null&&t.hasEnoughToStart&&e?s=e.currentTime:this.nextLoadPosition>=0&&(s=this.nextLoadPosition),s}handleFragLoadAborted(t,e){this.transmuxer&&t.type===this.playlistType&&le(t)&&t.stats.aborted&&(this.log(`Fragment ${t.sn}${e?" part "+e.index:""} of ${this.playlistLabel()} ${t.level} was aborted`),this.resetFragmentLoading(t))}resetFragmentLoading(t){(!this.fragCurrent||!this.fragContextChanged(t)&&this.state!==J.FRAG_LOADING_WAITING_RETRY)&&(this.state=J.IDLE)}onFragmentOrKeyLoadError(t,e){var s;if(e.chunkMeta&&!e.frag){const L=this.getCurrentContext(e.chunkMeta);L&&(e.frag=L.frag)}const r=e.frag;if(!r||r.type!==t||!this.levels)return;if(this.fragContextChanged(r)){var a;this.warn(`Frag load error must match current frag to retry ${r.url} > ${(a=this.fragCurrent)==null?void 0:a.url}`);return}const o=e.details===z.FRAG_GAP;o&&this.fragmentTracker.fragBuffered(r,!0);const f=e.errorAction;if(!f){this.state=J.ERROR;return}const{action:h,flags:d,retryCount:g=0,retryConfig:p}=f,v=!!p,E=v&&h===Le.RetryRequest,S=v&&!f.resolved&&d===Je.MoveAllAlternatesMatchingHost,A=(s=this.hls.latestLevelDetails)==null?void 0:s.live;if(!E&&S&&le(r)&&!r.endList&&A&&!ty(e))this.resetFragmentErrors(t),this.treatAsGap(r),f.resolved=!0;else if((E||S)&&g<p.maxNumRetry){var b;const L=yf((b=e.response)==null?void 0:b.code),_=Bf(p,g);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+_,this.state=J.FRAG_LOADING_WAITING_RETRY,f.resolved=!0,L){this.log("Waiting for connection (offline)"),this.retryDate=1/0,e.reason="offline";return}this.warn(`Fragment ${r.sn} of ${t} ${r.level} errored with ${e.details}, retrying loading ${g+1}/${p.maxNumRetry} in ${_}ms`)}else if(p)if(this.resetFragmentErrors(t),g<p.maxNumRetry)!o&&h!==Le.RemoveAlternatePermanently&&(f.resolved=!0);else{this.warn(`${e.details} reached or exceeded max retry (${g})`);return}else h===Le.SendAlternateToPenaltyBox?this.state=J.WAITING_LEVEL:this.state=J.ERROR;this.tickImmediate()}checkRetryDate(){const t=self.performance.now(),e=this.retryDate,s=e===1/0;(!e||t>=e||s&&!yf(0))&&(s&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=J.IDLE)}reduceLengthAndFlushBuffer(t){if(this.state===J.PARSING||this.state===J.PARSED){const e=t.frag,s=t.parent,r=this.getFwdBufferInfo(this.mediaBuffer,s),a=r&&r.len>.5;a&&this.reduceMaxBufferLength(r.len,(e==null?void 0:e.duration)||10);const o=!a;return o&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${s} buffer`),e&&(this.fragmentTracker.removeFragment(e),this.nextLoadPosition=e.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(t){t===ht.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==J.STOPPED&&(this.state=J.IDLE)}afterBufferFlushed(t,e,s){if(!t)return;const r=Tt.getBuffered(t);this.fragmentTracker.detectEvictedFragments(e,r,s),this.state===J.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==J.STOPPED&&(this.state=J.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const t=this.levelLastLoaded,e=t?t.details:null;e!=null&&e.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(e,e.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(t){this.log(`Loading context changed while buffering sn ${t.sn} of ${this.playlistLabel()} ${t.level===-1?"<removed>":t.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(t=0){this.fragmentTracker.removeFragmentsInRange(t,1/0,this.playlistType,!1,!0)}updateLevelTiming(t,e,s,r){const a=s.details;if(!a){this.warn("level.details undefined");return}if(!Object.keys(t.elementaryStreams).reduce((h,d)=>{const g=t.elementaryStreams[d];if(g){const p=g.endPTS-g.startPTS;if(p<=0)return this.warn(`Could not parse fragment ${t.sn} ${d} duration reliably (${p})`),h||!1;const v=r?0:uy(a,t,g.startPTS,g.endPTS,g.startDTS,g.endDTS,this);return this.hls.trigger(x.LEVEL_PTS_UPDATED,{details:a,level:s,drift:v,type:d,frag:t,start:g.startPTS,end:g.endPTS}),!0}return h},!1)){var f;const h=((f=this.transmuxer)==null?void 0:f.error)===null;if((s.fragmentError===0||h&&(s.fragmentError<2||t.endList))&&this.treatAsGap(t,s),h){const d=new Error(`Found no media in fragment ${t.sn} of ${this.playlistLabel()} ${t.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(d.message),this.hls.trigger(x.ERROR,{type:pt.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!1,error:d,frag:t,reason:`Found no media in msn ${t.sn} of ${this.playlistLabel()} "${s.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=J.PARSED,this.log(`Parsed ${t.type} sn: ${t.sn}${e?" part: "+e.index:""} of ${this.fragInfo(t,!1,e)})`),this.hls.trigger(x.FRAG_PARSED,{frag:t,part:e})}playlistLabel(){return this.playlistType===ht.MAIN?"level":"track"}fragInfo(t,e=!0,s){var r,a;return`${this.playlistLabel()} ${t.level} (${s?"part":"frag"}:[${((r=e&&!s?t.startPTS:(s||t).start)!=null?r:NaN).toFixed(3)}-${((a=e&&!s?t.endPTS:(s||t).end)!=null?a:NaN).toFixed(3)}]${s&&t.type==="main"?"INDEPENDENT="+(s.independent?"YES":"NO"):""}`}treatAsGap(t,e){e&&e.fragmentError++,t.gap=!0,this.fragmentTracker.removeFragment(t),this.fragmentTracker.fragBuffered(t,!0)}resetTransmuxer(){var t;(t=this.transmuxer)==null||t.reset()}recoverWorkerError(t){t.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(t){const e=this._state;e!==t&&(this._state=t,this.log(`${e}->${t}`))}get state(){return this._state}}function Zm(u){return!!u.interstitialsController&&u.enableInterstitialPlayback!==!1}class yy{constructor(){this.chunks=[],this.dataLength=0}push(t){this.chunks.push(t),this.dataLength+=t.length}flush(){const{chunks:t,dataLength:e}=this;let s;if(t.length)t.length===1?s=t[0]:s=IA(t,e);else return new Uint8Array(0);return this.reset(),s}reset(){this.chunks.length=0,this.dataLength=0}}function IA(u,t){const e=new Uint8Array(t);let s=0;for(let r=0;r<u.length;r++){const a=u[r];e.set(a,s),s+=a.length}return e}var Xc={exports:{}},Jm;function CA(){return Jm||(Jm=1,(function(u){var t=Object.prototype.hasOwnProperty,e="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(e=!1));function r(h,d,g){this.fn=h,this.context=d,this.once=g||!1}function a(h,d,g,p,v){if(typeof g!="function")throw new TypeError("The listener must be a function");var E=new r(g,p||h,v),S=e?e+d:d;return h._events[S]?h._events[S].fn?h._events[S]=[h._events[S],E]:h._events[S].push(E):(h._events[S]=E,h._eventsCount++),h}function o(h,d){--h._eventsCount===0?h._events=new s:delete h._events[d]}function f(){this._events=new s,this._eventsCount=0}f.prototype.eventNames=function(){var d=[],g,p;if(this._eventsCount===0)return d;for(p in g=this._events)t.call(g,p)&&d.push(e?p.slice(1):p);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(g)):d},f.prototype.listeners=function(d){var g=e?e+d:d,p=this._events[g];if(!p)return[];if(p.fn)return[p.fn];for(var v=0,E=p.length,S=new Array(E);v<E;v++)S[v]=p[v].fn;return S},f.prototype.listenerCount=function(d){var g=e?e+d:d,p=this._events[g];return p?p.fn?1:p.length:0},f.prototype.emit=function(d,g,p,v,E,S){var A=e?e+d:d;if(!this._events[A])return!1;var b=this._events[A],L=arguments.length,_,D;if(b.fn){switch(b.once&&this.removeListener(d,b.fn,void 0,!0),L){case 1:return b.fn.call(b.context),!0;case 2:return b.fn.call(b.context,g),!0;case 3:return b.fn.call(b.context,g,p),!0;case 4:return b.fn.call(b.context,g,p,v),!0;case 5:return b.fn.call(b.context,g,p,v,E),!0;case 6:return b.fn.call(b.context,g,p,v,E,S),!0}for(D=1,_=new Array(L-1);D<L;D++)_[D-1]=arguments[D];b.fn.apply(b.context,_)}else{var k=b.length,w;for(D=0;D<k;D++)switch(b[D].once&&this.removeListener(d,b[D].fn,void 0,!0),L){case 1:b[D].fn.call(b[D].context);break;case 2:b[D].fn.call(b[D].context,g);break;case 3:b[D].fn.call(b[D].context,g,p);break;case 4:b[D].fn.call(b[D].context,g,p,v);break;default:if(!_)for(w=1,_=new Array(L-1);w<L;w++)_[w-1]=arguments[w];b[D].fn.apply(b[D].context,_)}}return!0},f.prototype.on=function(d,g,p){return a(this,d,g,p,!1)},f.prototype.once=function(d,g,p){return a(this,d,g,p,!0)},f.prototype.removeListener=function(d,g,p,v){var E=e?e+d:d;if(!this._events[E])return this;if(!g)return o(this,E),this;var S=this._events[E];if(S.fn)S.fn===g&&(!v||S.once)&&(!p||S.context===p)&&o(this,E);else{for(var A=0,b=[],L=S.length;A<L;A++)(S[A].fn!==g||v&&!S[A].once||p&&S[A].context!==p)&&b.push(S[A]);b.length?this._events[E]=b.length===1?b[0]:b:o(this,E)}return this},f.prototype.removeAllListeners=function(d){var g;return d?(g=e?e+d:d,this._events[g]&&o(this,g)):(this._events=new s,this._eventsCount=0),this},f.prototype.off=f.prototype.removeListener,f.prototype.addListener=f.prototype.on,f.prefixed=e,f.EventEmitter=f,u.exports=f})(Xc)),Xc.exports}var kA=CA(),Kf=ix(kA);const ma="1.6.15",or={};function OA(){return typeof __HLS_WORKER_BUNDLE__=="function"}function MA(){const u=or[ma];if(u)return u.clientCount++,u;const t=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),e=self.URL.createObjectURL(t),r={worker:new self.Worker(e),objectURL:e,clientCount:1};return or[ma]=r,r}function wA(u){const t=or[u];if(t)return t.clientCount++,t;const e=new self.URL(u,self.location.href).href,r={worker:new self.Worker(e),scriptURL:e,clientCount:1};return or[u]=r,r}function NA(u){const t=or[u||ma];if(t&&t.clientCount--===1){const{worker:s,objectURL:r}=t;delete or[u||ma],r&&self.URL.revokeObjectURL(r),s.terminate()}}function vy(u,t){return t+10<=u.length&&u[t]===51&&u[t+1]===68&&u[t+2]===73&&u[t+3]<255&&u[t+4]<255&&u[t+6]<128&&u[t+7]<128&&u[t+8]<128&&u[t+9]<128}function jf(u,t){return t+10<=u.length&&u[t]===73&&u[t+1]===68&&u[t+2]===51&&u[t+3]<255&&u[t+4]<255&&u[t+6]<128&&u[t+7]<128&&u[t+8]<128&&u[t+9]<128}function xo(u,t){let e=0;return e=(u[t]&127)<<21,e|=(u[t+1]&127)<<14,e|=(u[t+2]&127)<<7,e|=u[t+3]&127,e}function pa(u,t){const e=t;let s=0;for(;jf(u,t);){s+=10;const r=xo(u,t+6);s+=r,vy(u,t+10)&&(s+=10),t+=s}if(s>0)return u.subarray(e,e+s)}function PA(u,t,e,s){const r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],a=t[e+2],o=a>>2&15;if(o>12){const E=new Error(`invalid ADTS sampling index:${o}`);u.emit(x.ERROR,x.ERROR,{type:pt.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!0,error:E,reason:E.message});return}const f=(a>>6&3)+1,h=t[e+3]>>6&3|(a&1)<<2,d="mp4a.40."+f,g=r[o];let p=o;(f===5||f===29)&&(p-=3);const v=[f<<3|(p&14)>>1,(p&1)<<7|h<<3];return Gt.log(`manifest codec:${s}, parsed codec:${d}, channels:${h}, rate:${g} (ADTS object type:${f} sampling index:${o})`),{config:v,samplerate:g,channelCount:h,codec:d,parsedCodec:d,manifestCodec:s}}function Ey(u,t){return u[t]===255&&(u[t+1]&246)===240}function Sy(u,t){return u[t+1]&1?7:9}function Vf(u,t){return(u[t+3]&3)<<11|u[t+4]<<3|(u[t+5]&224)>>>5}function UA(u,t){return t+5<u.length}function Eo(u,t){return t+1<u.length&&Ey(u,t)}function BA(u,t){return UA(u,t)&&Ey(u,t)&&Vf(u,t)<=u.length-t}function FA(u,t){if(Eo(u,t)){const e=Sy(u,t);if(t+e>=u.length)return!1;const s=Vf(u,t);if(s<=e)return!1;const r=t+s;return r===u.length||Eo(u,r)}return!1}function Ty(u,t,e,s,r){if(!u.samplerate){const a=PA(t,e,s,r);if(!a)return;jt(u,a)}}function xy(u){return 1024*9e4/u}function $A(u,t){const e=Sy(u,t);if(t+e<=u.length){const s=Vf(u,t)-e;if(s>0)return{headerLength:e,frameLength:s}}}function Ay(u,t,e,s,r){const a=xy(u.samplerate),o=s+r*a,f=$A(t,e);let h;if(f){const{frameLength:p,headerLength:v}=f,E=v+p,S=Math.max(0,e+E-t.length);S?(h=new Uint8Array(E-v),h.set(t.subarray(e+v,t.length),0)):h=t.subarray(e+v,e+E);const A={unit:h,pts:o};return S||u.samples.push(A),{sample:A,length:E,missing:S}}const d=t.length-e;return h=new Uint8Array(d),h.set(t.subarray(e,t.length),0),{sample:{unit:h,pts:o},length:d,missing:-1}}function GA(u,t){return jf(u,t)&&xo(u,t+6)+10<=u.length-t}function HA(u){return u instanceof ArrayBuffer?u:u.byteOffset==0&&u.byteLength==u.buffer.byteLength?u.buffer:new Uint8Array(u).buffer}function Qc(u,t=0,e=1/0){return zA(u,t,e,Uint8Array)}function zA(u,t,e,s){const r=KA(u);let a=1;"BYTES_PER_ELEMENT"in s&&(a=s.BYTES_PER_ELEMENT);const o=jA(u)?u.byteOffset:0,f=(o+u.byteLength)/a,h=(o+t)/a,d=Math.floor(Math.max(0,Math.min(h,f))),g=Math.floor(Math.min(d+Math.max(e,0),f));return new s(r,d,g-d)}function KA(u){return u instanceof ArrayBuffer?u:u.buffer}function jA(u){return u&&u.buffer instanceof ArrayBuffer&&u.byteLength!==void 0&&u.byteOffset!==void 0}function VA(u){const t={key:u.type,description:"",data:"",mimeType:null,pictureType:null},e=3;if(u.size<2)return;if(u.data[0]!==e){console.log("Ignore frame with unrecognized character encoding");return}const s=u.data.subarray(1).indexOf(0);if(s===-1)return;const r=ii(Qc(u.data,1,s)),a=u.data[2+s],o=u.data.subarray(3+s).indexOf(0);if(o===-1)return;const f=ii(Qc(u.data,3+s,o));let h;return r==="-->"?h=ii(Qc(u.data,4+s+o)):h=HA(u.data.subarray(4+s+o)),t.mimeType=r,t.pictureType=a,t.description=f,t.data=h,t}function YA(u){if(u.size<2)return;const t=ii(u.data,!0),e=new Uint8Array(u.data.subarray(t.length+1));return{key:u.type,info:t,data:e.buffer}}function qA(u){if(u.size<2)return;if(u.type==="TXXX"){let e=1;const s=ii(u.data.subarray(e),!0);e+=s.length+1;const r=ii(u.data.subarray(e));return{key:u.type,info:s,data:r}}const t=ii(u.data.subarray(1));return{key:u.type,info:"",data:t}}function XA(u){if(u.type==="WXXX"){if(u.size<2)return;let e=1;const s=ii(u.data.subarray(e),!0);e+=s.length+1;const r=ii(u.data.subarray(e));return{key:u.type,info:s,data:r}}const t=ii(u.data);return{key:u.type,info:"",data:t}}function QA(u){return u.type==="PRIV"?YA(u):u.type[0]==="W"?XA(u):u.type==="APIC"?VA(u):qA(u)}function WA(u){const t=String.fromCharCode(u[0],u[1],u[2],u[3]),e=xo(u,4),s=10;return{type:t,size:e,data:u.subarray(s,s+e)}}const Kl=10,ZA=10;function by(u){let t=0;const e=[];for(;jf(u,t);){const s=xo(u,t+6);u[t+5]>>6&1&&(t+=Kl),t+=Kl;const r=t+s;for(;t+ZA<r;){const a=WA(u.subarray(t)),o=QA(a);o&&e.push(o),t+=a.size+Kl}vy(u,t)&&(t+=Kl)}return e}function Ly(u){return u&&u.key==="PRIV"&&u.info==="com.apple.streaming.transportStreamTimestamp"}function JA(u){if(u.data.byteLength===8){const t=new Uint8Array(u.data),e=t[3]&1;let s=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return s/=45,e&&(s+=4772185884e-2),Math.round(s)}}function Yf(u){const t=by(u);for(let e=0;e<t.length;e++){const s=t[e];if(Ly(s))return JA(s)}}let ei=(function(u){return u.audioId3="org.id3",u.dateRange="com.apple.quicktime.HLS",u.emsg="https://aomedia.org/emsg/ID3",u.misbklv="urn:misb:KLV:bin:1910.1",u})({});function Oi(u="",t=9e4){return{type:u,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class qf{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(t,e,s,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(t){this.initPTS=t,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(t,e){return!1}appendFrame(t,e,s){}demux(t,e){this.cachedData&&(t=gi(this.cachedData,t),this.cachedData=null);let s=pa(t,0),r=s?s.length:0,a;const o=this._audioTrack,f=this._id3Track,h=s?Yf(s):void 0,d=t.length;for((this.basePTS===null||this.frameIndex===0&&ct(h))&&(this.basePTS=tb(h,e,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),s&&s.length>0&&f.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:ei.audioId3,duration:Number.POSITIVE_INFINITY});r<d;){if(this.canParse(t,r)){const g=this.appendFrame(o,t,r);g?(this.frameIndex++,this.lastPTS=g.sample.pts,r+=g.length,a=r):r=d}else GA(t,r)?(s=pa(t,r),f.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:ei.audioId3,duration:Number.POSITIVE_INFINITY}),r+=s.length,a=r):r++;if(r===d&&a!==d){const g=t.slice(a);this.cachedData?this.cachedData=gi(this.cachedData,g):this.cachedData=g}}return{audioTrack:o,videoTrack:Oi(),id3Track:f,textTrack:Oi()}}demuxSampleAes(t,e,s){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(t){const e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),{audioTrack:this._audioTrack,videoTrack:Oi(),id3Track:this._id3Track,textTrack:Oi()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const tb=(u,t,e)=>{if(ct(u))return u*90;const s=e?e.baseTime*9e4/e.timescale:0;return t*9e4+s};let jl=null;const eb=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],ib=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],sb=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],nb=[0,1,1,4];function Ry(u,t,e,s,r){if(e+24>t.length)return;const a=_y(t,e);if(a&&e+a.frameLength<=t.length){const o=a.samplesPerFrame*9e4/a.sampleRate,f=s+r*o,h={unit:t.subarray(e,e+a.frameLength),pts:f,dts:f};return u.config=[],u.channelCount=a.channelCount,u.samplerate=a.sampleRate,u.samples.push(h),{sample:h,length:a.frameLength,missing:0}}}function _y(u,t){const e=u[t+1]>>3&3,s=u[t+1]>>1&3,r=u[t+2]>>4&15,a=u[t+2]>>2&3;if(e!==1&&r!==0&&r!==15&&a!==3){const o=u[t+2]>>1&1,f=u[t+3]>>6,h=e===3?3-s:s===3?3:4,d=eb[h*14+r-1]*1e3,p=ib[(e===3?0:e===2?1:2)*3+a],v=f===3?1:2,E=sb[e][s],S=nb[s],A=E*8*S,b=Math.floor(E*d/p+o)*S;if(jl===null){const D=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);jl=D?parseInt(D[1]):0}return!!jl&&jl<=87&&s===2&&d>=224e3&&f===0&&(u[t+3]=u[t+3]|128),{sampleRate:p,channelCount:v,frameLength:b,samplesPerFrame:A}}}function Xf(u,t){return u[t]===255&&(u[t+1]&224)===224&&(u[t+1]&6)!==0}function Dy(u,t){return t+1<u.length&&Xf(u,t)}function rb(u,t){return Xf(u,t)&&4<=u.length-t}function Iy(u,t){if(t+1<u.length&&Xf(u,t)){const s=_y(u,t);let r=4;s!=null&&s.frameLength&&(r=s.frameLength);const a=t+r;return a===u.length||Dy(u,a)}return!1}class ab extends qf{constructor(t,e){super(),this.observer=void 0,this.config=void 0,this.observer=t,this.config=e}resetInitSegment(t,e,s,r){super.resetInitSegment(t,e,s,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:e,duration:r,inputTimeScale:9e4,dropped:0}}static probe(t,e){if(!t)return!1;const s=pa(t,0);let r=(s==null?void 0:s.length)||0;if(Iy(t,r))return!1;for(let a=t.length;r<a;r++)if(FA(t,r))return e.log("ADTS sync word found !"),!0;return!1}canParse(t,e){return BA(t,e)}appendFrame(t,e,s){Ty(t,this.observer,e,s,t.manifestCodec);const r=Ay(t,e,s,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r}}const Cy=(u,t)=>{let e=0,s=5;t+=s;const r=new Uint32Array(1),a=new Uint32Array(1),o=new Uint8Array(1);for(;s>0;){o[0]=u[t];const f=Math.min(s,8),h=8-f;a[0]=4278190080>>>24+h<<h,r[0]=(o[0]&a[0])>>h,e=e?e<<f|r[0]:r[0],t+=1,s-=f}return e};class lb extends qf{constructor(t){super(),this.observer=void 0,this.observer=t}resetInitSegment(t,e,s,r){super.resetInitSegment(t,e,s,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:e,duration:r,inputTimeScale:9e4,dropped:0}}canParse(t,e){return e+64<t.length}appendFrame(t,e,s){const r=ky(t,e,s,this.basePTS,this.frameIndex);if(r!==-1)return{sample:t.samples[t.samples.length-1],length:r,missing:0}}static probe(t){if(!t)return!1;const e=pa(t,0);if(!e)return!1;const s=e.length;return t[s]===11&&t[s+1]===119&&Yf(e)!==void 0&&Cy(t,s)<16}}function ky(u,t,e,s,r){if(e+8>t.length||t[e]!==11||t[e+1]!==119)return-1;const a=t[e+4]>>6;if(a>=3)return-1;const f=[48e3,44100,32e3][a],h=t[e+4]&63,g=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][h*3+a]*2;if(e+g>t.length)return-1;const p=t[e+6]>>5;let v=0;p===2?v+=2:(p&1&&p!==1&&(v+=2),p&4&&(v+=2));const E=(t[e+6]<<8|t[e+7])>>12-v&1,A=[2,1,2,3,3,4,4,5][p]+E,b=t[e+5]>>3,L=t[e+5]&7,_=new Uint8Array([a<<6|b<<1|L>>2,(L&3)<<6|p<<3|E<<2|h>>4,h<<4&224]),D=1536/f*9e4,k=s+r*D,w=t.subarray(e,e+g);return u.config=_,u.channelCount=A,u.samplerate=f,u.samples.push({unit:w,pts:k}),g}class ob extends qf{resetInitSegment(t,e,s,r){super.resetInitSegment(t,e,s,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:e,duration:r,inputTimeScale:9e4,dropped:0}}static probe(t){if(!t)return!1;const e=pa(t,0);let s=(e==null?void 0:e.length)||0;if(e&&t[s]===11&&t[s+1]===119&&Yf(e)!==void 0&&Cy(t,s)<=16)return!1;for(let r=t.length;s<r;s++)if(Iy(t,s))return Gt.log("MPEG Audio sync word found !"),!0;return!1}canParse(t,e){return rb(t,e)}appendFrame(t,e,s){if(this.basePTS!==null)return Ry(t,e,s,this.basePTS,this.frameIndex)}}const ub=/\/emsg[-/]ID3/i;class cb{constructor(t,e){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=e}resetTimeStamp(){}resetInitSegment(t,e,s,r){const a=this.videoTrack=Oi("video",1),o=this.audioTrack=Oi("audio",1),f=this.txtTrack=Oi("text",1);if(this.id3Track=Oi("id3",1),this.timeOffset=0,!(t!=null&&t.byteLength))return;const h=Gp(t);if(h.video){const{id:d,timescale:g,codec:p,supplemental:v}=h.video;a.id=d,a.timescale=f.timescale=g,a.codec=p,a.supplemental=v}if(h.audio){const{id:d,timescale:g,codec:p}=h.audio;o.id=d,o.timescale=g,o.codec=p}f.id=Bp.text,a.sampleDuration=0,a.duration=o.duration=r}resetContiguity(){this.remainderData=null}static probe(t){return lx(t)}demux(t,e){this.timeOffset=e;let s=t;const r=this.videoTrack,a=this.txtTrack;if(this.config.progressive){this.remainderData&&(s=gi(this.remainderData,t));const f=gx(s);this.remainderData=f.remainder,r.samples=f.valid||new Uint8Array}else r.samples=s;const o=this.extractID3Track(r,e);return a.samples=ym(e,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const t=this.timeOffset,e=this.videoTrack,s=this.txtTrack;e.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(e,this.timeOffset);return s.samples=ym(t,e),{videoTrack:e,audioTrack:Oi(),id3Track:r,textTrack:Oi()}}extractID3Track(t,e){const s=this.id3Track;if(t.samples.length){const r=Lt(t.samples,["emsg"]);r&&r.forEach(a=>{const o=px(a);if(ub.test(o.schemeIdUri)){const f=tp(o,e);let h=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;h<=.001&&(h=Number.POSITIVE_INFINITY);const d=o.payload;s.samples.push({data:d,len:d.byteLength,dts:f,pts:f,type:ei.emsg,duration:h})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const f=tp(o,e);s.samples.push({data:o.payload,len:o.payload.byteLength,dts:f,pts:f,type:ei.misbklv,duration:Number.POSITIVE_INFINITY})}})}return s}demuxSampleAes(t,e,s){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function tp(u,t){return ct(u.presentationTime)?u.presentationTime/u.timeScale:t+u.presentationTimeDelta/u.timeScale}class fb{constructor(t,e,s){this.keyData=void 0,this.decrypter=void 0,this.keyData=s,this.decrypter=new Ff(e,{removePKCS7Padding:!1})}decryptBuffer(t){return this.decrypter.decrypt(t,this.keyData.key.buffer,this.keyData.iv.buffer,Bs.cbc)}decryptAacSample(t,e,s){const r=t[e].unit;if(r.length<=16)return;const a=r.subarray(16,r.length-r.length%16),o=a.buffer.slice(a.byteOffset,a.byteOffset+a.length);this.decryptBuffer(o).then(f=>{const h=new Uint8Array(f);r.set(h,16),this.decrypter.isSync()||this.decryptAacSamples(t,e+1,s)}).catch(s)}decryptAacSamples(t,e,s){for(;;e++){if(e>=t.length){s();return}if(!(t[e].unit.length<32)&&(this.decryptAacSample(t,e,s),!this.decrypter.isSync()))return}}getAvcEncryptedData(t){const e=Math.floor((t.length-48)/160)*16+16,s=new Int8Array(e);let r=0;for(let a=32;a<t.length-16;a+=160,r+=16)s.set(t.subarray(a,a+16),r);return s}getAvcDecryptedUnit(t,e){const s=new Uint8Array(e);let r=0;for(let a=32;a<t.length-16;a+=160,r+=16)t.set(s.subarray(r,r+16),a);return t}decryptAvcSample(t,e,s,r,a){const o=Kp(a.data),f=this.getAvcEncryptedData(o);this.decryptBuffer(f.buffer).then(h=>{a.data=this.getAvcDecryptedUnit(o,h),this.decrypter.isSync()||this.decryptAvcSamples(t,e,s+1,r)}).catch(r)}decryptAvcSamples(t,e,s,r){if(t instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,s=0){if(e>=t.length){r();return}const a=t[e].units;for(;!(s>=a.length);s++){const o=a[s];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(t,e,s,r,o),!this.decrypter.isSync()))return}}}}class Oy{constructor(){this.VideoSample=null}createVideoSample(t,e,s){return{key:t,frame:!1,pts:e,dts:s,units:[],length:0}}getLastNalUnit(t){var e;let s=this.VideoSample,r;if((!s||s.units.length===0)&&(s=t[t.length-1]),(e=s)!=null&&e.units){const a=s.units;r=a[a.length-1]}return r}pushAccessUnit(t,e){if(t.units.length&&t.frame){if(t.pts===void 0){const s=e.samples,r=s.length;if(r){const a=s[r-1];t.pts=a.pts,t.dts=a.dts}else{e.dropped++;return}}e.samples.push(t)}}parseNALu(t,e,s){const r=e.byteLength;let a=t.naluState||0;const o=a,f=[];let h=0,d,g,p,v=-1,E=0;for(a===-1&&(v=0,E=this.getNALuType(e,0),a=0,h=1);h<r;){if(d=e[h++],!a){a=d?0:1;continue}if(a===1){a=d?0:2;continue}if(!d)a=3;else if(d===1){if(g=h-a-1,v>=0){const S={data:e.subarray(v,g),type:E};f.push(S)}else{const S=this.getLastNalUnit(t.samples);S&&(o&&h<=4-o&&S.state&&(S.data=S.data.subarray(0,S.data.byteLength-o)),g>0&&(S.data=gi(S.data,e.subarray(0,g)),S.state=0))}h<r?(p=this.getNALuType(e,h),v=h,E=p,a=0):a=-1}else a=0}if(v>=0&&a>=0){const S={data:e.subarray(v,r),type:E,state:a};f.push(S)}if(f.length===0){const S=this.getLastNalUnit(t.samples);S&&(S.data=gi(S.data,e))}return t.naluState=a,f}}class ua{constructor(t){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const t=this.data,e=this.bytesAvailable,s=t.byteLength-e,r=new Uint8Array(4),a=Math.min(4,e);if(a===0)throw new Error("no bytes available");r.set(t.subarray(s,s+a)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=a*8,this.bytesAvailable-=a}skipBits(t){let e;t=Math.min(t,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,e=t>>3,t-=e<<3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)}readBits(t){let e=Math.min(this.bitsAvailable,t);const s=this.word>>>32-e;if(t>32&&Gt.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0)this.word<<=e;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return e=t-e,e>0&&this.bitsAvailable?s<<e|this.readBits(e):s}skipLZ(){let t;for(t=0;t<this.bitsAvailable;++t)if((this.word&2147483648>>>t)!==0)return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const t=this.skipLZ();return this.readBits(t+1)-1}readEG(){const t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class db extends Oy{parsePES(t,e,s,r){const a=this.parseNALu(t,s.data,r);let o=this.VideoSample,f,h=!1;s.data=null,o&&a.length&&!t.audFound&&(this.pushAccessUnit(o,t),o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),a.forEach(d=>{var g,p;switch(d.type){case 1:{let A=!1;f=!0;const b=d.data;if(h&&b.length>4){const L=this.readSliceType(b);(L===2||L===4||L===7||L===9)&&(A=!0)}if(A){var v;(v=o)!=null&&v.frame&&!o.key&&(this.pushAccessUnit(o,t),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.frame=!0,o.key=A;break}case 5:f=!0,(g=o)!=null&&g.frame&&!o.key&&(this.pushAccessUnit(o,t),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.key=!0,o.frame=!0;break;case 6:{f=!0,Nf(d.data,1,s.pts,e.samples);break}case 7:{var E,S;f=!0,h=!0;const A=d.data,b=this.readSPS(A);if(!t.sps||t.width!==b.width||t.height!==b.height||((E=t.pixelRatio)==null?void 0:E[0])!==b.pixelRatio[0]||((S=t.pixelRatio)==null?void 0:S[1])!==b.pixelRatio[1]){t.width=b.width,t.height=b.height,t.pixelRatio=b.pixelRatio,t.sps=[A];const L=A.subarray(1,4);let _="avc1.";for(let D=0;D<3;D++){let k=L[D].toString(16);k.length<2&&(k="0"+k),_+=k}t.codec=_}break}case 8:f=!0,t.pps=[d.data];break;case 9:f=!0,t.audFound=!0,(p=o)!=null&&p.frame&&(this.pushAccessUnit(o,t),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;case 12:f=!0;break;default:f=!1;break}o&&f&&o.units.push(d)}),r&&o&&(this.pushAccessUnit(o,t),this.VideoSample=null)}getNALuType(t,e){return t[e]&31}readSliceType(t){const e=new ua(t);return e.readUByte(),e.readUEG(),e.readUEG()}skipScalingList(t,e){let s=8,r=8,a;for(let o=0;o<t;o++)r!==0&&(a=e.readEG(),r=(s+a+256)%256),s=r===0?s:r}readSPS(t){const e=new ua(t);let s=0,r=0,a=0,o=0,f,h,d;const g=e.readUByte.bind(e),p=e.readBits.bind(e),v=e.readUEG.bind(e),E=e.readBoolean.bind(e),S=e.skipBits.bind(e),A=e.skipEG.bind(e),b=e.skipUEG.bind(e),L=this.skipScalingList.bind(this);g();const _=g();if(p(5),S(3),g(),b(),_===100||_===110||_===122||_===244||_===44||_===83||_===86||_===118||_===128){const $=v();if($===3&&S(1),b(),b(),S(1),E())for(h=$!==3?8:12,d=0;d<h;d++)E()&&(d<6?L(16,e):L(64,e))}b();const D=v();if(D===0)v();else if(D===1)for(S(1),A(),A(),f=v(),d=0;d<f;d++)A();b(),S(1);const k=v(),w=v(),V=p(1);V===0&&S(1),S(1),E()&&(s=v(),r=v(),a=v(),o=v());let O=[1,1];if(E()&&E())switch(g()){case 1:O=[1,1];break;case 2:O=[12,11];break;case 3:O=[10,11];break;case 4:O=[16,11];break;case 5:O=[40,33];break;case 6:O=[24,11];break;case 7:O=[20,11];break;case 8:O=[32,11];break;case 9:O=[80,33];break;case 10:O=[18,11];break;case 11:O=[15,11];break;case 12:O=[64,33];break;case 13:O=[160,99];break;case 14:O=[4,3];break;case 15:O=[3,2];break;case 16:O=[2,1];break;case 255:{O=[g()<<8|g(),g()<<8|g()];break}}return{width:Math.ceil((k+1)*16-s*2-r*2),height:(2-V)*(w+1)*16-(V?2:4)*(a+o),pixelRatio:O}}}class hb extends Oy{constructor(...t){super(...t),this.initVPS=null}parsePES(t,e,s,r){const a=this.parseNALu(t,s.data,r);let o=this.VideoSample,f,h=!1;s.data=null,o&&a.length&&!t.audFound&&(this.pushAccessUnit(o,t),o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),a.forEach(d=>{var g,p;switch(d.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),o.frame=!0,f=!0;break;case 16:case 17:case 18:case 21:if(f=!0,h){var v;(v=o)!=null&&v.frame&&!o.key&&(this.pushAccessUnit(o,t),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:f=!0,(g=o)!=null&&g.frame&&!o.key&&(this.pushAccessUnit(o,t),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.key=!0,o.frame=!0;break;case 39:f=!0,Nf(d.data,2,s.pts,e.samples);break;case 32:f=!0,t.vps||(typeof t.params!="object"&&(t.params={}),t.params=jt(t.params,this.readVPS(d.data)),this.initVPS=d.data),t.vps=[d.data];break;case 33:if(f=!0,h=!0,t.vps!==void 0&&t.vps[0]!==this.initVPS&&t.sps!==void 0&&!this.matchSPS(t.sps[0],d.data)&&(this.initVPS=t.vps[0],t.sps=t.pps=void 0),!t.sps){const E=this.readSPS(d.data);t.width=E.width,t.height=E.height,t.pixelRatio=E.pixelRatio,t.codec=E.codecString,t.sps=[],typeof t.params!="object"&&(t.params={});for(const S in E.params)t.params[S]=E.params[S]}this.pushParameterSet(t.sps,d.data,t.vps),o||(o=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),o.key=!0;break;case 34:if(f=!0,typeof t.params=="object"){if(!t.pps){t.pps=[];const E=this.readPPS(d.data);for(const S in E)t.params[S]=E[S]}this.pushParameterSet(t.pps,d.data,t.vps)}break;case 35:f=!0,t.audFound=!0,(p=o)!=null&&p.frame&&(this.pushAccessUnit(o,t),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;default:f=!1;break}o&&f&&o.units.push(d)}),r&&o&&(this.pushAccessUnit(o,t),this.VideoSample=null)}pushParameterSet(t,e,s){(s&&s[0]===this.initVPS||!s&&!t.length)&&t.push(e)}getNALuType(t,e){return(t[e]&126)>>>1}ebsp2rbsp(t){const e=new Uint8Array(t.byteLength);let s=0;for(let r=0;r<t.byteLength;r++)r>=2&&t[r]===3&&t[r-1]===0&&t[r-2]===0||(e[s]=t[r],s++);return new Uint8Array(e.buffer,0,s)}pushAccessUnit(t,e){super.pushAccessUnit(t,e),this.initVPS&&(this.initVPS=null)}readVPS(t){const e=new ua(t);e.readUByte(),e.readUByte(),e.readBits(4),e.skipBits(2),e.readBits(6);const s=e.readBits(3),r=e.readBoolean();return{numTemporalLayers:s+1,temporalIdNested:r}}readSPS(t){const e=new ua(this.ebsp2rbsp(t));e.readUByte(),e.readUByte(),e.readBits(4);const s=e.readBits(3);e.readBoolean();const r=e.readBits(2),a=e.readBoolean(),o=e.readBits(5),f=e.readUByte(),h=e.readUByte(),d=e.readUByte(),g=e.readUByte(),p=e.readUByte(),v=e.readUByte(),E=e.readUByte(),S=e.readUByte(),A=e.readUByte(),b=e.readUByte(),L=e.readUByte(),_=[],D=[];for(let It=0;It<s;It++)_.push(e.readBoolean()),D.push(e.readBoolean());if(s>0)for(let It=s;It<8;It++)e.readBits(2);for(let It=0;It<s;It++)_[It]&&(e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte(),e.readUByte()),D[It]&&e.readUByte();e.readUEG();const k=e.readUEG();k==3&&e.skipBits(1);const w=e.readUEG(),V=e.readUEG(),O=e.readBoolean();let $=0,G=0,B=0,Q=0;O&&($+=e.readUEG(),G+=e.readUEG(),B+=e.readUEG(),Q+=e.readUEG());const st=e.readUEG(),ut=e.readUEG(),dt=e.readUEG(),lt=e.readBoolean();for(let It=lt?0:s;It<=s;It++)e.skipUEG(),e.skipUEG(),e.skipUEG();if(e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG(),e.readBoolean()&&e.readBoolean())for(let me=0;me<4;me++)for(let Ce=0;Ce<(me===3?2:6);Ce++)if(!e.readBoolean())e.readUEG();else{const ke=Math.min(64,1<<4+(me<<1));me>1&&e.readEG();for(let bi=0;bi<ke;bi++)e.readEG()}e.readBoolean(),e.readBoolean(),e.readBoolean()&&(e.readUByte(),e.skipUEG(),e.skipUEG(),e.readBoolean());const Z=e.readUEG();let rt=0;for(let It=0;It<Z;It++){let me=!1;if(It!==0&&(me=e.readBoolean()),me){It===Z&&e.readUEG(),e.readBoolean(),e.readUEG();let Ce=0;for(let yi=0;yi<=rt;yi++){const ke=e.readBoolean();let bi=!1;ke||(bi=e.readBoolean()),(ke||bi)&&Ce++}rt=Ce}else{const Ce=e.readUEG(),yi=e.readUEG();rt=Ce+yi;for(let ke=0;ke<Ce;ke++)e.readUEG(),e.readBoolean();for(let ke=0;ke<yi;ke++)e.readUEG(),e.readBoolean()}}if(e.readBoolean()){const It=e.readUEG();for(let me=0;me<It;me++){for(let Ce=0;Ce<dt+4;Ce++)e.readBits(1);e.readBits(1)}}let I=0,U=1,it=1,nt=!0,at=1,ft=0;e.readBoolean(),e.readBoolean();let Et=!1;if(e.readBoolean()){if(e.readBoolean()){const Ui=e.readUByte(),Sa=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],pe=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Ui>0&&Ui<16?(U=Sa[Ui-1],it=pe[Ui-1]):Ui===255&&(U=e.readBits(16),it=e.readBits(16))}if(e.readBoolean()&&e.readBoolean(),e.readBoolean()&&(e.readBits(3),e.readBoolean(),e.readBoolean()&&(e.readUByte(),e.readUByte(),e.readUByte())),e.readBoolean()&&(e.readUEG(),e.readUEG()),e.readBoolean(),e.readBoolean(),e.readBoolean(),Et=e.readBoolean(),Et&&(e.skipUEG(),e.skipUEG(),e.skipUEG(),e.skipUEG()),e.readBoolean()&&(at=e.readBits(32),ft=e.readBits(32),e.readBoolean()&&e.readUEG(),e.readBoolean())){const pe=e.readBoolean(),Ta=e.readBoolean();let as=!1;(pe||Ta)&&(as=e.readBoolean(),as&&(e.readUByte(),e.readBits(5),e.readBoolean(),e.readBits(5)),e.readBits(4),e.readBits(4),as&&e.readBits(4),e.readBits(5),e.readBits(5),e.readBits(5));for(let cr=0;cr<=s;cr++){nt=e.readBoolean();const fn=nt||e.readBoolean();let xa=!1;fn?e.readEG():xa=e.readBoolean();const fr=xa?1:e.readUEG()+1;if(pe)for(let Fs=0;Fs<fr;Fs++)e.readUEG(),e.readUEG(),as&&(e.readUEG(),e.readUEG()),e.skipBits(1);if(Ta)for(let Fs=0;Fs<fr;Fs++)e.readUEG(),e.readUEG(),as&&(e.readUEG(),e.readUEG()),e.skipBits(1)}}e.readBoolean()&&(e.readBoolean(),e.readBoolean(),e.readBoolean(),I=e.readUEG())}let Mt=w,De=V;if(O){let It=1,me=1;k===1?It=me=2:k==2&&(It=2),Mt=w-It*G-It*$,De=V-me*Q-me*B}const si=r?["A","B","C"][r]:"",ur=f<<24|h<<16|d<<8|g;let cn=0;for(let It=0;It<32;It++)cn=(cn|(ur>>It&1)<<31-It)>>>0;let pi=cn.toString(16);return o===1&&pi==="2"&&(pi="6"),{codecString:`hvc1.${si}${o}.${pi}.${a?"H":"L"}${L}.B0`,params:{general_tier_flag:a,general_profile_idc:o,general_profile_space:r,general_profile_compatibility_flags:[f,h,d,g],general_constraint_indicator_flags:[p,v,E,S,A,b],general_level_idc:L,bit_depth:st+8,bit_depth_luma_minus8:st,bit_depth_chroma_minus8:ut,min_spatial_segmentation_idc:I,chroma_format_idc:k,frame_rate:{fixed:nt,fps:ft/at}},width:Mt,height:De,pixelRatio:[U,it]}}readPPS(t){const e=new ua(this.ebsp2rbsp(t));e.readUByte(),e.readUByte(),e.skipUEG(),e.skipUEG(),e.skipBits(2),e.skipBits(3),e.skipBits(2),e.skipUEG(),e.skipUEG(),e.skipEG(),e.skipBits(2),e.readBoolean()&&e.skipUEG(),e.skipEG(),e.skipEG(),e.skipBits(4);const r=e.readBoolean(),a=e.readBoolean();let o=1;return a&&r?o=0:a?o=3:r&&(o=2),{parallelismType:o}}matchSPS(t,e){return String.fromCharCode.apply(null,t).substr(3)===String.fromCharCode.apply(null,e).substr(3)}}const Ee=188;class Ns{constructor(t,e,s,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=t,this.config=e,this.typeSupported=s,this.logger=r,this.videoParser=null}static probe(t,e){const s=Ns.syncOffset(t);return s>0&&e.warn(`MPEG2-TS detected but first sync word found @ offset ${s}`),s!==-1}static syncOffset(t){const e=t.length;let s=Math.min(Ee*5,e-Ee)+1,r=0;for(;r<s;){let a=!1,o=-1,f=0;for(let h=r;h<e;h+=Ee)if(t[h]===71&&(e-h===Ee||t[h+Ee]===71)){if(f++,o===-1&&(o=h,o!==0&&(s=Math.min(o+Ee*99,t.length-Ee)+1)),a||(a=xf(t,h)===0),a&&f>1&&(o===0&&f>2||h+Ee>s))return o}else{if(f)return-1;break}r++}return-1}static createTrack(t,e){return{container:t==="video"||t==="audio"?"video/mp2t":void 0,type:t,id:Bp[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:t==="audio"?e:void 0}}resetInitSegment(t,e,s,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Ns.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=Ns.createTrack("audio",r),this._id3Track=Ns.createTrack("id3"),this._txtTrack=Ns.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=e,this.videoCodec=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:t,_videoTrack:e,_id3Track:s}=this;t&&(t.pesData=null),e&&(e.pesData=null),s&&(s.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(t,e,s=!1,r=!1){s||(this.sampleAes=null);let a;const o=this._videoTrack,f=this._audioTrack,h=this._id3Track,d=this._txtTrack;let g=o.pid,p=o.pesData,v=f.pid,E=h.pid,S=f.pesData,A=h.pesData,b=null,L=this.pmtParsed,_=this._pmtId,D=t.length;if(this.remainderData&&(t=gi(this.remainderData,t),D=t.length,this.remainderData=null),D<Ee&&!r)return this.remainderData=t,{audioTrack:f,videoTrack:o,id3Track:h,textTrack:d};const k=Math.max(0,Ns.syncOffset(t));D-=(D-k)%Ee,D<t.byteLength&&!r&&(this.remainderData=new Uint8Array(t.buffer,D,t.buffer.byteLength-D));let w=0;for(let O=k;O<D;O+=Ee)if(t[O]===71){const $=!!(t[O+1]&64),G=xf(t,O),B=(t[O+3]&48)>>4;let Q;if(B>1){if(Q=O+5+t[O+4],Q===O+Ee)continue}else Q=O+4;switch(G){case g:$&&(p&&(a=Jn(p,this.logger))&&(this.readyVideoParser(o.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(o,d,a,!1)),p={data:[],size:0}),p&&(p.data.push(t.subarray(Q,O+Ee)),p.size+=O+Ee-Q);break;case v:if($){if(S&&(a=Jn(S,this.logger)))switch(f.segmentCodec){case"aac":this.parseAACPES(f,a);break;case"mp3":this.parseMPEGPES(f,a);break;case"ac3":this.parseAC3PES(f,a);break}S={data:[],size:0}}S&&(S.data.push(t.subarray(Q,O+Ee)),S.size+=O+Ee-Q);break;case E:$&&(A&&(a=Jn(A,this.logger))&&this.parseID3PES(h,a),A={data:[],size:0}),A&&(A.data.push(t.subarray(Q,O+Ee)),A.size+=O+Ee-Q);break;case 0:$&&(Q+=t[Q]+1),_=this._pmtId=gb(t,Q);break;case _:{$&&(Q+=t[Q]+1);const st=mb(t,Q,this.typeSupported,s,this.observer,this.logger);g=st.videoPid,g>0&&(o.pid=g,o.segmentCodec=st.segmentVideoCodec),v=st.audioPid,v>0&&(f.pid=v,f.segmentCodec=st.segmentAudioCodec),E=st.id3Pid,E>0&&(h.pid=E),b!==null&&!L&&(this.logger.warn(`MPEG-TS PMT found at ${O} after unknown PID '${b}'. Backtracking to sync byte @${k} to parse all TS packets.`),b=null,O=k-188),L=this.pmtParsed=!0;break}case 17:case 8191:break;default:b=G;break}}else w++;w>0&&Af(this.observer,new Error(`Found ${w} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=p,f.pesData=S,h.pesData=A;const V={audioTrack:f,videoTrack:o,id3Track:h,textTrack:d};return r&&this.extractRemainingSamples(V),V}flush(){const{remainderData:t}=this;this.remainderData=null;let e;return t?e=this.demux(t,-1,!1,!0):e={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e}extractRemainingSamples(t){const{audioTrack:e,videoTrack:s,id3Track:r,textTrack:a}=t,o=s.pesData,f=e.pesData,h=r.pesData;let d;if(o&&(d=Jn(o,this.logger))?(this.readyVideoParser(s.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(s,a,d,!0),s.pesData=null)):s.pesData=o,f&&(d=Jn(f,this.logger))){switch(e.segmentCodec){case"aac":this.parseAACPES(e,d);break;case"mp3":this.parseMPEGPES(e,d);break;case"ac3":this.parseAC3PES(e,d);break}e.pesData=null}else f!=null&&f.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),e.pesData=f;h&&(d=Jn(h,this.logger))?(this.parseID3PES(r,d),r.pesData=null):r.pesData=h}demuxSampleAes(t,e,s){const r=this.demux(t,s,!0,!this.config.progressive),a=this.sampleAes=new fb(this.observer,this.config,e);return this.decrypt(r,a)}readyVideoParser(t){this.videoParser===null&&(t==="avc"?this.videoParser=new db:t==="hevc"&&(this.videoParser=new hb))}decrypt(t,e){return new Promise(s=>{const{audioTrack:r,videoTrack:a}=t;r.samples&&r.segmentCodec==="aac"?e.decryptAacSamples(r.samples,0,()=>{a.samples?e.decryptAvcSamples(a.samples,0,0,()=>{s(t)}):s(t)}):a.samples&&e.decryptAvcSamples(a.samples,0,0,()=>{s(t)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(t,e){let s=0;const r=this.aacOverFlow;let a=e.data;if(r){this.aacOverFlow=null;const p=r.missing,v=r.sample.unit.byteLength;if(p===-1)a=gi(r.sample.unit,a);else{const E=v-p;r.sample.unit.set(a.subarray(0,p),E),t.samples.push(r.sample),s=r.missing}}let o,f;for(o=s,f=a.length;o<f-1&&!Eo(a,o);o++);if(o!==s){let p;const v=o<f-1;if(v?p=`AAC PES did not start with ADTS header,offset:${o}`:p="No ADTS header found in AAC PES",Af(this.observer,new Error(p),v,this.logger),!v)return}Ty(t,this.observer,a,o,this.audioCodec);let h;if(e.pts!==void 0)h=e.pts;else if(r){const p=xy(t.samplerate);h=r.sample.pts+p}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let d=0,g;for(;o<f;)if(g=Ay(t,a,o,h,d),o+=g.length,g.missing){this.aacOverFlow=g;break}else for(d++;o<f-1&&!Eo(a,o);o++);}parseMPEGPES(t,e){const s=e.data,r=s.length;let a=0,o=0;const f=e.pts;if(f===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<r;)if(Dy(s,o)){const h=Ry(t,s,o,f,a);if(h)o+=h.length,a++;else break}else o++}parseAC3PES(t,e){{const s=e.data,r=e.pts;if(r===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const a=s.length;let o=0,f=0,h;for(;f<a&&(h=ky(t,s,f,r,o++))>0;)f+=h}}parseID3PES(t,e){if(e.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const s=jt({},e,{type:this._videoTrack?ei.emsg:ei.audioId3,duration:Number.POSITIVE_INFINITY});t.samples.push(s)}}function xf(u,t){return((u[t+1]&31)<<8)+u[t+2]}function gb(u,t){return(u[t+10]&31)<<8|u[t+11]}function mb(u,t,e,s,r,a){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},f=(u[t+1]&15)<<8|u[t+2],h=t+3+f-4,d=(u[t+10]&15)<<8|u[t+11];for(t+=12+d;t<h;){const g=xf(u,t),p=(u[t+3]&15)<<8|u[t+4];switch(u[t]){case 207:if(!s){Wc("ADTS AAC",a);break}case 15:o.audioPid===-1&&(o.audioPid=g);break;case 21:o.id3Pid===-1&&(o.id3Pid=g);break;case 219:if(!s){Wc("H.264",a);break}case 27:o.videoPid===-1&&(o.videoPid=g);break;case 3:case 4:!e.mpeg&&!e.mp3?a.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=g,o.segmentAudioCodec="mp3");break;case 193:if(!s){Wc("AC-3",a);break}case 129:e.ac3?o.audioPid===-1&&(o.audioPid=g,o.segmentAudioCodec="ac3"):a.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&p>0){let v=t+5,E=p;for(;E>2;){switch(u[v]){case 106:e.ac3!==!0?a.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=g,o.segmentAudioCodec="ac3");break}const A=u[v+1]+2;v+=A,E-=A}}break;case 194:case 135:return Af(r,new Error("Unsupported EC-3 in M2TS found"),void 0,a),o;case 36:o.videoPid===-1&&(o.videoPid=g,o.segmentVideoCodec="hevc",a.log("HEVC in M2TS found"));break}t+=p+5}return o}function Af(u,t,e,s){s.warn(`parsing error: ${t.message}`),u.emit(x.ERROR,x.ERROR,{type:pt.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!1,levelRetry:e,error:t,reason:t.message})}function Wc(u,t){t.log(`${u} with AES-128-CBC encryption found in unencrypted stream`)}function Jn(u,t){let e=0,s,r,a,o,f;const h=u.data;if(!u||u.size===0)return null;for(;h[0].length<19&&h.length>1;)h[0]=gi(h[0],h[1]),h.splice(1,1);if(s=h[0],(s[0]<<16)+(s[1]<<8)+s[2]===1){if(r=(s[4]<<8)+s[5],r&&r>u.size-6)return null;const g=s[7];g&192&&(o=(s[9]&14)*536870912+(s[10]&255)*4194304+(s[11]&254)*16384+(s[12]&255)*128+(s[13]&254)/2,g&64?(f=(s[14]&14)*536870912+(s[15]&255)*4194304+(s[16]&254)*16384+(s[17]&255)*128+(s[18]&254)/2,o-f>60*9e4&&(t.warn(`${Math.round((o-f)/9e4)}s delta between PTS and DTS, align them`),o=f)):f=o),a=s[8];let p=a+9;if(u.size<=p)return null;u.size-=p;const v=new Uint8Array(u.size);for(let E=0,S=h.length;E<S;E++){s=h[E];let A=s.byteLength;if(p)if(p>A){p-=A;continue}else s=s.subarray(p),A-=p,p=0;v.set(s,e),e+=A}return r&&(r-=a+3),{data:v,pts:o,dts:f,len:r}}return null}class pb{static getSilentFrame(t,e){switch(t){case"mp4a.40.2":if(e===1)return new Uint8Array([0,200,0,128,35,128]);if(e===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(e===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(e===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(e===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(e===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(e===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Os=Math.pow(2,32)-1;class H{static init(){H.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let t;for(t in H.types)H.types.hasOwnProperty(t)&&(H.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);const e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);H.HDLR_TYPES={video:e,audio:s};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);H.STTS=H.STSC=H.STCO=a,H.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),H.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),H.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),H.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),f=new Uint8Array([97,118,99,49]),h=new Uint8Array([0,0,0,1]);H.FTYP=H.box(H.types.ftyp,o,h,o,f),H.DINF=H.box(H.types.dinf,H.box(H.types.dref,r))}static box(t,...e){let s=8,r=e.length;const a=r;for(;r--;)s+=e[r].byteLength;const o=new Uint8Array(s);for(o[0]=s>>24&255,o[1]=s>>16&255,o[2]=s>>8&255,o[3]=s&255,o.set(t,4),r=0,s=8;r<a;r++)o.set(e[r],s),s+=e[r].byteLength;return o}static hdlr(t){return H.box(H.types.hdlr,H.HDLR_TYPES[t])}static mdat(t){return H.box(H.types.mdat,t)}static mdhd(t,e){e*=t;const s=Math.floor(e/(Os+1)),r=Math.floor(e%(Os+1));return H.box(H.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,s>>24,s>>16&255,s>>8&255,s&255,r>>24,r>>16&255,r>>8&255,r&255,85,196,0,0]))}static mdia(t){return H.box(H.types.mdia,H.mdhd(t.timescale||0,t.duration||0),H.hdlr(t.type),H.minf(t))}static mfhd(t){return H.box(H.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]))}static minf(t){return t.type==="audio"?H.box(H.types.minf,H.box(H.types.smhd,H.SMHD),H.DINF,H.stbl(t)):H.box(H.types.minf,H.box(H.types.vmhd,H.VMHD),H.DINF,H.stbl(t))}static moof(t,e,s){return H.box(H.types.moof,H.mfhd(t),H.traf(s,e))}static moov(t){let e=t.length;const s=[];for(;e--;)s[e]=H.trak(t[e]);return H.box.apply(null,[H.types.moov,H.mvhd(t[0].timescale||0,t[0].duration||0)].concat(s).concat(H.mvex(t)))}static mvex(t){let e=t.length;const s=[];for(;e--;)s[e]=H.trex(t[e]);return H.box.apply(null,[H.types.mvex,...s])}static mvhd(t,e){e*=t;const s=Math.floor(e/(Os+1)),r=Math.floor(e%(Os+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,s>>24,s>>16&255,s>>8&255,s&255,r>>24,r>>16&255,r>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return H.box(H.types.mvhd,a)}static sdtp(t){const e=t.samples||[],s=new Uint8Array(4+e.length);let r,a;for(r=0;r<e.length;r++)a=e[r].flags,s[r+4]=a.dependsOn<<4|a.isDependedOn<<2|a.hasRedundancy;return H.box(H.types.sdtp,s)}static stbl(t){return H.box(H.types.stbl,H.stsd(t),H.box(H.types.stts,H.STTS),H.box(H.types.stsc,H.STSC),H.box(H.types.stsz,H.STSZ),H.box(H.types.stco,H.STCO))}static avc1(t){let e=[],s=[],r,a,o;for(r=0;r<t.sps.length;r++)a=t.sps[r],o=a.byteLength,e.push(o>>>8&255),e.push(o&255),e=e.concat(Array.prototype.slice.call(a));for(r=0;r<t.pps.length;r++)a=t.pps[r],o=a.byteLength,s.push(o>>>8&255),s.push(o&255),s=s.concat(Array.prototype.slice.call(a));const f=H.box(H.types.avcC,new Uint8Array([1,e[3],e[4],e[5],255,224|t.sps.length].concat(e).concat([t.pps.length]).concat(s))),h=t.width,d=t.height,g=t.pixelRatio[0],p=t.pixelRatio[1];return H.box(H.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h>>8&255,h&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),f,H.box(H.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),H.box(H.types.pasp,new Uint8Array([g>>24,g>>16&255,g>>8&255,g&255,p>>24,p>>16&255,p>>8&255,p&255])))}static esds(t){const e=t.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...e,6,1,2])}static audioStsd(t){const e=t.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount||0,0,16,0,0,0,0,e>>8&255,e&255,0,0])}static mp4a(t){return H.box(H.types.mp4a,H.audioStsd(t),H.box(H.types.esds,H.esds(t)))}static mp3(t){return H.box(H.types[".mp3"],H.audioStsd(t))}static ac3(t){return H.box(H.types["ac-3"],H.audioStsd(t),H.box(H.types.dac3,t.config))}static stsd(t){const{segmentCodec:e}=t;if(t.type==="audio"){if(e==="aac")return H.box(H.types.stsd,H.STSD,H.mp4a(t));if(e==="ac3"&&t.config)return H.box(H.types.stsd,H.STSD,H.ac3(t));if(e==="mp3"&&t.codec==="mp3")return H.box(H.types.stsd,H.STSD,H.mp3(t))}else if(t.pps&&t.sps){if(e==="avc")return H.box(H.types.stsd,H.STSD,H.avc1(t));if(e==="hevc"&&t.vps)return H.box(H.types.stsd,H.STSD,H.hvc1(t))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${t.type} segment codec (${e}/${t.codec})`)}static tkhd(t){const e=t.id,s=(t.duration||0)*(t.timescale||0),r=t.width||0,a=t.height||0,o=Math.floor(s/(Os+1)),f=Math.floor(s%(Os+1));return H.box(H.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,f>>24,f>>16&255,f>>8&255,f&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,r&255,0,0,a>>8&255,a&255,0,0]))}static traf(t,e){const s=H.sdtp(t),r=t.id,a=Math.floor(e/(Os+1)),o=Math.floor(e%(Os+1));return H.box(H.types.traf,H.box(H.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255])),H.box(H.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,o>>24,o>>16&255,o>>8&255,o&255])),H.trun(t,s.length+16+20+8+16+8+8),s)}static trak(t){return t.duration=t.duration||4294967295,H.box(H.types.trak,H.tkhd(t),H.mdia(t))}static trex(t){const e=t.id;return H.box(H.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(t,e){const s=t.samples||[],r=s.length,a=12+16*r,o=new Uint8Array(a);let f,h,d,g,p,v;for(e+=8+a,o.set([t.type==="video"?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255],0),f=0;f<r;f++)h=s[f],d=h.duration,g=h.size,p=h.flags,v=h.cts,o.set([d>>>24&255,d>>>16&255,d>>>8&255,d&255,g>>>24&255,g>>>16&255,g>>>8&255,g&255,p.isLeading<<2|p.dependsOn,p.isDependedOn<<6|p.hasRedundancy<<4|p.paddingValue<<1|p.isNonSync,p.degradPrio&61440,p.degradPrio&15,v>>>24&255,v>>>16&255,v>>>8&255,v&255],12+16*f);return H.box(H.types.trun,o)}static initSegment(t){H.types||H.init();const e=H.moov(t);return gi(H.FTYP,e)}static hvc1(t){const e=t.params,s=[t.vps,t.sps,t.pps],r=4,a=new Uint8Array([1,e.general_profile_space<<6|(e.general_tier_flag?32:0)|e.general_profile_idc,e.general_profile_compatibility_flags[0],e.general_profile_compatibility_flags[1],e.general_profile_compatibility_flags[2],e.general_profile_compatibility_flags[3],e.general_constraint_indicator_flags[0],e.general_constraint_indicator_flags[1],e.general_constraint_indicator_flags[2],e.general_constraint_indicator_flags[3],e.general_constraint_indicator_flags[4],e.general_constraint_indicator_flags[5],e.general_level_idc,240|e.min_spatial_segmentation_idc>>8,255&e.min_spatial_segmentation_idc,252|e.parallelismType,252|e.chroma_format_idc,248|e.bit_depth_luma_minus8,248|e.bit_depth_chroma_minus8,0,parseInt(e.frame_rate.fps),r-1|e.temporal_id_nested<<2|e.num_temporal_layers<<3|(e.frame_rate.fixed?64:0),s.length]);let o=a.length;for(let S=0;S<s.length;S+=1){o+=3;for(let A=0;A<s[S].length;A+=1)o+=2+s[S][A].length}const f=new Uint8Array(o);f.set(a,0),o=a.length;const h=s.length-1;for(let S=0;S<s.length;S+=1){f.set(new Uint8Array([32+S|(S===h?128:0),0,s[S].length]),o),o+=3;for(let A=0;A<s[S].length;A+=1)f.set(new Uint8Array([s[S][A].length>>8,s[S][A].length&255]),o),o+=2,f.set(s[S][A],o),o+=s[S][A].length}const d=H.box(H.types.hvcC,f),g=t.width,p=t.height,v=t.pixelRatio[0],E=t.pixelRatio[1];return H.box(H.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,g>>8&255,g&255,p>>8&255,p&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,H.box(H.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),H.box(H.types.pasp,new Uint8Array([v>>24,v>>16&255,v>>8&255,v&255,E>>24,E>>16&255,E>>8&255,E&255])))}}H.types=void 0;H.HDLR_TYPES=void 0;H.STTS=void 0;H.STSC=void 0;H.STCO=void 0;H.STSZ=void 0;H.VMHD=void 0;H.SMHD=void 0;H.STSD=void 0;H.FTYP=void 0;H.DINF=void 0;const My=9e4;function Qf(u,t,e=1,s=!1){const r=u*t*e;return s?Math.round(r):r}function yb(u,t,e=1,s=!1){return Qf(u,t,1/e,s)}function aa(u,t=!1){return Qf(u,1e3,1/My,t)}function vb(u,t=1){return Qf(u,My,1/t)}function ep(u){const{baseTime:t,timescale:e,trackId:s}=u;return`${t/e} (${t}/${e}) trackId: ${s}`}const Eb=10*1e3,Sb=1024,Tb=1152,xb=1536;let tr=null,Zc=null;function ip(u,t,e,s){return{duration:t,size:e,cts:s,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:u?2:1,isNonSync:u?0:1}}}class no extends mi{constructor(t,e,s,r){if(super("mp4-remuxer",r),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=t,this.config=e,this.typeSupported=s,this.ISGenerated=!1,tr===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);tr=o?parseInt(o[1]):0}if(Zc===null){const a=navigator.userAgent.match(/Safari\/(\d+)/i);Zc=a?parseInt(a[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(t){const e=this._initPTS;(!e||!t||t.trackId!==e.trackId||t.baseTime!==e.baseTime||t.timescale!==e.timescale)&&this.log(`Reset initPTS: ${e&&ep(e)} > ${t&&ep(t)}`),this._initPTS=this._initDTS=t}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(t){let e=!1;const s=t[0].pts,r=t.reduce((a,o)=>{let f=o.pts,h=f-a;return h<-4294967296&&(e=!0,f=ti(f,s),h=f-a),h>0?a:f},s);return e&&this.debug("PTS rollover detected"),r}remux(t,e,s,r,a,o,f,h){let d,g,p,v,E,S,A=a,b=a;const L=t.pid>-1,_=e.pid>-1,D=e.samples.length,k=t.samples.length>0,w=f&&D>0||D>1;if((!L||k)&&(!_||w)||this.ISGenerated||f){if(this.ISGenerated){var O,$,G,B;const dt=this.videoTrackConfig;(dt&&(e.width!==dt.width||e.height!==dt.height||((O=e.pixelRatio)==null?void 0:O[0])!==(($=dt.pixelRatio)==null?void 0:$[0])||((G=e.pixelRatio)==null?void 0:G[1])!==((B=dt.pixelRatio)==null?void 0:B[1]))||!dt&&w||this.nextAudioTs===null&&k)&&this.resetInitSegment()}this.ISGenerated||(p=this.generateIS(t,e,a,o));const Q=this.isVideoContiguous;let st=-1,ut;if(w&&(st=Ab(e.samples),!Q&&this.config.forceKeyFrameOnDiscontinuity))if(S=!0,st>0){this.warn(`Dropped ${st} out of ${D} video samples due to a missing keyframe`);const dt=this.getVideoStartPts(e.samples);e.samples=e.samples.slice(st),e.dropped+=st,b+=(e.samples[0].pts-dt)/e.inputTimeScale,ut=b}else st===-1&&(this.warn(`No keyframe found out of ${D} video samples`),S=!1);if(this.ISGenerated){if(k&&w){const dt=this.getVideoStartPts(e.samples),N=(ti(t.samples[0].pts,dt)-dt)/e.inputTimeScale;A+=Math.max(0,N),b+=Math.max(0,-N)}if(k){if(t.samplerate||(this.warn("regenerate InitSegment as audio detected"),p=this.generateIS(t,e,a,o)),g=this.remuxAudio(t,A,this.isAudioContiguous,o,_||w||h===ht.AUDIO?b:void 0),w){const dt=g?g.endPTS-g.startPTS:0;e.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),p=this.generateIS(t,e,a,o)),d=this.remuxVideo(e,b,Q,dt)}}else w&&(d=this.remuxVideo(e,b,Q,0));d&&(d.firstKeyFrame=st,d.independent=st!==-1,d.firstKeyFramePTS=ut)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(s.samples.length&&(E=wy(s,a,this._initPTS,this._initDTS)),r.samples.length&&(v=Ny(r,a,this._initPTS))),{audio:g,video:d,initSegment:p,independent:S,text:v,id3:E}}computeInitPts(t,e,s,r){const a=Math.round(s*e);let o=ti(t,a);if(o<a+e)for(this.log(`Adjusting PTS for rollover in timeline near ${(a-o)/e} ${r}`);o<a+e;)o+=8589934592;return o-a}generateIS(t,e,s,r){const a=t.samples,o=e.samples,f=this.typeSupported,h={},d=this._initPTS;let g=!d||r,p="audio/mp4",v,E,S,A=-1;if(g&&(v=E=1/0),t.config&&a.length){switch(t.timescale=t.samplerate,t.segmentCodec){case"mp3":f.mpeg?(p="audio/mpeg",t.codec=""):f.mp3&&(t.codec="mp3");break;case"ac3":t.codec="ac-3";break}h.audio={id:"audio",container:p,codec:t.codec,initSegment:t.segmentCodec==="mp3"&&f.mpeg?new Uint8Array(0):H.initSegment([t]),metadata:{channelCount:t.channelCount}},g&&(A=t.id,S=t.inputTimeScale,!d||S!==d.timescale?v=E=this.computeInitPts(a[0].pts,S,s,"audio"):g=!1)}if(e.sps&&e.pps&&o.length){if(e.timescale=e.inputTimeScale,h.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:H.initSegment([e]),metadata:{width:e.width,height:e.height}},g)if(A=e.id,S=e.inputTimeScale,!d||S!==d.timescale){const b=this.getVideoStartPts(o),L=ti(o[0].dts,b),_=this.computeInitPts(L,S,s,"video"),D=this.computeInitPts(b,S,s,"video");E=Math.min(E,_),v=Math.min(v,D)}else g=!1;this.videoTrackConfig={width:e.width,height:e.height,pixelRatio:e.pixelRatio}}if(Object.keys(h).length)return this.ISGenerated=!0,g?(d&&this.warn(`Timestamps at playlist time: ${r?"":"~"}${s} ${v/S} != initPTS: ${d.baseTime/d.timescale} (${d.baseTime}/${d.timescale}) trackId: ${d.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${v/S} (${v}/${S}) trackId: ${A}`),this._initPTS={baseTime:v,timescale:S,trackId:A},this._initDTS={baseTime:E,timescale:S,trackId:A}):v=S=void 0,{tracks:h,initPTS:v,timescale:S,trackId:A}}remuxVideo(t,e,s,r){const a=t.inputTimeScale,o=t.samples,f=[],h=o.length,d=this._initPTS,g=d.baseTime*a/d.timescale;let p=this.nextVideoTs,v=8,E=this.videoSampleDuration,S,A,b=Number.POSITIVE_INFINITY,L=Number.NEGATIVE_INFINITY,_=!1;if(!s||p===null){const I=g+e*a,U=o[0].pts-ti(o[0].dts,o[0].pts);tr&&p!==null&&Math.abs(I-U-(p+g))<15e3?s=!0:p=I-U-g}const D=p+g;for(let I=0;I<h;I++){const U=o[I];U.pts=ti(U.pts,D),U.dts=ti(U.dts,D),U.dts<o[I>0?I-1:I].dts&&(_=!0)}_&&o.sort(function(I,U){const it=I.dts-U.dts,nt=I.pts-U.pts;return it||nt}),S=o[0].dts,A=o[o.length-1].dts;const k=A-S,w=k?Math.round(k/(h-1)):E||t.inputTimeScale/30;if(s){const I=S-D,U=I>w,it=I<-1;if((U||it)&&(U?this.warn(`${(t.segmentCodec||"").toUpperCase()}: ${aa(I,!0)} ms (${I}dts) hole between fragments detected at ${e.toFixed(3)}`):this.warn(`${(t.segmentCodec||"").toUpperCase()}: ${aa(-I,!0)} ms (${I}dts) overlapping between fragments detected at ${e.toFixed(3)}`),!it||D>=o[0].pts||tr)){S=D;const nt=o[0].pts-I;if(U)o[0].dts=S,o[0].pts=nt;else{let at=!0;for(let ft=0;ft<o.length&&!(o[ft].dts>nt&&at);ft++){const Et=o[ft].pts;if(o[ft].dts-=I,o[ft].pts-=I,ft<o.length-1){const wt=o[ft+1].pts,Mt=o[ft].pts,De=wt<=Mt,si=wt<=Et;at=De==si}}}this.log(`Video: Initial PTS/DTS adjusted: ${aa(nt,!0)}/${aa(S,!0)}, delta: ${aa(I,!0)} ms`)}}S=Math.max(0,S);let V=0,O=0,$=S;for(let I=0;I<h;I++){const U=o[I],it=U.units,nt=it.length;let at=0;for(let ft=0;ft<nt;ft++)at+=it[ft].data.length;O+=at,V+=nt,U.length=at,U.dts<$?(U.dts=$,$+=w/4|0||1):$=U.dts,b=Math.min(U.pts,b),L=Math.max(U.pts,L)}A=o[h-1].dts;const G=O+4*V+8;let B;try{B=new Uint8Array(G)}catch(I){this.observer.emit(x.ERROR,x.ERROR,{type:pt.MUX_ERROR,details:z.REMUX_ALLOC_ERROR,fatal:!1,error:I,bytes:G,reason:`fail allocating video mdat ${G}`});return}const Q=new DataView(B.buffer);Q.setUint32(0,G),B.set(H.types.mdat,4);let st=!1,ut=Number.POSITIVE_INFINITY,dt=Number.POSITIVE_INFINITY,lt=Number.NEGATIVE_INFINITY,N=Number.NEGATIVE_INFINITY;for(let I=0;I<h;I++){const U=o[I],it=U.units;let nt=0;for(let Et=0,wt=it.length;Et<wt;Et++){const Mt=it[Et],De=Mt.data,si=Mt.data.byteLength;Q.setUint32(v,si),v+=4,B.set(De,v),v+=si,nt+=4+si}let at;if(I<h-1)E=o[I+1].dts-U.dts,at=o[I+1].pts-U.pts;else{const Et=this.config,wt=I>0?U.dts-o[I-1].dts:w;if(at=I>0?U.pts-o[I-1].pts:w,Et.stretchShortVideoTrack&&this.nextAudioTs!==null){const Mt=Math.floor(Et.maxBufferHole*a),De=(r?b+r*a:this.nextAudioTs+g)-U.pts;De>Mt?(E=De-wt,E<0?E=wt:st=!0,this.log(`It is approximately ${De/90} ms to the next segment; using duration ${E/90} ms for the last video frame.`)):E=wt}else E=wt}const ft=Math.round(U.pts-U.dts);ut=Math.min(ut,E),lt=Math.max(lt,E),dt=Math.min(dt,at),N=Math.max(N,at),f.push(ip(U.key,E,nt,ft))}if(f.length){if(tr){if(tr<70){const I=f[0].flags;I.dependsOn=2,I.isNonSync=0}}else if(Zc&&N-dt<lt-ut&&w/lt<.025&&f[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let I=S;for(let U=0,it=f.length;U<it;U++){const nt=I+f[U].duration,at=I+f[U].cts;if(U<it-1){const ft=nt+f[U+1].cts;f[U].duration=ft-at}else f[U].duration=U?f[U-1].duration:w;f[U].cts=0,I=nt}}}E=st||!E?w:E;const X=A+E;this.nextVideoTs=p=X-g,this.videoSampleDuration=E,this.isVideoContiguous=!0;const ot={data1:H.moof(t.sequenceNumber++,S,jt(t,{samples:f})),data2:B,startPTS:(b-g)/a,endPTS:(L+E-g)/a,startDTS:(S-g)/a,endDTS:p/a,type:"video",hasAudio:!1,hasVideo:!0,nb:f.length,dropped:t.dropped};return t.samples=[],t.dropped=0,ot}getSamplesPerFrame(t){switch(t.segmentCodec){case"mp3":return Tb;case"ac3":return xb;default:return Sb}}remuxAudio(t,e,s,r,a){const o=t.inputTimeScale,f=t.samplerate?t.samplerate:o,h=o/f,d=this.getSamplesPerFrame(t),g=d*h,p=this._initPTS,v=t.segmentCodec==="mp3"&&this.typeSupported.mpeg,E=[],S=a!==void 0;let A=t.samples,b=v?0:8,L=this.nextAudioTs||-1;const _=p.baseTime*o/p.timescale,D=_+e*o;if(this.isAudioContiguous=s=s||A.length&&L>0&&(r&&Math.abs(D-(L+_))<9e3||Math.abs(ti(A[0].pts,D)-(L+_))<20*g),A.forEach(function(N){N.pts=ti(N.pts,D)}),!s||L<0){const N=A.length;if(A=A.filter(X=>X.pts>=0),N!==A.length&&this.warn(`Removed ${A.length-N} of ${N} samples (initPTS ${_} / ${o})`),!A.length)return;a===0?L=0:r&&!S?L=Math.max(0,D-_):L=A[0].pts-_}if(t.segmentCodec==="aac"){const N=this.config.maxAudioFramesDrift;for(let X=0,Z=L+_;X<A.length;X++){const rt=A[X],ot=rt.pts,I=ot-Z,U=Math.abs(1e3*I/o);if(I<=-N*g&&S)X===0&&(this.warn(`Audio frame @ ${(ot/o).toFixed(3)}s overlaps marker by ${Math.round(1e3*I/o)} ms.`),this.nextAudioTs=L=ot-_,Z=ot);else if(I>=N*g&&U<Eb&&S){let it=Math.round(I/g);for(Z=ot-it*g;Z<0&&it&&g;)it--,Z+=g;X===0&&(this.nextAudioTs=L=Z-_),this.warn(`Injecting ${it} audio frames @ ${((Z-_)/o).toFixed(3)}s due to ${Math.round(1e3*I/o)} ms gap.`);for(let nt=0;nt<it;nt++){let at=pb.getSilentFrame(t.parsedCodec||t.manifestCodec||t.codec,t.channelCount);at||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),at=rt.unit.subarray()),A.splice(X,0,{unit:at,pts:Z}),Z+=g,X++}}rt.pts=Z,Z+=g}}let k=null,w=null,V,O=0,$=A.length;for(;$--;)O+=A[$].unit.byteLength;for(let N=0,X=A.length;N<X;N++){const Z=A[N],rt=Z.unit;let ot=Z.pts;if(w!==null){const U=E[N-1];U.duration=Math.round((ot-w)/h)}else if(s&&t.segmentCodec==="aac"&&(ot=L+_),k=ot,O>0){O+=b;try{V=new Uint8Array(O)}catch(U){this.observer.emit(x.ERROR,x.ERROR,{type:pt.MUX_ERROR,details:z.REMUX_ALLOC_ERROR,fatal:!1,error:U,bytes:O,reason:`fail allocating audio mdat ${O}`});return}v||(new DataView(V.buffer).setUint32(0,O),V.set(H.types.mdat,4))}else return;V.set(rt,b);const I=rt.byteLength;b+=I,E.push(ip(!0,d,I,0)),w=ot}const G=E.length;if(!G)return;const B=E[E.length-1];L=w-_,this.nextAudioTs=L+h*B.duration;const Q=v?new Uint8Array(0):H.moof(t.sequenceNumber++,k/h,jt({},t,{samples:E}));t.samples=[];const st=(k-_)/o,ut=this.nextAudioTs/o,lt={data1:Q,data2:V,startPTS:st,endPTS:ut,startDTS:st,endDTS:ut,type:"audio",hasAudio:!0,hasVideo:!1,nb:G};return this.isAudioContiguous=!0,lt}}function ti(u,t){let e;if(t===null)return u;for(t<u?e=-8589934592:e=8589934592;Math.abs(u-t)>4294967296;)u+=e;return u}function Ab(u){for(let t=0;t<u.length;t++)if(u[t].key)return t;return-1}function wy(u,t,e,s){const r=u.samples.length;if(!r)return;const a=u.inputTimeScale;for(let f=0;f<r;f++){const h=u.samples[f];h.pts=ti(h.pts-e.baseTime*a/e.timescale,t*a)/a,h.dts=ti(h.dts-s.baseTime*a/s.timescale,t*a)/a}const o=u.samples;return u.samples=[],{samples:o}}function Ny(u,t,e){const s=u.samples.length;if(!s)return;const r=u.inputTimeScale;for(let o=0;o<s;o++){const f=u.samples[o];f.pts=ti(f.pts-e.baseTime*r/e.timescale,t*r)/r}u.samples.sort((o,f)=>o.pts-f.pts);const a=u.samples;return u.samples=[],{samples:a}}class bb extends mi{constructor(t,e,s,r){super("passthrough-remuxer",r),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(t){this.lastEndTime=null;const e=this.initPTS;e&&t&&e.baseTime===t.baseTime&&e.timescale===t.timescale||(this.initPTS=t)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(t,e,s,r){this.audioCodec=e,this.videoCodec=s,this.generateInitSegment(t,r),this.emitInitSegment=!0}generateInitSegment(t,e){let{audioCodec:s,videoCodec:r}=this;if(!(t!=null&&t.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:a,video:o}=this.initData=Gp(t);if(e)fx(t,e);else{const h=a||o;h!=null&&h.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${h.codec}")!`)}a&&(s=sp(a,qt.AUDIO,this)),o&&(r=sp(o,qt.VIDEO,this));const f={};a&&o?f.audiovideo={container:"video/mp4",codec:s+","+r,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:t,id:"main"}:a?f.audio={container:"audio/mp4",codec:s,encrypted:a.encrypted,initSegment:t,id:"audio"}:o?f.video={container:"video/mp4",codec:r,supplemental:o.supplemental,encrypted:o.encrypted,initSegment:t,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=f}remux(t,e,s,r,a,o){var f,h;let{initPTS:d,lastEndTime:g}=this;const p={audio:void 0,video:void 0,text:r,id3:s,initSegment:void 0};ct(g)||(g=this.lastEndTime=a||0);const v=e.samples;if(!v.length)return p;const E={initPTS:void 0,timescale:void 0,trackId:void 0};let S=this.initData;if((f=S)!=null&&f.length||(this.generateInitSegment(v),S=this.initData),!((h=S)!=null&&h.length))return this.warn("Failed to generate initSegment."),p;this.emitInitSegment&&(E.tracks=this.initTracks,this.emitInitSegment=!1);const A=hx(v,S,this),b=S.audio?A[S.audio.id]:null,L=S.video?A[S.video.id]:null,_=Vl(L,1/0),D=Vl(b,1/0),k=Vl(L,0,!0),w=Vl(b,0,!0);let V=a,O=0;const $=b&&(!L||!d&&D<_||d&&d.trackId===S.audio.id),G=$?b:L;if(G){const Z=G.timescale,rt=G.start-a*Z,ot=$?S.audio.id:S.video.id;V=G.start/Z,O=$?w-D:k-_,(o||!d)&&(Lb(d,V,a,O)||Z!==d.timescale)&&(d&&this.warn(`Timestamps at playlist time: ${o?"":"~"}${a} ${rt/Z} != initPTS: ${d.baseTime/d.timescale} (${d.baseTime}/${d.timescale}) trackId: ${d.trackId}`),this.log(`Found initPTS at playlist time: ${a} offset: ${V-a} (${rt}/${Z}) trackId: ${ot}`),d=null,E.initPTS=rt,E.timescale=Z,E.trackId=ot)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${a}`);d?(E.initPTS=d.baseTime,E.timescale=d.timescale,E.trackId=d.trackId):((!E.timescale||E.trackId===void 0||E.initPTS===void 0)&&(this.warn("Could not set initPTS"),E.initPTS=V,E.timescale=1,E.trackId=-1),this.initPTS=d={baseTime:E.initPTS,timescale:E.timescale,trackId:E.trackId});const B=V-d.baseTime/d.timescale,Q=B+O;O>0?this.lastEndTime=Q:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const st=!!S.audio,ut=!!S.video;let dt="";st&&(dt+="audio"),ut&&(dt+="video");const lt=(S.audio?S.audio.encrypted:!1)||(S.video?S.video.encrypted:!1),N={data1:v,startPTS:B,startDTS:B,endPTS:Q,endDTS:Q,type:dt,hasAudio:st,hasVideo:ut,nb:1,dropped:0,encrypted:lt};p.audio=st&&!ut?N:void 0,p.video=ut?N:void 0;const X=L==null?void 0:L.sampleCount;if(X){const Z=L.keyFrameIndex,rt=Z!==-1;N.nb=X,N.dropped=Z===0||this.isVideoContiguous?0:rt?Z:X,N.independent=rt,N.firstKeyFrame=Z,rt&&L.keyFrameStart&&(N.firstKeyFramePTS=(L.keyFrameStart-d.baseTime)/d.timescale),this.isVideoContiguous||(p.independent=rt),this.isVideoContiguous||(this.isVideoContiguous=rt),N.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${Z}/${X} dropped: ${N.dropped} start: ${N.firstKeyFramePTS||"NA"}`)}return p.initSegment=E,p.id3=wy(s,a,d,d),r.samples.length&&(p.text=Ny(r,a,d)),p}}function Vl(u,t,e=!1){return(u==null?void 0:u.start)!==void 0?(u.start+(e?u.duration:0))/u.timescale:t}function Lb(u,t,e,s){if(u===null)return!0;const r=Math.max(s,1),a=t-u.baseTime/u.timescale;return Math.abs(a-e)>r}function sp(u,t,e){const s=u.codec;return s&&s.length>4?s:t===qt.AUDIO?s==="ec-3"||s==="ac-3"||s==="alac"?s:s==="fLaC"||s==="Opus"?co(s,!1):(e.warn(`Unhandled audio codec "${s}" in mp4 MAP`),s||"mp4a"):(e.warn(`Unhandled video codec "${s}" in mp4 MAP`),s||"avc1")}let rs;try{rs=self.performance.now.bind(self.performance)}catch{rs=Date.now}const ro=[{demux:cb,remux:bb},{demux:Ns,remux:no},{demux:ab,remux:no},{demux:ob,remux:no}];ro.splice(2,0,{demux:lb,remux:no});class np{constructor(t,e,s,r,a,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=t,this.typeSupported=e,this.config=s,this.id=a,this.logger=o}configure(t){this.transmuxConfig=t,this.decrypter&&this.decrypter.reset()}push(t,e,s,r){const a=s.transmuxing;a.executeStart=rs();let o=new Uint8Array(t);const{currentTransmuxState:f,transmuxConfig:h}=this;r&&(this.currentTransmuxState=r);const{contiguous:d,discontinuity:g,trackSwitch:p,accurateTimeOffset:v,timeOffset:E,initSegmentChange:S}=r||f,{audioCodec:A,videoCodec:b,defaultInitPts:L,duration:_,initSegmentData:D}=h,k=Rb(o,e);if(k&&nr(k.method)){const $=this.getDecrypter(),G=Gf(k.method);if($.isSync()){let B=$.softwareDecrypt(o,k.key.buffer,k.iv.buffer,G);if(s.part>-1){const st=$.flush();B=st&&st.buffer}if(!B)return a.executeEnd=rs(),Jc(s);o=new Uint8Array(B)}else return this.asyncResult=!0,this.decryptionPromise=$.webCryptoDecrypt(o,k.key.buffer,k.iv.buffer,G).then(B=>{const Q=this.push(B,null,s);return this.decryptionPromise=null,Q}),this.decryptionPromise}const w=this.needsProbing(g,p);if(w){const $=this.configureTransmuxer(o);if($)return this.logger.warn(`[transmuxer] ${$.message}`),this.observer.emit(x.ERROR,x.ERROR,{type:pt.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,fatal:!1,error:$,reason:$.message}),a.executeEnd=rs(),Jc(s)}(g||p||S||w)&&this.resetInitSegment(D,A,b,_,e),(g||S||w)&&this.resetInitialTimestamp(L),d||this.resetContiguity();const V=this.transmux(o,k,E,v,s);this.asyncResult=ya(V);const O=this.currentTransmuxState;return O.contiguous=!0,O.discontinuity=!1,O.trackSwitch=!1,a.executeEnd=rs(),V}flush(t){const e=t.transmuxing;e.executeStart=rs();const{decrypter:s,currentTransmuxState:r,decryptionPromise:a}=this;if(a)return this.asyncResult=!0,a.then(()=>this.flush(t));const o=[],{timeOffset:f}=r;if(s){const p=s.flush();p&&o.push(this.push(p.buffer,null,t))}const{demuxer:h,remuxer:d}=this;if(!h||!d){e.executeEnd=rs();const p=[Jc(t)];return this.asyncResult?Promise.resolve(p):p}const g=h.flush(f);return ya(g)?(this.asyncResult=!0,g.then(p=>(this.flushRemux(o,p,t),o))):(this.flushRemux(o,g,t),this.asyncResult?Promise.resolve(o):o)}flushRemux(t,e,s){const{audioTrack:r,videoTrack:a,id3Track:o,textTrack:f}=e,{accurateTimeOffset:h,timeOffset:d}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${s.sn}${s.part>-1?" part: "+s.part:""} of ${this.id===ht.MAIN?"level":"track"} ${s.level}`);const g=this.remuxer.remux(r,a,o,f,d,h,!0,this.id);t.push({remuxResult:g,chunkMeta:s}),s.transmuxing.executeEnd=rs()}resetInitialTimestamp(t){const{demuxer:e,remuxer:s}=this;!e||!s||(e.resetTimeStamp(t),s.resetTimeStamp(t))}resetContiguity(){const{demuxer:t,remuxer:e}=this;!t||!e||(t.resetContiguity(),e.resetNextTimestamp())}resetInitSegment(t,e,s,r,a){const{demuxer:o,remuxer:f}=this;!o||!f||(o.resetInitSegment(t,e,s,r),f.resetInitSegment(t,e,s,a))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(t,e,s,r,a){let o;return e&&e.method==="SAMPLE-AES"?o=this.transmuxSampleAes(t,e,s,r,a):o=this.transmuxUnencrypted(t,s,r,a),o}transmuxUnencrypted(t,e,s,r){const{audioTrack:a,videoTrack:o,id3Track:f,textTrack:h}=this.demuxer.demux(t,e,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(a,o,f,h,e,s,!1,this.id),chunkMeta:r}}transmuxSampleAes(t,e,s,r,a){return this.demuxer.demuxSampleAes(t,e,s).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,s,r,!1,this.id),chunkMeta:a}))}configureTransmuxer(t){const{config:e,observer:s,typeSupported:r}=this;let a;for(let p=0,v=ro.length;p<v;p++){var o;if((o=ro[p].demux)!=null&&o.probe(t,this.logger)){a=ro[p];break}}if(!a)return new Error("Failed to find demuxer by probing fragment data");const f=this.demuxer,h=this.remuxer,d=a.remux,g=a.demux;(!h||!(h instanceof d))&&(this.remuxer=new d(s,e,r,this.logger)),(!f||!(f instanceof g))&&(this.demuxer=new g(s,e,r,this.logger),this.probe=g.probe)}needsProbing(t,e){return!this.demuxer||!this.remuxer||t||e}getDecrypter(){let t=this.decrypter;return t||(t=this.decrypter=new Ff(this.config)),t}}function Rb(u,t){let e=null;return u.byteLength>0&&(t==null?void 0:t.key)!=null&&t.iv!==null&&t.method!=null&&(e=t),e}const Jc=u=>({remuxResult:{},chunkMeta:u});function ya(u){return"then"in u&&u.then instanceof Function}class _b{constructor(t,e,s,r,a){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=e,this.initSegmentData=s,this.duration=r,this.defaultInitPts=a||null}}class Db{constructor(t,e,s,r,a,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=t,this.contiguous=e,this.accurateTimeOffset=s,this.trackSwitch=r,this.timeOffset=a,this.initSegmentChange=o}}let rp=0;class Py{constructor(t,e,s,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=rp++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=h=>{const d=h.data,g=this.hls;if(!(!g||!(d!=null&&d.event)||d.instanceNo!==this.instanceNo))switch(d.event){case"init":{var p;const v=(p=this.workerContext)==null?void 0:p.objectURL;v&&self.URL.revokeObjectURL(v);break}case"transmuxComplete":{this.handleTransmuxComplete(d.data);break}case"flush":{this.onFlush(d.data);break}case"workerLog":{g.logger[d.data.logType]&&g.logger[d.data.logType](d.data.message);break}default:{d.data=d.data||{},d.data.frag=this.frag,d.data.part=this.part,d.data.id=this.id,g.trigger(d.event,d.data);break}}},this.onWorkerError=h=>{if(!this.hls)return;const d=new Error(`${h.message}  (${h.filename}:${h.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(x.ERROR,{type:pt.OTHER_ERROR,details:z.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:d})};const a=t.config;this.hls=t,this.id=e,this.useWorker=!!a.enableWorker,this.onTransmuxComplete=s,this.onFlush=r;const o=(h,d)=>{d=d||{},d.frag=this.frag||void 0,h===x.ERROR&&(d=d,d.parent=this.id,d.part=this.part,this.error=d.error),this.hls.trigger(h,d)};this.observer=new Kf,this.observer.on(x.FRAG_DECRYPTED,o),this.observer.on(x.ERROR,o);const f=Sm(a.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const h=this.hls.logger;if(a.workerPath||OA()){try{a.workerPath?(h.log(`loading Web Worker ${a.workerPath} for "${e}"`),this.workerContext=wA(a.workerPath)):(h.log(`injecting Web Worker for "${e}"`),this.workerContext=MA());const{worker:g}=this.workerContext;g.addEventListener("message",this.onWorkerMessage),g.addEventListener("error",this.onWorkerError),g.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:f,id:e,config:Xt(a)})}catch(g){h.warn(`Error setting up "${e}" Web Worker, fallback to inline`,g),this.terminateWorker(),this.error=null,this.transmuxer=new np(this.observer,f,a,"",e,t.logger)}return}}this.transmuxer=new np(this.observer,f,a,"",e,t.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const t=this.instanceNo;this.instanceNo=rp++;const e=this.hls.config,s=Sm(e.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:t,typeSupported:s,id:this.id,config:Xt(e)})}}terminateWorker(){if(this.workerContext){const{worker:t}=this.workerContext;this.workerContext=null,t.removeEventListener("message",this.onWorkerMessage),t.removeEventListener("error",this.onWorkerError),NA(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(t,e,s,r,a,o,f,h,d,g){var p,v;d.transmuxing.start=self.performance.now();const{instanceNo:E,transmuxer:S}=this,A=o?o.start:a.start,b=a.decryptdata,L=this.frag,_=!(L&&a.cc===L.cc),D=!(L&&d.level===L.level),k=L?d.sn-L.sn:-1,w=this.part?d.part-this.part.index:-1,V=k===0&&d.id>1&&d.id===(L==null?void 0:L.stats.chunkCount),O=!D&&(k===1||k===0&&(w===1||V&&w<=0)),$=self.performance.now();(D||k||a.stats.parsing.start===0)&&(a.stats.parsing.start=$),o&&(w||!O)&&(o.stats.parsing.start=$);const G=!(L&&((p=a.initSegment)==null?void 0:p.url)===((v=L.initSegment)==null?void 0:v.url)),B=new Db(_,O,h,D,A,G);if(!O||_||G){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${a.type} sn: ${d.sn}${d.part>-1?" part: "+d.part:""} ${this.id===ht.MAIN?"level":"track"}: ${d.level} id: ${d.id}
        discontinuity: ${_}
        trackSwitch: ${D}
        contiguous: ${O}
        accurateTimeOffset: ${h}
        timeOffset: ${A}
        initSegmentChange: ${G}`);const Q=new _b(s,r,e,f,g);this.configureTransmuxer(Q)}if(this.frag=a,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:E,cmd:"demux",data:t,decryptdata:b,chunkMeta:d,state:B},t instanceof ArrayBuffer?[t]:[]);else if(S){const Q=S.push(t,b,d,B);ya(Q)?Q.then(st=>{this.handleTransmuxComplete(st)}).catch(st=>{this.transmuxerError(st,d,"transmuxer-interface push error")}):this.handleTransmuxComplete(Q)}}flush(t){t.transmuxing.start=self.performance.now();const{instanceNo:e,transmuxer:s}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:e,cmd:"flush",chunkMeta:t});else if(s){const r=s.flush(t);ya(r)?r.then(a=>{this.handleFlushResult(a,t)}).catch(a=>{this.transmuxerError(a,t,"transmuxer-interface flush error")}):this.handleFlushResult(r,t)}}transmuxerError(t,e,s){this.hls&&(this.error=t,this.hls.trigger(x.ERROR,{type:pt.MEDIA_ERROR,details:z.FRAG_PARSING_ERROR,chunkMeta:e,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:t,err:t,reason:s}))}handleFlushResult(t,e){t.forEach(s=>{this.handleTransmuxComplete(s)}),this.onFlush(e)}configureTransmuxer(t){const{instanceNo:e,transmuxer:s}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:e,cmd:"configure",config:t}):s&&s.configure(t)}handleTransmuxComplete(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)}}const ap=100;class Ib extends zf{constructor(t,e,s){super(t,e,s,"audio-stream-controller",ht.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:t}=this;t.on(x.LEVEL_LOADED,this.onLevelLoaded,this),t.on(x.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(x.BUFFER_RESET,this.onBufferReset,this),t.on(x.BUFFER_CREATED,this.onBufferCreated,this),t.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(x.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(x.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(x.FRAG_LOADING,this.onFragLoading,this),t.on(x.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:t}=this;t&&(super.unregisterListeners(),t.off(x.LEVEL_LOADED,this.onLevelLoaded,this),t.off(x.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(x.BUFFER_RESET,this.onBufferReset,this),t.off(x.BUFFER_CREATED,this.onBufferCreated,this),t.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(x.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(x.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(x.FRAG_LOADING,this.onFragLoading,this),t.off(x.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(t,{frag:e,id:s,initPTS:r,timescale:a,trackId:o}){if(s===ht.MAIN){const f=e.cc,h=this.fragCurrent;if(this.initPTS[f]={baseTime:r,timescale:a,trackId:o},this.log(`InitPTS for cc: ${f} found from main: ${r/a} (${r}/${a}) trackId: ${o}`),this.mainAnchor=e,this.state===J.WAITING_INIT_PTS){const d=this.waitingData;(!d&&!this.loadingParts||d&&d.frag.cc!==f)&&this.syncWithAnchor(e,d==null?void 0:d.frag)}else!this.hls.hasEnoughToStart&&h&&h.cc!==f?(h.abortRequests(),this.syncWithAnchor(e,h)):this.state===J.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(t,e){var s;const r=((s=this.mainFragLoading)==null?void 0:s.frag)||null;if(e&&(r==null?void 0:r.cc)===e.cc)return;const a=(r||t).cc,o=this.getLevelDetails(),f=this.getLoadPosition(),h=Zp(o,a,f);h&&(this.log(`Syncing with main frag at ${h.start} cc ${h.cc}`),this.startFragRequested=!1,this.nextLoadPosition=h.start,this.resetLoadingState(),this.state===J.IDLE&&this.doTickIdle())}startLoad(t,e){if(!this.levels){this.startPosition=t,this.state=J.STOPPED;return}const s=this.lastCurrentTime;this.stopLoad(),this.setInterval(ap),s>0&&t===-1?(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),t=s,this.state=J.IDLE):this.state=J.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=t+this.timelineOffset,this.startPosition=e?-1:t,this.tick()}doTick(){switch(this.state){case J.IDLE:this.doTickIdle();break;case J.WAITING_TRACK:{const{levels:t,trackId:e}=this,s=t==null?void 0:t[e],r=s==null?void 0:s.details;if(r&&!this.waitForLive(s)){if(this.waitForCdnTuneIn(r))break;this.state=J.WAITING_INIT_PTS}break}case J.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case J.WAITING_INIT_PTS:{const t=this.waitingData;if(t){const{frag:e,part:s,cache:r,complete:a}=t,o=this.mainAnchor;if(this.initPTS[e.cc]!==void 0){this.waitingData=null,this.state=J.FRAG_LOADING;const f=r.flush().buffer,h={frag:e,part:s,payload:f,networkDetails:null};this._handleFragmentLoadProgress(h),a&&super._handleFragmentLoadComplete(h)}else o&&o.cc!==t.frag.cc&&this.syncWithAnchor(o,t.frag)}else this.state=J.IDLE}}this.onTickEnd()}resetLoadingState(){const t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:t}=this;t!=null&&t.readyState&&(this.lastCurrentTime=t.currentTime)}doTickIdle(){var t;const{hls:e,levels:s,media:r,trackId:a}=this,o=e.config;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(s!=null&&s[a]))return;const f=s[a],h=f.details;if(!h||this.waitForLive(f)||this.waitForCdnTuneIn(h)){this.state=J.WAITING_TRACK,this.startFragRequested=!1;return}const d=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&d&&(this.bufferFlushed=!1,this.afterBufferFlushed(d,qt.AUDIO,ht.AUDIO));const g=this.getFwdBufferInfo(d,ht.AUDIO);if(g===null)return;if(!this.switchingTrack&&this._streamEnded(g,h)){e.trigger(x.BUFFER_EOS,{type:"audio"}),this.state=J.ENDED;return}const p=g.len,v=e.maxBufferLength,E=h.fragments,S=E[0].start,A=this.getLoadPosition(),b=this.flushing?A:g.end;if(this.switchingTrack&&r){const D=A;h.PTSKnown&&D<S&&(g.end>S||g.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=S+.05)}if(p>=v&&!this.switchingTrack&&b<E[E.length-1].start)return;let L=this.getNextFragment(b,h);if(L&&this.isLoopLoading(L,b)&&(L=this.getNextFragmentLoopLoading(L,h,g,ht.MAIN,v)),!L){this.bufferFlushed=!0;return}let _=((t=this.mainFragLoading)==null?void 0:t.frag)||null;if(!this.audioOnly&&this.startFragRequested&&_&&le(L)&&!L.endList&&(!h.live||!this.loadingParts&&b<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(_)===ge.OK&&(this.mainFragLoading=_=null),_&&le(_))){if(L.start>_.end){const k=this.fragmentTracker.getFragAtPos(b,ht.MAIN);k&&k.end>_.end&&(_=k,this.mainFragLoading={frag:k,targetBufferTime:null})}if(L.start>_.end)return}this.loadFragment(L,f,b)}onMediaDetaching(t,e){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(t,e)}onAudioTracksUpdated(t,{audioTracks:e}){this.resetTransmuxer(),this.levels=e.map(s=>new ga(s))}onAudioTrackSwitching(t,e){const s=!!e.url;this.trackId=e.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),s?(this.switchingTrack=e,this.flushAudioIfNeeded(e),this.state!==J.STOPPED&&(this.setInterval(ap),this.state=J.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=e,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(t,e){this.mainDetails=e.details;const s=this.cachedTrackLoadedData;s&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(x.AUDIO_TRACK_LOADED,s))}onAudioTrackLoaded(t,e){var s;const{levels:r}=this,{details:a,id:o,groupId:f,track:h}=e;if(!r){this.warn(`Audio tracks reset while loading track ${o} "${h.name}" of "${f}"`);return}const d=this.mainDetails;if(!d||a.endCC>d.endCC||d.expired){this.cachedTrackLoadedData=e,this.state!==J.STOPPED&&(this.state=J.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${h.name}" of "${f}" loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`);const g=r[o];let p=0;if(a.live||(s=g.details)!=null&&s.live){if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;if(g.details){var v;p=this.alignPlaylists(a,g.details,(v=this.levelLastLoaded)==null?void 0:v.details)}a.alignedSliding||(py(a,d),a.alignedSliding||vo(a,d),p=a.fragmentStart)}g.details=a,this.levelLastLoaded=g,this.startFragRequested||this.setStartPosition(d,p),this.hls.trigger(x.AUDIO_TRACK_UPDATED,{details:a,id:o,groupId:e.groupId}),this.state===J.WAITING_TRACK&&!this.waitForCdnTuneIn(a)&&(this.state=J.IDLE),this.tick()}_handleFragmentLoadProgress(t){var e;const s=t.frag,{part:r,payload:a}=t,{config:o,trackId:f,levels:h}=this;if(!h){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const d=h[f];if(!d){this.warn("Audio track is undefined on fragment load progress");return}const g=d.details;if(!g){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(s.start);return}const p=o.defaultAudioCodec||d.audioCodec||"mp4a.40.2";let v=this.transmuxer;v||(v=this.transmuxer=new Py(this.hls,ht.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const E=this.initPTS[s.cc],S=(e=s.initSegment)==null?void 0:e.data;if(E!==void 0){const b=r?r.index:-1,L=b!==-1,_=new $f(s.level,s.sn,s.stats.chunkCount,a.byteLength,b,L);v.push(a,S,p,"",s,r,g.totalduration,!1,_,E)}else{this.log(`Unknown video PTS for cc ${s.cc}, waiting for video PTS before demuxing audio frag ${s.sn} of [${g.startSN} ,${g.endSN}],track ${f}`);const{cache:A}=this.waitingData=this.waitingData||{frag:s,part:r,cache:new yy,complete:!1};A.push(new Uint8Array(a)),this.state!==J.STOPPED&&(this.state=J.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(t){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(t)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(t,e){this.bufferFlushed=this.flushing=!1;const s=e.tracks.audio;s&&(this.mediaBuffer=s.buffer||null)}onFragLoading(t,e){!this.audioOnly&&e.frag.type===ht.MAIN&&le(e.frag)&&(this.mainFragLoading=e,this.state===J.IDLE&&this.tick())}onFragBuffered(t,e){const{frag:s,part:r}=e;if(s.type!==ht.AUDIO){!this.audioOnly&&s.type===ht.MAIN&&!s.elementaryStreams.video&&!s.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${r?" p: "+r.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(le(s)){this.fragPrevious=s;const a=this.switchingTrack;a&&(this.bufferedTrack=a,this.switchingTrack=null,this.hls.trigger(x.AUDIO_TRACK_SWITCHED,$t({},a)))}this.fragBufferedComplete(s,r),this.media&&this.tick()}onError(t,e){var s;if(e.fatal){this.state=J.ERROR;return}switch(e.details){case z.FRAG_GAP:case z.FRAG_PARSING_ERROR:case z.FRAG_DECRYPT_ERROR:case z.FRAG_LOAD_ERROR:case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_ERROR:case z.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ht.AUDIO,e);break;case z.AUDIO_TRACK_LOAD_ERROR:case z.AUDIO_TRACK_LOAD_TIMEOUT:case z.LEVEL_PARSING_ERROR:!e.levelRetry&&this.state===J.WAITING_TRACK&&((s=e.context)==null?void 0:s.type)===Rt.AUDIO_TRACK&&(this.state=J.IDLE);break;case z.BUFFER_ADD_CODEC_ERROR:case z.BUFFER_APPEND_ERROR:if(e.parent!=="audio")return;this.reduceLengthAndFlushBuffer(e)||this.resetLoadingState();break;case z.BUFFER_FULL_ERROR:if(e.parent!=="audio")return;this.reduceLengthAndFlushBuffer(e)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case z.INTERNAL_EXCEPTION:this.recoverWorkerError(e);break}}onBufferFlushing(t,{type:e}){e!==qt.VIDEO&&(this.flushing=!0)}onBufferFlushed(t,{type:e}){if(e!==qt.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===J.ENDED&&(this.state=J.IDLE);const s=this.mediaBuffer||this.media;s&&(this.afterBufferFlushed(s,e,ht.AUDIO),this.tick())}}_handleTransmuxComplete(t){var e;const s="audio",{hls:r}=this,{remuxResult:a,chunkMeta:o}=t,f=this.getCurrentContext(o);if(!f){this.resetWhenMissingContext(o);return}const{frag:h,part:d,level:g}=f,{details:p}=g,{audio:v,text:E,id3:S,initSegment:A}=a;if(this.fragContextChanged(h)||!p){this.fragmentTracker.removeFragment(h);return}if(this.state=J.PARSING,this.switchingTrack&&v&&this.completeAudioSwitch(this.switchingTrack),A!=null&&A.tracks){const b=h.initSegment||h;if(this.unhandledEncryptionError(A,h))return;this._bufferInitSegment(g,A.tracks,b,o),r.trigger(x.FRAG_PARSING_INIT_SEGMENT,{frag:b,id:s,tracks:A.tracks})}if(v){const{startPTS:b,endPTS:L,startDTS:_,endDTS:D}=v;d&&(d.elementaryStreams[qt.AUDIO]={startPTS:b,endPTS:L,startDTS:_,endDTS:D}),h.setElementaryStreamInfo(qt.AUDIO,b,L,_,D),this.bufferFragmentData(v,h,d,o)}if(S!=null&&(e=S.samples)!=null&&e.length){const b=jt({id:s,frag:h,details:p},S);r.trigger(x.FRAG_PARSING_METADATA,b)}if(E){const b=jt({id:s,frag:h,details:p},E);r.trigger(x.FRAG_PARSING_USERDATA,b)}}_bufferInitSegment(t,e,s,r){if(this.state!==J.PARSING||(e.video&&delete e.video,e.audiovideo&&delete e.audiovideo,!e.audio))return;const a=e.audio;a.id=ht.AUDIO;const o=t.audioCodec;this.log(`Init audio buffer, container:${a.container}, codecs[level/parsed]=[${o}/${a.codec}]`),o&&o.split(",").length===1&&(a.levelCodec=o),this.hls.trigger(x.BUFFER_CODECS,e);const f=a.initSegment;if(f!=null&&f.byteLength){const h={type:"audio",frag:s,part:null,chunkMeta:r,parent:s.type,data:f};this.hls.trigger(x.BUFFER_APPENDING,h)}this.tickImmediate()}loadFragment(t,e,s){const r=this.fragmentTracker.getState(t);if(this.switchingTrack||r===ge.NOT_LOADED||r===ge.PARTIAL){var a;if(!le(t))this._loadInitSegment(t,e);else if((a=e.details)!=null&&a.live&&!this.initPTS[t.cc]){this.log(`Waiting for video PTS in continuity counter ${t.cc} of live stream before loading audio fragment ${t.sn} of level ${this.trackId}`),this.state=J.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==e.details.fragmentStart&&vo(e.details,o)}else super.loadFragment(t,e,s)}else this.clearTrackerIfNeeded(t)}flushAudioIfNeeded(t){if(this.media&&this.bufferedTrack){const{name:e,lang:s,assocLang:r,characteristics:a,audioCodec:o,channels:f}=this.bufferedTrack;on({name:e,lang:s,assocLang:r,characteristics:a,audioCodec:o,channels:f},t,ln)||(ho(t.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=t)}}completeAudioSwitch(t){const{hls:e}=this;this.flushAudioIfNeeded(t),this.bufferedTrack=t,this.switchingTrack=null,e.trigger(x.AUDIO_TRACK_SWITCHED,$t({},t))}}class Wf extends mi{constructor(t,e){super(e,t.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=t}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(t,e,s){const r=e==null?void 0:e.renditionReports;if(r){let a=-1;for(let o=0;o<r.length;o++){const f=r[o];let h;try{h=new self.URL(f.URI,e.url).href}catch(d){this.warn(`Could not construct new URL for Rendition Report: ${d}`),h=f.URI||""}if(h===t){a=o;break}else h===t.substring(0,h.length)&&(a=o)}if(a!==-1){const o=r[a],f=parseInt(o["LAST-MSN"])||e.lastPartSn;let h=parseInt(o["LAST-PART"])||e.lastPartIndex;if(this.hls.config.lowLatencyMode){const g=Math.min(e.age-e.partTarget,e.targetduration);h>=0&&g>e.partTarget&&(h+=1)}const d=s&&Tm(s);return new xm(f,h>=0?h:void 0,d)}}}loadPlaylist(t){this.clearTimer()}loadingPlaylist(t,e){this.clearTimer()}shouldLoadPlaylist(t){return this.canLoad&&!!t&&!!t.url&&(!t.details||t.details.live)}getUrlWithDirectives(t,e){if(e)try{return e.addDirectives(t)}catch(s){this.warn(`Could not construct new URL with HLS Delivery Directives: ${s}`)}return t}playlistLoaded(t,e,s){const{details:r,stats:a}=e,o=self.performance.now(),f=a.loading.first?Math.max(0,o-a.loading.first):0;r.advancedDateTime=Date.now()-f;const h=this.hls.config.timelineOffset;if(h!==r.appliedTimelineOffset){const g=Math.max(h||0,0);r.appliedTimelineOffset=g,r.fragments.forEach(p=>{p.setStart(p.playlistOffset+g)})}if(r.live||s!=null&&s.live){const g="levelInfo"in e?e.levelInfo:e.track;if(r.reloaded(s),s&&r.fragments.length>0){TA(s,r,this);const _=r.playlistParsingError;if(_){this.warn(_);const D=this.hls;if(!D.config.ignorePlaylistParsingErrors){var d;const{networkDetails:k}=e;D.trigger(x.ERROR,{type:pt.NETWORK_ERROR,details:z.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:_,reason:_.message,level:e.level||void 0,parent:(d=r.fragments[0])==null?void 0:d.type,networkDetails:k,stats:a});return}r.playlistParsingError=null}}r.requestScheduled===-1&&(r.requestScheduled=a.loading.start);const p=this.hls.mainForwardBufferInfo,v=p?p.end-p.len:0,E=(r.edge-v)*1e3,S=fy(r,E);if(r.requestScheduled+S<o?r.requestScheduled=o:r.requestScheduled+=S,this.log(`live playlist ${t} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),!this.canLoad||!r.live)return;let A,b,L;if(r.canBlockReload&&r.endSN&&r.advanced){const _=this.hls.config.lowLatencyMode,D=r.lastPartSn,k=r.endSN,w=r.lastPartIndex,V=w!==-1,O=D===k;V?O?(b=k+1,L=_?0:w):(b=D,L=_?w+1:r.maxPartIndex):b=k+1;const $=r.age,G=$+r.ageHeader;let B=Math.min(G-r.partTarget,r.targetduration*1.5);if(B>0){if(G>r.targetduration*3)this.log(`Playlist last advanced ${$.toFixed(2)}s ago. Omitting segment and part directives.`),b=void 0,L=void 0;else if(s!=null&&s.tuneInGoal&&G-r.partTarget>s.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${s.tuneInGoal} to: ${B} with playlist age: ${r.age}`),B=0;else{const Q=Math.floor(B/r.targetduration);if(b+=Q,L!==void 0){const st=Math.round(B%r.targetduration/r.partTarget);L+=st}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${$.toFixed(2)}s goal: ${B} skip sn ${Q} to part ${L}`)}r.tuneInGoal=B}if(A=this.getDeliveryDirectives(r,e.deliveryDirectives,b,L),_||!O){r.requestScheduled=o,this.loadingPlaylist(g,A);return}}else(r.canBlockReload||r.canSkipUntil)&&(A=this.getDeliveryDirectives(r,e.deliveryDirectives,b,L));A&&b!==void 0&&r.canBlockReload&&(r.requestScheduled=a.loading.first+Math.max(S-f*2,S/2)),this.scheduleLoading(g,A,r)}else this.clearTimer()}scheduleLoading(t,e,s){const r=s||t.details;if(!r){this.loadingPlaylist(t,e);return}const a=self.performance.now(),o=r.requestScheduled;if(a>=o){this.loadingPlaylist(t,e);return}const f=o-a;this.log(`reload live playlist ${t.name||t.bitrate+"bps"} in ${Math.round(f)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(t,e),f)}getDeliveryDirectives(t,e,s,r){let a=Tm(t);return e!=null&&e.skip&&t.deltaUpdateFailed&&(s=e.msn,r=e.part,a=io.No),new xm(s,r,a)}checkRetry(t){const e=t.details,s=go(t),r=t.errorAction,{action:a,retryCount:o=0,retryConfig:f}=r||{},h=!!r&&!!f&&(a===Le.RetryRequest||!r.resolved&&a===Le.SendAlternateToPenaltyBox);if(h){var d;if(o>=f.maxNumRetry)return!1;if(s&&(d=t.context)!=null&&d.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${f.maxNumRetry} after "${e}" without delivery-directives`),this.loadPlaylist();else{const g=Bf(f,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),g),this.warn(`Retrying playlist loading ${o+1}/${f.maxNumRetry} after "${e}" in ${g}ms`)}t.levelRetry=!0,r.resolved=!0}return h}}function Uy(u,t){if(u.length!==t.length)return!1;for(let e=0;e<u.length;e++)if(!va(u[e].attrs,t[e].attrs))return!1;return!0}function va(u,t,e){const s=u["STABLE-RENDITION-ID"];return s&&!e?s===t["STABLE-RENDITION-ID"]:!(e||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>u[r]!==t[r])}function bf(u,t){return t.label.toLowerCase()===u.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(u.lang||"").toLowerCase())}class Cb extends Wf{constructor(t){super(t,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:t}=this;t.on(x.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.MANIFEST_PARSED,this.onManifestParsed,this),t.on(x.LEVEL_LOADING,this.onLevelLoading,this),t.on(x.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(x.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.MANIFEST_PARSED,this.onManifestParsed,this),t.off(x.LEVEL_LOADING,this.onLevelLoading,this),t.off(x.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(x.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(x.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(t,e){this.tracks=e.audioTracks||[]}onAudioTrackLoaded(t,e){const{id:s,groupId:r,details:a}=e,o=this.tracksInGroup[s];if(!o||o.groupId!==r){this.warn(`Audio track with id:${s} and group:${r} not found in active group ${o==null?void 0:o.groupId}`);return}const f=o.details;o.details=e.details,this.log(`Audio track ${s} "${o.name}" lang:${o.lang} group:${r} loaded [${a.startSN}-${a.endSN}]`),s===this.trackId&&this.playlistLoaded(s,e,f)}onLevelLoading(t,e){this.switchLevel(e.level)}onLevelSwitching(t,e){this.switchLevel(e.level)}switchLevel(t){const e=this.hls.levels[t];if(!e)return;const s=e.audioGroups||null,r=this.groupIds;let a=this.currentTrack;if(!s||(r==null?void 0:r.length)!==(s==null?void 0:s.length)||s!=null&&s.some(f=>(r==null?void 0:r.indexOf(f))===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const f=this.tracks.filter(v=>!s||s.indexOf(v.groupId)!==-1);if(f.length)this.selectDefaultTrack&&!f.some(v=>v.default)&&(this.selectDefaultTrack=!1),f.forEach((v,E)=>{v.id=E});else if(!a&&!this.tracksInGroup.length)return;this.tracksInGroup=f;const h=this.hls.config.audioPreference;if(!a&&h){const v=Mi(h,f,ln);if(v>-1)a=f[v];else{const E=Mi(h,this.tracks);a=this.tracks[E]}}let d=this.findTrackId(a);d===-1&&a&&(d=this.findTrackId(null));const g={audioTracks:f};this.log(`Updating audio tracks, ${f.length} track(s) found in group(s): ${s==null?void 0:s.join(",")}`),this.hls.trigger(x.AUDIO_TRACKS_UPDATED,g);const p=this.trackId;if(d!==-1&&p===-1)this.setAudioTrack(d);else if(f.length&&p===-1){var o;const v=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${f.length}`);this.warn(v.message),this.hls.trigger(x.ERROR,{type:pt.MEDIA_ERROR,details:z.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:v})}}}onError(t,e){e.fatal||!e.context||e.context.type===Rt.AUDIO_TRACK&&e.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(e.context.groupId)!==-1)&&this.checkRetry(e)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}setAudioOption(t){const e=this.hls;if(e.config.audioPreference=t,t){const s=this.allAudioTracks;if(this.selectDefaultTrack=!1,s.length){const r=this.currentTrack;if(r&&on(t,r,ln))return r;const a=Mi(t,this.tracksInGroup,ln);if(a>-1){const o=this.tracksInGroup[a];return this.setAudioTrack(a),o}else if(r){let o=e.loadLevel;o===-1&&(o=e.firstAutoLevel);const f=Hx(t,e.levels,s,o,ln);if(f===-1)return null;e.nextLoadLevel=f}if(t.channels||t.audioCodec){const o=Mi(t,s);if(o>-1)return s[o]}}}return null}setAudioTrack(t){const e=this.tracksInGroup;if(t<0||t>=e.length){this.warn(`Invalid audio track id: ${t}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,r=e[t],a=r.details&&!r.details.live;if(t===this.trackId&&r===s&&a||(this.log(`Switching to audio-track ${t} "${r.name}" lang:${r.lang} group:${r.groupId} channels:${r.channels}`),this.trackId=t,this.currentTrack=r,this.hls.trigger(x.AUDIO_TRACK_SWITCHING,$t({},r)),a))return;const o=this.switchParams(r.url,s==null?void 0:s.details,r.details);this.loadPlaylist(o)}findTrackId(t){const e=this.tracksInGroup;for(let s=0;s<e.length;s++){const r=e[s];if(!(this.selectDefaultTrack&&!r.default)&&(!t||on(t,r,ln)))return s}if(t){const{name:s,lang:r,assocLang:a,characteristics:o,audioCodec:f,channels:h}=t;for(let d=0;d<e.length;d++){const g=e[d];if(on({name:s,lang:r,assocLang:a,characteristics:o,audioCodec:f,channels:h},g,ln))return d}for(let d=0;d<e.length;d++){const g=e[d];if(va(t.attrs,g.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return d}for(let d=0;d<e.length;d++){const g=e[d];if(va(t.attrs,g.attrs,["LANGUAGE"]))return d}}return-1}loadPlaylist(t){super.loadPlaylist();const e=this.currentTrack;this.shouldLoadPlaylist(e)&&ho(e.url,this.hls)&&this.scheduleLoading(e,t)}loadingPlaylist(t,e){super.loadingPlaylist(t,e);const s=t.id,r=t.groupId,a=this.getUrlWithDirectives(t.url,e),o=t.details,f=o==null?void 0:o.age;this.log(`Loading audio-track ${s} "${t.name}" lang:${t.lang} group:${r}${(e==null?void 0:e.msn)!==void 0?" at sn "+e.msn+" part "+e.part:""}${f&&o.live?" age "+f.toFixed(1)+(o.type&&" "+o.type||""):""} ${a}`),this.hls.trigger(x.AUDIO_TRACK_LOADING,{url:a,id:s,groupId:r,deliveryDirectives:e||null,track:t})}}class kb{constructor(t){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=t}destroy(){this.tracks=this.queues=null}append(t,e,s){if(this.queues===null||this.tracks===null)return;const r=this.queues[e];r.push(t),r.length===1&&!s&&this.executeNext(e)}appendBlocker(t){return new Promise(e=>{const s={label:"async-blocker",execute:e,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(s,t)})}prependBlocker(t){return new Promise(e=>{if(this.queues){const s={label:"async-blocker-prepend",execute:e,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[t].unshift(s)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(t=>{var e;const s=(e=t[0])==null?void 0:e.label;(s==="async-blocker"||s==="async-blocker-prepend")&&(t[0].execute(),t.splice(0,1))})}unblockAudio(t){if(this.queues===null)return;this.queues.audio[0]===t&&this.shiftAndExecuteNext("audio")}executeNext(t){if(this.queues===null||this.tracks===null)return;const e=this.queues[t];if(e.length){const r=e[0];try{r.execute()}catch(a){var s;if(r.onError(a),this.queues===null||this.tracks===null)return;const o=(s=this.tracks[t])==null?void 0:s.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(t)}}}shiftAndExecuteNext(t){this.queues!==null&&(this.queues[t].shift(),this.executeNext(t))}current(t){var e;return((e=this.queues)==null?void 0:e[t][0])||null}toString(){const{queues:t,tracks:e}=this;return t===null||e===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(t){var e,s;return(e=this.queues)!=null&&e[t]||(s=this.tracks)!=null&&s[t]?`${t}: (${this.listSbInfo(t)}) ${this.listOps(t)}`:""}listSbInfo(t){var e;const s=(e=this.tracks)==null?void 0:e[t],r=s==null?void 0:s.buffer;return r?`SourceBuffer${r.updating?" updating":""}${s.ended?" ended":""}${s.ending?" ending":""}`:"none"}listOps(t){var e;return((e=this.queues)==null?void 0:e[t].map(s=>s.label).join(", "))||""}}const lp=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,By="HlsJsTrackRemovedError";class Ob extends Error{constructor(t){super(t),this.name=By}}class Mb extends mi{constructor(t,e){super("buffer-controller",t.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=s=>{var r;this.hls&&((r=this.mediaSource)==null?void 0:r.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=s=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=s=>{const{media:r,mediaSource:a}=this;s&&this.log("Media source opened"),!(!r||!a)&&(a.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(x.MEDIA_ATTACHED,{media:r,mediaSource:a}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:s,_objectUrl:r}=this;s!==r&&this.error(`Media element src was set while attaching MediaSource (${r} > ${s})`)},this.hls=t,this.fragmentTracker=e,this.appendSource=ex(Us(t.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:t}=this;t.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(x.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.MANIFEST_PARSED,this.onManifestParsed,this),t.on(x.BUFFER_RESET,this.onBufferReset,this),t.on(x.BUFFER_APPENDING,this.onBufferAppending,this),t.on(x.BUFFER_CODECS,this.onBufferCodecs,this),t.on(x.BUFFER_EOS,this.onBufferEos,this),t.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(x.FRAG_PARSED,this.onFragParsed,this),t.on(x.FRAG_CHANGED,this.onFragChanged,this),t.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(x.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.MANIFEST_PARSED,this.onManifestParsed,this),t.off(x.BUFFER_RESET,this.onBufferReset,this),t.off(x.BUFFER_APPENDING,this.onBufferAppending,this),t.off(x.BUFFER_CODECS,this.onBufferCodecs,this),t.off(x.BUFFER_EOS,this.onBufferEos,this),t.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(x.FRAG_PARSED,this.onFragParsed,this),t.off(x.FRAG_CHANGED,this.onFragChanged,this),t.off(x.ERROR,this.onError,this)}transferMedia(){const{media:t,mediaSource:e}=this;if(!t)return null;const s={};if(this.operationQueue){const a=this.isUpdating();a||this.operationQueue.removeBlockers();const o=this.isQueued();(a||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${a?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===e?jt(s,r.tracks):this.sourceBuffers.forEach(a=>{const[o]=a;o&&(s[o]=jt({},this.tracks[o]),this.removeBuffer(o)),a[0]=a[1]=null}),{media:t,mediaSource:e,tracks:s}}initTracks(){const t={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=t,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(t,e){var s;let r=2;(e.audio&&!e.video||!e.altAudio)&&(r=1),this.bufferCodecEventsTotal=r,this.log(`${r} bufferCodec event(s) expected.`),(s=this.transferData)!=null&&s.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(t,e){const s=this.media=e.media;this.transferData=this.overrides=void 0;const r=Us(this.appendSource);if(r){const a=!!e.mediaSource;(a||e.overrides)&&(this.transferData=e,this.overrides=e.overrides);const o=this.mediaSource=e.mediaSource||new r;if(this.assignMediaSource(o),a)this._objectUrl=s.src,this.attachTransferred();else{const f=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{s.removeAttribute("src");const h=self.ManagedMediaSource;s.disableRemotePlayback=s.disableRemotePlayback||h&&o instanceof h,op(s),wb(s,f),s.load()}catch{s.src=f}else s.src=f}s.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(t){var e,s;this.log(`${((e=this.transferData)==null?void 0:e.mediaSource)===t?"transferred":"created"} media source: ${(s=t.constructor)==null?void 0:s.name}`),t.addEventListener("sourceopen",this._onMediaSourceOpen),t.addEventListener("sourceended",this._onMediaSourceEnded),t.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(t.addEventListener("startstreaming",this._onStartStreaming),t.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const t=this.media,e=this.transferData;if(!e||!t)return;const s=this.tracks,r=e.tracks,a=r?Object.keys(r):null,o=a?a.length:0,f=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(r&&a&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Xt(s,(h,d)=>h==="initSegment"?void 0:d)};
transfer tracks: ${Xt(r,(h,d)=>h==="initSegment"?void 0:d)}}`),!wp(r,s)){e.mediaSource=null,e.tracks=void 0;const h=t.currentTime,d=this.details,g=Math.max(h,(d==null?void 0:d.fragments[0].start)||0);if(g-h>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${h} -> ${g}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(r)}"->"${Object.keys(s)}") start time: ${g} currentTime: ${h}`),this.onMediaDetaching(x.MEDIA_DETACHING,{}),this.onMediaAttaching(x.MEDIA_ATTACHING,e),t.currentTime=g;return}this.transferData=void 0,a.forEach(h=>{const d=h,g=r[d];if(g){const p=g.buffer;if(p){const v=this.fragmentTracker,E=g.id;if(v.hasFragments(E)||v.hasParts(E)){const b=Tt.getBuffered(p);v.detectEvictedFragments(d,b,E,null,!0)}const S=tf(d),A=[d,p];this.sourceBuffers[S]=A,p.updating&&this.operationQueue&&this.operationQueue.prependBlocker(d),this.trackSourceBuffer(d,g)}}}),f(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),f()}get mediaSourceOpenOrEnded(){var t;const e=(t=this.mediaSource)==null?void 0:t.readyState;return e==="open"||e==="ended"}onMediaDetaching(t,e){const s=!!e.transferMedia;this.transferData=this.overrides=void 0;const{media:r,mediaSource:a,_objectUrl:o}=this;if(a){if(this.log(`media source ${s?"transferring":"detaching"}`),s)this.sourceBuffers.forEach(([f])=>{f&&this.removeBuffer(f)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const f=a.readyState==="open";try{const h=a.sourceBuffers;for(let d=h.length;d--;)f&&h[d].abort(),a.removeSourceBuffer(h[d]);f&&a.endOfStream()}catch(h){this.warn(`onMediaDetaching: ${h.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}a.removeEventListener("sourceopen",this._onMediaSourceOpen),a.removeEventListener("sourceended",this._onMediaSourceEnded),a.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(a.removeEventListener("startstreaming",this._onStartStreaming),a.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),s||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(r.removeAttribute("src"),this.appendSource&&op(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(x.MEDIA_DETACHED,e)}onBufferReset(){this.sourceBuffers.forEach(([t])=>{t&&this.resetBuffer(t)}),this.initTracks()}resetBuffer(t){var e;const s=(e=this.tracks[t])==null?void 0:e.buffer;if(this.removeBuffer(t),s)try{var r;(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(s)}catch(a){this.warn(`onBufferReset ${t}`,a)}delete this.tracks[t]}removeBuffer(t){this.removeBufferListeners(t),this.sourceBuffers[tf(t)]=[null,null];const e=this.tracks[t];e&&(e.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new kb(this.tracks)}onBufferCodecs(t,e){var s;const r=this.tracks,a=Object.keys(e);this.log(`BUFFER_CODECS: "${a}" (current SB count ${this.sourceBufferCount})`);const o="audiovideo"in e&&(r.audio||r.video)||r.audiovideo&&("audio"in e||"video"in e),f=!o&&this.sourceBufferCount&&this.media&&a.some(h=>!r[h]);if(o||f){this.warn(`Unsupported transition between "${Object.keys(r)}" and "${a}" SourceBuffers`);return}a.forEach(h=>{var d,g;const p=e[h],{id:v,codec:E,levelCodec:S,container:A,metadata:b,supplemental:L}=p;let _=r[h];const D=(d=this.transferData)==null||(d=d.tracks)==null?void 0:d[h],k=D!=null&&D.buffer?D:_,w=(k==null?void 0:k.pendingCodec)||(k==null?void 0:k.codec),V=k==null?void 0:k.levelCodec;_||(_=r[h]={buffer:void 0,listeners:[],codec:E,supplemental:L,container:A,levelCodec:S,metadata:b,id:v});const O=eo(w,V),$=O==null?void 0:O.replace(lp,"$1");let G=eo(E,S);const B=(g=G)==null?void 0:g.replace(lp,"$1");G&&O&&$!==B&&(h.slice(0,5)==="audio"&&(G=co(G,this.appendSource)),this.log(`switching codec ${w} to ${G}`),G!==(_.pendingCodec||_.codec)&&(_.pendingCodec=G),_.container=A,this.appendChangeType(h,A,G))}),(this.tracksReady||this.sourceBufferCount)&&(e.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!e.video&&((s=e.audio)==null?void 0:s.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((t,e)=>{const s=this.tracks[e];return t[e]={id:s.id,container:s.container,codec:s.codec,levelCodec:s.levelCodec},t},{})}appendChangeType(t,e,s){const r=`${e};codecs=${s}`,a={label:`change-type=${r}`,execute:()=>{const o=this.tracks[t];if(o){const f=o.buffer;f!=null&&f.changeType&&(this.log(`changing ${t} sourceBuffer type to ${r}`),f.changeType(r),o.codec=s,o.container=e)}this.shiftAndExecuteNext(t)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${t} SourceBuffer type`,o)}};this.append(a,t,this.isPending(this.tracks[t]))}blockAudio(t){var e;const s=t.start,r=s+t.duration*.05;if(((e=this.fragmentTracker.getAppendedFrag(s,ht.MAIN))==null?void 0:e.gap)===!0)return;const o={label:"block-audio",execute:()=>{var f;const h=this.tracks.video;(this.lastVideoAppendEnd>r||h!=null&&h.buffer&&Tt.isBuffered(h.buffer,r)||((f=this.fragmentTracker.getAppendedFrag(r,ht.MAIN))==null?void 0:f.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:f=>{this.warn("Error executing block-audio operation",f)}};this.blockedAudioAppend={op:o,frag:t},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:t,operationQueue:e}=this;t&&e&&(this.blockedAudioAppend=null,e.unblockAudio(t.op))}onBufferAppending(t,e){const{tracks:s}=this,{data:r,type:a,parent:o,frag:f,part:h,chunkMeta:d,offset:g}=e,p=d.buffering[a],{sn:v,cc:E}=f,S=self.performance.now();p.start=S;const A=f.stats.buffering,b=h?h.stats.buffering:null;A.start===0&&(A.start=S),b&&b.start===0&&(b.start=S);const L=s.audio;let _=!1;a==="audio"&&(L==null?void 0:L.container)==="audio/mpeg"&&(_=!this.lastMpegAudioChunk||d.id===1||this.lastMpegAudioChunk.sn!==d.sn,this.lastMpegAudioChunk=d);const D=s.video,k=D==null?void 0:D.buffer;if(k&&v!=="initSegment"){const O=h||f,$=this.blockedAudioAppend;if(a==="audio"&&o!=="main"&&!this.blockedAudioAppend&&!(D.ending||D.ended)){const B=O.start+O.duration*.05,Q=k.buffered,st=this.currentOp("video");!Q.length&&!st?this.blockAudio(O):!st&&!Tt.isBuffered(k,B)&&this.lastVideoAppendEnd<B&&this.blockAudio(O)}else if(a==="video"){const G=O.end;if($){const B=$.frag.start;(G>B||G<this.lastVideoAppendEnd||Tt.isBuffered(k,B))&&this.unblockAudio()}this.lastVideoAppendEnd=G}}const w=(h||f).start,V={label:`append-${a}`,execute:()=>{var O;p.executeStart=self.performance.now();const $=(O=this.tracks[a])==null?void 0:O.buffer;$&&(_?this.updateTimestampOffset($,w,.1,a,v,E):g!==void 0&&ct(g)&&this.updateTimestampOffset($,g,1e-6,a,v,E)),this.appendExecutor(r,a)},onStart:()=>{},onComplete:()=>{const O=self.performance.now();p.executeEnd=p.end=O,A.first===0&&(A.first=O),b&&b.first===0&&(b.first=O);const $={};this.sourceBuffers.forEach(([G,B])=>{G&&($[G]=Tt.getBuffered(B))}),this.appendErrors[a]=0,a==="audio"||a==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(x.BUFFER_APPENDED,{type:a,frag:f,part:h,chunkMeta:d,parent:f.type,timeRanges:$})},onError:O=>{var $;const G={type:pt.MEDIA_ERROR,parent:f.type,details:z.BUFFER_APPEND_ERROR,sourceBufferName:a,frag:f,part:h,chunkMeta:d,error:O,err:O,fatal:!1},B=($=this.media)==null?void 0:$.error;if(O.code===DOMException.QUOTA_EXCEEDED_ERR||O.name=="QuotaExceededError"||"quota"in O)G.details=z.BUFFER_FULL_ERROR;else if(O.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!B)G.errorAction=sr(!0);else if(O.name===By&&this.sourceBufferCount===0)G.errorAction=sr(!0);else{const Q=++this.appendErrors[a];this.warn(`Failed ${Q}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${a}" sourceBuffer (${B||"no media error"})`),(Q>=this.hls.config.appendErrorMaxRetry||B)&&(G.fatal=!0)}this.hls.trigger(x.ERROR,G)}};this.log(`queuing "${a}" append sn: ${v}${h?" p: "+h.index:""} of ${f.type===ht.MAIN?"level":"track"} ${f.level} cc: ${E}`),this.append(V,a,this.isPending(this.tracks[a]))}getFlushOp(t,e,s){return this.log(`queuing "${t}" remove ${e}-${s}`),{label:"remove",execute:()=>{this.removeExecutor(t,e,s)},onStart:()=>{},onComplete:()=>{this.hls.trigger(x.BUFFER_FLUSHED,{type:t})},onError:r=>{this.warn(`Failed to remove ${e}-${s} from "${t}" SourceBuffer`,r)}}}onBufferFlushing(t,e){const{type:s,startOffset:r,endOffset:a}=e;s?this.append(this.getFlushOp(s,r,a),s):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,r,a),o)})}onFragParsed(t,e){const{frag:s,part:r}=e,a=[],o=r?r.elementaryStreams:s.elementaryStreams;o[qt.AUDIOVIDEO]?a.push("audiovideo"):(o[qt.AUDIO]&&a.push("audio"),o[qt.VIDEO]&&a.push("video"));const f=()=>{const h=self.performance.now();s.stats.buffering.end=h,r&&(r.stats.buffering.end=h);const d=r?r.stats:s.stats;this.hls.trigger(x.FRAG_BUFFERED,{frag:s,part:r,stats:d,id:s.type})};a.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${s.type} level: ${s.level} sn: ${s.sn}`),this.blockBuffers(f,a).catch(h=>{this.warn(`Fragment buffered callback ${h}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(t,e){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([t])=>{if(t){const e=this.tracks[t];if(e)return!e.ended||e.ending}return!1})}onBufferEos(t,e){var s;this.sourceBuffers.forEach(([o])=>{if(o){const f=this.tracks[o];(!e.type||e.type===o)&&(f.ending=!0,f.ended||(f.ended=!0,this.log(`${o} buffer reached EOS`)))}});const r=((s=this.overrides)==null?void 0:s.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var f;return o&&!((f=this.tracks[o])!=null&&f.ended)})?r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(x.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(x.BUFFERED_TO_END,void 0)):e.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([t])=>{if(t!==null){const e=this.tracks[t];e&&(e.ending=!1)}})}onLevelUpdated(t,{details:e}){e.fragments.length&&(this.details=e,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const t=this.getDurationAndRange();t&&this.updateMediaSource(t)})}onError(t,e){if(e.details===z.BUFFER_APPEND_ERROR&&e.frag){var s;const r=(s=e.errorAction)==null?void 0:s.nextAutoLevel;ct(r)&&r!==e.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:t,details:e,media:s}=this;if(!s||e===null||!this.sourceBufferCount)return;const r=t.config,a=s.currentTime,o=e.levelTargetDuration,f=e.live&&r.liveBackBufferLength!==null?r.liveBackBufferLength:r.backBufferLength;if(ct(f)&&f>=0){const d=Math.max(f,o),g=Math.floor(a/o)*o-d;this.flushBackBuffer(a,o,g)}const h=r.frontBufferFlushThreshold;if(ct(h)&&h>0){const d=Math.max(r.maxBufferLength,h),g=Math.max(d,o),p=Math.floor(a/o)*o+g;this.flushFrontBuffer(a,o,p)}}flushBackBuffer(t,e,s){this.sourceBuffers.forEach(([r,a])=>{if(a){const f=Tt.getBuffered(a);if(f.length>0&&s>f.start(0)){var o;this.hls.trigger(x.BACK_BUFFER_REACHED,{bufferEnd:s});const h=this.tracks[r];if((o=this.details)!=null&&o.live)this.hls.trigger(x.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s});else if(h!=null&&h.ended){this.log(`Cannot flush ${r} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(x.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:r})}}})}flushFrontBuffer(t,e,s){this.sourceBuffers.forEach(([r,a])=>{if(a){const o=Tt.getBuffered(a),f=o.length;if(f<2)return;const h=o.start(f-1),d=o.end(f-1);if(s>h||t>=h&&t<=d)return;this.hls.trigger(x.BUFFER_FLUSHING,{startOffset:h,endOffset:1/0,type:r})}})}getDurationAndRange(){var t;const{details:e,mediaSource:s}=this;if(!e||!this.media||(s==null?void 0:s.readyState)!=="open")return null;const r=e.edge;if(e.live&&this.hls.config.liveDurationInfinity){if(e.fragments.length&&s.setLiveSeekableRange){const d=Math.max(0,e.fragmentStart),g=Math.max(d,r);return{duration:1/0,start:d,end:g}}return{duration:1/0}}const a=(t=this.overrides)==null?void 0:t.duration;if(a)return ct(a)?{duration:a}:null;const o=this.media.duration,f=ct(s.duration)?s.duration:0;return r>f&&r>o||!ct(o)?{duration:r}:null}updateMediaSource({duration:t,start:e,end:s}){const r=this.mediaSource;!this.media||!r||r.readyState!=="open"||(r.duration!==t&&(ct(t)&&this.log(`Updating MediaSource duration to ${t.toFixed(3)}`),r.duration=t),e!==void 0&&s!==void 0&&(this.log(`MediaSource duration is set to ${r.duration}. Setting seekable range to ${e}-${s}.`),r.setLiveSeekableRange(e,s)))}get tracksReady(){const t=this.pendingTrackCount;return t>0&&(t>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:t,pendingTrackCount:e,tracks:s}=this;if(this.log(`checkPendingTracks (pending: ${e} codec events expected: ${t}) ${Xt(s)}`),this.tracksReady){var r;const a=(r=this.transferData)==null?void 0:r.tracks;a&&Object.keys(a).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const t={};this.sourceBuffers.forEach(([e,s])=>{if(e){const r=this.tracks[e];t[e]={buffer:s,container:r.container,codec:r.codec,supplemental:r.supplemental,levelCodec:r.levelCodec,id:r.id,metadata:r.metadata}}}),this.hls.trigger(x.BUFFER_CREATED,{tracks:t}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([e])=>{this.executeNext(e)})}else{const t=new Error("could not create source buffer for media codec(s)");this.hls.trigger(x.ERROR,{type:pt.MEDIA_ERROR,details:z.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:t,reason:t.message})}}createSourceBuffers(){const{tracks:t,sourceBuffers:e,mediaSource:s}=this;if(!s)throw new Error("createSourceBuffers called when mediaSource was null");for(const a in t){const o=a,f=t[o];if(this.isPending(f)){const h=this.getTrackCodec(f,o),d=`${f.container};codecs=${h}`;f.codec=h,this.log(`creating sourceBuffer(${d})${this.currentOp(o)?" Queued":""} ${Xt(f)}`);try{const g=s.addSourceBuffer(d),p=tf(o),v=[o,g];e[p]=v,f.buffer=g}catch(g){var r;this.error(`error while trying to add sourceBuffer: ${g.message}`),this.shiftAndExecuteNext(o),(r=this.operationQueue)==null||r.removeBlockers(),delete this.tracks[o],this.hls.trigger(x.ERROR,{type:pt.MEDIA_ERROR,details:z.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:g,sourceBufferName:o,mimeType:d,parent:f.id});return}this.trackSourceBuffer(o,f)}}this.bufferCreated()}getTrackCodec(t,e){const s=t.supplemental;let r=t.codec;s&&(e==="video"||e==="audiovideo")&&da(s,"video")&&(r=Ax(r,s));const a=eo(r,t.levelCodec);return a?e.slice(0,5)==="audio"?co(a,this.appendSource):a:""}trackSourceBuffer(t,e){const s=e.buffer;if(!s)return;const r=this.getTrackCodec(e,t);this.tracks[t]={buffer:s,codec:r,container:e.container,levelCodec:e.levelCodec,supplemental:e.supplemental,metadata:e.metadata,id:e.id,listeners:[]},this.removeBufferListeners(t),this.addBufferListener(t,"updatestart",this.onSBUpdateStart),this.addBufferListener(t,"updateend",this.onSBUpdateEnd),this.addBufferListener(t,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(t,"bufferedchange",(a,o)=>{const f=o.removedRanges;f!=null&&f.length&&this.hls.trigger(x.BUFFER_FLUSHED,{type:a})})}get mediaSrc(){var t,e;const s=((t=this.media)==null||(e=t.querySelector)==null?void 0:e.call(t,"source"))||this.media;return s==null?void 0:s.src}onSBUpdateStart(t){const e=this.currentOp(t);e&&e.onStart()}onSBUpdateEnd(t){var e;if(((e=this.mediaSource)==null?void 0:e.readyState)==="closed"){this.resetBuffer(t);return}const s=this.currentOp(t);s&&(s.onComplete(),this.shiftAndExecuteNext(t))}onSBUpdateError(t,e){var s;const r=new Error(`${t} SourceBuffer error. MediaSource readyState: ${(s=this.mediaSource)==null?void 0:s.readyState}`);this.error(`${r}`,e),this.hls.trigger(x.ERROR,{type:pt.MEDIA_ERROR,details:z.BUFFER_APPENDING_ERROR,sourceBufferName:t,error:r,fatal:!1});const a=this.currentOp(t);a&&a.onError(r)}updateTimestampOffset(t,e,s,r,a,o){const f=e-t.timestampOffset;Math.abs(f)>=s&&(this.log(`Updating ${r} SourceBuffer timestampOffset to ${e} (sn: ${a} cc: ${o})`),t.timestampOffset=e)}removeExecutor(t,e,s){const{media:r,mediaSource:a}=this,o=this.tracks[t],f=o==null?void 0:o.buffer;if(!r||!a||!f){this.warn(`Attempting to remove from the ${t} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(t);return}const h=ct(r.duration)?r.duration:1/0,d=ct(a.duration)?a.duration:1/0,g=Math.max(0,e),p=Math.min(s,h,d);p>g&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${g},${p}] from the ${t} SourceBuffer`),f.remove(g,p)):this.shiftAndExecuteNext(t)}appendExecutor(t,e){const s=this.tracks[e],r=s==null?void 0:s.buffer;if(!r)throw new Ob(`Attempting to append to the ${e} SourceBuffer, but it does not exist`);s.ending=!1,s.ended=!1,r.appendBuffer(t)}blockUntilOpen(t){if(this.isUpdating()||this.isQueued())this.blockBuffers(t).catch(e=>{this.warn(`SourceBuffer blocked callback ${e}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{t()}catch(e){this.warn(`Callback run without blocking ${this.operationQueue} ${e}`)}}isUpdating(){return this.sourceBuffers.some(([t,e])=>t&&e.updating)}isQueued(){return this.sourceBuffers.some(([t])=>t&&!!this.currentOp(t))}isPending(t){return!!t&&!t.buffer}blockBuffers(t,e=this.sourceBufferTypes){if(!e.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(t);const{operationQueue:s}=this,r=e.map(o=>this.appendBlocker(o));return e.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(o=>{s===this.operationQueue&&(t(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(t){t.forEach(e=>{var s;const r=(s=this.tracks[e])==null?void 0:s.buffer;!r||r.updating||this.shiftAndExecuteNext(e)})}append(t,e,s){this.operationQueue&&this.operationQueue.append(t,e,s)}appendBlocker(t){if(this.operationQueue)return this.operationQueue.appendBlocker(t)}currentOp(t){return this.operationQueue?this.operationQueue.current(t):null}executeNext(t){t&&this.operationQueue&&this.operationQueue.executeNext(t)}shiftAndExecuteNext(t){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(t)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((t,e)=>t+(this.isPending(this.tracks[e])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((t,[e])=>t+(e?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([t])=>t).filter(t=>!!t)}addBufferListener(t,e,s){const r=this.tracks[t];if(!r)return;const a=r.buffer;if(!a)return;const o=s.bind(this,t);r.listeners.push({event:e,listener:o}),a.addEventListener(e,o)}removeBufferListeners(t){const e=this.tracks[t];if(!e)return;const s=e.buffer;s&&(e.listeners.forEach(r=>{s.removeEventListener(r.event,r.listener)}),e.listeners.length=0)}}function op(u){const t=u.querySelectorAll("source");[].slice.call(t).forEach(e=>{u.removeChild(e)})}function wb(u,t){const e=self.document.createElement("source");e.type="video/mp4",e.src=t,u.appendChild(e)}function tf(u){return u==="audio"?1:0}class Zf{constructor(t){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(t){this.streamController=t}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:t}=this;t.on(x.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(x.MANIFEST_PARSED,this.onManifestParsed,this),t.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(x.BUFFER_CODECS,this.onBufferCodecs,this),t.on(x.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:t}=this;t.off(x.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(x.MANIFEST_PARSED,this.onManifestParsed,this),t.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(x.BUFFER_CODECS,this.onBufferCodecs,this),t.off(x.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(t,e){const s=this.hls.levels[e.droppedLevel];this.isLevelAllowed(s)&&this.restrictedLevels.push({bitrate:s.bitrate,height:s.height,width:s.width})}onMediaAttaching(t,e){this.media=e.media instanceof HTMLVideoElement?e.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(t,e){const s=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,s.config.capLevelToPlayerSize&&e.video&&this.startCapping()}onLevelsUpdated(t,e){this.timer&&ct(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(t,e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const t=this.hls.levels;if(t.length){const e=this.hls,s=this.getMaxLevel(t.length-1);s!==this.autoLevelCapping&&e.logger.log(`Setting autoLevelCapping to ${s}: ${t[s].height}p@${t[s].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),e.autoLevelCapping=s,e.autoLevelEnabled&&e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}}getMaxLevel(t){const e=this.hls.levels;if(!e.length)return-1;const s=e.filter((r,a)=>this.isLevelAllowed(r)&&a<=t);return this.clientRect=null,Zf.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const t=this.media,e={width:0,height:0};if(t){const s=t.getBoundingClientRect();e.width=s.width,e.height=s.height,!e.width&&!e.height&&(e.width=s.right-s.left||t.width||0,e.height=s.bottom-s.top||t.height||0)}return this.clientRect=e,e}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let t=1;if(!this.hls.config.ignoreDevicePixelRatio)try{t=self.devicePixelRatio}catch{}return Math.min(t,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(t){return!this.restrictedLevels.some(s=>t.bitrate===s.bitrate&&t.width===s.width&&t.height===s.height)}static getMaxLevelByMediaSize(t,e,s){if(!(t!=null&&t.length))return-1;const r=(f,h)=>h?f.width!==h.width||f.height!==h.height:!0;let a=t.length-1;const o=Math.max(e,s);for(let f=0;f<t.length;f+=1){const h=t[f];if((h.width>=o||h.height>=o)&&r(h,t[f+1])){a=f;break}}return a}}const Nb={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Ge=Nb,Pb={HLS:"h"},Ub=Pb;class Ni{constructor(t,e){Array.isArray(t)&&(t=t.map(s=>s instanceof Ni?s:new Ni(s))),this.value=t,this.params=e}}const Bb="Dict";function Fb(u){return Array.isArray(u)?JSON.stringify(u):u instanceof Map?"Map{}":u instanceof Set?"Set{}":typeof u=="object"?JSON.stringify(u):String(u)}function $b(u,t,e,s){return new Error(`failed to ${u} "${Fb(t)}" as ${e}`,{cause:s})}function Pi(u,t,e){return $b("serialize",u,t,e)}class Fy{constructor(t){this.description=t}}const up="Bare Item",Gb="Boolean";function Hb(u){if(typeof u!="boolean")throw Pi(u,Gb);return u?"?1":"?0"}function zb(u){return btoa(String.fromCharCode(...u))}const Kb="Byte Sequence";function jb(u){if(ArrayBuffer.isView(u)===!1)throw Pi(u,Kb);return`:${zb(u)}:`}const Vb="Integer";function Yb(u){return u<-999999999999999||999999999999999<u}function $y(u){if(Yb(u))throw Pi(u,Vb);return u.toString()}function qb(u){return`@${$y(u.getTime()/1e3)}`}function Gy(u,t){if(u<0)return-Gy(-u,t);const e=Math.pow(10,t);if(Math.abs(u*e%1-.5)<Number.EPSILON){const r=Math.floor(u*e);return(r%2===0?r:r+1)/e}else return Math.round(u*e)/e}const Xb="Decimal";function Qb(u){const t=Gy(u,3);if(Math.floor(Math.abs(t)).toString().length>12)throw Pi(u,Xb);const e=t.toString();return e.includes(".")?e:`${e}.0`}const Wb="String",Zb=/[\x00-\x1f\x7f]+/;function Jb(u){if(Zb.test(u))throw Pi(u,Wb);return`"${u.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function t1(u){return u.description||u.toString().slice(7,-1)}const e1="Token";function cp(u){const t=t1(u);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t)===!1)throw Pi(t,e1);return t}function Lf(u){switch(typeof u){case"number":if(!ct(u))throw Pi(u,up);return Number.isInteger(u)?$y(u):Qb(u);case"string":return Jb(u);case"symbol":return cp(u);case"boolean":return Hb(u);case"object":if(u instanceof Date)return qb(u);if(u instanceof Uint8Array)return jb(u);if(u instanceof Fy)return cp(u);default:throw Pi(u,up)}}const i1="Key";function Rf(u){if(/^[a-z*][a-z0-9\-_.*]*$/.test(u)===!1)throw Pi(u,i1);return u}function Jf(u){return u==null?"":Object.entries(u).map(([t,e])=>e===!0?`;${Rf(t)}`:`;${Rf(t)}=${Lf(e)}`).join("")}function Hy(u){return u instanceof Ni?`${Lf(u.value)}${Jf(u.params)}`:Lf(u)}function s1(u){return`(${u.value.map(Hy).join(" ")})${Jf(u.params)}`}function n1(u,t={whitespace:!0}){if(typeof u!="object"||u==null)throw Pi(u,Bb);const e=u instanceof Map?u.entries():Object.entries(u),s=t!=null&&t.whitespace?" ":"";return Array.from(e).map(([r,a])=>{a instanceof Ni||(a=new Ni(a));let o=Rf(r);return a.value===!0?o+=Jf(a.params):(o+="=",Array.isArray(a.value)?o+=s1(a):o+=Hy(a)),o}).join(`,${s}`)}function zy(u,t){return n1(u,t)}const Ci="CMCD-Object",ne="CMCD-Request",rn="CMCD-Session",Ms="CMCD-Status",r1={br:Ci,ab:Ci,d:Ci,ot:Ci,tb:Ci,tpb:Ci,lb:Ci,tab:Ci,lab:Ci,url:Ci,pb:ne,bl:ne,tbl:ne,dl:ne,ltc:ne,mtp:ne,nor:ne,nrr:ne,rc:ne,sn:ne,sta:ne,su:ne,ttfb:ne,ttfbb:ne,ttlb:ne,cmsdd:ne,cmsds:ne,smrt:ne,df:ne,cs:ne,ts:ne,cid:rn,pr:rn,sf:rn,sid:rn,st:rn,v:rn,msd:rn,bs:Ms,bsd:Ms,cdn:Ms,rtp:Ms,bg:Ms,pt:Ms,ec:Ms,e:Ms},a1={REQUEST:ne};function l1(u){return Object.keys(u).reduce((t,e)=>{var s;return(s=u[e])===null||s===void 0||s.forEach(r=>t[r]=e),t},{})}function o1(u,t){const e={};if(!u)return e;const s=Object.keys(u),r=t?l1(t):{};return s.reduce((a,o)=>{var f;const h=r1[o]||r[o]||a1.REQUEST,d=(f=a[h])!==null&&f!==void 0?f:a[h]={};return d[o]=u[o],a},e)}function u1(u){return["ot","sf","st","e","sta"].includes(u)}function c1(u){return typeof u=="number"?ct(u):u!=null&&u!==""&&u!==!1}const Ky="event";function f1(u,t){const e=new URL(u),s=new URL(t);if(e.origin!==s.origin)return u;const r=e.pathname.split("/").slice(1),a=s.pathname.split("/").slice(1,-1);for(;r[0]===a[0];)r.shift(),a.shift();for(;a.length;)a.shift(),r.unshift("..");return r.join("/")+e.search+e.hash}const ao=u=>Math.round(u),_f=(u,t)=>Array.isArray(u)?u.map(e=>_f(e,t)):u instanceof Ni&&typeof u.value=="string"?new Ni(_f(u.value,t),u.params):(t.baseUrl&&(u=f1(u,t.baseUrl)),t.version===1?encodeURIComponent(u):u),Yl=u=>ao(u/100)*100,d1=(u,t)=>{let e=u;return t.version>=2&&(u instanceof Ni&&typeof u.value=="string"?e=new Ni([u]):typeof u=="string"&&(e=[u])),_f(e,t)},h1={br:ao,d:ao,bl:Yl,dl:Yl,mtp:Yl,nor:d1,rtp:Yl,tb:ao},jy="request",Vy="response",td=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],g1=["e"],m1=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Ao(u){return m1.test(u)}function p1(u){return td.includes(u)||g1.includes(u)||Ao(u)}const Yy=["d","dl","nor","ot","rtp","su"];function y1(u){return td.includes(u)||Yy.includes(u)||Ao(u)}const v1=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function E1(u){return td.includes(u)||Yy.includes(u)||v1.includes(u)||Ao(u)}const S1=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function T1(u){return S1.includes(u)||Ao(u)}const x1={[Vy]:E1,[Ky]:p1,[jy]:y1};function qy(u,t={}){const e={};if(u==null||typeof u!="object")return e;const s=t.version||u.v||1,r=t.reportingMode||jy,a=s===1?T1:x1[r];let o=Object.keys(u).filter(a);const f=t.filter;typeof f=="function"&&(o=o.filter(f));const h=r===Vy||r===Ky;h&&!o.includes("ts")&&o.push("ts"),s>1&&!o.includes("v")&&o.push("v");const d=jt({},h1,t.formatters),g={version:s,reportingMode:r,baseUrl:t.baseUrl};return o.sort().forEach(p=>{let v=u[p];const E=d[p];if(typeof E=="function"&&(v=E(v,g)),p==="v"){if(s===1)return;v=s}p=="pr"&&v===1||(h&&p==="ts"&&!ct(v)&&(v=Date.now()),c1(v)&&(u1(p)&&typeof v=="string"&&(v=new Fy(v)),e[p]=v))}),e}function A1(u,t={}){const e={};if(!u)return e;const s=qy(u,t),r=o1(s,t==null?void 0:t.customHeaderMap);return Object.entries(r).reduce((a,[o,f])=>{const h=zy(f,{whitespace:!1});return h&&(a[o]=h),a},e)}function b1(u,t,e){return jt(u,A1(t,e))}const L1="CMCD";function R1(u,t={}){return u?zy(qy(u,t),{whitespace:!1}):""}function _1(u,t={}){if(!u)return"";const e=R1(u,t);return encodeURIComponent(e)}function D1(u,t={}){if(!u)return"";const e=_1(u,t);return`${L1}=${e}`}const fp=/CMCD=[^&#]+/;function I1(u,t,e){const s=D1(t,e);if(!s)return u;if(fp.test(u))return u.replace(fp,s);const r=u.includes("?")?"&":"?";return`${u}${r}${s}`}class C1{constructor(t){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=r=>{try{this.apply(r,{ot:Ge.MANIFEST,su:!this.initialized})}catch(a){this.hls.logger.warn("Could not generate manifest CMCD data.",a)}},this.applyFragmentData=r=>{try{const{frag:a,part:o}=r,f=this.hls.levels[a.level],h=this.getObjectType(a),d={d:(o||a).duration*1e3,ot:h};(h===Ge.VIDEO||h===Ge.AUDIO||h==Ge.MUXED)&&(d.br=f.bitrate/1e3,d.tb=this.getTopBandwidth(h)/1e3,d.bl=this.getBufferLength(h));const g=o?this.getNextPart(o):this.getNextFrag(a);g!=null&&g.url&&g.url!==a.url&&(d.nor=g.url),this.apply(r,d)}catch(a){this.hls.logger.warn("Could not generate segment CMCD data.",a)}},this.hls=t;const e=this.config=t.config,{cmcd:s}=e;s!=null&&(e.pLoader=this.createPlaylistLoader(),e.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||t.sessionId,this.cid=s.contentId,this.useHeaders=s.useHeaders===!0,this.includeKeys=s.includeKeys,this.registerListeners())}registerListeners(){const t=this.hls;t.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(x.MEDIA_DETACHED,this.onMediaDetached,this),t.on(x.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const t=this.hls;t.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(x.MEDIA_DETACHED,this.onMediaDetached,this),t.off(x.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(t,e){this.media=e.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(t,e){var s,r;this.audioBuffer=(s=e.tracks.audio)==null?void 0:s.buffer,this.videoBuffer=(r=e.tracks.video)==null?void 0:r.buffer}createData(){var t;return{v:1,sf:Ub.HLS,sid:this.sid,cid:this.cid,pr:(t=this.media)==null?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(t,e={}){jt(e,this.createData());const s=e.ot===Ge.INIT||e.ot===Ge.VIDEO||e.ot===Ge.MUXED;this.starved&&s&&(e.bs=!0,e.su=!0,this.starved=!1),e.su==null&&(e.su=this.buffering);const{includeKeys:r}=this;r&&(e=Object.keys(e).reduce((o,f)=>(r.includes(f)&&(o[f]=e[f]),o),{}));const a={baseUrl:t.url};this.useHeaders?(t.headers||(t.headers={}),b1(t.headers,e,a)):t.url=I1(t.url,e,a)}getNextFrag(t){var e;const s=(e=this.hls.levels[t.level])==null?void 0:e.details;if(s){const r=t.sn-s.startSN;return s.fragments[r+1]}}getNextPart(t){var e;const{index:s,fragment:r}=t,a=(e=this.hls.levels[r.level])==null||(e=e.details)==null?void 0:e.partList;if(a){const{sn:o}=r;for(let f=a.length-1;f>=0;f--){const h=a[f];if(h.index===s&&h.fragment.sn===o)return a[f+1]}}}getObjectType(t){const{type:e}=t;if(e==="subtitle")return Ge.TIMED_TEXT;if(t.sn==="initSegment")return Ge.INIT;if(e==="audio")return Ge.AUDIO;if(e==="main")return this.hls.audioTracks.length?Ge.VIDEO:Ge.MUXED}getTopBandwidth(t){let e=0,s;const r=this.hls;if(t===Ge.AUDIO)s=r.audioTracks;else{const a=r.maxAutoLevel,o=a>-1?a+1:r.levels.length;s=r.levels.slice(0,o)}return s.forEach(a=>{a.bitrate>e&&(e=a.bitrate)}),e>0?e:NaN}getBufferLength(t){const e=this.media,s=t===Ge.AUDIO?this.audioBuffer:this.videoBuffer;return!s||!e?NaN:Tt.bufferInfo(s,e.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:t}=this.config,e=this.applyPlaylistData,s=t||this.config.loader;return class{constructor(a){this.loader=void 0,this.loader=new s(a)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(a,o,f){e(a),this.loader.load(a,o,f)}}}createFragmentLoader(){const{fLoader:t}=this.config,e=this.applyFragmentData,s=t||this.config.loader;return class{constructor(a){this.loader=void 0,this.loader=new s(a)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(a,o,f){e(a),this.loader.load(a,o,f)}}}}const k1=3e5;class O1 extends mi{constructor(t){super("content-steering",t.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=t,this.registerListeners()}registerListeners(){const t=this.hls;t.on(x.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(x.MANIFEST_PARSED,this.onManifestParsed,this),t.on(x.ERROR,this.onError,this)}unregisterListeners(){const t=this.hls;t&&(t.off(x.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(x.MANIFEST_PARSED,this.onManifestParsed,this),t.off(x.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((t,e)=>(t.indexOf(e.pathwayId)===-1&&t.push(e.pathwayId),t),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(t){this.updatePathwayPriority(t)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const t=this.timeToLoad*1e3-(performance.now()-this.updated);if(t>0){this.scheduleRefresh(this.uri,t);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(t){const e=this.levels;e&&(this.levels=e.filter(s=>s!==t))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(t,e){const{contentSteering:s}=e;s!==null&&(this.pathwayId=s.pathwayId,this.uri=s.uri,this.started&&this.startLoad())}onManifestParsed(t,e){this.audioTracks=e.audioTracks,this.subtitleTracks=e.subtitleTracks}onError(t,e){const{errorAction:s}=e;if((s==null?void 0:s.action)===Le.SendAlternateToPenaltyBox&&s.flags===Je.MoveAllAlternatesMatchingHost){const r=this.levels;let a=this._pathwayPriority,o=this.pathwayId;if(e.context){const{groupId:f,pathwayId:h,type:d}=e.context;f&&r?o=this.getPathwayForGroupId(f,d,o):h&&(o=h)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!a&&r&&(a=this.pathways()),a&&a.length>1&&(this.updatePathwayPriority(a),s.resolved=this.pathwayId!==o),e.details===z.BUFFER_APPEND_ERROR&&!e.fatal?s.resolved=!0:s.resolved||this.warn(`Could not resolve ${e.details} ("${e.error.message}") with content-steering for Pathway: ${o} levels: ${r&&r.length} priorities: ${Xt(a)} penalized: ${Xt(this.penalizedPathways)}`)}}filterParsedLevels(t){this.levels=t;let e=this.getLevelsForPathway(this.pathwayId);if(e.length===0){const s=t[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${s}"`),e=this.getLevelsForPathway(s),this.pathwayId=s}return e.length!==t.length&&this.log(`Found ${e.length}/${t.length} levels in Pathway "${this.pathwayId}"`),e}getLevelsForPathway(t){return this.levels===null?[]:this.levels.filter(e=>t===e.pathwayId)}updatePathwayPriority(t){this._pathwayPriority=t;let e;const s=this.penalizedPathways,r=performance.now();Object.keys(s).forEach(a=>{r-s[a]>k1&&delete s[a]});for(let a=0;a<t.length;a++){const o=t[a];if(o in s)continue;if(o===this.pathwayId)return;const f=this.hls.nextLoadLevel,h=this.hls.levels[f];if(e=this.getLevelsForPathway(o),e.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,gy(e),this.hls.trigger(x.LEVELS_UPDATED,{levels:e});const d=this.hls.levels[f];h&&d&&this.levels&&(d.attrs["STABLE-VARIANT-ID"]!==h.attrs["STABLE-VARIANT-ID"]&&d.bitrate!==h.bitrate&&this.log(`Unstable Pathways change from bitrate ${h.bitrate} to ${d.bitrate}`),this.hls.nextLoadLevel=f);break}}}getPathwayForGroupId(t,e,s){const r=this.getLevelsForPathway(s).concat(this.levels||[]);for(let a=0;a<r.length;a++)if(e===Rt.AUDIO_TRACK&&r[a].hasAudioGroup(t)||e===Rt.SUBTITLE_TRACK&&r[a].hasSubtitleGroup(t))return r[a].pathwayId;return s}clonePathways(t){const e=this.levels;if(!e)return;const s={},r={};t.forEach(a=>{const{ID:o,"BASE-ID":f,"URI-REPLACEMENT":h}=a;if(e.some(g=>g.pathwayId===o))return;const d=this.getLevelsForPathway(f).map(g=>{const p=new te(g.attrs);p["PATHWAY-ID"]=o;const v=p.AUDIO&&`${p.AUDIO}_clone_${o}`,E=p.SUBTITLES&&`${p.SUBTITLES}_clone_${o}`;v&&(s[p.AUDIO]=v,p.AUDIO=v),E&&(r[p.SUBTITLES]=E,p.SUBTITLES=E);const S=Xy(g.uri,p["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",h),A=new ga({attrs:p,audioCodec:g.audioCodec,bitrate:g.bitrate,height:g.height,name:g.name,url:S,videoCodec:g.videoCodec,width:g.width});if(g.audioGroups)for(let b=1;b<g.audioGroups.length;b++)A.addGroupId("audio",`${g.audioGroups[b]}_clone_${o}`);if(g.subtitleGroups)for(let b=1;b<g.subtitleGroups.length;b++)A.addGroupId("text",`${g.subtitleGroups[b]}_clone_${o}`);return A});e.push(...d),dp(this.audioTracks,s,h,o),dp(this.subtitleTracks,r,h,o)})}loadSteeringManifest(t){const e=this.hls.config,s=e.loader;this.loader&&this.loader.destroy(),this.loader=new s(e);let r;try{r=new self.URL(t)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${t}`);return}if(r.protocol!=="data:"){const g=(this.hls.bandwidthEstimate||e.abrEwmaDefaultEstimate)|0;r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+g)}const a={responseType:"json",url:r.href},o=e.steeringManifestLoadPolicy.default,f=o.errorRetry||o.timeoutRetry||{},h={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:f.maxNumRetry||0,retryDelay:f.retryDelayMs||0,maxRetryDelay:f.maxRetryDelayMs||0},d={onSuccess:(g,p,v,E)=>{this.log(`Loaded steering manifest: "${r}"`);const S=g.data;if((S==null?void 0:S.VERSION)!==1){this.log(`Steering VERSION ${S.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=S.TTL;const{"RELOAD-URI":A,"PATHWAY-CLONES":b,"PATHWAY-PRIORITY":L}=S;if(A)try{this.uri=new self.URL(A,r).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${A}`);return}this.scheduleRefresh(this.uri||v.url),b&&this.clonePathways(b);const _={steeringManifest:S,url:r.toString()};this.hls.trigger(x.STEERING_MANIFEST_LOADED,_),L&&this.updatePathwayPriority(L)},onError:(g,p,v,E)=>{if(this.log(`Error loading steering manifest: ${g.code} ${g.text} (${p.url})`),this.stopLoad(),g.code===410){this.enabled=!1,this.log(`Steering manifest ${p.url} no longer available`);return}let S=this.timeToLoad*1e3;if(g.code===429){const A=this.loader;if(typeof(A==null?void 0:A.getResponseHeader)=="function"){const b=A.getResponseHeader("Retry-After");b&&(S=parseFloat(b)*1e3)}this.log(`Steering manifest ${p.url} rate limited`);return}this.scheduleRefresh(this.uri||p.url,S)},onTimeout:(g,p,v)=>{this.log(`Timeout loading steering manifest (${p.url})`),this.scheduleRefresh(this.uri||p.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(a,h,d)}scheduleRefresh(t,e=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var s;const r=(s=this.hls)==null?void 0:s.media;if(r&&!r.ended){this.loadSteeringManifest(t);return}this.scheduleRefresh(t,this.timeToLoad*1e3)},e)}}function dp(u,t,e,s){u&&Object.keys(t).forEach(r=>{const a=u.filter(o=>o.groupId===r).map(o=>{const f=jt({},o);return f.details=void 0,f.attrs=new te(f.attrs),f.url=f.attrs.URI=Xy(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",e),f.groupId=f.attrs["GROUP-ID"]=t[r],f.attrs["PATHWAY-ID"]=s,f});u.push(...a)})}function Xy(u,t,e,s){const{HOST:r,PARAMS:a,[e]:o}=s;let f;t&&(f=o==null?void 0:o[t],f&&(u=f));const h=new self.URL(u);return r&&!f&&(h.host=r),a&&Object.keys(a).sort().forEach(d=>{d&&h.searchParams.set(d,a[d])}),h.href}class rr extends mi{constructor(t){super("eme",t.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=rr.CDMCleanupPromise?[rr.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=e=>{const{initDataType:s,initData:r}=e,a=`"${e.type}" event: init data type: "${s}"`;if(this.debug(a),r!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=la(this.config));const f=o.map(Vc).filter(h=>!!h);this.keyFormatPromise=this.getKeyFormatPromise(f)}this.keyFormatPromise.then(o=>{const f=so(o);if(s!=="sinf"||f!==ee.FAIRPLAY){this.log(`Ignoring "${e.type}" event with init data type: "${s}" for selected key-system ${f}`);return}let h;try{const E=he(new Uint8Array(r)),S=Hf(JSON.parse(E).sinf),A=zp(S);if(!A)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");h=new Uint8Array(A.subarray(8,24))}catch(E){this.warn(`${a} Failed to parse sinf: ${E}`);return}const d=Re(h),{keyIdToKeySessionPromise:g,mediaKeySessions:p}=this;let v=g[d];for(let E=0;E<p.length;E++){const S=p[E],A=S.decryptdata;if(!A.keyId)continue;const b=Re(A.keyId);if(po(h,A.keyId)||A.uri.replace(/-/g,"").indexOf(d)!==-1){if(v=g[b],!v)continue;if(A.pssh)break;delete g[b],A.pssh=new Uint8Array(r),A.keyId=h,v=g[d]=v.then(()=>this.generateRequestWithPreferredKeySession(S,s,r,"encrypted-event-key-match")),v.catch(L=>this.handleError(L));break}}v||this.handleError(new Error(`Key ID ${d} not encountered in playlist. Key-system sessions ${p.length}.`))}).catch(o=>this.handleError(o))}},this.onWaitingForKey=e=>{this.log(`"${e.type}" event`)},this.hls=t,this.config=t.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(x.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(x.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(x.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(x.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(x.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(x.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(t){const{drmSystems:e,widevineLicenseUrl:s}=this.config,r=e==null?void 0:e[t];if(r)return r.licenseUrl;if(t===ee.WIDEVINE&&s)return s}getLicenseServerUrlOrThrow(t){const e=this.getLicenseServerUrl(t);if(e===void 0)throw new Error(`no license server URL configured for key-system "${t}"`);return e}getServerCertificateUrl(t){const{drmSystems:e}=this.config,s=e==null?void 0:e[t];if(s)return s.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${t}"]`)}attemptKeySystemAccess(t){const e=this.hls.levels,s=(o,f,h)=>!!o&&h.indexOf(o)===f,r=e.map(o=>o.audioCodec).filter(s),a=e.map(o=>o.videoCodec).filter(s);return r.length+a.length===0&&a.push("avc1.42e01e"),new Promise((o,f)=>{const h=d=>{const g=d.shift();this.getMediaKeysPromise(g,r,a).then(p=>o({keySystem:g,mediaKeys:p})).catch(p=>{d.length?h(d):p instanceof Ze?f(p):f(new Ze({type:pt.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_ACCESS,error:p,fatal:!0},p.message))})};h(t)})}requestMediaKeySystemAccess(t,e){const{requestMediaKeySystemAccessFunc:s}=this.config;if(typeof s!="function"){let r=`Configured requestMediaKeySystemAccess is not a function ${s}`;return ay===null&&self.location.protocol==="http:"&&(r=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(r))}return s(t,e)}getMediaKeysPromise(t,e,s){var r;const a=dA(t,e,s,this.config.drmSystemOptions||{});let o=this.keySystemAccessPromises[t],f=(r=o)==null?void 0:r.keySystemAccess;if(!f){this.log(`Requesting encrypted media "${t}" key-system access with config: ${Xt(a)}`),f=this.requestMediaKeySystemAccess(t,a);const h=o=this.keySystemAccessPromises[t]={keySystemAccess:f};return f.catch(d=>{this.log(`Failed to obtain access to key-system "${t}": ${d}`)}),f.then(d=>{this.log(`Access for key-system "${d.keySystem}" obtained`);const g=this.fetchServerCertificate(t);this.log(`Create media-keys for "${t}"`);const p=h.mediaKeys=d.createMediaKeys().then(v=>(this.log(`Media-keys created for "${t}"`),h.hasMediaKeys=!0,g.then(E=>E?this.setMediaKeysServerCertificate(v,t,E):v)));return p.catch(v=>{this.error(`Failed to create media-keys for "${t}"}: ${v}`)}),p})}return f.then(()=>o.mediaKeys)}createMediaKeySessionContext({decryptdata:t,keySystem:e,mediaKeys:s}){this.log(`Creating key-system session "${e}" keyId: ${Re(t.keyId||[])} keyUri: ${t.uri}`);const r=s.createSession(),a={decryptdata:t,keySystem:e,mediaKeys:s,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(a),a}renewKeySession(t){const e=t.decryptdata;if(e.pssh){const s=this.createMediaKeySessionContext(t),r=ql(e),a="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(s,a,e.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(t)}updateKeySession(t,e){const s=t.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyId ${Re(t.decryptdata.keyId||[])}
      } (data length: ${e.byteLength})`),s.update(e)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(t=>({keySystem:t,hasMediaKeys:this.keySystemAccessPromises[t].hasMediaKeys})).filter(({hasMediaKeys:t})=>!!t).map(({keySystem:t})=>Vc(t)).filter(t=>!!t)}getKeySystemAccess(t){return this.getKeySystemSelectionPromise(t).then(({keySystem:e,mediaKeys:s})=>this.attemptSetMediaKeys(e,s))}selectKeySystem(t){return new Promise((e,s)=>{this.getKeySystemSelectionPromise(t).then(({keySystem:r})=>{const a=Vc(r);a?e(a):s(new Error(`Unable to find format for key-system "${r}"`))}).catch(s)})}selectKeySystemFormat(t){const e=Object.keys(t.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${t.sn} ${t.type}: ${t.level}) key formats ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)),this.keyFormatPromise}getKeyFormatPromise(t){const e=la(this.config),s=t.map(so).filter(r=>!!r&&e.indexOf(r)!==-1);return this.selectKeySystem(s)}getKeyStatus(t){const{mediaKeySessions:e}=this;for(let s=0;s<e.length;s++){const r=M1(t,e[s]);if(r)return r}}loadKey(t){const e=t.keyInfo.decryptdata,s=ql(e),r=this.bannedKeyIds[s];if(r||this.getKeyStatus(e)==="internal-error"){const f=hp(r||"internal-error",e);return this.handleError(f,t.frag),Promise.reject(f)}const a=`(keyId: ${s} format: "${e.keyFormat}" method: ${e.method} uri: ${e.uri})`;this.log(`Starting session for key ${a}`);const o=this.keyIdToKeySessionPromise[s];if(!o){const f=this.getKeySystemForKeyPromise(e).then(({keySystem:h,mediaKeys:d})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${t.frag.sn} ${t.frag.type}: ${t.frag.level} using key ${a}`),this.attemptSetMediaKeys(h,d).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:h,mediaKeys:d,decryptdata:e}))))).then(h=>{const d="cenc",g=e.pssh?e.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(h,d,g,"playlist-key")});return f.catch(h=>this.handleError(h,t.frag)),this.keyIdToKeySessionPromise[s]=f,f}return o.catch(f=>{if(f instanceof Ze){const h=$t({},f.data);this.getKeyStatus(e)==="internal-error"&&(h.decryptdata=e);const d=new Ze(h,f.message);this.handleError(d,t.frag)}}),o}throwIfDestroyed(t="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(t,e){if(this.hls)if(t instanceof Ze){e&&(t.data.frag=e);const s=t.data.decryptdata;this.error(`${t.message}${s?` (${Re(s.keyId||[])})`:""}`),this.hls.trigger(x.ERROR,t.data)}else this.error(t.message),this.hls.trigger(x.ERROR,{type:pt.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_KEYS,error:t,fatal:!0})}getKeySystemForKeyPromise(t){const e=ql(t),s=this.keyIdToKeySessionPromise[e];if(!s){const r=so(t.keyFormat),a=r?[r]:la(this.config);return this.attemptKeySystemAccess(a)}return s}getKeySystemSelectionPromise(t){if(t.length||(t=la(this.config)),t.length===0)throw new Ze({type:pt.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Xt({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(t)}attemptSetMediaKeys(t,e){if(this.mediaResolved=void 0,this.mediaKeys===e)return Promise.resolve();const s=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${t}"`);const r=Promise.all(s).then(()=>this.media?this.media.setMediaKeys(e):new Promise((a,o)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return o(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=e,this.media.setMediaKeys(e).then(a).catch(o)}}));return this.mediaKeys=e,this.setMediaKeysQueue.push(r),r.then(()=>{this.log(`Media-keys set for "${t}"`),s.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(a=>s.indexOf(a)===-1)})}generateRequestWithPreferredKeySession(t,e,s,r){var a;const o=(a=this.config.drmSystems)==null||(a=a[t.keySystem])==null?void 0:a.generateRequest;if(o)try{const S=o.call(this.hls,e,s,t);if(!S)throw new Error("Invalid response from configured generateRequest filter");e=S.initDataType,s=S.initData?S.initData:null,t.decryptdata.pssh=s?new Uint8Array(s):null}catch(S){if(this.warn(S.message),this.hls&&this.hls.config.debug)throw S}if(s===null)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(t);const f=ql(t.decryptdata),h=t.decryptdata.uri;this.log(`Generating key-session request for "${r}" keyId: ${f} URI: ${h} (init data type: ${e} length: ${s.byteLength})`);const d=new Kf,g=t._onmessage=S=>{const A=t.mediaKeysSession;if(!A){d.emit("error",new Error("invalid state"));return}const{messageType:b,message:L}=S;this.log(`"${b}" message event for session "${A.sessionId}" message size: ${L.byteLength}`),b==="license-request"||b==="license-renewal"?this.renewLicense(t,L).catch(_=>{d.eventNames().length?d.emit("error",_):this.handleError(_)}):b==="license-release"?t.keySystem===ee.FAIRPLAY&&this.updateKeySession(t,Ef("acknowledged")).then(()=>this.removeSession(t)).catch(_=>this.handleError(_)):this.warn(`unhandled media key message type "${b}"`)},p=(S,A)=>{A.keyStatus=S;let b;S.startsWith("usable")?d.emit("resolved"):S==="internal-error"||S==="output-restricted"||S==="output-downscaled"?b=hp(S,A.decryptdata):S==="expired"?b=new Error(`key expired (keyId: ${f})`):S==="released"?b=new Error("key released"):S==="status-pending"||this.warn(`unhandled key status change "${S}" (keyId: ${f})`),b&&(d.eventNames().length?d.emit("error",b):this.handleError(b))},v=t._onkeystatuseschange=S=>{if(!t.mediaKeysSession){d.emit("error",new Error("invalid state"));return}const b=this.getKeyStatuses(t);if(!Object.keys(b).some(k=>b[k]!=="status-pending"))return;if(b[f]==="expired"){this.log(`Expired key ${Xt(b)} in key-session "${t.mediaKeysSession.sessionId}"`),this.renewKeySession(t);return}let _=b[f];if(_)p(_,t);else{var D;t.keyStatusTimeouts||(t.keyStatusTimeouts={}),(D=t.keyStatusTimeouts)[f]||(D[f]=self.setTimeout(()=>{if(!t.mediaKeysSession||!this.mediaKeys)return;const w=this.getKeyStatus(t.decryptdata);if(w&&w!=="status-pending")return this.log(`No status for keyId ${f} in key-session "${t.mediaKeysSession.sessionId}". Using session key-status ${w} from other session.`),p(w,t);this.log(`key status for ${f} in key-session "${t.mediaKeysSession.sessionId}" timed out after 1000ms`),_="internal-error",p(_,t)},1e3)),this.log(`No status for keyId ${f} (${Xt(b)}).`)}};Me(t.mediaKeysSession,"message",g),Me(t.mediaKeysSession,"keystatuseschange",v);const E=new Promise((S,A)=>{d.on("error",A),d.on("resolved",S)});return t.mediaKeysSession.generateRequest(e,s).then(()=>{this.log(`Request generated for key-session "${t.mediaKeysSession.sessionId}" keyId: ${f} URI: ${h}`)}).catch(S=>{throw new Ze({type:pt.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_NO_SESSION,error:S,decryptdata:t.decryptdata,fatal:!1},`Error generating key-session request: ${S}`)}).then(()=>E).catch(S=>(d.removeAllListeners(),this.removeSession(t).then(()=>{throw S}))).then(()=>(d.removeAllListeners(),t))}getKeyStatuses(t){const e={};return t.mediaKeysSession.keyStatuses.forEach((s,r)=>{if(typeof r=="string"&&typeof s=="object"){const f=r;r=s,s=f}const a="buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r);if(t.keySystem===ee.PLAYREADY&&a.length===16){const f=Re(a);e[f]=s,ny(a)}const o=Re(a);s==="internal-error"&&(this.bannedKeyIds[o]=s),this.log(`key status change "${s}" for keyStatuses keyId: ${o} key-session "${t.mediaKeysSession.sessionId}"`),e[o]=s}),e}fetchServerCertificate(t){const e=this.config,s=e.loader,r=new s(e),a=this.getServerCertificateUrl(t);return a?(this.log(`Fetching server certificate for "${t}"`),new Promise((o,f)=>{const h={responseType:"arraybuffer",url:a},d=e.certLoadPolicy.default,g={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(v,E,S,A)=>{o(v.data)},onError:(v,E,S,A)=>{f(new Ze({type:pt.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:S,response:$t({url:h.url,data:void 0},v)},`"${t}" certificate request failed (${a}). Status: ${v.code} (${v.text})`))},onTimeout:(v,E,S)=>{f(new Ze({type:pt.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:S,response:{url:h.url,data:void 0}},`"${t}" certificate request timed out (${a})`))},onAbort:(v,E,S)=>{f(new Error("aborted"))}};r.load(h,g,p)})):Promise.resolve()}setMediaKeysServerCertificate(t,e,s){return new Promise((r,a)=>{t.setServerCertificate(s).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${s.byteLength}) on "${e}"`),r(t)}).catch(o=>{a(new Ze({type:pt.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(t,e){return this.requestLicense(t,new Uint8Array(e)).then(s=>this.updateKeySession(t,new Uint8Array(s)).catch(r=>{throw new Ze({type:pt.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:t.decryptdata,error:r,fatal:!1},r.message)}))}unpackPlayReadyKeyMessage(t,e){const s=String.fromCharCode.apply(null,new Uint16Array(e.buffer));if(!s.includes("PlayReadyKeyMessage"))return t.setRequestHeader("Content-Type","text/xml; charset=utf-8"),e;const r=new DOMParser().parseFromString(s,"application/xml"),a=r.querySelectorAll("HttpHeader");if(a.length>0){let g;for(let p=0,v=a.length;p<v;p++){var o,f;g=a[p];const E=(o=g.querySelector("name"))==null?void 0:o.textContent,S=(f=g.querySelector("value"))==null?void 0:f.textContent;E&&S&&t.setRequestHeader(E,S)}}const h=r.querySelector("Challenge"),d=h==null?void 0:h.textContent;if(!d)throw new Error("Cannot find <Challenge> in key message");return Ef(atob(d))}setupLicenseXHR(t,e,s,r){const a=this.config.licenseXhrSetup;return a?Promise.resolve().then(()=>{if(!s.decryptdata)throw new Error("Key removed");return a.call(this.hls,t,e,s,r)}).catch(o=>{if(!s.decryptdata)throw o;return t.open("POST",e,!0),a.call(this.hls,t,e,s,r)}).then(o=>(t.readyState||t.open("POST",e,!0),{xhr:t,licenseChallenge:o||r})):(t.open("POST",e,!0),Promise.resolve({xhr:t,licenseChallenge:r}))}requestLicense(t,e){const s=this.config.keyLoadPolicy.default;return new Promise((r,a)=>{const o=this.getLicenseServerUrlOrThrow(t.keySystem);this.log(`Sending license request to URL: ${o}`);const f=new XMLHttpRequest;f.responseType="arraybuffer",f.onreadystatechange=()=>{if(!this.hls||!t.mediaKeysSession)return a(new Error("invalid state"));if(f.readyState===4)if(f.status===200){this._requestLicenseFailureCount=0;let h=f.response;this.log(`License received ${h instanceof ArrayBuffer?h.byteLength:h}`);const d=this.config.licenseResponseCallback;if(d)try{h=d.call(this.hls,f,o,t)}catch(g){this.error(g)}r(h)}else{const h=s.errorRetry,d=h?h.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>d||f.status>=400&&f.status<500)a(new Ze({type:pt.KEY_SYSTEM_ERROR,details:z.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:t.decryptdata,fatal:!0,networkDetails:f,response:{url:o,data:void 0,code:f.status,text:f.statusText}},`License Request XHR failed (${o}). Status: ${f.status} (${f.statusText})`));else{const g=d-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${g} attempts left`),this.requestLicense(t,e).then(r,a)}}},t.licenseXhr&&t.licenseXhr.readyState!==XMLHttpRequest.DONE&&t.licenseXhr.abort(),t.licenseXhr=f,this.setupLicenseXHR(f,o,t,e).then(({xhr:h,licenseChallenge:d})=>{t.keySystem==ee.PLAYREADY&&(d=this.unpackPlayReadyKeyMessage(h,d)),h.send(d)}).catch(a)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(t,e){if(!this.config.emeEnabled)return;const s=e.media;this.media=s,Me(s,"encrypted",this.onMediaEncrypted),Me(s,"waitingforkey",this.onWaitingForKey);const r=this.mediaResolved;r?r():this.mediaKeys=s.mediaKeys}onMediaDetached(){const t=this.media;t&&(He(t,"encrypted",this.onMediaEncrypted),He(t,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var t;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const e=this.mediaResolved;if(e&&e(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const s=this.media,r=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Ps.clearKeyUriToKeyIdMap();const a=r.length;rr.CDMCleanupPromise=Promise.all(r.map(o=>this.removeSession(o)).concat((s==null||(t=s.setMediaKeys(null))==null?void 0:t.catch(o=>{this.log(`Could not clear media keys: ${o}`),this.hls&&this.hls.trigger(x.ERROR,{type:pt.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${o}`)})}))||Promise.resolve())).catch(o=>{this.log(`Could not close sessions and clear media keys: ${o}`),this.hls&&this.hls.trigger(x.ERROR,{type:pt.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${o}`)})}).then(()=>{a&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(t,{sessionKeys:e}){if(!(!e||!this.config.emeEnabled)&&!this.keyFormatPromise){const s=e.reduce((r,a)=>(r.indexOf(a.keyFormat)===-1&&r.push(a.keyFormat),r),[]);this.log(`Selecting key-system from session-keys ${s.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(s)}}removeSession(t){const{mediaKeysSession:e,licenseXhr:s,decryptdata:r}=t;if(e){this.log(`Remove licenses and keys and close session "${e.sessionId}" keyId: ${Re((r==null?void 0:r.keyId)||[])}`),t._onmessage&&(e.removeEventListener("message",t._onmessage),t._onmessage=void 0),t._onkeystatuseschange&&(e.removeEventListener("keystatuseschange",t._onkeystatuseschange),t._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),t.mediaKeysSession=t.decryptdata=t.licenseXhr=void 0;const a=this.mediaKeySessions.indexOf(t);a>-1&&this.mediaKeySessions.splice(a,1);const{keyStatusTimeouts:o}=t;o&&Object.keys(o).forEach(d=>self.clearTimeout(o[d]));const{drmSystemOptions:f}=this.config;return(gA(f)?new Promise((d,g)=>{self.setTimeout(()=>g(new Error("MediaKeySession.remove() timeout")),8e3),e.remove().then(d).catch(g)}):Promise.resolve()).catch(d=>{this.log(`Could not remove session: ${d}`),this.hls&&this.hls.trigger(x.ERROR,{type:pt.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${d}`)})}).then(()=>e.close()).catch(d=>{this.log(`Could not close session: ${d}`),this.hls&&this.hls.trigger(x.ERROR,{type:pt.OTHER_ERROR,details:z.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${d}`)})})}return Promise.resolve()}}rr.CDMCleanupPromise=void 0;function ql(u){if(!u)throw new Error("Could not read keyId of undefined decryptdata");if(u.keyId===null)throw new Error("keyId is null");return Re(u.keyId)}function M1(u,t){if(u.keyId&&t.mediaKeysSession.keyStatuses.has(u.keyId))return t.mediaKeysSession.keyStatuses.get(u.keyId);if(u.matches(t.decryptdata))return t.keyStatus}class Ze extends Error{constructor(t,e){super(e),this.data=void 0,t.error||(t.error=new Error(e)),this.data=t,t.err=t.error}}function hp(u,t){const e=u==="output-restricted",s=e?z.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:z.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Ze({type:pt.KEY_SYSTEM_ERROR,details:s,fatal:!1,decryptdata:t},e?"HDCP level output restricted":`key status changed to "${u}"`)}class w1{constructor(t){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}setStreamController(t){this.streamController=t}registerListeners(){this.hls.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(x.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(x.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(t,e){const s=this.hls.config;if(s.capLevelOnFPSDrop){const r=e.media instanceof self.HTMLVideoElement?e.media:null;this.media=r,r&&typeof r.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),s.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(t,e,s){const r=performance.now();if(e){if(this.lastTime){const a=r-this.lastTime,o=s-this.lastDroppedFrames,f=e-this.lastDecodedFrames,h=1e3*o/a,d=this.hls;if(d.trigger(x.FPS_DROP,{currentDropped:o,currentDecoded:f,totalDroppedFrames:s}),h>0&&o>d.config.fpsDroppedMonitoringThreshold*f){let g=d.currentLevel;d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+g),g>0&&(d.autoLevelCapping===-1||d.autoLevelCapping>=g)&&(g=g-1,d.trigger(x.FPS_DROP_LEVEL_CAPPING,{level:g,droppedLevel:d.currentLevel}),d.autoLevelCapping=g,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=s,this.lastDecodedFrames=e}}checkFPSInterval(){const t=this.media;if(t)if(this.isVideoPlaybackQualityAvailable){const e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)}}function Qy(u,t){let e;try{e=new Event("addtrack")}catch{e=document.createEvent("Event"),e.initEvent("addtrack",!1,!1)}e.track=u,t.dispatchEvent(e)}function Wy(u,t){const e=u.mode;if(e==="disabled"&&(u.mode="hidden"),u.cues&&!u.cues.getCueById(t.id))try{if(u.addCue(t),!u.cues.getCueById(t.id))throw new Error(`addCue is failed for: ${t}`)}catch(s){Gt.debug(`[texttrack-utils]: ${s}`);try{const r=new self.TextTrackCue(t.startTime,t.endTime,t.text);r.id=t.id,u.addCue(r)}catch(r){Gt.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${r}`)}}e==="disabled"&&(u.mode=e)}function ir(u,t){const e=u.mode;if(e==="disabled"&&(u.mode="hidden"),u.cues)for(let s=u.cues.length;s--;)t&&u.cues[s].removeEventListener("enter",t),u.removeCue(u.cues[s]);e==="disabled"&&(u.mode=e)}function Df(u,t,e,s){const r=u.mode;if(r==="disabled"&&(u.mode="hidden"),u.cues&&u.cues.length>0){const a=P1(u.cues,t,e);for(let o=0;o<a.length;o++)(!s||s(a[o]))&&u.removeCue(a[o])}r==="disabled"&&(u.mode=r)}function N1(u,t){if(t<=u[0].startTime)return 0;const e=u.length-1;if(t>u[e].endTime)return-1;let s=0,r=e,a;for(;s<=r;)if(a=Math.floor((r+s)/2),t<u[a].startTime)r=a-1;else if(t>u[a].startTime&&s<e)s=a+1;else return a;return u[s].startTime-t<t-u[r].startTime?s:r}function P1(u,t,e){const s=[],r=N1(u,t);if(r>-1)for(let a=r,o=u.length;a<o;a++){const f=u[a];if(f.startTime>=t&&f.endTime<=e)s.push(f);else if(f.startTime>e)return s}return s}function lo(u){const t=[];for(let e=0;e<u.length;e++){const s=u[e];(s.kind==="subtitles"||s.kind==="captions")&&s.label&&t.push(u[e])}return t}class U1 extends Wf{constructor(t){super(t,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=null;const s=lo(this.media.textTracks);for(let a=0;a<s.length;a++)if(s[a].mode==="hidden")e=s[a];else if(s[a].mode==="showing"){e=s[a];break}const r=this.findTrackForTextTrack(e);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(t){this._subtitleDisplay=t,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:t}=this;t.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(x.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.MANIFEST_PARSED,this.onManifestParsed,this),t.on(x.LEVEL_LOADING,this.onLevelLoading,this),t.on(x.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(x.ERROR,this.onError,this)}unregisterListeners(){const{hls:t}=this;t.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(x.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.MANIFEST_PARSED,this.onManifestParsed,this),t.off(x.LEVEL_LOADING,this.onLevelLoading,this),t.off(x.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(x.ERROR,this.onError,this)}onMediaAttached(t,e){this.media=e.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,t)}onMediaDetaching(t,e){const s=this.media;if(!s)return;const r=!!e.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||s.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r)return;lo(s.textTracks).forEach(o=>{ir(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(t,e){this.tracks=e.subtitleTracks}onSubtitleTrackLoaded(t,e){const{id:s,groupId:r,details:a}=e,o=this.tracksInGroup[s];if(!o||o.groupId!==r){this.warn(`Subtitle track with id:${s} and group:${r} not found in active group ${o==null?void 0:o.groupId}`);return}const f=o.details;o.details=e.details,this.log(`Subtitle track ${s} "${o.name}" lang:${o.lang} group:${r} loaded [${a.startSN}-${a.endSN}]`),s===this.trackId&&this.playlistLoaded(s,e,f)}onLevelLoading(t,e){this.switchLevel(e.level)}onLevelSwitching(t,e){this.switchLevel(e.level)}switchLevel(t){const e=this.hls.levels[t];if(!e)return;const s=e.subtitleGroups||null,r=this.groupIds;let a=this.currentTrack;if(!s||(r==null?void 0:r.length)!==(s==null?void 0:s.length)||s!=null&&s.some(o=>(r==null?void 0:r.indexOf(o))===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(g=>!s||s.indexOf(g.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(g=>g.default)&&(this.selectDefaultTrack=!1),o.forEach((g,p)=>{g.id=p});else if(!a&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const f=this.hls.config.subtitlePreference;if(!a&&f){this.selectDefaultTrack=!1;const g=Mi(f,o);if(g>-1)a=o[g];else{const p=Mi(f,this.tracks);a=this.tracks[p]}}let h=this.findTrackId(a);h===-1&&a&&(h=this.findTrackId(null));const d={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${s==null?void 0:s.join(",")}" group-id`),this.hls.trigger(x.SUBTITLE_TRACKS_UPDATED,d),h!==-1&&this.trackId===-1&&this.setSubtitleTrack(h)}}findTrackId(t){const e=this.tracksInGroup,s=this.selectDefaultTrack;for(let r=0;r<e.length;r++){const a=e[r];if(!(s&&!a.default||!s&&!t)&&(!t||on(a,t)))return r}if(t){for(let r=0;r<e.length;r++){const a=e[r];if(va(t.attrs,a.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<e.length;r++){const a=e[r];if(va(t.attrs,a.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(t){if(t){const e=this.tracksInGroup;for(let s=0;s<e.length;s++){const r=e[s];if(bf(r,t))return s}}return-1}onError(t,e){e.fatal||!e.context||e.context.type===Rt.SUBTITLE_TRACK&&e.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(e.context.groupId)!==-1)&&this.checkRetry(e)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(t){this.selectDefaultTrack=!1,this.setSubtitleTrack(t)}setSubtitleOption(t){if(this.hls.config.subtitlePreference=t,t){if(t.id===-1)return this.setSubtitleTrack(-1),null;const e=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,e.length){const s=this.currentTrack;if(s&&on(t,s))return s;const r=Mi(t,this.tracksInGroup);if(r>-1){const a=this.tracksInGroup[r];return this.setSubtitleTrack(r),a}else{if(s)return null;{const a=Mi(t,e);if(a>-1)return e[a]}}}}return null}loadPlaylist(t){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,t)}loadingPlaylist(t,e){super.loadingPlaylist(t,e);const s=t.id,r=t.groupId,a=this.getUrlWithDirectives(t.url,e),o=t.details,f=o==null?void 0:o.age;this.log(`Loading subtitle ${s} "${t.name}" lang:${t.lang} group:${r}${(e==null?void 0:e.msn)!==void 0?" at sn "+e.msn+" part "+e.part:""}${f&&o.live?" age "+f.toFixed(1)+(o.type&&" "+o.type||""):""} ${a}`),this.hls.trigger(x.SUBTITLE_TRACK_LOADING,{url:a,id:s,groupId:r,deliveryDirectives:e||null,track:t})}toggleTrackModes(){const{media:t}=this;if(!t)return;const e=lo(t.textTracks),s=this.currentTrack;let r;if(s&&(r=e.filter(a=>bf(s,a))[0],r||this.warn(`Unable to find subtitle TextTrack with name "${s.name}" and language "${s.lang}"`)),[].slice.call(e).forEach(a=>{a.mode!=="disabled"&&a!==r&&(a.mode="disabled")}),r){const a=this.subtitleDisplay?"showing":"hidden";r.mode!==a&&(r.mode=a)}}setSubtitleTrack(t){const e=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=t;return}if(t<-1||t>=e.length||!ct(t)){this.warn(`Invalid subtitle track id: ${t}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,r=e[t]||null;if(this.trackId=t,this.currentTrack=r,this.toggleTrackModes(),!r){this.hls.trigger(x.SUBTITLE_TRACK_SWITCH,{id:t});return}const a=!!r.details&&!r.details.live;if(t===this.trackId&&r===s&&a)return;this.log(`Switching to subtitle-track ${t}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));const{id:o,groupId:f="",name:h,type:d,url:g}=r;this.hls.trigger(x.SUBTITLE_TRACK_SWITCH,{id:o,groupId:f,name:h,type:d,url:g});const p=this.switchParams(r.url,s==null?void 0:s.details,r.details);this.loadPlaylist(p)}}function B1(){try{return crypto.randomUUID()}catch{try{const t=URL.createObjectURL(new Blob),e=t.toString();return URL.revokeObjectURL(t),e.slice(e.lastIndexOf("/")+1)}catch{let e=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const a=(e+Math.random()*16)%16|0;return e=Math.floor(e/16),(r=="x"?a:a&3|8).toString(16)})}}}function ca(u){let t=5381,e=u.length;for(;e;)t=t*33^u.charCodeAt(--e);return(t>>>0).toString()}const ar=.025;let So=(function(u){return u[u.Point=0]="Point",u[u.Range=1]="Range",u})({});function F1(u,t,e){return`${u.identifier}-${e+1}-${ca(t)}`}class $1{constructor(t,e){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=e,this.dateRange=t,this.setDateRange(t)}setDateRange(t){this.dateRange=t,this.resumeOffset=t.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=t.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=t.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=t.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var t;this.appendInPlaceStarted=!1,(t=this.assetListLoader)==null||t.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(t){var e;if(t>0&&t>=this.assetList.length)return!0;const s=this.playoutLimit;return t<=0||isNaN(s)?!1:s===0?!0:(((e=this.assetList[t])==null?void 0:e.startOffset)||0)>s}findAssetIndex(t){return this.assetList.indexOf(t)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const t=this.dateRange.startTime;if(this.snapOptions.out){const e=this.dateRange.tagAnchor;if(e)return ef(t,e)}return t}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const t=this.dateRange.tagAnchor;if(t){const e=this.dateRange.startTime,s=ef(e,t);return e-s<.1}return!1}get resumptionOffset(){const t=this.resumeOffset,e=ct(t)?t:this.duration;return this.cumulativeDuration+e}get resumeTime(){const t=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const e=this.resumeAnchor;if(e)return ef(t,e)}return t}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<ar))}set appendInPlace(t){if(this.appendInPlaceStarted){this.resetOnResume=!t;return}this.appendInPlaceDisabled=!t}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(t){this._timelineStart=t}get duration(){const t=this.playoutLimit;let e;return this._duration!==null?e=this._duration:this.dateRange.duration?e=this.dateRange.duration:e=this.dateRange.plannedDuration||0,!isNaN(t)&&t<e&&(e=t),e}set duration(t){this._duration=t}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?So.Range:So.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return G1(this)}}function ef(u,t){return u-t.start<t.duration/2&&!(Math.abs(u-(t.start+t.duration))<ar)?t.start:t.start+t.duration}function Zy(u,t,e){const s=new self.URL(u,e);return s.protocol!=="data:"&&s.searchParams.set("_HLS_primary_id",t),s}function sf(u,t){for(;(e=u.assetList[++t])!=null&&e.error;)var e;return t}function G1(u){return`["${u.identifier}" ${u.cue.pre?"<pre>":u.cue.post?"<post>":""}${u.timelineStart.toFixed(2)}-${u.resumeTime.toFixed(2)}]`}function er(u){const t=u.timelineStart,e=u.duration||0;return`["${u.identifier}" ${t.toFixed(2)}-${(t+e).toFixed(2)}]`}class H1{constructor(t,e,s,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(x.PLAYOUT_LIMIT_REACHED,{})};const a=this.hls=new t(e);this.interstitial=s,this.assetItem=r;const o=()=>{this.hasDetails=!0};a.once(x.LEVEL_LOADED,o),a.once(x.AUDIO_TRACK_LOADED,o),a.once(x.SUBTITLE_TRACK_LOADED,o),a.on(x.MEDIA_ATTACHING,(f,{media:h})=>{this.removeMediaListeners(),this.mediaAttached=h,this.interstitial.playoutLimit&&(h.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&a.on(x.BUFFER_APPENDED,()=>{const g=this.bufferedEnd;this.reachedPlayout(g)&&(this._bufferedEosTime=g,a.trigger(x.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const t=this.hls;if(t)if(t.url)t.levels.length&&!t.started&&t.startLoad(-1,!0);else{let e=this.assetItem.uri;try{e=Zy(e,t.config.primarySessionId||"").href}catch{}t.loadSource(e)}}bufferedInPlaceToEnd(t){var e;if(!this.appendInPlace)return!1;if((e=this.hls)!=null&&e.bufferedToEnd)return!0;if(!t)return!1;const s=Math.min(this._bufferedEosTime||1/0,this.duration),r=this.timelineOffset,a=Tt.bufferInfo(t,r,0);return this.getAssetTime(a.end)>=s-.02}reachedPlayout(t){const s=this.interstitial.playoutLimit;return this.startOffset+t>=s}get destroyed(){var t;return!((t=this.hls)!=null&&t.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var t;return((t=this.hls)==null?void 0:t.media)||null}get bufferedEnd(){const t=this.media||this.mediaAttached;if(!t)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const e=Tt.bufferInfo(t,t.currentTime,.001);return this.getAssetTime(e.end)}get currentTime(){const t=this.media||this.mediaAttached;return t?this.getAssetTime(t.currentTime):this._currentTime||0}get duration(){const t=this.assetItem.duration;if(!t)return 0;const e=this.interstitial.playoutLimit;if(e){const s=e-this.startOffset;if(s>0&&s<t)return s}return t}get remaining(){const t=this.duration;return t?Math.max(0,t-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var t;return((t=this.hls)==null?void 0:t.config.timelineOffset)||0}set timelineOffset(t){const e=this.timelineOffset;if(t!==e){const s=t-e;if(Math.abs(s)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=t}}}getAssetTime(t){const e=this.timelineOffset,s=this.duration;return Math.min(Math.max(0,t-e),s)}removeMediaListeners(){const t=this.mediaAttached;t&&(this._currentTime=t.currentTime,this.bufferSnapShot(),t.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var t;(t=this.hls)!=null&&t.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(t){var e;this.loadSource(),(e=this.hls)==null||e.attachMedia(t)}detachMedia(){var t;this.removeMediaListeners(),this.mediaAttached=null,(t=this.hls)==null||t.detachMedia()}resumeBuffering(){var t;(t=this.hls)==null||t.resumeBuffering()}pauseBuffering(){var t;(t=this.hls)==null||t.pauseBuffering()}transferMedia(){var t;return this.bufferSnapShot(),((t=this.hls)==null?void 0:t.transferMedia())||null}resetDetails(){const t=this.hls;if(t&&this.hasDetails){t.stopLoad();const e=s=>delete s.details;t.levels.forEach(e),t.allAudioTracks.forEach(e),t.allSubtitleTracks.forEach(e),this.hasDetails=!1}}on(t,e,s){var r;(r=this.hls)==null||r.on(t,e)}once(t,e,s){var r;(r=this.hls)==null||r.once(t,e)}off(t,e,s){var r;(r=this.hls)==null||r.off(t,e)}toString(){var t;return`HlsAssetPlayer: ${er(this.assetItem)} ${(t=this.hls)==null?void 0:t.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const gp=.033;class z1 extends mi{constructor(t,e){super("interstitials-sched",e),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=t}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(t=>t.reset()),this.events=this.items=null}resetErrorsInRange(t,e){return this.events?this.events.reduce((s,r)=>t<=r.startOffset&&e>r.startOffset?(delete r.error,s+1):s,0):0}get duration(){const t=this.items;return t?t[t.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(t){return t&&this.eventMap[t]||null}hasEvent(t){return t in this.eventMap}findItemIndex(t,e){if(t.event)return this.findEventIndex(t.event.identifier);let s=-1;t.nextEvent?s=this.findEventIndex(t.nextEvent.identifier)-1:t.previousEvent&&(s=this.findEventIndex(t.previousEvent.identifier)+1);const r=this.items;if(r)for(r[s]||(e===void 0&&(e=t.start),s=this.findItemIndexAtTime(e));s>=0&&(a=r[s])!=null&&a.event;){var a;s--}return s}findItemIndexAtTime(t,e){const s=this.items;if(s)for(let r=0;r<s.length;r++){let a=s[r];if(e&&e!=="primary"&&(a=a[e]),t===a.start||t>a.start&&t<a.end)return r}return-1}findJumpRestrictedIndex(t,e){const s=this.items;if(s)for(let r=t;r<=e&&s[r];r++){const a=s[r].event;if(a!=null&&a.restrictions.jump&&!a.appendInPlace)return r}return-1}findEventIndex(t){const e=this.items;if(e)for(let r=e.length;r--;){var s;if(((s=e[r].event)==null?void 0:s.identifier)===t)return r}return-1}findAssetIndex(t,e){const s=t.assetList,r=s.length;if(r>1)for(let a=0;a<r;a++){const o=s[a];if(!o.error){const f=o.timelineStart;if(e===f||e>f&&(e<f+(o.duration||0)||a===r-1))return a}}return 0}get assetIdAtEnd(){var t;const e=(t=this.items)==null||(t=t[this.length-1])==null?void 0:t.event;if(e){const s=e.assetList,r=s[s.length-1];if(r)return r.identifier}return null}parseInterstitialDateRanges(t,e){const s=t.main.details,{dateRanges:r}=s,a=this.events,o=this.parseDateRanges(r,{url:s.url},e),f=Object.keys(r),h=a?a.filter(d=>!f.includes(d.identifier)):[];o.length&&o.sort((d,g)=>{const p=d.cue.pre,v=d.cue.post,E=g.cue.pre,S=g.cue.post;if(p&&!E)return-1;if(E&&!p||v&&!S)return 1;if(S&&!v)return-1;if(!p&&!E&&!v&&!S){const A=d.startTime,b=g.startTime;if(A!==b)return A-b}return d.dateRange.tagOrder-g.dateRange.tagOrder}),this.events=o,h.forEach(d=>{this.removeEvent(d)}),this.updateSchedule(t,h)}updateSchedule(t,e=[],s=!1){const r=this.events||[];if(r.length||e.length||this.length<2){const a=this.items,o=this.parseSchedule(r,t);(s||e.length||(a==null?void 0:a.length)!==o.length||o.some((h,d)=>Math.abs(h.playout.start-a[d].playout.start)>.005||Math.abs(h.playout.end-a[d].playout.end)>.005))&&(this.items=o,this.onScheduleUpdate(e,a))}}parseDateRanges(t,e,s){const r=[],a=Object.keys(t);for(let o=0;o<a.length;o++){const f=a[o],h=t[f];if(h.isInterstitial){let d=this.eventMap[f];d?d.setDateRange(h):(d=new $1(h,e),this.eventMap[f]=d,s===!1&&(d.appendInPlace=s)),r.push(d)}}return r}parseSchedule(t,e){const s=[],r=e.main.details,a=r.live?1/0:r.edge;let o=0;if(t=t.filter(h=>!h.error&&!(h.cue.once&&h.hasPlayed)),t.length){this.resolveOffsets(t,e);let h=0,d=0;if(t.forEach((g,p)=>{const v=g.cue.pre,E=g.cue.post,S=t[p-1]||null,A=g.appendInPlace,b=E?a:g.startOffset,L=g.duration,_=g.timelineOccupancy===So.Range?L:0,D=g.resumptionOffset,k=(S==null?void 0:S.startTime)===b,w=b+g.cumulativeDuration;let V=A?w+L:b+D;if(v||!E&&b<=0){const $=d;d+=_,g.timelineStart=w;const G=o;o+=L,s.push({event:g,start:w,end:V,playout:{start:G,end:o},integrated:{start:$,end:d}})}else if(b<=a){if(!k){const B=b-h;if(B>gp){const Q=h,st=d;d+=B;const ut=o;o+=B;const dt={previousEvent:t[p-1]||null,nextEvent:g,start:Q,end:Q+B,playout:{start:ut,end:o},integrated:{start:st,end:d}};s.push(dt)}else B>0&&S&&(S.cumulativeDuration+=B,s[s.length-1].end=b)}E&&(V=w),g.timelineStart=w;const $=d;d+=_;const G=o;o+=L,s.push({event:g,start:w,end:V,playout:{start:G,end:o},integrated:{start:$,end:d}})}else return;const O=g.resumeTime;E||O>a?h=a:h=O}),h<a){var f;const g=h,p=d,v=a-h;d+=v;const E=o;o+=v,s.push({previousEvent:((f=s[s.length-1])==null?void 0:f.event)||null,nextEvent:null,start:h,end:g+v,playout:{start:E,end:o},integrated:{start:p,end:d}})}this.setDurations(a,o,d)}else s.push({previousEvent:null,nextEvent:null,start:0,end:a,playout:{start:0,end:a},integrated:{start:0,end:a}}),this.setDurations(a,a,a);return s}setDurations(t,e,s){this.durations={primary:t,playout:e,integrated:s}}resolveOffsets(t,e){const s=e.main.details,r=s.live?1/0:s.edge;let a=0,o=-1;t.forEach((f,h)=>{const d=f.cue.pre,g=f.cue.post,p=d?0:g?r:f.startTime;this.updateAssetDurations(f),o===p?f.cumulativeDuration=a:(a=0,o=p),!g&&f.snapOptions.in&&(f.resumeAnchor=un(null,s.fragments,f.startOffset+f.resumptionOffset,0,0)||void 0),f.appendInPlace&&!f.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(f,e)||(f.appendInPlace=!1)),!f.appendInPlace&&h+1<t.length&&t[h+1].startTime-t[h].resumeTime<gp&&(t[h+1].appendInPlace=!1,t[h+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${f}`));const E=ct(f.resumeOffset)?f.resumeOffset:f.duration;a+=E})}primaryCanResumeInPlaceAt(t,e){const s=t.resumeTime,r=t.startTime+t.resumptionOffset;return Math.abs(s-r)>ar?(this.log(`"${t.identifier}" resumption ${s} not aligned with estimated timeline end ${r}`),!1):!Object.keys(e).some(o=>{const f=e[o].details,h=f.edge;if(s>=h)return this.log(`"${t.identifier}" resumption ${s} past ${o} playlist end ${h}`),!1;const d=un(null,f.fragments,s);if(!d)return this.log(`"${t.identifier}" resumption ${s} does not align with any fragments in ${o} playlist (${f.fragStart}-${f.fragmentEnd})`),!0;const g=o==="audio"?.175:0;return Math.abs(d.start-s)<ar+g||Math.abs(d.end-s)<ar+g?!1:(this.log(`"${t.identifier}" resumption ${s} not aligned with ${o} fragment bounds (${d.start}-${d.end} sn: ${d.sn} cc: ${d.cc})`),!0)})}updateAssetDurations(t){if(!t.assetListLoaded)return;const e=t.timelineStart;let s=0,r=!1,a=!1;for(let o=0;o<t.assetList.length;o++){const f=t.assetList[o],h=e+s;f.startOffset=s,f.timelineStart=h,r||(r=f.duration===null),a||(a=!!f.error);const d=f.error?0:f.duration||0;s+=d}r&&!a?t.duration=Math.max(s,t.duration):t.duration=s}removeEvent(t){t.reset(),delete this.eventMap[t.identifier]}}function Ti(u){return`[${u.event?'"'+u.event.identifier+'"':"primary"}: ${u.start.toFixed(2)}-${u.end.toFixed(2)}]`}class K1{constructor(t){this.hls=void 0,this.hls=t}destroy(){this.hls=null}loadAssetList(t,e){const s=t.assetListUrl;let r;try{r=Zy(s,this.hls.sessionId,t.baseUrl)}catch(v){const E=this.assignAssetListError(t,z.ASSET_LIST_LOAD_ERROR,v,s);this.hls.trigger(x.ERROR,E);return}e&&r.protocol!=="data:"&&r.searchParams.set("_HLS_start_offset",""+e);const a=this.hls.config,o=a.loader,f=new o(a),h={responseType:"json",url:r.href},d=a.interstitialAssetListLoadPolicy.default,g={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(v,E,S,A)=>{const b=v.data,L=b==null?void 0:b.ASSETS;if(!Array.isArray(L)){const _=this.assignAssetListError(t,z.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),S.url,E,A);this.hls.trigger(x.ERROR,_);return}t.assetListResponse=b,this.hls.trigger(x.ASSET_LIST_LOADED,{event:t,assetListResponse:b,networkDetails:A})},onError:(v,E,S,A)=>{const b=this.assignAssetListError(t,z.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${v.code} ${v.text} (${E.url})`),E.url,A,S);this.hls.trigger(x.ERROR,b)},onTimeout:(v,E,S)=>{const A=this.assignAssetListError(t,z.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${E.url})`),E.url,v,S);this.hls.trigger(x.ERROR,A)}};return f.load(h,g,p),this.hls.trigger(x.ASSET_LIST_LOADING,{event:t}),f}assignAssetListError(t,e,s,r,a,o){return t.error=s,{type:pt.NETWORK_ERROR,details:e,fatal:!1,interstitial:t,url:r,error:s,networkDetails:o,stats:a}}}function mp(u){var t;u==null||(t=u.play())==null||t.catch(()=>{})}function Xl(u,t){return`[${u}] Advancing timeline position to ${t}`}class j1 extends mi{constructor(t,e){super("interstitials",t.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled||!this.schedule)return;const r=s-this.timelinePos;if(Math.abs(r)<1/7056e5)return;const o=r<=-.01;this.timelinePos=s,this.bufferedPos=s;const f=this.playingItem;if(!f){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(s,s-r)&&this.updateSchedule(!0),this.checkBuffer(),o&&s<f.start||s>=f.end){var h;const E=this.findItemIndex(f);let S=this.schedule.findItemIndexAtTime(s);if(S===-1&&(S=E+(o?-1:1),this.log(`seeked ${o?"back ":""}to position not covered by schedule ${s} (resolving from ${E} to ${S})`)),!this.isInterstitial(f)&&(h=this.media)!=null&&h.paused&&(this.shouldPlay=!1),!o&&S>E){const A=this.schedule.findJumpRestrictedIndex(E+1,S);if(A>E){this.setSchedulePosition(A);return}}this.setSchedulePosition(S);return}const d=this.playingAsset;if(!d){if(this.playingLastItem&&this.isInterstitial(f)){const E=f.event.assetList[0];E&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(s,E))}return}const g=d.timelineStart,p=d.duration||0;if(o&&s<g||s>=g+p){var v;(v=f.event)!=null&&v.appendInPlace&&(this.clearAssetPlayers(f.event,f),this.flushFrontBuffer(s)),this.setScheduleToAssetAtTime(s,d)}},this.onTimeupdate=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled)return;if(s>this.timelinePos)this.timelinePos=s,s>this.bufferedPos&&this.checkBuffer();else return;const r=this.playingItem;if(!r||this.playingLastItem)return;if(s>=r.end){this.timelinePos=r.end;const f=this.findItemIndex(r);this.setSchedulePosition(f+1)}const a=this.playingAsset;if(!a)return;const o=a.timelineStart+(a.duration||0);s>=o&&this.setScheduleToAssetAtTime(s,a)},this.onScheduleUpdate=(s,r)=>{const a=this.schedule;if(!a)return;const o=this.playingItem,f=a.events||[],h=a.items||[],d=a.durations,g=s.map(A=>A.identifier),p=!!(f.length||g.length);(p||r)&&this.log(`INTERSTITIALS_UPDATED (${f.length}): ${f}
Schedule: ${h.map(A=>Ti(A))} pos: ${this.timelinePos}`),g.length&&this.log(`Removed events ${g}`);let v=null,E=null;o&&(v=this.updateItem(o,this.timelinePos),this.itemsMatch(o,v)?this.playingItem=v:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const S=this.bufferingItem;if(S&&(E=this.updateItem(S,this.bufferedPos),this.itemsMatch(S,E)?this.bufferingItem=E:S.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(S.event,null))),s.forEach(A=>{A.assetList.forEach(b=>{this.clearAssetPlayer(b.identifier,null)})}),this.playerQueue.forEach(A=>{if(A.interstitial.appendInPlace){const b=A.assetItem.timelineStart,L=A.timelineOffset-b;if(L)try{A.timelineOffset=b}catch(_){Math.abs(L)>ar&&this.warn(`${_} ("${A.assetId}" ${A.timelineOffset}->${b})`)}}}),p||r){if(this.hls.trigger(x.INTERSTITIALS_UPDATED,{events:f.slice(0),schedule:h.slice(0),durations:d,removedIds:g}),this.isInterstitial(o)&&g.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}o&&this.trimInPlace(v,o),S&&E!==v&&this.trimInPlace(E,S),this.checkBuffer()}},this.hls=t,this.HlsPlayerClass=e,this.assetListLoader=new K1(t),this.schedule=new z1(this.onScheduleUpdate,t.logger),this.registerListeners()}registerListeners(){const t=this.hls;t&&(t.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(x.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(x.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),t.on(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(x.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),t.on(x.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),t.on(x.ASSET_LIST_LOADED,this.onAssetListLoaded,this),t.on(x.BUFFER_APPENDED,this.onBufferAppended,this),t.on(x.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(x.BUFFERED_TO_END,this.onBufferedToEnd,this),t.on(x.MEDIA_ENDED,this.onMediaEnded,this),t.on(x.ERROR,this.onError,this),t.on(x.DESTROYING,this.onDestroying,this))}unregisterListeners(){const t=this.hls;t&&(t.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(x.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(x.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),t.off(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(x.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),t.off(x.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),t.off(x.ASSET_LIST_LOADED,this.onAssetListLoaded,this),t.off(x.BUFFER_CODECS,this.onBufferCodecs,this),t.off(x.BUFFER_APPENDED,this.onBufferAppended,this),t.off(x.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(x.BUFFERED_TO_END,this.onBufferedToEnd,this),t.off(x.MEDIA_ENDED,this.onMediaEnded,this),t.off(x.ERROR,this.onError,this),t.off(x.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var t;(t=this.getBufferingPlayer())==null||t.resumeBuffering()}pauseBuffering(){var t;(t=this.getBufferingPlayer())==null||t.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const t=this.primaryMedia||this.media;t&&this.removeMediaListeners(t)}removeMediaListeners(t){He(t,"play",this.onPlay),He(t,"pause",this.onPause),He(t,"seeking",this.onSeeking),He(t,"timeupdate",this.onTimeupdate)}onMediaAttaching(t,e){const s=this.media=e.media;Me(s,"seeking",this.onSeeking),Me(s,"timeupdate",this.onTimeupdate),Me(s,"play",this.onPlay),Me(s,"pause",this.onPause)}onMediaAttached(t,e){const s=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,s===null)this.checkStart();else if(!r){this.clearScheduleState();const a=this.findItemIndex(s);this.setSchedulePosition(a)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(t,e){const s=!!e.transferMedia,r=this.media;if(this.media=null,!s&&(r&&this.removeMediaListeners(r),this.detachedData)){const a=this.getBufferingPlayer();a&&(this.log(`Removing schedule state for detachedData and ${a}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,a.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const t=this,e=()=>t.bufferingItem||t.waitingItem,s=p=>p&&t.getAssetPlayer(p.identifier),r=(p,v,E,S,A)=>{if(p){let b=p[v].start;const L=p.event;if(L){if(v==="playout"||L.timelineOccupancy!==So.Point){const _=s(E);(_==null?void 0:_.interstitial)===L&&(b+=_.assetItem.startOffset+_[A])}}else{const _=S==="bufferedPos"?o():t[S];b+=_-p.start}return b}return 0},a=(p,v)=>{var E;if(p!==0&&v!=="primary"&&(E=t.schedule)!=null&&E.length){var S;const A=t.schedule.findItemIndexAtTime(p),b=(S=t.schedule.items)==null?void 0:S[A];if(b){const L=b[v].start-b.start;return p+L}}return p},o=()=>{const p=t.bufferedPos;return p===Number.MAX_VALUE?f("primary"):Math.max(p,0)},f=p=>{var v,E;return(v=t.primaryDetails)!=null&&v.live?t.primaryDetails.edge:((E=t.schedule)==null?void 0:E.durations[p])||0},h=(p,v)=>{var E,S;const A=t.effectivePlayingItem;if(A!=null&&(E=A.event)!=null&&E.restrictions.skip||!t.schedule)return;t.log(`seek to ${p} "${v}"`);const b=t.effectivePlayingItem,L=t.schedule.findItemIndexAtTime(p,v),_=(S=t.schedule.items)==null?void 0:S[L],D=t.getBufferingPlayer(),k=D==null?void 0:D.interstitial,w=k==null?void 0:k.appendInPlace,V=b&&t.itemsMatch(b,_);if(b&&(w||V)){const O=s(t.playingAsset),$=(O==null?void 0:O.media)||t.primaryMedia;if($){const G=v==="primary"?$.currentTime:r(b,v,t.playingAsset,"timelinePos","currentTime"),B=p-G,Q=(w?G:$.currentTime)+B;if(Q>=0&&(!O||w||Q<=O.duration)){$.currentTime=Q;return}}}if(_){let O=p;if(v!=="primary"){const G=_[v].start,B=p-G;O=_.start+B}const $=!t.isInterstitial(_);if((!t.isInterstitial(b)||b.event.appendInPlace)&&($||_.event.appendInPlace)){const G=t.media||(w?D==null?void 0:D.media:null);G&&(G.currentTime=O)}else if(b){const G=t.findItemIndex(b);if(L>G){const Q=t.schedule.findJumpRestrictedIndex(G+1,L);if(Q>G){t.setSchedulePosition(Q);return}}let B=0;if($)t.timelinePos=O,t.checkBuffer();else{const Q=_.event.assetList,st=p-(_[v]||_).start;for(let ut=Q.length;ut--;){const dt=Q[ut];if(dt.duration&&st>=dt.startOffset&&st<dt.startOffset+dt.duration){B=ut;break}}}t.setSchedulePosition(L,B)}}},d=()=>{const p=t.effectivePlayingItem;if(t.isInterstitial(p))return p;const v=e();return t.isInterstitial(v)?v:null},g={get bufferedEnd(){const p=e(),v=t.bufferingItem;if(v&&v===p){var E;return r(v,"playout",t.bufferingAsset,"bufferedPos","bufferedEnd")-v.playout.start||((E=t.bufferingAsset)==null?void 0:E.startOffset)||0}return 0},get currentTime(){const p=d(),v=t.effectivePlayingItem;return v&&v===p?r(v,"playout",t.effectivePlayingAsset,"timelinePos","currentTime")-v.playout.start:0},set currentTime(p){const v=d(),E=t.effectivePlayingItem;E&&E===v&&h(p+E.playout.start,"playout")},get duration(){const p=d();return p?p.playout.end-p.playout.start:0},get assetPlayers(){var p;const v=(p=d())==null?void 0:p.event.assetList;return v?v.map(E=>t.getAssetPlayer(E.identifier)):[]},get playingIndex(){var p;const v=(p=d())==null?void 0:p.event;return v&&t.effectivePlayingAsset?v.findAssetIndex(t.effectivePlayingAsset):-1},get scheduleItem(){return d()}};return this.manager={get events(){var p;return((p=t.schedule)==null||(p=p.events)==null?void 0:p.slice(0))||[]},get schedule(){var p;return((p=t.schedule)==null||(p=p.items)==null?void 0:p.slice(0))||[]},get interstitialPlayer(){return d()?g:null},get playerQueue(){return t.playerQueue.slice(0)},get bufferingAsset(){return t.bufferingAsset},get bufferingItem(){return e()},get bufferingIndex(){const p=e();return t.findItemIndex(p)},get playingAsset(){return t.effectivePlayingAsset},get playingItem(){return t.effectivePlayingItem},get playingIndex(){const p=t.effectivePlayingItem;return t.findItemIndex(p)},primary:{get bufferedEnd(){return o()},get currentTime(){const p=t.timelinePos;return p>0?p:0},set currentTime(p){h(p,"primary")},get duration(){return f("primary")},get seekableStart(){var p;return((p=t.primaryDetails)==null?void 0:p.fragmentStart)||0}},integrated:{get bufferedEnd(){return r(e(),"integrated",t.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return r(t.effectivePlayingItem,"integrated",t.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(p){h(p,"integrated")},get duration(){return f("integrated")},get seekableStart(){var p;return a(((p=t.primaryDetails)==null?void 0:p.fragmentStart)||0,"integrated")}},skip:()=>{const p=t.effectivePlayingItem,v=p==null?void 0:p.event;if(v&&!v.restrictions.skip){const E=t.findItemIndex(p);if(v.appendInPlace){const S=p.playout.start+p.event.duration;h(S+.001,"playout")}else t.advanceAfterAssetEnded(v,E,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var t;const e=this.playingItem,s=(t=this.schedule)==null?void 0:t.items;return!this.playbackStarted||!e||!s?!1:this.findItemIndex(e)===s.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var t,e;if(this.mediaSelection===null)return;const s=this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&!s.event.appendInPlace)return;let r=this.media;!r&&(t=this.bufferingItem)!=null&&(t=t.event)!=null&&t.appendInPlace&&(r=this.primaryMedia);const a=(e=r)==null?void 0:e.currentTime;if(!(a===void 0||!ct(a)))return a}get primaryMedia(){var t;return this.media||((t=this.detachedData)==null?void 0:t.media)||null}isInterstitial(t){return!!(t!=null&&t.event)}retreiveMediaSource(t,e){const s=this.getAssetPlayer(t);s&&this.transferMediaFromPlayer(s,e)}transferMediaFromPlayer(t,e){const s=t.interstitial.appendInPlace,r=t.media;if(s&&r===this.primaryMedia){if(this.bufferingAsset=null,(!e||this.isInterstitial(e)&&!e.event.appendInPlace)&&e&&r){this.detachedData={media:r};return}const a=t.transferMedia();this.log(`transfer MediaSource from ${t} ${Xt(a)}`),this.detachedData=a}else e&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(t,e){var s,r;if(t.media===e)return;let a=null;const o=this.hls,f=t!==o,h=f&&t.interstitial.appendInPlace,d=(s=this.detachedData)==null?void 0:s.mediaSource;let g;if(o.media)h&&(a=o.transferMedia(),this.detachedData=a),g="Primary";else if(d){const S=this.getBufferingPlayer();S?(a=S.transferMedia(),g=`${S}`):g="detached MediaSource"}else g="detached media";if(!a){if(d)a=this.detachedData,this.log(`using detachedData: MediaSource ${Xt(a)}`);else if(!this.detachedData||o.media===e){const S=this.playerQueue;S.length>1&&S.forEach(A=>{if(f&&A.interstitial.appendInPlace!==h){const b=A.interstitial;this.clearInterstitial(A.interstitial,null),b.appendInPlace=!1,b.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${b}`)}}),this.hls.detachMedia(),this.detachedData={media:e}}}const p=a&&"mediaSource"in a&&((r=a.mediaSource)==null?void 0:r.readyState)!=="closed",v=p&&a?a:e;this.log(`${p?"transfering MediaSource":"attaching media"} to ${f?t:"Primary"} from ${g} (media.currentTime: ${e.currentTime})`);const E=this.schedule;if(v===a&&E){const S=f&&t.assetId===E.assetIdAtEnd;v.overrides={duration:E.duration,endOfStream:!f||S,cueRemoval:!f}}t.attachMedia(v)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const t=this.schedule,e=t==null?void 0:t.events;if(!e||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const s=this.timelinePos,r=this.effectivePlayingItem;if(s===-1){const a=this.hls.startPosition;if(this.log(Xl("checkStart",a)),this.timelinePos=a,e.length&&e[0].cue.pre){const o=t.findEventIndex(e[0].identifier);this.setSchedulePosition(o)}else if(a>=0||!this.primaryLive){const o=this.timelinePos=a>0?a:0,f=t.findItemIndexAtTime(o);this.setSchedulePosition(f)}}else if(r&&!this.playingItem){const a=t.findItemIndex(r);this.setSchedulePosition(a)}}advanceAssetBuffering(t,e){const s=t.event,r=s.findAssetIndex(e),a=sf(s,r);if(!s.isAssetPastPlayoutLimit(a))this.bufferedToEvent(t,a);else if(this.schedule){var o;const f=(o=this.schedule.items)==null?void 0:o[this.findItemIndex(t)+1];f&&this.bufferedToItem(f)}}advanceAfterAssetEnded(t,e,s){const r=sf(t,s);if(t.isAssetPastPlayoutLimit(r)){if(this.schedule){const a=this.schedule.items;if(a){const o=e+1,f=a.length;if(o>=f){this.setSchedulePosition(-1);return}const h=t.resumeTime;this.timelinePos<h&&(this.log(Xl("advanceAfterAssetEnded",h)),this.timelinePos=h,t.appendInPlace&&this.advanceInPlace(h),this.checkBuffer(this.bufferedPos<h)),this.setSchedulePosition(o)}}}else{if(t.appendInPlace){const a=t.assetList[r];a&&this.advanceInPlace(a.timelineStart)}this.setSchedulePosition(e,r)}}setScheduleToAssetAtTime(t,e){const s=this.schedule;if(!s)return;const r=e.parentIdentifier,a=s.getEvent(r);if(a){const o=s.findEventIndex(r),f=s.findAssetIndex(a,t);this.advanceAfterAssetEnded(a,o,f-1)}}setSchedulePosition(t,e){var s;const r=(s=this.schedule)==null?void 0:s.items;if(!r||this.playbackDisabled)return;const a=t>=0?r[t]:null;this.log(`setSchedulePosition ${t}, ${e} (${a&&Ti(a)}) pos: ${this.timelinePos}`);const o=this.waitingItem||this.playingItem,f=this.playingLastItem;if(this.isInterstitial(o)){const g=o.event,p=this.playingAsset,v=p==null?void 0:p.identifier,E=v?this.getAssetPlayer(v):null;if(E&&v&&(!this.eventItemsMatch(o,a)||e!==void 0&&v!==g.assetList[e].identifier)){var h;const S=g.findAssetIndex(p);if(this.log(`INTERSTITIAL_ASSET_ENDED ${S+1}/${g.assetList.length} ${er(p)}`),this.endedAsset=p,this.playingAsset=null,this.hls.trigger(x.INTERSTITIAL_ASSET_ENDED,{asset:p,assetListIndex:S,event:g,schedule:r.slice(0),scheduleIndex:t,player:E}),o!==this.playingItem){this.itemsMatch(o,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(g,this.findItemIndex(this.playingItem),S);return}this.retreiveMediaSource(v,a),E.media&&!((h=this.detachedData)!=null&&h.mediaSource)&&E.detachMedia()}if(!this.eventItemsMatch(o,a)&&(this.endedItem=o,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${g} ${Ti(o)}`),g.hasPlayed=!0,this.hls.trigger(x.INTERSTITIAL_ENDED,{event:g,schedule:r.slice(0),scheduleIndex:t}),g.cue.once)){var d;this.updateSchedule();const S=(d=this.schedule)==null?void 0:d.items;if(a&&S){const A=this.findItemIndex(a);this.advanceSchedule(A,S,e,o,f)}return}}this.advanceSchedule(t,r,e,o,f)}advanceSchedule(t,e,s,r,a){const o=this.schedule;if(!o)return;const f=e[t]||null,h=this.primaryMedia,d=this.playerQueue;if(d.length&&d.forEach(g=>{const p=g.interstitial,v=o.findEventIndex(p.identifier);(v<t||v>t+1)&&this.clearInterstitial(p,f)}),this.isInterstitial(f)){this.timelinePos=Math.min(Math.max(this.timelinePos,f.start),f.end);const g=f.event;if(s===void 0){s=o.findAssetIndex(g,this.timelinePos);const S=sf(g,s-1);if(g.isAssetPastPlayoutLimit(S)||g.appendInPlace&&this.timelinePos===f.end){this.advanceAfterAssetEnded(g,t,s);return}s=S}const p=this.waitingItem;this.assetsBuffered(f,h)||this.setBufferingItem(f);let v=this.preloadAssets(g,s);if(this.eventItemsMatch(f,p||r)||(this.waitingItem=f,this.log(`INTERSTITIAL_STARTED ${Ti(f)} ${g.appendInPlace?"append in place":""}`),this.hls.trigger(x.INTERSTITIAL_STARTED,{event:g,schedule:e.slice(0),scheduleIndex:t})),!g.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${g}`);return}if(g.assetListLoader&&(g.assetListLoader.destroy(),g.assetListLoader=void 0),!h){this.log(`Waiting for attachMedia to start Interstitial ${g}`);return}this.waitingItem=this.endedItem=null,this.playingItem=f;const E=g.assetList[s];if(!E){this.advanceAfterAssetEnded(g,t,s||0);return}if(v||(v=this.getAssetPlayer(E.identifier)),v===null||v.destroyed){const S=g.assetList.length;this.warn(`asset ${s+1}/${S} player destroyed ${g}`),v=this.createAssetPlayer(g,E,s),v.loadSource()}if(!this.eventItemsMatch(f,this.bufferingItem)&&g.appendInPlace&&this.isAssetBuffered(E))return;this.startAssetPlayer(v,s,e,t,h),this.shouldPlay&&mp(v.media)}else f?(this.resumePrimary(f,t,r),this.shouldPlay&&mp(this.hls.media)):a&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(o.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var t;return(t=this.mediaSelection)==null?void 0:t.main.details}get primaryLive(){var t;return!!((t=this.primaryDetails)!=null&&t.live)}resumePrimary(t,e,s){var r,a;if(this.playingItem=t,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(t),this.log(`resuming ${Ti(t)}`),!((r=this.detachedData)!=null&&r.mediaSource)){let f=this.timelinePos;(f<t.start||f>=t.end)&&(f=this.getPrimaryResumption(t,e),this.log(Xl("resumePrimary",f)),this.timelinePos=f),this.attachPrimary(f,t)}if(!s)return;const o=(a=this.schedule)==null?void 0:a.items;o&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Ti(t)}`),this.hls.trigger(x.INTERSTITIALS_PRIMARY_RESUMED,{schedule:o.slice(0),scheduleIndex:e}),this.checkBuffer())}getPrimaryResumption(t,e){const s=t.start;if(this.primaryLive){const r=this.primaryDetails;if(e===0)return this.hls.startPosition;if(r&&(s<r.fragmentStart||s>r.edge))return this.hls.liveSyncPosition||-1}return s}isAssetBuffered(t){const e=this.getAssetPlayer(t.identifier);return e!=null&&e.hls?e.hls.bufferedToEnd:Tt.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=t.timelineStart+(t.duration||0)}attachPrimary(t,e,s){e?this.setBufferingItem(e):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const r=this.primaryMedia;if(!r)return;const a=this.hls;a.media?this.checkBuffer():(this.transferMediaTo(a,r),s&&this.startLoadingPrimaryAt(t,s)),s||(this.log(Xl("attachPrimary",t)),this.timelinePos=t,this.startLoadingPrimaryAt(t,s))}startLoadingPrimaryAt(t,e){var s;const r=this.hls;!r.loadingEnabled||!r.media||Math.abs((((s=r.mainForwardBufferInfo)==null?void 0:s.start)||r.media.currentTime)-t)>.5?r.startLoad(t,e):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){var t;this.stopLoad(),(t=this.schedule)==null||t.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(x.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(x.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(t,e){if(e.level===-1||!this.schedule)return;const s=this.hls.levels[e.level];if(!s.details)return;const r=$t($t({},this.mediaSelection||this.altSelection),{},{main:s});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(t,e){const s=this.hls.audioTracks[e.id],r=this.mediaSelection;if(!r){this.altSelection=$t($t({},this.altSelection),{},{audio:s});return}const a=$t($t({},r),{},{audio:s});this.mediaSelection=a}onSubtitleTrackUpdated(t,e){const s=this.hls.subtitleTracks[e.id],r=this.mediaSelection;if(!r){this.altSelection=$t($t({},this.altSelection),{},{subtitles:s});return}const a=$t($t({},r),{},{subtitles:s});this.mediaSelection=a}onAudioTrackSwitching(t,e){const s=bm(e);this.playerQueue.forEach(({hls:r})=>r&&(r.setAudioOption(e)||r.setAudioOption(s)))}onSubtitleTrackSwitch(t,e){const s=bm(e);this.playerQueue.forEach(({hls:r})=>r&&(r.setSubtitleOption(e)||e.id!==-1&&r.setSubtitleOption(s)))}onBufferCodecs(t,e){const s=e.tracks;s&&(this.requiredTracks=s)}onBufferAppended(t,e){this.checkBuffer()}onBufferFlushed(t,e){const s=this.playingItem;if(s&&!this.itemsMatch(s,this.bufferingItem)&&!this.isInterstitial(s)){const r=this.timelinePos;this.bufferedPos=r,this.checkBuffer()}}onBufferedToEnd(t){if(!this.schedule)return;const e=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&e){for(let r=0;r<e.length;r++){const a=e[r];if(a.cue.post){var s;const o=this.schedule.findEventIndex(a.identifier),f=(s=this.schedule.items)==null?void 0:s[o];this.isInterstitial(f)&&this.eventItemsMatch(f,this.bufferingItem)&&this.bufferedToItem(f,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(t){const e=this.playingItem;if(!this.playingLastItem&&e){const s=this.findItemIndex(e);this.setSchedulePosition(s+1)}else this.shouldPlay=!1}updateItem(t,e){var s;const r=(s=this.schedule)==null?void 0:s.items;if(t&&r){const a=this.findItemIndex(t,e);return r[a]||null}return null}trimInPlace(t,e){if(this.isInterstitial(t)&&t.event.appendInPlace&&e.end-t.end>.25){t.event.assetList.forEach((a,o)=>{t.event.isAssetPastPlayoutLimit(o)&&this.clearAssetPlayer(a.identifier,null)});const s=t.end+.25,r=Tt.bufferInfo(this.primaryMedia,s,0);(r.end>s||(r.nextStart||0)>s)&&(this.log(`trim buffered interstitial ${Ti(t)} (was ${Ti(e)})`),this.attachPrimary(s,null,!0),this.flushFrontBuffer(s))}}itemsMatch(t,e){return!!e&&(t===e||t.event&&e.event&&this.eventItemsMatch(t,e)||!t.event&&!e.event&&this.findItemIndex(t)===this.findItemIndex(e))}eventItemsMatch(t,e){var s;return!!e&&(t===e||t.event.identifier===((s=e.event)==null?void 0:s.identifier))}findItemIndex(t,e){return t&&this.schedule?this.schedule.findItemIndex(t,e):-1}updateSchedule(t=!1){var e;const s=this.mediaSelection;s&&((e=this.schedule)==null||e.updateSchedule(s,[],t))}checkBuffer(t){var e;const s=(e=this.schedule)==null?void 0:e.items;if(!s)return;const r=Tt.bufferInfo(this.primaryMedia,this.timelinePos,0);t&&(this.bufferedPos=this.timelinePos),t||(t=r.len<1),this.updateBufferedPos(r.end,s,t)}updateBufferedPos(t,e,s){const r=this.schedule,a=this.bufferingItem;if(this.bufferedPos>t||!r)return;if(e.length===1&&this.itemsMatch(e[0],a)){this.bufferedPos=t;return}const o=this.playingItem,f=this.findItemIndex(o);let h=r.findItemIndexAtTime(t);if(this.bufferedPos<t){var d;const g=this.findItemIndex(a),p=Math.min(g+1,e.length-1),v=e[p];if((h===-1&&a&&t>=a.end||(d=v.event)!=null&&d.appendInPlace&&t+.01>=v.start)&&(h=p),this.isInterstitial(a)){const E=a.event;if(p-f>1&&E.appendInPlace===!1||E.assetList.length===0&&E.assetListLoader)return}if(this.bufferedPos=t,h>g&&h>f)this.bufferedToItem(v);else{const E=this.primaryDetails;this.primaryLive&&E&&t>E.edge-E.targetduration&&v.start<E.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(v)&&this.preloadAssets(v.event,0)}}else s&&o&&!this.itemsMatch(o,a)&&(h===f?this.bufferedToItem(o):h===f+1&&this.bufferedToItem(e[h]))}assetsBuffered(t,e){return t.event.assetList.length===0?!1:!t.event.assetList.some(r=>{const a=this.getAssetPlayer(r.identifier);return!(a!=null&&a.bufferedInPlaceToEnd(e))})}setBufferingItem(t){const e=this.bufferingItem,s=this.schedule;if(!this.itemsMatch(t,e)&&s){const{items:r,events:a}=s;if(!r||!a)return e;const o=this.isInterstitial(t),f=this.getBufferingPlayer();this.bufferingItem=t,this.bufferedPos=Math.max(t.start,Math.min(t.end,this.timelinePos));const h=f?f.remaining:e?e.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Ti(t)}`+(e?` (${h.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(o){const d=s.findAssetIndex(t.event,this.bufferedPos);t.event.assetList.forEach((g,p)=>{const v=this.getAssetPlayer(g.identifier);v&&(p===d&&v.loadSource(),v.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(d=>d.pauseBuffering());this.hls.trigger(x.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:a.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(t),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==t&&(this.bufferingItem=t);return e}bufferedToItem(t,e=0){const s=this.setBufferingItem(t);if(!this.playbackDisabled){if(this.isInterstitial(t))this.bufferedToEvent(t,e);else if(s!==null){this.bufferingAsset=null;const r=this.detachedData;r?r.mediaSource?this.attachPrimary(t.start,t,!0):this.preloadPrimary(t):this.preloadPrimary(t)}}}preloadPrimary(t){const e=this.findItemIndex(t),s=this.getPrimaryResumption(t,e);this.startLoadingPrimaryAt(s)}bufferedToEvent(t,e){const s=t.event,r=s.assetList.length===0&&!s.assetListLoader,a=s.cue.once;if(r||!a){const o=this.preloadAssets(s,e);if(o!=null&&o.interstitial.appendInPlace){const f=this.primaryMedia;f&&this.bufferAssetPlayer(o,f)}}}preloadAssets(t,e){const s=t.assetUrl,r=t.assetList.length,a=r===0&&!t.assetListLoader,o=t.cue.once;if(a){const h=t.timelineStart;if(t.appendInPlace){var f;const v=this.playingItem;!this.isInterstitial(v)&&(v==null||(f=v.nextEvent)==null?void 0:f.identifier)===t.identifier&&this.flushFrontBuffer(h+.25)}let d,g=0;if(!this.playingItem&&this.primaryLive&&(g=this.hls.startPosition,g===-1&&(g=this.hls.liveSyncPosition||0)),g&&!(t.cue.pre||t.cue.post)){const v=g-h;v>0&&(d=Math.round(v*1e3)/1e3)}if(this.log(`Load interstitial asset ${e+1}/${s?1:r} ${t}${d?` live-start: ${g} start-offset: ${d}`:""}`),s)return this.createAsset(t,0,0,h,t.duration,s);const p=this.assetListLoader.loadAssetList(t,d);p&&(t.assetListLoader=p)}else if(!o&&r){for(let d=e;d<r;d++){const g=t.assetList[d],p=this.getAssetPlayerQueueIndex(g.identifier);(p===-1||this.playerQueue[p].destroyed)&&!g.error&&this.createAssetPlayer(t,g,d)}const h=t.assetList[e];if(h){const d=this.getAssetPlayer(h.identifier);return d&&d.loadSource(),d}}return null}flushFrontBuffer(t){const e=this.requiredTracks;if(!e)return;this.log(`Removing front buffer starting at ${t}`),Object.keys(e).forEach(r=>{this.hls.trigger(x.BUFFER_FLUSHING,{startOffset:t,endOffset:1/0,type:r})})}getAssetPlayerQueueIndex(t){const e=this.playerQueue;for(let s=0;s<e.length;s++)if(t===e[s].assetId)return s;return-1}getAssetPlayer(t){const e=this.getAssetPlayerQueueIndex(t);return this.playerQueue[e]||null}getBufferingPlayer(){const{playerQueue:t,primaryMedia:e}=this;if(e){for(let s=0;s<t.length;s++)if(t[s].media===e)return t[s]}return null}createAsset(t,e,s,r,a,o){const f={parentIdentifier:t.identifier,identifier:F1(t,o,e),duration:a,startOffset:s,timelineStart:r,uri:o};return this.createAssetPlayer(t,f,e)}createAssetPlayer(t,e,s){const r=this.hls,a=r.userConfig;let o=a.videoPreference;const f=r.loadLevelObj||r.levels[r.currentLevel];(o||f)&&(o=jt({},o),f.videoCodec&&(o.videoCodec=f.videoCodec),f.videoRange&&(o.allowedVideoRanges=[f.videoRange]));const h=r.audioTracks[r.audioTrack],d=r.subtitleTracks[r.subtitleTrack];let g=0;if(this.primaryLive||t.appendInPlace){const k=this.timelinePos-e.timelineStart;if(k>1){const w=e.duration;w&&k<w&&(g=k)}}const p=e.identifier,v=$t($t({},a),{},{maxMaxBufferLength:Math.min(180,r.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:p,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:g,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:h||a.audioPreference,subtitlePreference:d||a.subtitlePreference});t.appendInPlace&&(t.appendInPlaceStarted=!0,e.timelineStart&&(v.timelineOffset=e.timelineStart));const E=v.cmcd;E!=null&&E.sessionId&&E.contentId&&(v.cmcd=jt({},E,{contentId:ca(e.uri)})),this.getAssetPlayer(p)&&this.warn(`Duplicate date range identifier ${t} and asset ${p}`);const S=new H1(this.HlsPlayerClass,v,t,e);this.playerQueue.push(S),t.assetList[s]=e;let A=!0;const b=k=>{if(k.live){var w;const $=new Error(`Interstitials MUST be VOD assets ${t}`),G={fatal:!0,type:pt.OTHER_ERROR,details:z.INTERSTITIAL_ASSET_ITEM_ERROR,error:$},B=((w=this.schedule)==null?void 0:w.findEventIndex(t.identifier))||-1;this.handleAssetItemError(G,t,B,s,$.message);return}const V=k.edge-k.fragmentStart,O=e.duration;(A||O===null||V>O)&&(A=!1,this.log(`Interstitial asset "${p}" duration change ${O} > ${V}`),e.duration=V,this.updateSchedule())};S.on(x.LEVEL_UPDATED,(k,{details:w})=>b(w)),S.on(x.LEVEL_PTS_UPDATED,(k,{details:w})=>b(w)),S.on(x.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const L=(k,w)=>{const V=this.getAssetPlayer(p);if(V&&w.tracks){V.off(x.BUFFER_CODECS,L),V.tracks=w.tracks;const O=this.primaryMedia;this.bufferingAsset===V.assetItem&&O&&!V.media&&this.bufferAssetPlayer(V,O)}};S.on(x.BUFFER_CODECS,L);const _=()=>{var k;const w=this.getAssetPlayer(p);if(this.log(`buffered to end of asset ${w}`),!w||!this.schedule)return;const V=this.schedule.findEventIndex(t.identifier),O=(k=this.schedule.items)==null?void 0:k[V];this.isInterstitial(O)&&this.advanceAssetBuffering(O,e)};S.on(x.BUFFERED_TO_END,_);const D=k=>()=>{if(!this.getAssetPlayer(p)||!this.schedule)return;this.shouldPlay=!0;const V=this.schedule.findEventIndex(t.identifier);this.advanceAfterAssetEnded(t,V,k)};return S.once(x.MEDIA_ENDED,D(s)),S.once(x.PLAYOUT_LIMIT_REACHED,D(1/0)),S.on(x.ERROR,(k,w)=>{if(!this.schedule)return;const V=this.getAssetPlayer(p);if(w.details===z.BUFFER_STALLED_ERROR){if(V!=null&&V.appendInPlace){this.handleInPlaceStall(t);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(w,t,this.schedule.findEventIndex(t.identifier),s,`Asset player error ${w.error} ${t}`)}),S.on(x.DESTROYING,()=>{if(!this.getAssetPlayer(p)||!this.schedule)return;const w=new Error(`Asset player destroyed unexpectedly ${p}`),V={fatal:!0,type:pt.OTHER_ERROR,details:z.INTERSTITIAL_ASSET_ITEM_ERROR,error:w};this.handleAssetItemError(V,t,this.schedule.findEventIndex(t.identifier),s,w.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${er(e)}`),this.hls.trigger(x.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:e,assetListIndex:s,event:t,player:S}),S}clearInterstitial(t,e){this.clearAssetPlayers(t,e),t.reset()}clearAssetPlayers(t,e){t.assetList.forEach(s=>{this.clearAssetPlayer(s.identifier,e)})}resetAssetPlayer(t){const e=this.getAssetPlayerQueueIndex(t);if(e!==-1){this.log(`reset asset player "${t}" after error`);const s=this.playerQueue[e];this.transferMediaFromPlayer(s,null),s.resetDetails()}}clearAssetPlayer(t,e){const s=this.getAssetPlayerQueueIndex(t);if(s!==-1){const r=this.playerQueue[s];this.log(`clear ${r} toSegment: ${e&&Ti(e)}`),this.transferMediaFromPlayer(r,e),this.playerQueue.splice(s,1),r.destroy()}}emptyPlayerQueue(){let t;for(;t=this.playerQueue.pop();)t.destroy();this.playerQueue=[]}startAssetPlayer(t,e,s,r,a){const{interstitial:o,assetItem:f,assetId:h}=t,d=o.assetList.length,g=this.playingAsset;this.endedAsset=null,this.playingAsset=f,(!g||g.identifier!==h)&&(g&&(this.clearAssetPlayer(g.identifier,s[r]),delete g.error),this.log(`INTERSTITIAL_ASSET_STARTED ${e+1}/${d} ${er(f)}`),this.hls.trigger(x.INTERSTITIAL_ASSET_STARTED,{asset:f,assetListIndex:e,event:o,schedule:s.slice(0),scheduleIndex:r,player:t})),this.bufferAssetPlayer(t,a)}bufferAssetPlayer(t,e){var s,r;if(!this.schedule)return;const{interstitial:a,assetItem:o}=t,f=this.schedule.findEventIndex(a.identifier),h=(s=this.schedule.items)==null?void 0:s[f];if(!h)return;t.loadSource(),this.setBufferingItem(h),this.bufferingAsset=o;const d=this.getBufferingPlayer();if(d===t)return;const g=a.appendInPlace;if(g&&(d==null?void 0:d.interstitial.appendInPlace)===!1)return;const p=(d==null?void 0:d.tracks)||((r=this.detachedData)==null?void 0:r.tracks)||this.requiredTracks;if(g&&o!==this.playingAsset){if(!t.tracks){this.log(`Waiting for track info before buffering ${t}`);return}if(p&&!wp(p,t.tracks)){const v=new Error(`Asset ${er(o)} SourceBuffer tracks ('${Object.keys(t.tracks)}') are not compatible with primary content tracks ('${Object.keys(p)}')`),E={fatal:!0,type:pt.OTHER_ERROR,details:z.INTERSTITIAL_ASSET_ITEM_ERROR,error:v},S=a.findAssetIndex(o);this.handleAssetItemError(E,a,f,S,v.message);return}}this.transferMediaTo(t,e)}handleInPlaceStall(t){const e=this.schedule,s=this.primaryMedia;if(!e||!s)return;const r=s.currentTime,a=e.findAssetIndex(t,r),o=t.assetList[a];if(o){const f=this.getAssetPlayer(o.identifier);if(f){const h=f.currentTime||r-o.timelineStart,d=f.duration-h;if(this.warn(`Stalled at ${h} of ${h+d} in ${f} ${t} (media.currentTime: ${r})`),h&&(d/s.playbackRate<.5||f.bufferedInPlaceToEnd(s))&&f.hls){const g=e.findEventIndex(t.identifier);this.advanceAfterAssetEnded(t,g,a)}}}}advanceInPlace(t){const e=this.primaryMedia;e&&e.currentTime<t&&(e.currentTime=t)}handleAssetItemError(t,e,s,r,a){if(t.details===z.BUFFER_STALLED_ERROR)return;const o=e.assetList[r]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${o&&er(o)} ${t.error}`),!this.schedule)return;const f=(o==null?void 0:o.identifier)||"",h=this.getAssetPlayerQueueIndex(f),d=this.playerQueue[h]||null,g=this.schedule.items,p=jt({},t,{fatal:!1,errorAction:sr(!0),asset:o,assetListIndex:r,event:e,schedule:g,scheduleIndex:s,player:d});if(this.hls.trigger(x.INTERSTITIAL_ASSET_ERROR,p),!t.fatal)return;const v=this.playingAsset,E=this.bufferingAsset,S=new Error(a);if(o&&(this.clearAssetPlayer(f,null),o.error=S),!e.assetList.some(A=>!A.error))e.error=S;else for(let A=r;A<e.assetList.length;A++)this.resetAssetPlayer(e.assetList[A].identifier);this.updateSchedule(!0),e.error?this.primaryFallback(e):v&&v.identifier===f?this.advanceAfterAssetEnded(e,s,r):E&&E.identifier===f&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,E)}primaryFallback(t){const e=t.timelineStart,s=this.effectivePlayingItem;let r=this.timelinePos;if(s){this.log(`Fallback to primary from event "${t.identifier}" start: ${e} pos: ${r} playing: ${Ti(s)} error: ${t.error}`),r===-1&&(r=this.hls.startPosition);const o=this.updateItem(s,r);this.itemsMatch(s,o)&&this.clearInterstitial(t,null),t.appendInPlace&&(this.attachPrimary(e,null),this.flushFrontBuffer(e))}else if(r===-1){this.checkStart();return}if(!this.schedule)return;const a=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(a)}onAssetListLoaded(t,e){var s,r;const a=e.event,o=a.identifier,f=e.assetListResponse.ASSETS;if(!((s=this.schedule)!=null&&s.hasEvent(o)))return;const h=a.timelineStart,d=a.duration;let g=0;f.forEach((A,b)=>{const L=parseFloat(A.DURATION);this.createAsset(a,b,g,h+g,L,A.URI),g+=L}),a.duration=g,this.log(`Loaded asset-list with duration: ${g} (was: ${d}) ${a}`);const p=this.waitingItem,v=(p==null?void 0:p.event.identifier)===o;this.updateSchedule();const E=(r=this.bufferingItem)==null?void 0:r.event;if(v){var S;const A=this.schedule.findEventIndex(o),b=(S=this.schedule.items)==null?void 0:S[A];if(b){if(!this.playingItem&&this.timelinePos>b.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==A){a.error=new Error(`Interstitial ${f.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${a}`),this.log(a.error.message),this.updateSchedule(!0),this.primaryFallback(a);return}this.setBufferingItem(b)}this.setSchedulePosition(A)}else if((E==null?void 0:E.identifier)===o){const A=a.assetList[0];if(A){const b=this.getAssetPlayer(A.identifier);if(E.appendInPlace){const L=this.primaryMedia;b&&L&&this.bufferAssetPlayer(b,L)}else b&&b.loadSource()}}}onError(t,e){if(this.schedule)switch(e.details){case z.ASSET_LIST_PARSING_ERROR:case z.ASSET_LIST_LOAD_ERROR:case z.ASSET_LIST_LOAD_TIMEOUT:{const s=e.interstitial;s&&(this.updateSchedule(!0),this.primaryFallback(s));break}case z.BUFFER_STALLED_ERROR:{const s=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&s.event.appendInPlace){this.handleInPlaceStall(s.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const pp=500;class V1 extends zf{constructor(t,e,s){super(t,e,s,"subtitle-stream-controller",ht.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:t}=this;t.on(x.LEVEL_LOADED,this.onLevelLoaded,this),t.on(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(x.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:t}=this;t.off(x.LEVEL_LOADED,this.onLevelLoaded,this),t.off(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(x.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(x.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(x.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(t,e){this.stopLoad(),this.state=J.IDLE,this.setInterval(pp),this.nextLoadPosition=this.lastCurrentTime=t+this.timelineOffset,this.startPosition=e?-1:t,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(t,e){this.tracksBuffered=[],super.onMediaDetaching(t,e)}onLevelLoaded(t,e){this.mainDetails=e.details}onSubtitleFragProcessed(t,e){const{frag:s,success:r}=e;if(this.fragContextChanged(s)||(le(s)&&(this.fragPrevious=s),this.state=J.IDLE),!r)return;const a=this.tracksBuffered[this.currentTrackId];if(!a)return;let o;const f=s.start;for(let d=0;d<a.length;d++)if(f>=a[d].start&&f<=a[d].end){o=a[d];break}const h=s.start+s.duration;o?o.end=h:(o={start:f,end:h},a.push(o)),this.fragmentTracker.fragBuffered(s),this.fragBufferedComplete(s,null),this.media&&this.tick()}onBufferFlushing(t,e){const{startOffset:s,endOffset:r}=e;if(s===0&&r!==Number.POSITIVE_INFINITY){const a=r-1;if(a<=0)return;e.endOffsetSubtitles=Math.max(0,a),this.tracksBuffered.forEach(o=>{for(let f=0;f<o.length;){if(o[f].end<=a){o.shift();continue}else if(o[f].start<a)o[f].start=a;else break;f++}}),this.fragmentTracker.removeFragmentsInRange(s,a,ht.SUBTITLE)}}onError(t,e){const s=e.frag;(s==null?void 0:s.type)===ht.SUBTITLE&&(e.details===z.FRAG_GAP&&this.fragmentTracker.fragBuffered(s,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==J.STOPPED&&(this.state=J.IDLE))}onSubtitleTracksUpdated(t,{subtitleTracks:e}){if(this.levels&&Uy(this.levels,e)){this.levels=e.map(s=>new ga(s));return}this.tracksBuffered=[],this.levels=e.map(s=>{const r=new ga(s);return this.tracksBuffered[r.id]=[],r}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,ht.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(t,e){var s;if(this.currentTrackId=e.id,!((s=this.levels)!=null&&s.length)||this.currentTrackId===-1){this.clearInterval();return}const r=this.levels[this.currentTrackId];r!=null&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.state!==J.STOPPED&&this.setInterval(pp)}onSubtitleTrackLoaded(t,e){var s;const{currentTrackId:r,levels:a}=this,{details:o,id:f}=e;if(!a){this.warn(`Subtitle tracks were reset while loading level ${f}`);return}const h=a[f];if(f>=a.length||!h)return;this.log(`Subtitle track ${f} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let d=0;if(o.live||(s=h.details)!=null&&s.live){if(o.deltaUpdateFailed)return;const p=this.mainDetails;if(!p){this.startFragRequested=!1;return}const v=p.fragments[0];if(!h.details)o.hasProgramDateTime&&p.hasProgramDateTime?(vo(o,p),d=o.fragmentStart):v&&(d=v.start,Tf(o,d));else{var g;d=this.alignPlaylists(o,h.details,(g=this.levelLastLoaded)==null?void 0:g.details),d===0&&v&&(d=v.start,Tf(o,d))}p&&!this.startFragRequested&&this.setStartPosition(p,d)}h.details=o,this.levelLastLoaded=h,f===r&&(this.hls.trigger(x.SUBTITLE_TRACK_UPDATED,{details:o,id:f,groupId:e.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===J.IDLE&&(un(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),h.details=void 0)))}_handleFragmentLoadComplete(t){const{frag:e,payload:s}=t,r=e.decryptdata,a=this.hls;if(!this.fragContextChanged(e)&&s&&s.byteLength>0&&r!=null&&r.key&&r.iv&&nr(r.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(s),r.key.buffer,r.iv.buffer,Gf(r.method)).catch(f=>{throw a.trigger(x.ERROR,{type:pt.MEDIA_ERROR,details:z.FRAG_DECRYPT_ERROR,fatal:!1,error:f,reason:f.message,frag:e}),f}).then(f=>{const h=performance.now();a.trigger(x.FRAG_DECRYPTED,{frag:e,payload:f,stats:{tstart:o,tdecrypt:h}})}).catch(f=>{this.warn(`${f.name}: ${f.message}`),this.state=J.IDLE})}}doTick(){if(!this.media){this.state=J.IDLE;return}if(this.state===J.IDLE){const{currentTrackId:t,levels:e}=this,s=e==null?void 0:e[t];if(!s||!e.length||!s.details||this.waitForLive(s))return;const{config:r}=this,a=this.getLoadPosition(),o=Tt.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],a,r.maxBufferHole),{end:f,len:h}=o,d=s.details,g=this.hls.maxBufferLength+d.levelTargetDuration;if(h>g)return;const p=d.fragments,v=p.length,E=d.edge;let S=null;const A=this.fragPrevious;if(f<E){const _=r.maxFragLookUpTolerance,D=f>E-_?0:_;S=un(A,p,Math.max(p[0].start,f),D),!S&&A&&A.start<p[0].start&&(S=p[0])}else S=p[v-1];if(S=this.filterReplacedPrimary(S,s.details),!S)return;const b=S.sn-d.startSN,L=p[b-1];if(L&&L.cc===S.cc&&this.fragmentTracker.getState(L)===ge.NOT_LOADED&&(S=L),this.fragmentTracker.getState(S)===ge.NOT_LOADED){const _=this.mapToInitFragWhenRequired(S);_&&this.loadFragment(_,s,f)}}}loadFragment(t,e,s){le(t)?super.loadFragment(t,e,s):this._loadInitSegment(t,e)}get mediaBufferTimeRanges(){return new Y1(this.tracksBuffered[this.currentTrackId]||[])}}class Y1{constructor(t){this.buffered=void 0;const e=(s,r,a)=>{if(r=r>>>0,r>a-1)throw new DOMException(`Failed to execute '${s}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${a})`);return t[r][s]};this.buffered={get length(){return t.length},end(s){return e("end",s,t.length)},start(s){return e("start",s,t.length)}}}}const q1={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Jy=u=>String.fromCharCode(q1[u]||u),xi=15,ss=100,X1={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Q1={17:2,18:4,21:6,22:8,23:10,19:13,20:15},W1={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Z1={25:2,26:4,29:6,30:8,31:10,27:13,28:15},J1=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class tL{constructor(){this.time=null,this.verboseLevel=0}log(t,e){if(this.verboseLevel>=t){const s=typeof e=="function"?e():e;Gt.log(`${this.time} [${t}] ${s}`)}}}const an=function(t){const e=[];for(let s=0;s<t.length;s++)e.push(t[s].toString(16));return e};class tv{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(t){const e=["foreground","underline","italics","background","flash"];for(let s=0;s<e.length;s++){const r=e[s];t.hasOwnProperty(r)&&(this[r]=t[r])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash}copy(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class eL{constructor(){this.uchar=" ",this.penState=new tv}reset(){this.uchar=" ",this.penState.reset()}setChar(t,e){this.uchar=t,this.penState.copy(e)}setPenState(t){this.penState.copy(t)}equals(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)}copy(t){this.uchar=t.uchar,this.penState.copy(t.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class iL{constructor(t){this.chars=[],this.pos=0,this.currPenState=new tv,this.cueStartTime=null,this.logger=void 0;for(let e=0;e<ss;e++)this.chars.push(new eL);this.logger=t}equals(t){for(let e=0;e<ss;e++)if(!this.chars[e].equals(t.chars[e]))return!1;return!0}copy(t){for(let e=0;e<ss;e++)this.chars[e].copy(t.chars[e])}isEmpty(){let t=!0;for(let e=0;e<ss;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t}setCursor(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>ss&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=ss)}moveCursor(t){const e=this.pos+t;if(t>1)for(let s=this.pos+1;s<e+1;s++)this.chars[s].setPenState(this.currPenState);this.setCursor(e)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(t){t>=144&&this.backSpace();const e=Jy(t);if(this.pos>=ss){this.logger.log(0,()=>"Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1)}clearFromPos(t){let e;for(e=t;e<ss;e++)this.chars[e].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const t=[];let e=!0;for(let s=0;s<ss;s++){const r=this.chars[s].uchar;r!==" "&&(e=!1),t.push(r)}return e?"":t.join("")}setPenStyles(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)}}class nf{constructor(t){this.rows=[],this.currRow=xi-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let e=0;e<xi;e++)this.rows.push(new iL(t));this.logger=t}reset(){for(let t=0;t<xi;t++)this.rows[t].clear();this.currRow=xi-1}equals(t){let e=!0;for(let s=0;s<xi;s++)if(!this.rows[s].equals(t.rows[s])){e=!1;break}return e}copy(t){for(let e=0;e<xi;e++)this.rows[e].copy(t.rows[e])}isEmpty(){let t=!0;for(let e=0;e<xi;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(t){this.rows[this.currRow].insertChar(t)}setPen(t){this.rows[this.currRow].setPenStyles(t)}moveCursor(t){this.rows[this.currRow].moveCursor(t)}setCursor(t){this.logger.log(2,"setCursor: "+t),this.rows[this.currRow].setCursor(t)}setPAC(t){this.logger.log(2,()=>"pacData = "+Xt(t));let e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(let f=0;f<xi;f++)this.rows[f].clear();const a=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const f=o.rows[a].cueStartTime,h=this.logger.time;if(f!==null&&h!==null&&f<h)for(let d=0;d<this.nrRollUpRows;d++)this.rows[e-this.nrRollUpRows+d+1].copy(o.rows[a+d])}}this.currRow=e;const s=this.rows[this.currRow];if(t.indent!==null){const a=t.indent,o=Math.max(a-1,0);s.setCursor(t.indent),t.color=s.chars[o].penState.foreground}const r={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(t){this.logger.log(2,()=>"bkgData = "+Xt(t)),this.backSpace(),this.setPen(t),this.insertChar(32)}setRollUpRows(t){this.nrRollUpRows=t}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),this.logger.log(2,"Rolling up")}getDisplayText(t){t=t||!1;const e=[];let s="",r=-1;for(let a=0;a<xi;a++){const o=this.rows[a].getTextString();o&&(r=a+1,t?e.push("Row "+r+": '"+o+"'"):e.push(o.trim()))}return e.length>0&&(t?s="["+e.join(" | ")+"]":s=e.join(`
`)),s}getTextAndFormat(){return this.rows}}class yp{constructor(t,e,s){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new nf(s),this.nonDisplayedMemory=new nf(s),this.lastOutputScreen=new nf(s),this.currRollUpRow=this.displayedMemory.rows[xi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=s}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[xi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(t){this.outputFilter=t}setPAC(t){this.writeScreen.setPAC(t)}setBkgData(t){this.writeScreen.setBkgData(t)}setMode(t){t!==this.mode&&(this.mode=t,this.logger.log(2,()=>"MODE="+t),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)}insertChars(t){for(let s=0;s<t.length;s++)this.writeScreen.insertChar(t[s]);const e=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>e+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(t){this.logger.log(2,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(t){this.logger.log(2,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)}ccMIDROW(t){const e={flash:!1};if(e.underline=t%2===1,e.italics=t>=46,e.italics)e.foreground="white";else{const s=Math.floor(t/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];e.foreground=r[s]}this.logger.log(2,"MIDROW: "+Xt(e)),this.writeScreen.setPen(e)}outputDataUpdate(t=!1){const e=this.logger.time;e!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=e:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))}}class vp{constructor(t,e,s){this.channels=void 0,this.currentChannel=0,this.cmdHistory=nL(),this.logger=void 0;const r=this.logger=new tL;this.channels=[null,new yp(t,e,r),new yp(t+1,s,r)]}getHandler(t){return this.channels[t].getHandler()}setHandler(t,e){this.channels[t].setHandler(e)}addData(t,e){this.logger.time=t;for(let s=0;s<e.length;s+=2){const r=e[s]&127,a=e[s+1]&127;let o=!1,f=null;if(r===0&&a===0)continue;this.logger.log(3,()=>"["+an([e[s],e[s+1]])+"] -> ("+an([r,a])+")");const h=this.cmdHistory;if(r>=16&&r<=31){if(sL(r,a,h)){Ql(null,null,h),this.logger.log(3,()=>"Repeated command ("+an([r,a])+") is dropped");continue}Ql(r,a,this.cmdHistory),o=this.parseCmd(r,a),o||(o=this.parseMidrow(r,a)),o||(o=this.parsePAC(r,a)),o||(o=this.parseBackgroundAttributes(r,a))}else Ql(null,null,h);if(!o&&(f=this.parseChars(r,a),f)){const g=this.currentChannel;g&&g>0?this.channels[g].insertChars(f):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!f&&this.logger.log(2,()=>"Couldn't parse cleaned data "+an([r,a])+" orig: "+an([e[s],e[s+1]]))}}parseCmd(t,e){const s=(t===20||t===28||t===21||t===29)&&e>=32&&e<=47,r=(t===23||t===31)&&e>=33&&e<=35;if(!(s||r))return!1;const a=t===20||t===21||t===23?1:2,o=this.channels[a];return t===20||t===21||t===28||t===29?e===32?o.ccRCL():e===33?o.ccBS():e===34?o.ccAOF():e===35?o.ccAON():e===36?o.ccDER():e===37?o.ccRU(2):e===38?o.ccRU(3):e===39?o.ccRU(4):e===40?o.ccFON():e===41?o.ccRDC():e===42?o.ccTR():e===43?o.ccRTD():e===44?o.ccEDM():e===45?o.ccCR():e===46?o.ccENM():e===47&&o.ccEOC():o.ccTO(e-32),this.currentChannel=a,!0}parseMidrow(t,e){let s=0;if((t===17||t===25)&&e>=32&&e<=47){if(t===17?s=1:s=2,s!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[s];return r?(r.ccMIDROW(e),this.logger.log(3,()=>"MIDROW ("+an([t,e])+")"),!0):!1}return!1}parsePAC(t,e){let s;const r=(t>=17&&t<=23||t>=25&&t<=31)&&e>=64&&e<=127,a=(t===16||t===24)&&e>=64&&e<=95;if(!(r||a))return!1;const o=t<=23?1:2;e>=64&&e<=95?s=o===1?X1[t]:W1[t]:s=o===1?Q1[t]:Z1[t];const f=this.channels[o];return f?(f.setPAC(this.interpretPAC(s,e)),this.currentChannel=o,!0):!1}interpretPAC(t,e){let s;const r={color:null,italics:!1,indent:null,underline:!1,row:t};return e>95?s=e-96:s=e-64,r.underline=(s&1)===1,s<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(s/2)]:s<=15?(r.italics=!0,r.color="white"):r.indent=Math.floor((s-16)/2)*4,r}parseChars(t,e){let s,r=null,a=null;if(t>=25?(s=2,a=t-8):(s=1,a=t),a>=17&&a<=19){let o;a===17?o=e+80:a===18?o=e+112:o=e+144,this.logger.log(2,()=>"Special char '"+Jy(o)+"' in channel "+s),r=[o]}else t>=32&&t<=127&&(r=e===0?[t]:[t,e]);return r&&this.logger.log(3,()=>"Char codes =  "+an(r).join(",")),r}parseBackgroundAttributes(t,e){const s=(t===16||t===24)&&e>=32&&e<=47,r=(t===23||t===31)&&e>=45&&e<=47;if(!(s||r))return!1;let a;const o={};t===16||t===24?(a=Math.floor((e-32)/2),o.background=J1[a],e%2===1&&(o.background=o.background+"_semi")):e===45?o.background="transparent":(o.foreground="black",e===47&&(o.underline=!0));const f=t<=23?1:2;return this.channels[f].setBkgData(o),!0}reset(){for(let t=0;t<Object.keys(this.channels).length;t++){const e=this.channels[t];e&&e.reset()}Ql(null,null,this.cmdHistory)}cueSplitAtTime(t){for(let e=0;e<this.channels.length;e++){const s=this.channels[e];s&&s.cueSplitAtTime(t)}}}function Ql(u,t,e){e.a=u,e.b=t}function sL(u,t,e){return e.a===u&&e.b===t}function nL(){return{a:null,b:null}}var ed=(function(){if(yo!=null&&yo.VTTCue)return self.VTTCue;const u=["","lr","rl"],t=["start","middle","end","left","right"];function e(f,h){if(typeof h!="string"||!Array.isArray(f))return!1;const d=h.toLowerCase();return~f.indexOf(d)?d:!1}function s(f){return e(u,f)}function r(f){return e(t,f)}function a(f,...h){let d=1;for(;d<arguments.length;d++){const g=arguments[d];for(const p in g)f[p]=g[p]}return f}function o(f,h,d){const g=this,p={enumerable:!0};g.hasBeenReset=!1;let v="",E=!1,S=f,A=h,b=d,L=null,_="",D=!0,k="auto",w="start",V=50,O="middle",$=50,G="middle";Object.defineProperty(g,"id",a({},p,{get:function(){return v},set:function(B){v=""+B}})),Object.defineProperty(g,"pauseOnExit",a({},p,{get:function(){return E},set:function(B){E=!!B}})),Object.defineProperty(g,"startTime",a({},p,{get:function(){return S},set:function(B){if(typeof B!="number")throw new TypeError("Start time must be set to a number.");S=B,this.hasBeenReset=!0}})),Object.defineProperty(g,"endTime",a({},p,{get:function(){return A},set:function(B){if(typeof B!="number")throw new TypeError("End time must be set to a number.");A=B,this.hasBeenReset=!0}})),Object.defineProperty(g,"text",a({},p,{get:function(){return b},set:function(B){b=""+B,this.hasBeenReset=!0}})),Object.defineProperty(g,"region",a({},p,{get:function(){return L},set:function(B){L=B,this.hasBeenReset=!0}})),Object.defineProperty(g,"vertical",a({},p,{get:function(){return _},set:function(B){const Q=s(B);if(Q===!1)throw new SyntaxError("An invalid or illegal string was specified.");_=Q,this.hasBeenReset=!0}})),Object.defineProperty(g,"snapToLines",a({},p,{get:function(){return D},set:function(B){D=!!B,this.hasBeenReset=!0}})),Object.defineProperty(g,"line",a({},p,{get:function(){return k},set:function(B){if(typeof B!="number"&&B!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");k=B,this.hasBeenReset=!0}})),Object.defineProperty(g,"lineAlign",a({},p,{get:function(){return w},set:function(B){const Q=r(B);if(!Q)throw new SyntaxError("An invalid or illegal string was specified.");w=Q,this.hasBeenReset=!0}})),Object.defineProperty(g,"position",a({},p,{get:function(){return V},set:function(B){if(B<0||B>100)throw new Error("Position must be between 0 and 100.");V=B,this.hasBeenReset=!0}})),Object.defineProperty(g,"positionAlign",a({},p,{get:function(){return O},set:function(B){const Q=r(B);if(!Q)throw new SyntaxError("An invalid or illegal string was specified.");O=Q,this.hasBeenReset=!0}})),Object.defineProperty(g,"size",a({},p,{get:function(){return $},set:function(B){if(B<0||B>100)throw new Error("Size must be between 0 and 100.");$=B,this.hasBeenReset=!0}})),Object.defineProperty(g,"align",a({},p,{get:function(){return G},set:function(B){const Q=r(B);if(!Q)throw new SyntaxError("An invalid or illegal string was specified.");G=Q,this.hasBeenReset=!0}})),g.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o})();class rL{decode(t,e){if(!t)return"";if(typeof t!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}function ev(u){function t(s,r,a,o){return(s|0)*3600+(r|0)*60+(a|0)+parseFloat(o||0)}const e=u.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return e?parseFloat(e[2])>59?t(e[2],e[3],0,e[4]):t(e[1],e[2],e[3],e[4]):null}let aL=class{constructor(){this.values=Object.create(null)}set(t,e){!this.get(t)&&e!==""&&(this.values[t]=e)}get(t,e,s){return s?this.has(t)?this.values[t]:e[s]:this.has(t)?this.values[t]:e}has(t){return t in this.values}alt(t,e,s){for(let r=0;r<s.length;++r)if(e===s[r]){this.set(t,e);break}}integer(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))}percent(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){const s=parseFloat(e);if(s>=0&&s<=100)return this.set(t,s),!0}return!1}};function iv(u,t,e,s){const r=s?u.split(s):[u];for(const a in r){if(typeof r[a]!="string")continue;const o=r[a].split(e);if(o.length!==2)continue;const f=o[0],h=o[1];t(f,h)}}const If=new ed(0,0,""),Wl=If.align==="middle"?"middle":"center";function lL(u,t,e){const s=u;function r(){const f=ev(u);if(f===null)throw new Error("Malformed timestamp: "+s);return u=u.replace(/^[^\sa-zA-Z-]+/,""),f}function a(f,h){const d=new aL;iv(f,function(v,E){let S;switch(v){case"region":for(let A=e.length-1;A>=0;A--)if(e[A].id===E){d.set(v,e[A].region);break}break;case"vertical":d.alt(v,E,["rl","lr"]);break;case"line":S=E.split(","),d.integer(v,S[0]),d.percent(v,S[0])&&d.set("snapToLines",!1),d.alt(v,S[0],["auto"]),S.length===2&&d.alt("lineAlign",S[1],["start",Wl,"end"]);break;case"position":S=E.split(","),d.percent(v,S[0]),S.length===2&&d.alt("positionAlign",S[1],["start",Wl,"end","line-left","line-right","auto"]);break;case"size":d.percent(v,E);break;case"align":d.alt(v,E,["start",Wl,"end","left","right"]);break}},/:/,/\s/),h.region=d.get("region",null),h.vertical=d.get("vertical","");let g=d.get("line","auto");g==="auto"&&If.line===-1&&(g=-1),h.line=g,h.lineAlign=d.get("lineAlign","start"),h.snapToLines=d.get("snapToLines",!0),h.size=d.get("size",100),h.align=d.get("align",Wl);let p=d.get("position","auto");p==="auto"&&If.position===50&&(p=h.align==="start"||h.align==="left"?0:h.align==="end"||h.align==="right"?100:50),h.position=p}function o(){u=u.replace(/^\s+/,"")}if(o(),t.startTime=r(),o(),u.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+s);u=u.slice(3),o(),t.endTime=r(),o(),a(u,t)}function sv(u){return u.replace(/<br(?: \/)?>/gi,`
`)}class oL{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new rL,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(t){const e=this;t&&(e.buffer+=e.decoder.decode(t,{stream:!0}));function s(){let a=e.buffer,o=0;for(a=sv(a);o<a.length&&a[o]!=="\r"&&a[o]!==`
`;)++o;const f=a.slice(0,o);return a[o]==="\r"&&++o,a[o]===`
`&&++o,e.buffer=a.slice(o),f}function r(a){iv(a,function(o,f){},/:/)}try{let a="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;a=s();const f=a.match(/^()?WEBVTT([ \t].*)?$/);if(!(f!=null&&f[0]))throw new Error("Malformed WebVTT signature.");e.state="HEADER"}let o=!1;for(;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(o?o=!1:a=s(),e.state){case"HEADER":/:/.test(a)?r(a):a||(e.state="ID");continue;case"NOTE":a||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(a)){e.state="NOTE";break}if(!a)continue;if(e.cue=new ed(0,0,""),e.state="CUE",a.indexOf("-->")===-1){e.cue.id=a;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{lL(a,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{const f=a.indexOf("-->")!==-1;if(!a||f&&(o=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=a}continue;case"BADCUE":a||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const t=this;try{if((t.cue||t.state==="HEADER")&&(t.buffer+=`

`,t.parse()),t.state==="INITIAL"||t.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){t.onparsingerror&&t.onparsingerror(e)}return t.onflush&&t.onflush(),this}}const uL=/\r\n|\n\r|\n|\r/g,rf=function(t,e,s=0){return t.slice(s,s+e.length)===e},cL=function(t){let e=parseInt(t.slice(-3));const s=parseInt(t.slice(-6,-4)),r=parseInt(t.slice(-9,-7)),a=t.length>9?parseInt(t.substring(0,t.indexOf(":"))):0;if(!ct(e)||!ct(s)||!ct(r)||!ct(a))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${t}`);return e+=1e3*s,e+=60*1e3*r,e+=3600*1e3*a,e};function id(u,t,e){return ca(u.toString())+ca(t.toString())+ca(e)}const fL=function(t,e,s){let r=t[e],a=t[r.prevCC];if(!a||!a.new&&r.new){t.ccOffset=t.presentationOffset=r.start,r.new=!1;return}for(;(o=a)!=null&&o.new;){var o;t.ccOffset+=r.start-a.start,r.new=!1,r=a,a=t[r.prevCC]}t.presentationOffset=s};function dL(u,t,e,s,r,a,o){const f=new oL,h=ii(new Uint8Array(u)).trim().replace(uL,`
`).split(`
`),d=[],g=t?vb(t.baseTime,t.timescale):0;let p="00:00.000",v=0,E=0,S,A=!0;f.oncue=function(b){const L=e[s];let _=e.ccOffset;const D=(v-g)/9e4;if(L!=null&&L.new&&(E!==void 0?_=e.ccOffset=L.start:fL(e,s,D)),D){if(!t){S=new Error("Missing initPTS for VTT MPEGTS");return}_=D-e.presentationOffset}const k=b.endTime-b.startTime,w=ti((b.startTime+_-E)*9e4,r*9e4)/9e4;b.startTime=Math.max(w,0),b.endTime=Math.max(w+k,0);const V=b.text.trim();b.text=decodeURIComponent(encodeURIComponent(V)),b.id||(b.id=id(b.startTime,b.endTime,V)),b.endTime>0&&d.push(b)},f.onparsingerror=function(b){S=b},f.onflush=function(){if(S){o(S);return}a(d)},h.forEach(b=>{if(A)if(rf(b,"X-TIMESTAMP-MAP=")){A=!1,b.slice(16).split(",").forEach(L=>{rf(L,"LOCAL:")?p=L.slice(6):rf(L,"MPEGTS:")&&(v=parseInt(L.slice(7)))});try{E=cL(p)/1e3}catch(L){S=L}return}else b===""&&(A=!1);f.parse(b+`
`)}),f.flush()}const af="stpp.ttml.im1t",nv=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,rv=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,hL={left:"start",center:"center",right:"end",start:"start",end:"end"};function Ep(u,t,e,s){const r=Lt(new Uint8Array(u),["mdat"]);if(r.length===0){s(new Error("Could not parse IMSC1 mdat"));return}const a=r.map(f=>ii(f)),o=yb(t.baseTime,1,t.timescale);try{a.forEach(f=>e(gL(f,o)))}catch(f){s(f)}}function gL(u,t){const r=new DOMParser().parseFromString(u,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const a={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(a).reduce((p,v)=>(p[v]=r.getAttribute(`ttp:${v}`)||a[v],p),{}),f=r.getAttribute("xml:space")!=="preserve",h=Sp(lf(r,"styling","style")),d=Sp(lf(r,"layout","region")),g=lf(r,"body","[begin]");return[].map.call(g,p=>{const v=av(p,f);if(!v||!p.hasAttribute("begin"))return null;const E=uf(p.getAttribute("begin"),o),S=uf(p.getAttribute("dur"),o);let A=uf(p.getAttribute("end"),o);if(E===null)throw Tp(p);if(A===null){if(S===null)throw Tp(p);A=E+S}const b=new ed(E-t,A-t,v);b.id=id(b.startTime,b.endTime,b.text);const L=d[p.getAttribute("region")],_=h[p.getAttribute("style")],D=mL(L,_,h),{textAlign:k}=D;if(k){const w=hL[k];w&&(b.lineAlign=w),b.align=k}return jt(b,D),b}).filter(p=>p!==null)}function lf(u,t,e){const s=u.getElementsByTagName(t)[0];return s?[].slice.call(s.querySelectorAll(e)):[]}function Sp(u){return u.reduce((t,e)=>{const s=e.getAttribute("xml:id");return s&&(t[s]=e),t},{})}function av(u,t){return[].slice.call(u.childNodes).reduce((e,s,r)=>{var a;return s.nodeName==="br"&&r?e+`
`:(a=s.childNodes)!=null&&a.length?av(s,t):t?e+s.textContent.trim().replace(/\s+/g," "):e+s.textContent},"")}function mL(u,t,e){const s="http://www.w3.org/ns/ttml#styling";let r=null;const a=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=u!=null&&u.hasAttribute("style")?u.getAttribute("style"):null;return o&&e.hasOwnProperty(o)&&(r=e[o]),a.reduce((f,h)=>{const d=of(t,s,h)||of(u,s,h)||of(r,s,h);return d&&(f[h]=d),f},{})}function of(u,t,e){return u&&u.hasAttributeNS(t,e)?u.getAttributeNS(t,e):null}function Tp(u){return new Error(`Could not parse ttml timestamp ${u}`)}function uf(u,t){if(!u)return null;let e=ev(u);return e===null&&(nv.test(u)?e=pL(u,t):rv.test(u)&&(e=yL(u,t))),e}function pL(u,t){const e=nv.exec(u),s=(e[4]|0)+(e[5]|0)/t.subFrameRate;return(e[1]|0)*3600+(e[2]|0)*60+(e[3]|0)+s/t.frameRate}function yL(u,t){const e=rv.exec(u),s=Number(e[1]);switch(e[2]){case"h":return s*3600;case"m":return s*60;case"ms":return s*1e3;case"f":return s/t.frameRate;case"t":return s/t.tickRate}return s}class Zl{constructor(t,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=e}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(t,e,s){(this.startTime===null||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=s,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class vL{constructor(t){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Ap(),this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},t.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(x.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(x.FRAG_LOADING,this.onFragLoading,this),t.on(x.FRAG_LOADED,this.onFragLoaded,this),t.on(x.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(x.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(x.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(x.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:t}=this;t.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(x.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(x.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(x.FRAG_LOADING,this.onFragLoading,this),t.off(x.FRAG_LOADED,this.onFragLoaded,this),t.off(x.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(x.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(x.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(x.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const t=new Zl(this,"textTrack1"),e=new Zl(this,"textTrack2"),s=new Zl(this,"textTrack3"),r=new Zl(this,"textTrack4");this.cea608Parser1=new vp(1,t,e),this.cea608Parser2=new vp(3,s,r)}addCues(t,e,s,r,a){let o=!1;for(let f=a.length;f--;){const h=a[f],d=EL(h[0],h[1],e,s);if(d>=0&&(h[0]=Math.min(h[0],e),h[1]=Math.max(h[1],s),o=!0,d/(s-e)>.5))return}if(o||a.push([e,s]),this.config.renderTextTracksNatively){const f=this.captionsTracks[t];this.Cues.newCue(f,e,s,r)}else{const f=this.Cues.newCue(null,e,s,r);this.hls.trigger(x.CUES_PARSED,{type:"captions",cues:f,track:t})}}onInitPtsFound(t,{frag:e,id:s,initPTS:r,timescale:a,trackId:o}){const{unparsedVttFrags:f}=this;s===ht.MAIN&&(this.initPTS[e.cc]={baseTime:r,timescale:a,trackId:o}),f.length&&(this.unparsedVttFrags=[],f.forEach(h=>{this.initPTS[h.frag.cc]?this.onFragLoaded(x.FRAG_LOADED,h):this.hls.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:h.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(t,e){const{media:s}=this;if(s)for(let r=0;r<s.textTracks.length;r++){const a=s.textTracks[r];if(xp(a,{name:t,lang:e,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return a}return null}createCaptionsTrack(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)}createNativeTrack(t){if(this.captionsTracks[t])return;const{captionsProperties:e,captionsTracks:s,media:r}=this,{label:a,languageCode:o}=e[t],f=this.getExistingTrack(a,o);if(f)s[t]=f,ir(s[t]),Qy(s[t],r);else{const h=this.createTextTrack("captions",a,o);h&&(h[t]=!0,s[t]=h)}}createNonNativeTrack(t){if(this.nonNativeCaptionsTracks[t])return;const e=this.captionsProperties[t];if(!e)return;const s=e.label,r={_id:t,label:s,kind:"captions",default:e.media?!!e.media.default:!1,closedCaptions:e.media};this.nonNativeCaptionsTracks[t]=r,this.hls.trigger(x.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(t,e,s){const r=this.media;if(r)return r.addTextTrack(t,e,s)}onMediaAttaching(t,e){this.media=e.media,e.mediaSource||this._cleanTracks()}onMediaDetaching(t,e){const s=!!e.transferMedia;if(this.media=null,s)return;const{captionsTracks:r}=this;Object.keys(r).forEach(a=>{ir(r[a]),delete r[a]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Ap(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:t}=this;if(!t)return;const e=t.textTracks;if(e)for(let s=0;s<e.length;s++)ir(e[s])}onSubtitleTracksUpdated(t,e){const s=e.subtitleTracks||[],r=s.some(a=>a.textCodec===af);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(Uy(this.tracks,s)){this.tracks=s;return}if(this.textTracks=[],this.tracks=s,this.config.renderTextTracksNatively){const o=this.media,f=o?lo(o.textTracks):null;if(this.tracks.forEach((h,d)=>{let g;if(f){let p=null;for(let v=0;v<f.length;v++)if(f[v]&&xp(f[v],h)){p=f[v],f[v]=null;break}p&&(g=p)}if(g)ir(g);else{const p=lv(h);g=this.createTextTrack(p,h.name,h.lang),g&&(g.mode="disabled")}g&&this.textTracks.push(g)}),f!=null&&f.length){const h=f.filter(d=>d!==null).map(d=>d.label);h.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${h.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(f=>({label:f.name,kind:f.type.toLowerCase(),default:f.default,subtitleTrack:f}));this.hls.trigger(x.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(t,e){this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(s=>{const r=/(?:CC|SERVICE)([1-4])/.exec(s.instreamId);if(!r)return;const a=`textTrack${r[1]}`,o=this.captionsProperties[a];o&&(o.label=s.name,s.lang&&(o.languageCode=s.lang),o.media=s)})}closedCaptionsForLevel(t){const e=this.hls.levels[t.level];return e==null?void 0:e.attrs["CLOSED-CAPTIONS"]}onFragLoading(t,e){if(this.enabled&&e.frag.type===ht.MAIN){var s,r;const{cea608Parser1:a,cea608Parser2:o,lastSn:f}=this,{cc:h,sn:d}=e.frag,g=(s=(r=e.part)==null?void 0:r.index)!=null?s:-1;a&&o&&(d!==f+1||d===f&&g!==this.lastPartIndex+1||h!==this.lastCc)&&(a.reset(),o.reset()),this.lastCc=h,this.lastSn=d,this.lastPartIndex=g}}onFragLoaded(t,e){const{frag:s,payload:r}=e;if(s.type===ht.SUBTITLE)if(r.byteLength){const a=s.decryptdata,o="stats"in e;if(a==null||!a.encrypted||o){const f=this.tracks[s.level],h=this.vttCCs;h[s.cc]||(h[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),f&&f.textCodec===af?this._parseIMSC1(s,r):this._parseVTTs(e)}}else this.hls.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})}_parseIMSC1(t,e){const s=this.hls;Ep(e,this.initPTS[t.cc],r=>{this._appendCues(r,t.level),s.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},r=>{s.logger.log(`Failed to parse IMSC1: ${r}`),s.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:r})})}_parseVTTs(t){var e;const{frag:s,payload:r}=t,{initPTS:a,unparsedVttFrags:o}=this,f=a.length-1;if(!a[s.cc]&&f===-1){o.push(t);return}const h=this.hls,d=(e=s.initSegment)!=null&&e.data?gi(s.initSegment.data,new Uint8Array(r)).buffer:r;dL(d,this.initPTS[s.cc],this.vttCCs,s.cc,s.start,g=>{this._appendCues(g,s.level),h.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:s})},g=>{const p=g.message==="Missing initPTS for VTT MPEGTS";p?o.push(t):this._fallbackToIMSC1(s,r),h.logger.log(`Failed to parse VTT cue: ${g}`),!(p&&f>s.cc)&&h.trigger(x.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:g})})}_fallbackToIMSC1(t,e){const s=this.tracks[t.level];s.textCodec||Ep(e,this.initPTS[t.cc],()=>{s.textCodec=af,this._parseIMSC1(t,e)},()=>{s.textCodec="wvtt"})}_appendCues(t,e){const s=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[e];if(!r||r.mode==="disabled")return;t.forEach(a=>Wy(r,a))}else{const r=this.tracks[e];if(!r)return;const a=r.default?"default":"subtitles"+e;s.trigger(x.CUES_PARSED,{type:"subtitles",cues:t,track:a})}}onFragDecrypted(t,e){const{frag:s}=e;s.type===ht.SUBTITLE&&this.onFragLoaded(x.FRAG_LOADED,e)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(t,e){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:s,samples:r}=e;if(!(s.type===ht.MAIN&&this.closedCaptionsForLevel(s)==="NONE"))for(let a=0;a<r.length;a++){const o=r[a].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const f=this.extractCea608Data(o);this.cea608Parser1.addData(r[a].pts,f[0]),this.cea608Parser2.addData(r[a].pts,f[1])}}}onBufferFlushing(t,{startOffset:e,endOffset:s,endOffsetSubtitles:r,type:a}){const{media:o}=this;if(!(!o||o.currentTime<s)){if(!a||a==="video"){const{captionsTracks:f}=this;Object.keys(f).forEach(h=>Df(f[h],e,s))}if(this.config.renderTextTracksNatively&&e===0&&r!==void 0){const{textTracks:f}=this;Object.keys(f).forEach(h=>Df(f[h],e,r))}}}extractCea608Data(t){const e=[[],[]],s=t[0]&31;let r=2;for(let a=0;a<s;a++){const o=t[r++],f=127&t[r++],h=127&t[r++];if(f===0&&h===0)continue;if((4&o)!==0){const g=3&o;(g===0||g===1)&&(e[g].push(f),e[g].push(h))}}return e}}function lv(u){return u.characteristics&&/transcribes-spoken-dialog/gi.test(u.characteristics)&&/describes-music-and-sound/gi.test(u.characteristics)?"captions":"subtitles"}function xp(u,t){return!!u&&u.kind===lv(t)&&bf(t,u)}function EL(u,t,e,s){return Math.min(t,s)-Math.max(u,e)}function Ap(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const SL=/\s/,TL={newCue(u,t,e,s){const r=[];let a,o,f,h,d;const g=self.VTTCue||self.TextTrackCue;for(let v=0;v<s.rows.length;v++)if(a=s.rows[v],f=!0,h=0,d="",!a.isEmpty()){var p;for(let A=0;A<a.chars.length;A++)SL.test(a.chars[A].uchar)&&f?h++:(d+=a.chars[A].uchar,f=!1);a.cueStartTime=t,t===e&&(e+=1e-4),h>=16?h--:h++;const E=sv(d.trim()),S=id(t,e,E);u!=null&&(p=u.cues)!=null&&p.getCueById(S)||(o=new g(t,e,E),o.id=S,o.line=v+1,o.align="left",o.position=10+Math.min(80,Math.floor(h*8/32)*10),r.push(o))}return u&&r.length&&(r.sort((v,E)=>v.line==="auto"||E.line==="auto"?0:v.line>8&&E.line>8?E.line-v.line:v.line-E.line),r.forEach(v=>Wy(u,v))),r}};function xL(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const AL=/(\d+)-(\d+)\/(\d+)/;class bp{constructor(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||_L,this.controller=new self.AbortController,this.stats=new wf}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var t;this.abortInternal(),(t=this.callbacks)!=null&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(t,e,s){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const a=bL(t,this.controller.signal),o=t.responseType==="arraybuffer",f=o?"byteLength":"length",{maxTimeToFirstByteMs:h,maxLoadTimeMs:d}=e.loadPolicy;this.context=t,this.config=e,this.callbacks=s,this.request=this.fetchSetup(t,a),self.clearTimeout(this.requestTimeout),e.timeout=h&&ct(h)?h:d,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,t,this.response))},e.timeout),(ya(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(p=>{var v;this.response=this.loader=p;const E=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),e.timeout=d,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,t,this.response))},d-(E-r.loading.start)),!p.ok){const{status:A,statusText:b}=p;throw new DL(b||"fetch, bad network response",A,p)}r.loading.first=E,r.total=RL(p.headers)||r.total;const S=(v=this.callbacks)==null?void 0:v.onProgress;return S&&ct(e.highWaterMark)?this.loadProgressively(p,r,t,e.highWaterMark,S):o?p.arrayBuffer():t.responseType==="json"?p.json():p.text()}).then(p=>{var v,E;const S=this.response;if(!S)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const A=p[f];A&&(r.loaded=r.total=A);const b={url:S.url,data:p,code:S.status},L=(v=this.callbacks)==null?void 0:v.onProgress;L&&!ct(e.highWaterMark)&&L(r,t,p,S),(E=this.callbacks)==null||E.onSuccess(b,r,t,S)}).catch(p=>{var v;if(self.clearTimeout(this.requestTimeout),r.aborted)return;const E=p&&p.code||0,S=p?p.message:null;(v=this.callbacks)==null||v.onError({code:E,text:S},t,p?p.details:null,r)})}getCacheAge(){let t=null;if(this.response){const e=this.response.headers.get("age");t=e?parseFloat(e):null}return t}getResponseHeader(t){return this.response?this.response.headers.get(t):null}loadProgressively(t,e,s,r=0,a){const o=new yy,f=t.body.getReader(),h=()=>f.read().then(d=>{if(d.done)return o.dataLength&&a(e,s,o.flush().buffer,t),Promise.resolve(new ArrayBuffer(0));const g=d.value,p=g.length;return e.loaded+=p,p<r||o.dataLength?(o.push(g),o.dataLength>=r&&a(e,s,o.flush().buffer,t)):a(e,s,g.buffer,t),h()}).catch(()=>Promise.reject());return h()}}function bL(u,t){const e={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(jt({},u.headers))};return u.rangeEnd&&e.headers.set("Range","bytes="+u.rangeStart+"-"+String(u.rangeEnd-1)),e}function LL(u){const t=AL.exec(u);if(t)return parseInt(t[2])-parseInt(t[1])+1}function RL(u){const t=u.get("Content-Range");if(t){const s=LL(t);if(ct(s))return s}const e=u.get("Content-Length");if(e)return parseInt(e)}function _L(u,t){return new self.Request(u.url,t)}class DL extends Error{constructor(t,e,s){super(t),this.code=void 0,this.details=void 0,this.code=e,this.details=s}}const IL=/^age:\s*[\d.]+\s*$/im;class ov{constructor(t){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=t&&t.xhrSetup||null,this.stats=new wf,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,t.readyState!==4&&(this.stats.aborted=!0,t.abort()))}abort(){var t;this.abortInternal(),(t=this.callbacks)!=null&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(t,e,s){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=e,this.callbacks=s,this.loadInternal()}loadInternal(){const{config:t,context:e}=this;if(!t||!e)return;const s=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const a=this.xhrSetup;a?Promise.resolve().then(()=>{if(!(this.loader!==s||this.stats.aborted))return a(s,e.url)}).catch(o=>{if(!(this.loader!==s||this.stats.aborted))return s.open("GET",e.url,!0),a(s,e.url)}).then(()=>{this.loader!==s||this.stats.aborted||this.openAndSendXhr(s,e,t)}).catch(o=>{var f;(f=this.callbacks)==null||f.onError({code:s.status,text:o.message},e,s,r)}):this.openAndSendXhr(s,e,t)}openAndSendXhr(t,e,s){t.readyState||t.open("GET",e.url,!0);const r=e.headers,{maxTimeToFirstByteMs:a,maxLoadTimeMs:o}=s.loadPolicy;if(r)for(const f in r)t.setRequestHeader(f,r[f]);e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,self.clearTimeout(this.requestTimeout),s.timeout=a&&ct(a)?a:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout),t.send()}readystatechange(){const{context:t,loader:e,stats:s}=this;if(!t||!e)return;const r=e.readyState,a=this.config;if(!s.aborted&&r>=2&&(s.loading.first===0&&(s.loading.first=Math.max(self.performance.now(),s.loading.start),a.timeout!==a.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),a.timeout=a.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.loadPolicy.maxLoadTimeMs-(s.loading.first-s.loading.start)))),r===4)){self.clearTimeout(this.requestTimeout),e.onreadystatechange=null,e.onprogress=null;const d=e.status,g=e.responseType==="text"?e.responseText:null;if(d>=200&&d<300){const S=g??e.response;if(S!=null){var o,f;s.loading.end=Math.max(self.performance.now(),s.loading.first);const A=e.responseType==="arraybuffer"?S.byteLength:S.length;s.loaded=s.total=A,s.bwEstimate=s.total*8e3/(s.loading.end-s.loading.first);const b=(o=this.callbacks)==null?void 0:o.onProgress;b&&b(s,t,S,e);const L={url:e.responseURL,data:S,code:d};(f=this.callbacks)==null||f.onSuccess(L,s,t,e);return}}const p=a.loadPolicy.errorRetry,v=s.retry,E={url:t.url,data:void 0,code:d};if(mo(p,v,!1,E))this.retry(p);else{var h;Gt.error(`${d} while loading ${t.url}`),(h=this.callbacks)==null||h.onError({code:d,text:e.statusText},t,e,s)}}}loadtimeout(){if(!this.config)return;const t=this.config.loadPolicy.timeoutRetry,e=this.stats.retry;if(mo(t,e,!0))this.retry(t);else{var s;Gt.warn(`timeout while loading ${(s=this.context)==null?void 0:s.url}`);const r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}retry(t){const{context:e,stats:s}=this;this.retryDelay=Bf(t,s.retry),s.retry++,Gt.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${e==null?void 0:e.url}, retrying ${s.retry}/${t.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(t){const e=this.stats;e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total)}getCacheAge(){let t=null;if(this.loader&&IL.test(this.loader.getAllResponseHeaders())){const e=this.loader.getResponseHeader("age");t=e?parseFloat(e):null}return t}getResponseHeader(t){return this.loader&&new RegExp(`^${t}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(t):null}}const CL={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},kL=$t($t({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:ov,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:zx,bufferController:Mb,capLevelController:Zf,errorController:qx,fpsController:w1,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:ay,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:CL},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},OL()),{},{subtitleStreamController:V1,subtitleTrackController:U1,timelineController:vL,audioStreamController:Ib,audioTrackController:Cb,emeController:rr,cmcdController:C1,contentSteeringController:O1,interstitialsController:j1});function OL(){return{cueHandler:TL,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function ML(u,t,e){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(t.liveMaxLatencyDurationCount!==void 0&&(t.liveSyncDurationCount===void 0||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(t.liveMaxLatencyDuration!==void 0&&(t.liveSyncDuration===void 0||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const s=Cf(u),r=["manifest","level","frag"],a=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(o=>{const f=`${o==="level"?"playlist":o}LoadPolicy`,h=t[f]===void 0,d=[];a.forEach(g=>{const p=`${o}Loading${g}`,v=t[p];if(v!==void 0&&h){d.push(p);const E=s[f].default;switch(t[f]={default:E},g){case"TimeOut":E.maxLoadTimeMs=v,E.maxTimeToFirstByteMs=v;break;case"MaxRetry":E.errorRetry.maxNumRetry=v,E.timeoutRetry.maxNumRetry=v;break;case"RetryDelay":E.errorRetry.retryDelayMs=v,E.timeoutRetry.retryDelayMs=v;break;case"MaxRetryTimeout":E.errorRetry.maxRetryDelayMs=v,E.timeoutRetry.maxRetryDelayMs=v;break}}}),d.length&&e.warn(`hls.js config: "${d.join('", "')}" setting(s) are deprecated, use "${f}": ${Xt(t[f])}`)}),$t($t({},s),t)}function Cf(u){return u&&typeof u=="object"?Array.isArray(u)?u.map(Cf):Object.keys(u).reduce((t,e)=>(t[e]=Cf(u[e]),t),{}):u}function wL(u,t){const e=u.loader;e!==bp&&e!==ov?(t.log("[config]: Custom loader detected, cannot enable progressive streaming"),u.progressive=!1):xL()&&(u.loader=bp,u.progressive=!0,u.enableSoftwareAES=!0,t.log("[config]: Progressive streaming enabled, using FetchLoader"))}const oo=2,NL=.1,PL=.05,UL=100;class BL extends ey{constructor(t,e){super("gap-controller",t.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var s;(s=this.media)!=null&&s.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var s;this.ended=((s=this.media)==null?void 0:s.currentTime)||1,this.hls.trigger(x.MEDIA_ENDED,{stalled:!1})}},this.hls=t,this.fragmentTracker=e,this.registerListeners()}registerListeners(){const{hls:t}=this;t&&(t.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(x.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:t}=this;t&&(t.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(x.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(t,e){this.setInterval(UL),this.mediaSource=e.mediaSource;const s=this.media=e.media;Me(s,"playing",this.onMediaPlaying),Me(s,"waiting",this.onMediaWaiting),Me(s,"ended",this.onMediaEnded)}onMediaDetaching(t,e){this.clearInterval();const{media:s}=this;s&&(He(s,"playing",this.onMediaPlaying),He(s,"waiting",this.onMediaWaiting),He(s,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(t,e){this.buffered=e.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var t;if(!((t=this.media)!=null&&t.readyState)||!this.hasBuffered)return;const e=this.media.currentTime;this.poll(e,this.lastCurrentTime),this.lastCurrentTime=e}poll(t,e){var s,r;const a=(s=this.hls)==null?void 0:s.config;if(!a)return;const o=this.media;if(!o)return;const{seeking:f}=o,h=this.seeking&&!f,d=!this.seeking&&f,g=o.paused&&!f||o.ended||o.playbackRate===0;if(this.seeking=f,t!==e){e&&(this.ended=0),this.moved=!0,f||(this.nudgeRetry=0,a.nudgeOnVideoHole&&!g&&t>e&&this.nudgeOnVideoHole(t,e)),this.waiting===0&&this.stallResolved(t);return}if(d||h){h&&this.stallResolved(t);return}if(g){this.nudgeRetry=0,this.stallResolved(t),!this.ended&&o.ended&&this.hls&&(this.ended=t||1,this.hls.trigger(x.MEDIA_ENDED,{stalled:!1}));return}if(!Tt.getBuffered(o).length){this.nudgeRetry=0;return}const p=Tt.bufferInfo(o,t,0),v=p.nextStart||0,E=this.fragmentTracker;if(f&&E&&this.hls){const V=Lp(this.hls.inFlightFragments,t),O=p.len>oo,$=!v||V||v-t>oo&&!E.getPartialFragment(t);if(O||$)return;this.moved=!1}const S=(r=this.hls)==null?void 0:r.latestLevelDetails;if(!this.moved&&this.stalled!==null&&E){if(!(p.len>0)&&!v)return;const O=Math.max(v,p.start||0)-t,G=!!(S!=null&&S.live)?S.targetduration*2:oo,B=Jl(t,E);if(O>0&&(O<=G||B)){o.paused||this._trySkipBufferHole(B);return}}const A=a.detectStallWithCurrentTimeMs,b=self.performance.now(),L=this.waiting;let _=this.stalled;if(_===null)if(L>0&&b-L<A)_=this.stalled=L;else{this.stalled=b;return}const D=b-_;if(!f&&(D>=A||L)&&this.hls){var k;if(((k=this.mediaSource)==null?void 0:k.readyState)==="ended"&&!(S!=null&&S.live)&&Math.abs(t-((S==null?void 0:S.edge)||0))<1){if(this.ended)return;this.ended=t||1,this.hls.trigger(x.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(p),!this.media||!this.hls)return}const w=Tt.bufferInfo(o,t,a.maxBufferHole);this._tryFixBufferStall(w,D,t)}stallResolved(t){const e=this.stalled;if(e&&this.hls&&(this.stalled=null,this.stallReported)){const s=self.performance.now()-e;this.log(`playback not stuck anymore @${t}, after ${Math.round(s)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(x.STALL_RESOLVED,{})}}nudgeOnVideoHole(t,e){var s;const r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(s=this.buffered.audio)!=null&&s.length&&r&&r.length>1&&t>r.end(0)){const a=Tt.bufferedInfo(Tt.timeRangesToArray(this.buffered.audio),t,0);if(a.len>1&&e>=a.start){const o=Tt.timeRangesToArray(r),f=Tt.bufferedInfo(o,e,0).bufferedIndex;if(f>-1&&f<o.length-1){const h=Tt.bufferedInfo(o,t,0).bufferedIndex,d=o[f].end,g=o[f+1].start;if((h===-1||h>f)&&g-d<1&&t-d<2){const p=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${t} hole: ${d} -> ${g} buffered index: ${h}`);this.warn(p.message),this.media.currentTime+=1e-6;let v=Jl(t,this.fragmentTracker);v&&"fragment"in v?v=v.fragment:v||(v=void 0);const E=Tt.bufferInfo(this.media,t,0);this.hls.trigger(x.ERROR,{type:pt.MEDIA_ERROR,details:z.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:p,reason:p.message,frag:v,buffer:E.len,bufferInfo:E})}}}}}_tryFixBufferStall(t,e,s){var r,a;const{fragmentTracker:o,media:f}=this,h=(r=this.hls)==null?void 0:r.config;if(!f||!o||!h)return;const d=(a=this.hls)==null?void 0:a.latestLevelDetails,g=Jl(s,o);if((g||d!=null&&d.live&&s<d.fragmentStart)&&(this._trySkipBufferHole(g)||!this.media))return;const p=t.buffered,v=this.adjacentTraversal(t,s);(p&&p.length>1&&t.len>h.maxBufferHole||t.nextStart&&(t.nextStart-s<h.maxBufferHole||v))&&(e>h.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(t))}adjacentTraversal(t,e){const s=this.fragmentTracker,r=t.nextStart;if(s&&r){const a=s.getFragAtPos(e,ht.MAIN),o=s.getFragAtPos(r,ht.MAIN);if(a&&o)return o.sn-a.sn<2}return!1}_reportStall(t){const{hls:e,media:s,stallReported:r,stalled:a}=this;if(!r&&a!==null&&s&&e){this.stallReported=!0;const o=new Error(`Playback stalling at @${s.currentTime} due to low buffer (${Xt(t)})`);this.warn(o.message),e.trigger(x.ERROR,{type:pt.MEDIA_ERROR,details:z.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:t.len,bufferInfo:t,stalled:{start:a}})}}_trySkipBufferHole(t){var e;const{fragmentTracker:s,media:r}=this,a=(e=this.hls)==null?void 0:e.config;if(!r||!s||!a)return 0;const o=r.currentTime,f=Tt.bufferInfo(r,o,0),h=o<f.start?f.start:f.nextStart;if(h&&this.hls){const g=f.len<=a.maxBufferHole,p=f.len>0&&f.len<1&&r.readyState<3,v=h-o;if(v>0&&(g||p)){if(v>a.maxBufferHole){let S=!1;if(o===0){const A=s.getAppendedFrag(0,ht.MAIN);A&&h<A.end&&(S=!0)}if(!S&&t){var d;if(!((d=this.hls.loadLevelObj)!=null&&d.details)||Lp(this.hls.inFlightFragments,h))return 0;let b=!1,L=t.end;for(;L<h;){const _=Jl(L,s);if(_)L+=_.duration;else{b=!0;break}}if(b)return 0}}const E=Math.max(h+PL,o+NL);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${E}`),this.moved=!0,r.currentTime=E,!(t!=null&&t.gap)){const S=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${E}`),A={type:pt.MEDIA_ERROR,details:z.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:S,reason:S.message,buffer:f.len,bufferInfo:f};t&&("fragment"in t?A.part=t:A.frag=t),this.hls.trigger(x.ERROR,A)}return E}}return 0}_tryNudgeBuffer(t){const{hls:e,media:s,nudgeRetry:r}=this,a=e==null?void 0:e.config;if(!s||!a)return 0;const o=s.currentTime;if(this.nudgeRetry++,r<a.nudgeMaxRetry){const f=o+(r+1)*a.nudgeOffset,h=new Error(`Nudging 'currentTime' from ${o} to ${f}`);this.warn(h.message),s.currentTime=f,e.trigger(x.ERROR,{type:pt.MEDIA_ERROR,details:z.BUFFER_NUDGE_ON_STALL,error:h,fatal:!1,buffer:t.len,bufferInfo:t})}else{const f=new Error(`Playhead still not moving while enough data buffered @${o} after ${a.nudgeMaxRetry} nudges`);this.error(f.message),e.trigger(x.ERROR,{type:pt.MEDIA_ERROR,details:z.BUFFER_STALLED_ERROR,error:f,fatal:!0,buffer:t.len,bufferInfo:t})}}}function Lp(u,t){const e=Rp(u.main);if(e&&e.start<=t)return e;const s=Rp(u.audio);return s&&s.start<=t?s:null}function Rp(u){if(!u)return null;switch(u.state){case J.IDLE:case J.STOPPED:case J.ENDED:case J.ERROR:return null}return u.frag}function Jl(u,t){return t.getAppendedFrag(u,ht.MAIN)||t.getPartialFragment(u)}const FL=.25;function kf(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function cf(u,t,e,s,r){let a=new u(t,e,"");try{a.value=s,r&&(a.type=r)}catch{a=new u(t,e,Xt(r?$t({type:r},s):s))}return a}const to=(()=>{const u=kf();try{u&&new u(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class $L{constructor(t){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(x.EVENT_CUE_ENTER,{})},this.hls=t,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:t}=this;t&&(t.on(x.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(x.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(x.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(x.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:t}=this;t&&(t.off(x.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(x.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(x.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(x.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(t,e){var s;this.media=e.media,((s=e.overrides)==null?void 0:s.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var t;const e=(t=this.hls)==null?void 0:t.latestLevelDetails;e&&this.updateDateRangeCues(e)}onMediaDetaching(t,e){this.media=null,!e.transferMedia&&(this.id3Track&&(this.removeCues&&ir(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(t){const e=this.getID3Track(t.textTracks);return e.mode="hidden",e}getID3Track(t){if(this.media){for(let e=0;e<t.length;e++){const s=t[e];if(s.kind==="metadata"&&s.label==="id3")return Qy(s,this.media),s}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(t,e){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:s,enableID3MetadataCues:r}=this.hls.config;if(!s&&!r)return;const{samples:a}=e;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=kf();if(o)for(let f=0;f<a.length;f++){const h=a[f].type;if(h===ei.emsg&&!s||!r)continue;const d=by(a[f].data),g=a[f].pts;let p=g+a[f].duration;p>to&&(p=to),p-g<=0&&(p=g+FL);for(let E=0;E<d.length;E++){const S=d[E];if(!Ly(S)){this.updateId3CueEnds(g,h);const A=cf(o,g,p,S,h);A&&this.id3Track.addCue(A)}}}}updateId3CueEnds(t,e){var s;const r=(s=this.id3Track)==null?void 0:s.cues;if(r)for(let a=r.length;a--;){const o=r[a];o.type===e&&o.startTime<t&&o.endTime===to&&(o.endTime=t)}}onBufferFlushing(t,{startOffset:e,endOffset:s,type:r}){const{id3Track:a,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:f,enableID3MetadataCues:h}}=o;if(a&&(f||h)){let d;r==="audio"?d=g=>g.type===ei.audioId3&&h:r==="video"?d=g=>g.type===ei.emsg&&f:d=g=>g.type===ei.audioId3&&h||g.type===ei.emsg&&f,Df(a,e,s,d)}}onLevelUpdated(t,{details:e}){this.updateDateRangeCues(e,!0)}onLevelPtsUpdated(t,e){Math.abs(e.drift)>.01&&this.updateDateRangeCues(e.details)}updateDateRangeCues(t,e){if(!this.hls||!this.media)return;const{assetPlayerId:s,timelineOffset:r,enableDateRangeMetadataCues:a,interstitialsController:o}=this.hls.config;if(!a)return;const f=kf();if(s&&r&&!o){const{fragmentStart:A,fragmentEnd:b}=t;let L=this.assetCue;L?(L.startTime=A,L.endTime=b):f&&(L=this.assetCue=cf(f,A,b,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),L&&(L.id=s,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(L),L.addEventListener("enter",this.onEventCueEnter)))}if(!t.hasProgramDateTime)return;const{id3Track:h}=this,{dateRanges:d}=t,g=Object.keys(d);let p=this.dateRangeCuesAppended;if(h&&e){var v;if((v=h.cues)!=null&&v.length){const A=Object.keys(p).filter(b=>!g.includes(b));for(let b=A.length;b--;){var E;const L=A[b],_=(E=p[L])==null?void 0:E.cues;delete p[L],_&&Object.keys(_).forEach(D=>{const k=_[D];if(k){k.removeEventListener("enter",this.onEventCueEnter);try{h.removeCue(k)}catch{}}})}}else p=this.dateRangeCuesAppended={}}const S=t.fragments[t.fragments.length-1];if(!(g.length===0||!ct(S==null?void 0:S.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let A=0;A<g.length;A++){const b=g[A],L=d[b],_=L.startTime,D=p[b],k=(D==null?void 0:D.cues)||{};let w=(D==null?void 0:D.durationKnown)||!1,V=to;const{duration:O,endDate:$}=L;if($&&O!==null)V=_+O,w=!0;else if(L.endOnNext&&!w){const B=g.reduce((Q,st)=>{if(st!==L.id){const ut=d[st];if(ut.class===L.class&&ut.startDate>L.startDate&&(!Q||L.startDate<Q.startDate))return ut}return Q},null);B&&(V=B.startTime,w=!0)}const G=Object.keys(L.attr);for(let B=0;B<G.length;B++){const Q=G[B];if(!lA(Q))continue;const st=k[Q];if(st)w&&!(D!=null&&D.durationKnown)?st.endTime=V:Math.abs(st.startTime-_)>.01&&(st.startTime=_,st.endTime=V);else if(f){let ut=L.attr[Q];oA(Q)&&(ut=Np(ut));const lt=cf(f,_,V,{key:Q,data:ut},ei.dateRange);lt&&(lt.id=b,this.id3Track.addCue(lt),k[Q]=lt,o&&(Q==="X-ASSET-LIST"||Q==="X-ASSET-URL")&&lt.addEventListener("enter",this.onEventCueEnter))}}p[b]={cues:k,dateRange:L,durationKnown:w}}}}}class GL{constructor(t){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:e}=this,s=this.levelDetails;if(!e||!s)return;this.currentTime=e.currentTime;const r=this.computeLatency();if(r===null)return;this._latency=r;const{lowLatencyMode:a,maxLiveSyncPlaybackRate:o}=this.config;if(!a||o===1||!s.live)return;const f=this.targetLatency;if(f===null)return;const h=r-f,d=Math.min(this.maxLatency,f+s.targetduration);if(h<d&&h>.05&&this.forwardBufferLength>1){const p=Math.min(2,Math.max(1,o)),v=Math.round(2/(1+Math.exp(-.75*h-this.edgeStalled))*20)/20,E=Math.min(p,Math.max(1,v));this.changeMediaPlaybackRate(e,E)}else e.playbackRate!==1&&e.playbackRate!==0&&this.changeMediaPlaybackRate(e,1)},this.hls=t,this.config=t.config,this.registerListeners()}get levelDetails(){var t;return((t=this.hls)==null?void 0:t.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:t}=this;if(t.liveMaxLatencyDuration!==void 0)return t.liveMaxLatencyDuration;const e=this.levelDetails;return e?t.liveMaxLatencyDurationCount*e.targetduration:0}get targetLatency(){const t=this.levelDetails;if(t===null||this.hls===null)return null;const{holdBack:e,partHoldBack:s,targetduration:r}=t,{liveSyncDuration:a,liveSyncDurationCount:o,lowLatencyMode:f}=this.config,h=this.hls.userConfig;let d=f&&s||e;(this._targetLatencyUpdated||h.liveSyncDuration||h.liveSyncDurationCount||d===0)&&(d=a!==void 0?a:o*r);const g=r;return d+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,g)}set targetLatency(t){this.stallCount=0,this.config.liveSyncDuration=t,this._targetLatencyUpdated=!0}get liveSyncPosition(){const t=this.estimateLiveEdge(),e=this.targetLatency;if(t===null||e===null)return null;const s=this.levelDetails;if(s===null)return null;const r=s.edge,a=t-e-this.edgeStalled,o=r-s.totalduration,f=r-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(o,a),f)}get drift(){const t=this.levelDetails;return t===null?1:t.drift}get edgeStalled(){const t=this.levelDetails;if(t===null)return 0;const e=(this.config.lowLatencyMode&&t.partTarget||t.targetduration)*3;return Math.max(t.age-e,0)}get forwardBufferLength(){const{media:t}=this,e=this.levelDetails;if(!t||!e)return 0;const s=t.buffered.length;return(s?t.buffered.end(s-1):e.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:t}=this;t&&(t.on(x.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(x.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(x.ERROR,this.onError,this))}unregisterListeners(){const{hls:t}=this;t&&(t.off(x.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(x.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(x.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(x.ERROR,this.onError,this))}onMediaAttached(t,e){this.media=e.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(t,{details:e}){e.advanced&&this.onTimeupdate(),!e.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(t,e){var s;e.details===z.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(s=this.levelDetails)!=null&&s.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(t,e){var s,r;t.playbackRate!==e&&((s=this.hls)==null||s.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(r=this.targetLatency)==null?void 0:r.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${t.playbackRate} to ${e}`),t.playbackRate=e)}estimateLiveEdge(){const t=this.levelDetails;return t===null?null:t.edge+t.age}computeLatency(){const t=this.estimateLiveEdge();return t===null?null:t-this.currentTime}}class HL extends Wf{constructor(t,e){super(t,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=e,this._registerListeners()}_registerListeners(){const{hls:t}=this;t.on(x.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(x.LEVEL_LOADED,this.onLevelLoaded,this),t.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(x.FRAG_BUFFERED,this.onFragBuffered,this),t.on(x.ERROR,this.onError,this)}_unregisterListeners(){const{hls:t}=this;t.off(x.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(x.LEVEL_LOADED,this.onLevelLoaded,this),t.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(x.FRAG_BUFFERED,this.onFragBuffered,this),t.off(x.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(e=>{e.loadError=0,e.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(t,e){this.resetLevels()}onManifestLoaded(t,e){const s=this.hls.config.preferManagedMediaSource,r=[],a={},o={};let f=!1,h=!1,d=!1;e.levels.forEach(g=>{const p=g.attrs;let{audioCodec:v,videoCodec:E}=g;v&&(g.audioCodec=v=co(v,s)||void 0),E&&(E=g.videoCodec=bx(E));const{width:S,height:A,unknownCodecs:b}=g,L=(b==null?void 0:b.length)||0;if(f||(f=!!(S&&A)),h||(h=!!E),d||(d=!!v),L||v&&!this.isAudioSupported(v)||E&&!this.isVideoSupported(E)){this.log(`Some or all CODECS not supported "${p.CODECS}"`);return}const{CODECS:_,"FRAME-RATE":D,"HDCP-LEVEL":k,"PATHWAY-ID":w,RESOLUTION:V,"VIDEO-RANGE":O}=p,G=`${`${w||"."}-`}${g.bitrate}-${V}-${D}-${_}-${O}-${k}`;if(a[G])if(a[G].uri!==g.url&&!g.attrs["PATHWAY-ID"]){const B=o[G]+=1;g.attrs["PATHWAY-ID"]=new Array(B+1).join(".");const Q=this.createLevel(g);a[G]=Q,r.push(Q)}else a[G].addGroupId("audio",p.AUDIO),a[G].addGroupId("text",p.SUBTITLES);else{const B=this.createLevel(g);a[G]=B,o[G]=1,r.push(B)}}),this.filterAndSortMediaOptions(r,e,f,h,d)}createLevel(t){const e=new ga(t),s=t.supplemental;if(s!=null&&s.videoCodec&&!this.isVideoSupported(s.videoCodec)){const r=new Error(`SUPPLEMENTAL-CODECS not supported "${s.videoCodec}"`);this.log(r.message),e.supportedResult=Yp(r,[])}return e}isAudioSupported(t){return da(t,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(t){return da(t,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(t,e,s,r,a){var o;let f=[],h=[],d=t;const g=((o=e.stats)==null?void 0:o.parsing)||{};if((s||r)&&a&&(d=d.filter(({videoCodec:_,videoRange:D,width:k,height:w})=>(!!_||!!(k&&w))&&wx(D))),d.length===0){Promise.resolve().then(()=>{if(this.hls){let _="no level with compatible codecs found in manifest",D=_;e.levels.length&&(D=`one or more CODECS in variant not supported: ${Xt(e.levels.map(w=>w.attrs.CODECS).filter((w,V,O)=>O.indexOf(w)===V))}`,this.warn(D),_+=` (${D})`);const k=new Error(_);this.hls.trigger(x.ERROR,{type:pt.MEDIA_ERROR,details:z.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:e.url,error:k,reason:D})}}),g.end=performance.now();return}e.audioTracks&&(f=e.audioTracks.filter(_=>!_.audioCodec||this.isAudioSupported(_.audioCodec)),_p(f)),e.subtitles&&(h=e.subtitles,_p(h));const p=d.slice(0);d.sort((_,D)=>{if(_.attrs["HDCP-LEVEL"]!==D.attrs["HDCP-LEVEL"])return(_.attrs["HDCP-LEVEL"]||"")>(D.attrs["HDCP-LEVEL"]||"")?1:-1;if(s&&_.height!==D.height)return _.height-D.height;if(_.frameRate!==D.frameRate)return _.frameRate-D.frameRate;if(_.videoRange!==D.videoRange)return fo.indexOf(_.videoRange)-fo.indexOf(D.videoRange);if(_.videoCodec!==D.videoCodec){const k=vm(_.videoCodec),w=vm(D.videoCodec);if(k!==w)return w-k}if(_.uri===D.uri&&_.codecSet!==D.codecSet){const k=uo(_.codecSet),w=uo(D.codecSet);if(k!==w)return w-k}return _.averageBitrate!==D.averageBitrate?_.averageBitrate-D.averageBitrate:0});let v=p[0];if(this.steering&&(d=this.steering.filterParsedLevels(d),d.length!==p.length)){for(let _=0;_<p.length;_++)if(p[_].pathwayId===d[0].pathwayId){v=p[_];break}}this._levels=d;for(let _=0;_<d.length;_++)if(d[_]===v){var E;this._firstLevel=_;const D=v.bitrate,k=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${d.length} level(s) found, first bitrate: ${D}`),((E=this.hls.userConfig)==null?void 0:E.abrEwmaDefaultEstimate)===void 0){const w=Math.min(D,this.hls.config.abrEwmaDefaultEstimateMax);w>k&&k===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=w)}break}const S=a&&!r,A=this.hls.config,b=!!(A.audioStreamController&&A.audioTrackController),L={levels:d,audioTracks:f,subtitleTracks:h,sessionData:e.sessionData,sessionKeys:e.sessionKeys,firstLevel:this._firstLevel,stats:e.stats,audio:a,video:r,altAudio:b&&!S&&f.some(_=>!!_.url)};g.end=performance.now(),this.hls.trigger(x.MANIFEST_PARSED,L)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(t){const e=this._levels;if(e.length===0)return;if(t<0||t>=e.length){const g=new Error("invalid level idx"),p=t<0;if(this.hls.trigger(x.ERROR,{type:pt.OTHER_ERROR,details:z.LEVEL_SWITCH_ERROR,level:t,fatal:p,error:g,reason:g.message}),p)return;t=Math.min(t,e.length-1)}const s=this.currentLevelIndex,r=this.currentLevel,a=r?r.attrs["PATHWAY-ID"]:void 0,o=e[t],f=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=t,this.currentLevel=o,s===t&&r&&a===f)return;this.log(`Switching to level ${t} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${f?" with Pathway "+f:""} from level ${s}${a?" with Pathway "+a:""}`);const h={level:t,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(x.LEVEL_SWITCHING,h);const d=o.details;if(!d||d.live){const g=this.switchParams(o.uri,r==null?void 0:r.details,d);this.loadPlaylist(g)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(t){this.manualLevelIndex=t,this._startLevel===void 0&&(this._startLevel=t),t!==-1&&(this.level=t)}get firstLevel(){return this._firstLevel}set firstLevel(t){this._firstLevel=t}get startLevel(){if(this._startLevel===void 0){const t=this.hls.config.startLevel;return t!==void 0?t:this.hls.firstAutoLevel}return this._startLevel}set startLevel(t){this._startLevel=t}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(t){if(this.steering){const e=this.steering.pathways(),s=t.filter(r=>e.indexOf(r)!==-1);if(t.length<1){this.warn(`pathwayPriority ${t} should contain at least one pathway from list: ${e}`);return}this.steering.pathwayPriority=s}}onError(t,e){e.fatal||!e.context||e.context.type===Rt.LEVEL&&e.context.level===this.level&&this.checkRetry(e)}onFragBuffered(t,{frag:e}){if(e!==void 0&&e.type===ht.MAIN){const s=e.elementaryStreams;if(!Object.keys(s).some(a=>!!s[a]))return;const r=this._levels[e.level];r!=null&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(t,e){var s;const{level:r,details:a}=e,o=e.levelInfo;if(!o){var f;this.warn(`Invalid level index ${r}`),(f=e.deliveryDirectives)!=null&&f.skip&&(a.deltaUpdateFailed=!0);return}if(o===this.currentLevel||e.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let h=o.details;h===e.details&&h.advanced&&(h=void 0),this.playlistLoaded(r,e,h)}else(s=e.deliveryDirectives)!=null&&s.skip&&(a.deltaUpdateFailed=!0)}loadPlaylist(t){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,t)}loadingPlaylist(t,e){super.loadingPlaylist(t,e);const s=this.getUrlWithDirectives(t.uri,e),r=this.currentLevelIndex,a=t.attrs["PATHWAY-ID"],o=t.details,f=o==null?void 0:o.age;this.log(`Loading level index ${r}${(e==null?void 0:e.msn)!==void 0?" at sn "+e.msn+" part "+e.part:""}${a?" Pathway "+a:""}${f&&o.live?" age "+f.toFixed(1)+(o.type&&" "+o.type||""):""} ${s}`),this.hls.trigger(x.LEVEL_LOADING,{url:s,level:r,levelInfo:t,pathwayId:t.attrs["PATHWAY-ID"],id:0,deliveryDirectives:e||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(t){this.level=t,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=t)}removeLevel(t){var e;if(this._levels.length===1)return;const s=this._levels.filter((a,o)=>o!==t?!0:(this.steering&&this.steering.removeLevel(a),a===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,a.details&&a.details.fragments.forEach(f=>f.level=-1)),!1));gy(s),this._levels=s,this.currentLevelIndex>-1&&(e=this.currentLevel)!=null&&e.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const r=s.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(x.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(t,{levels:e}){this._levels=e}checkMaxAutoUpdated(){const{autoLevelCapping:t,maxAutoLevel:e,maxHdcpLevel:s}=this.hls;this._maxAutoLevel!==e&&(this._maxAutoLevel=e,this.hls.trigger(x.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:t,levels:this.levels,maxAutoLevel:e,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:s}))}}function _p(u){const t={};u.forEach(e=>{const s=e.groupId||"";e.id=t[s]=t[s]||0,t[s]++})}function uv(){return self.SourceBuffer||self.WebKitSourceBuffer}function cv(){if(!Us())return!1;const t=uv();return!t||t.prototype&&typeof t.prototype.appendBuffer=="function"&&typeof t.prototype.remove=="function"}function zL(){if(!cv())return!1;const u=Us();return typeof(u==null?void 0:u.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(t=>u.isTypeSupported(ha(t,"video")))||["mp4a.40.2","fLaC"].some(t=>u.isTypeSupported(ha(t,"audio"))))}function KL(){var u;const t=uv();return typeof(t==null||(u=t.prototype)==null?void 0:u.changeType)=="function"}const jL=100;class VL extends zf{constructor(t,e,s){super(t,e,s,"stream-controller",ht.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const r=this.media,a=r?r.currentTime:null;if(a===null||!ct(a)||(this.log(`Media seeked to ${a.toFixed(3)}`),!this.getBufferedFrag(a)))return;const o=this.getFwdBufferInfoAtPos(r,a,ht.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${a} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:t}=this;t.on(x.MANIFEST_PARSED,this.onManifestParsed,this),t.on(x.LEVEL_LOADING,this.onLevelLoading,this),t.on(x.LEVEL_LOADED,this.onLevelLoaded,this),t.on(x.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(x.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(x.BUFFER_CREATED,this.onBufferCreated,this),t.on(x.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(x.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:t}=this;t.off(x.MANIFEST_PARSED,this.onManifestParsed,this),t.off(x.LEVEL_LOADED,this.onLevelLoaded,this),t.off(x.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(x.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(x.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(x.BUFFER_CREATED,this.onBufferCreated,this),t.off(x.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(x.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(t,e){if(this.levels){const{lastCurrentTime:s,hls:r}=this;if(this.stopLoad(),this.setInterval(jL),this.level=-1,!this.startFragRequested){let a=r.startLevel;a===-1&&(r.config.testBandwidth&&this.levels.length>1?(a=0,this.bitrateTest=!0):a=r.firstAutoLevel),r.nextLoadLevel=a,this.level=r.loadLevel,this._hasEnoughToStart=!!e}s>0&&t===-1&&!e&&(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),t=s),this.state=J.IDLE,this.nextLoadPosition=this.lastCurrentTime=t+this.timelineOffset,this.startPosition=e?-1:t,this.tick()}else this._forceStartLoad=!0,this.state=J.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case J.WAITING_LEVEL:{const{levels:t,level:e}=this,s=t==null?void 0:t[e],r=s==null?void 0:s.details;if(r&&(!r.live||this.levelLastLoaded===s&&!this.waitForLive(s))){if(this.waitForCdnTuneIn(r))break;this.state=J.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=J.IDLE;break}break}case J.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===J.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var t;super.onTickEnd(),(t=this.media)!=null&&t.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:t,levelLastLoaded:e,levels:s,media:r}=this;if(e===null||!r&&!this.primaryPrefetch&&(this.startFragRequested||!t.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const a=this.buffering?t.nextLoadLevel:t.loadLevel;if(!(s!=null&&s[a]))return;const o=s[a],f=this.getMainFwdBufferInfo();if(f===null)return;const h=this.getLevelDetails();if(h&&this._streamEnded(f,h)){const A={};this.altAudio===2&&(A.type="video"),this.hls.trigger(x.BUFFER_EOS,A),this.state=J.ENDED;return}if(!this.buffering)return;t.loadLevel!==a&&t.manualLevel===-1&&this.log(`Adapting to level ${a} from level ${this.level}`),this.level=t.nextLoadLevel=a;const d=o.details;if(!d||this.state===J.WAITING_LEVEL||this.waitForLive(o)){this.level=a,this.state=J.WAITING_LEVEL,this.startFragRequested=!1;return}const g=f.len,p=this.getMaxBufferLength(o.maxBitrate);if(g>=p)return;this.backtrackFragment&&this.backtrackFragment.start>f.end&&(this.backtrackFragment=null);const v=this.backtrackFragment?this.backtrackFragment.start:f.end;let E=this.getNextFragment(v,d);if(this.couldBacktrack&&!this.fragPrevious&&E&&le(E)&&this.fragmentTracker.getState(E)!==ge.OK){var S;const b=((S=this.backtrackFragment)!=null?S:E).sn-d.startSN,L=d.fragments[b-1];L&&E.cc===L.cc&&(E=L,this.fragmentTracker.removeFragment(L))}else this.backtrackFragment&&f.len&&(this.backtrackFragment=null);if(E&&this.isLoopLoading(E,v)){if(!E.gap){const b=this.audioOnly&&!this.altAudio?qt.AUDIO:qt.VIDEO,L=(b===qt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;L&&this.afterBufferFlushed(L,b,ht.MAIN)}E=this.getNextFragmentLoopLoading(E,d,f,ht.MAIN,p)}E&&(E.initSegment&&!E.initSegment.data&&!this.bitrateTest&&(E=E.initSegment),this.loadFragment(E,o,v))}loadFragment(t,e,s){const r=this.fragmentTracker.getState(t);r===ge.NOT_LOADED||r===ge.PARTIAL?le(t)?this.bitrateTest?(this.log(`Fragment ${t.sn} of level ${t.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(t,e)):super.loadFragment(t,e,s):this._loadInitSegment(t,e):this.clearTrackerIfNeeded(t)}getBufferedFrag(t){return this.fragmentTracker.getBufferedFrag(t,ht.MAIN)}followingBufferedFrag(t){return t?this.getBufferedFrag(t.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:t,media:e}=this;if(e!=null&&e.readyState){let s;const r=this.getAppendedFrag(e.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const a=this.getLevelDetails();if(a!=null&&a.live){const f=this.getMainFwdBufferInfo();if(!f||f.len<a.targetduration*2)return}if(!e.paused&&t){const f=this.hls.nextLoadLevel,h=t[f],d=this.fragLastKbps;d&&this.fragCurrent?s=this.fragCurrent.duration*h.maxBitrate/(1e3*d)+1:s=0}else s=0;const o=this.getBufferedFrag(e.currentTime+s);if(o){const f=this.followingBufferedFrag(o);if(f){this.abortCurrentFrag();const h=f.maxStartPTS?f.maxStartPTS:f.start,d=f.duration,g=Math.max(o.end,h+Math.min(Math.max(d-this.config.maxFragLookUpTolerance,d*(this.couldBacktrack?.5:.125)),d*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(g,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.state){case J.KEY_LOADING:case J.FRAG_LOADING:case J.FRAG_LOADING_WAITING_RETRY:case J.PARSING:case J.PARSED:this.state=J.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(t,e){super.flushMainBuffer(t,e,this.altAudio===2?"video":null)}onMediaAttached(t,e){super.onMediaAttached(t,e);const s=e.media;Me(s,"playing",this.onMediaPlaying),Me(s,"seeked",this.onMediaSeeked)}onMediaDetaching(t,e){const{media:s}=this;s&&(He(s,"playing",this.onMediaPlaying),He(s,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(t,e),!e.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(x.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(t,e){let s=!1,r=!1;for(let a=0;a<e.levels.length;a++){const o=e.levels[a].audioCodec;o&&(s=s||o.indexOf("mp4a.40.2")!==-1,r=r||o.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=s&&r&&!KL(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1}onLevelLoading(t,e){const{levels:s}=this;if(!s||this.state!==J.IDLE)return;const r=e.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state=J.WAITING_LEVEL)}onLevelLoaded(t,e){var s;const{levels:r,startFragRequested:a}=this,o=e.level,f=e.details,h=f.totalduration;if(!r){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${f.startSN},${f.endSN}]${f.lastPartSn?`[part-${f.lastPartSn}-${f.lastPartIndex}]`:""}, cc [${f.startCC}, ${f.endCC}] duration:${h}`);const d=e.levelInfo,g=this.fragCurrent;g&&(this.state===J.FRAG_LOADING||this.state===J.FRAG_LOADING_WAITING_RETRY)&&g.level!==e.level&&g.loader&&this.abortCurrentFrag();let p=0;if(f.live||(s=d.details)!=null&&s.live){var v;if(this.checkLiveUpdate(f),f.deltaUpdateFailed)return;p=this.alignPlaylists(f,d.details,(v=this.levelLastLoaded)==null?void 0:v.details)}if(d.details=f,this.levelLastLoaded=d,a||this.setStartPosition(f,p),this.hls.trigger(x.LEVEL_UPDATED,{details:f,level:o}),this.state===J.WAITING_LEVEL){if(this.waitForCdnTuneIn(f))return;this.state=J.IDLE}a&&f.live&&this.synchronizeToLiveEdge(f),this.tick()}synchronizeToLiveEdge(t){const{config:e,media:s}=this;if(!s)return;const r=this.hls.liveSyncPosition,a=this.getLoadPosition(),o=t.fragmentStart,f=t.edge,h=a>=o-e.maxFragLookUpTolerance&&a<=f;if(r!==null&&s.duration>r&&(a<r||!h)){const g=e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:e.liveMaxLatencyDurationCount*t.targetduration;if((!h&&s.readyState<4||a<f-g)&&(this._hasEnoughToStart||(this.nextLoadPosition=r),s.readyState))if(this.warn(`Playback: ${a.toFixed(3)} is located too far from the end of live sliding playlist: ${f}, reset currentTime to : ${r.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var d;const p=Tt.bufferInfo(s,r,0);if(!((d=p.buffered)!=null&&d.length)){s.currentTime=r;return}if(p.start<=a){s.currentTime=r;return}const{nextStart:E}=Tt.bufferedInfo(p.buffered,a,0);E&&(s.currentTime=E)}else s.currentTime=r}}_handleFragmentLoadProgress(t){var e;const s=t.frag,{part:r,payload:a}=t,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const f=o[s.level];if(!f){this.warn(`Level ${s.level} not found on progress`);return}const h=f.details;if(!h){this.warn(`Dropping fragment ${s.sn} of level ${s.level} after level details were reset`),this.fragmentTracker.removeFragment(s);return}const d=f.videoCodec,g=h.PTSKnown||!h.live,p=(e=s.initSegment)==null?void 0:e.data,v=this._getAudioCodec(f),E=this.transmuxer=this.transmuxer||new Py(this.hls,ht.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),S=r?r.index:-1,A=S!==-1,b=new $f(s.level,s.sn,s.stats.chunkCount,a.byteLength,S,A),L=this.initPTS[s.cc];E.push(a,p,v,d,s,r,h.totalduration,g,b,L)}onAudioTrackSwitching(t,e){const s=this.hls,r=this.altAudio!==0;if(ho(e.url,s))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r){this.altAudio=0,this.fragmentTracker.removeAllFragments(),s.once(x.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(x.AUDIO_TRACK_SWITCHED,e)}),s.trigger(x.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}s.trigger(x.AUDIO_TRACK_SWITCHED,e)}}onAudioTrackSwitched(t,e){const s=ho(e.url,this.hls);if(s){const r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=s?2:0,this.tick()}onBufferCreated(t,e){const s=e.tracks;let r,a,o=!1;for(const f in s){const h=s[f];if(h.id==="main"){if(a=f,r=h,f==="video"){const d=s[f];d&&(this.videoBuffer=d.buffer)}}else o=!0}o&&r?(this.log(`Alternate track found, use ${a}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(t,e){const{frag:s,part:r}=e,a=s.type===ht.MAIN;if(a){if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${r?" p: "+r.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}`),this.state===J.PARSED&&(this.state=J.IDLE);return}const f=r?r.stats:s.stats;this.fragLastKbps=Math.round(8*f.total/(f.buffering.end-f.loading.first)),le(s)&&(this.fragPrevious=s),this.fragBufferedComplete(s,r)}const o=this.media;o&&(!this._hasEnoughToStart&&Tt.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),a&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(t,e){var s;if(e.fatal){this.state=J.ERROR;return}switch(e.details){case z.FRAG_GAP:case z.FRAG_PARSING_ERROR:case z.FRAG_DECRYPT_ERROR:case z.FRAG_LOAD_ERROR:case z.FRAG_LOAD_TIMEOUT:case z.KEY_LOAD_ERROR:case z.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ht.MAIN,e);break;case z.LEVEL_LOAD_ERROR:case z.LEVEL_LOAD_TIMEOUT:case z.LEVEL_PARSING_ERROR:!e.levelRetry&&this.state===J.WAITING_LEVEL&&((s=e.context)==null?void 0:s.type)===Rt.LEVEL&&(this.state=J.IDLE);break;case z.BUFFER_ADD_CODEC_ERROR:case z.BUFFER_APPEND_ERROR:if(e.parent!=="main")return;this.reduceLengthAndFlushBuffer(e)&&this.resetLoadingState();break;case z.BUFFER_FULL_ERROR:if(e.parent!=="main")return;this.reduceLengthAndFlushBuffer(e)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case z.INTERNAL_EXCEPTION:this.recoverWorkerError(e);break}}onFragLoadEmergencyAborted(){this.state=J.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(t,{type:e}){if(e!==qt.AUDIO||!this.altAudio){const s=(e===qt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;s&&(this.afterBufferFlushed(s,e,ht.MAIN),this.tick())}}onLevelsUpdated(t,e){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=e.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:t}=this;if(!t)return;const e=t.currentTime;let s=this.startPosition;if(s>=0&&e<s){if(t.seeking){this.log(`could not seek to ${s}, already seeking at ${e}`);return}const r=this.timelineOffset;r&&s&&(s+=r);const a=this.getLevelDetails(),o=Tt.getBuffered(t),f=o.length?o.start(0):0,h=f-s,d=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||h>0&&(h<d||this.loadingParts&&h<2*((a==null?void 0:a.partTarget)||0)))&&(this.log(`adjusting start position by ${h} to match buffer start`),s+=h,this.startPosition=s),e<s&&(this.log(`seek to target start position ${s} from current time ${e} buffer start ${f}`),t.currentTime=s)}}_getAudioCodec(t){let e=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&e&&(this.log("Swapping audio codec"),e.indexOf("mp4a.40.5")!==-1?e="mp4a.40.2":e="mp4a.40.5"),e}_loadBitrateTestFrag(t,e){t.bitrateTest=!0,this._doFragLoad(t,e).then(s=>{const{hls:r}=this,a=s==null?void 0:s.frag;if(!a||this.fragContextChanged(a))return;e.fragmentError=0,this.state=J.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=a.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),r.trigger(x.FRAG_LOADED,s),a.bitrateTest=!1}).catch(s=>{this.state===J.STOPPED||this.state===J.ERROR||(this.warn(s),this.resetFragmentLoading(t))})}_handleTransmuxComplete(t){const e=this.playlistType,{hls:s}=this,{remuxResult:r,chunkMeta:a}=t,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}const{frag:f,part:h,level:d}=o,{video:g,text:p,id3:v,initSegment:E}=r,{details:S}=d,A=this.altAudio?void 0:r.audio;if(this.fragContextChanged(f)){this.fragmentTracker.removeFragment(f);return}if(this.state=J.PARSING,E){const b=E.tracks;if(b){const k=f.initSegment||f;if(this.unhandledEncryptionError(E,f))return;this._bufferInitSegment(d,b,k,a),s.trigger(x.FRAG_PARSING_INIT_SEGMENT,{frag:k,id:e,tracks:b})}const L=E.initPTS,_=E.timescale,D=this.initPTS[f.cc];if(ct(L)&&(!D||D.baseTime!==L||D.timescale!==_)){const k=E.trackId;this.initPTS[f.cc]={baseTime:L,timescale:_,trackId:k},s.trigger(x.INIT_PTS_FOUND,{frag:f,id:e,initPTS:L,timescale:_,trackId:k})}}if(g&&S){A&&g.type==="audiovideo"&&this.logMuxedErr(f);const b=S.fragments[f.sn-1-S.startSN],L=f.sn===S.startSN,_=!b||f.cc>b.cc;if(r.independent!==!1){const{startPTS:D,endPTS:k,startDTS:w,endDTS:V}=g;if(h)h.elementaryStreams[g.type]={startPTS:D,endPTS:k,startDTS:w,endDTS:V};else if(g.firstKeyFrame&&g.independent&&a.id===1&&!_&&(this.couldBacktrack=!0),g.dropped&&g.independent){const O=this.getMainFwdBufferInfo(),$=(O?O.end:this.getLoadPosition())+this.config.maxBufferHole,G=g.firstKeyFramePTS?g.firstKeyFramePTS:D;if(!L&&$<G-this.config.maxBufferHole&&!_){this.backtrack(f);return}else _&&(f.gap=!0);f.setElementaryStreamInfo(g.type,f.start,k,f.start,V,!0)}else L&&D-(S.appliedTimelineOffset||0)>oo&&(f.gap=!0);f.setElementaryStreamInfo(g.type,D,k,w,V),this.backtrackFragment&&(this.backtrackFragment=f),this.bufferFragmentData(g,f,h,a,L||_)}else if(L||_)f.gap=!0;else{this.backtrack(f);return}}if(A){const{startPTS:b,endPTS:L,startDTS:_,endDTS:D}=A;h&&(h.elementaryStreams[qt.AUDIO]={startPTS:b,endPTS:L,startDTS:_,endDTS:D}),f.setElementaryStreamInfo(qt.AUDIO,b,L,_,D),this.bufferFragmentData(A,f,h,a)}if(S&&v!=null&&v.samples.length){const b={id:e,frag:f,details:S,samples:v.samples};s.trigger(x.FRAG_PARSING_METADATA,b)}if(S&&p){const b={id:e,frag:f,details:S,samples:p.samples};s.trigger(x.FRAG_PARSING_USERDATA,b)}}logMuxedErr(t){this.warn(`${le(t)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${t.url}`)}_bufferInitSegment(t,e,s,r){if(this.state!==J.PARSING)return;this.audioOnly=!!e.audio&&!e.video,this.altAudio&&!this.audioOnly&&(delete e.audio,e.audiovideo&&this.logMuxedErr(s));const{audio:a,video:o,audiovideo:f}=e;if(a){const d=t.audioCodec;let g=eo(a.codec,d);g==="mp4a"&&(g="mp4a.40.5");const p=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){g&&(g.indexOf("mp4a.40.5")!==-1?g="mp4a.40.2":g="mp4a.40.5");const v=a.metadata;v&&"channelCount"in v&&(v.channelCount||1)!==1&&p.indexOf("firefox")===-1&&(g="mp4a.40.5")}g&&g.indexOf("mp4a.40.5")!==-1&&p.indexOf("android")!==-1&&a.container!=="audio/mpeg"&&(g="mp4a.40.2",this.log(`Android: force audio codec to ${g}`)),d&&d!==g&&this.log(`Swapping manifest audio codec "${d}" for "${g}"`),a.levelCodec=g,a.id=ht.MAIN,this.log(`Init audio buffer, container:${a.container}, codecs[selected/level/parsed]=[${g||""}/${d||""}/${a.codec}]`),delete e.audiovideo}if(o){o.levelCodec=t.videoCodec,o.id=ht.MAIN;const d=o.codec;if((d==null?void 0:d.length)===4)switch(d){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${t.videoCodec||""}/${d}]${o.codec!==d?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete e.audiovideo}f&&(this.log(`Init audiovideo buffer, container:${f.container}, codecs[level/parsed]=[${t.codecs}/${f.codec}]`),delete e.video,delete e.audio);const h=Object.keys(e);if(h.length){if(this.hls.trigger(x.BUFFER_CODECS,e),!this.hls)return;h.forEach(d=>{const p=e[d].initSegment;p!=null&&p.byteLength&&this.hls.trigger(x.BUFFER_APPENDING,{type:d,data:p,frag:s,part:null,chunkMeta:r,parent:s.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const t=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(t,ht.MAIN)}get maxBufferLength(){const{levels:t,level:e}=this,s=t==null?void 0:t[e];return s?this.getMaxBufferLength(s.maxBitrate):this.config.maxBufferLength}backtrack(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=J.IDLE}checkFragmentChanged(){const t=this.media;let e=null;if(t&&t.readyState>1&&t.seeking===!1){const s=t.currentTime;if(Tt.isBuffered(t,s)?e=this.getAppendedFrag(s):Tt.isBuffered(t,s+.1)&&(e=this.getAppendedFrag(s+.1)),e){this.backtrackFragment=null;const r=this.fragPlaying,a=e.level;(!r||e.sn!==r.sn||r.level!==a)&&(this.fragPlaying=e,this.hls.trigger(x.FRAG_CHANGED,{frag:e}),(!r||r.level!==a)&&this.hls.trigger(x.LEVEL_SWITCHED,{level:a}))}}}get nextLevel(){const t=this.nextBufferedFrag;return t?t.level:-1}get currentFrag(){var t;if(this.fragPlaying)return this.fragPlaying;const e=((t=this.media)==null?void 0:t.currentTime)||this.lastCurrentTime;return ct(e)?this.getAppendedFrag(e):null}get currentProgramDateTime(){var t;const e=((t=this.media)==null?void 0:t.currentTime)||this.lastCurrentTime;if(ct(e)){const s=this.getLevelDetails(),r=this.currentFrag||(s?un(null,s.fragments,e):null);if(r){const a=r.programDateTime;if(a!==null){const o=a+(e-r.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const t=this.currentFrag;return t?t.level:-1}get nextBufferedFrag(){const t=this.currentFrag;return t?this.followingBufferedFrag(t):null}get forceStartLoad(){return this._forceStartLoad}}class YL extends mi{constructor(t,e){super("key-loader",e),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=t}abort(t){for(const s in this.keyIdToKeyInfo){const r=this.keyIdToKeyInfo[s].loader;if(r){var e;if(t&&t!==((e=r.context)==null?void 0:e.frag.type))return;r.abort()}}}detach(){for(const t in this.keyIdToKeyInfo){const e=this.keyIdToKeyInfo[t];(e.mediaKeySessionContext||e.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[t]}}destroy(){this.detach();for(const t in this.keyIdToKeyInfo){const e=this.keyIdToKeyInfo[t].loader;e&&e.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(t,e=z.KEY_LOAD_ERROR,s,r,a){return new ns({type:pt.NETWORK_ERROR,details:e,fatal:!1,frag:t,response:a,error:s,networkDetails:r})}loadClear(t,e,s){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(e.length)for(let r=0,a=e.length;r<a;r++){const o=e[r];if(t.cc<=o.cc&&(!le(t)||!le(o)||t.sn<o.sn)||!s&&r==a-1)return this.emeController.selectKeySystemFormat(o).then(f=>{if(!this.emeController)return;o.setKeyFormat(f);const h=so(f);if(h)return this.emeController.getKeySystemAccess([h])})}if(this.config.requireKeySystemAccessOnStart){const r=la(this.config);if(r.length)return this.emeController.getKeySystemAccess(r)}}return null}load(t){return!t.decryptdata&&t.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(t).then(e=>this.loadInternal(t,e)):this.loadInternal(t)}loadInternal(t,e){var s,r;e&&t.setKeyFormat(e);const a=t.decryptdata;if(!a){const d=new Error(e?`Expected frag.decryptdata to be defined after setting format ${e}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(t,z.KEY_LOAD_ERROR,d))}const o=a.uri;if(!o)return Promise.reject(this.createKeyLoadError(t,z.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));const f=ff(a);let h=this.keyIdToKeyInfo[f];if((s=h)!=null&&s.decryptdata.key)return a.key=h.decryptdata.key,Promise.resolve({frag:t,keyInfo:h});if(this.emeController&&(r=h)!=null&&r.keyLoadPromise)switch(this.emeController.getKeyStatus(h.decryptdata)){case"usable":case"usable-in-future":return h.keyLoadPromise.then(g=>{const{keyInfo:p}=g;return a.key=p.decryptdata.key,{frag:t,keyInfo:p}})}switch(this.log(`${this.keyIdToKeyInfo[f]?"Rel":"L"}oading${a.keyId?" keyId: "+Re(a.keyId):""} URI: ${a.uri} from ${t.type} ${t.level}`),h=this.keyIdToKeyInfo[f]={decryptdata:a,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},a.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return a.keyFormat==="identity"?this.loadKeyHTTP(h,t):this.loadKeyEME(h,t);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(h,t);default:return Promise.reject(this.createKeyLoadError(t,z.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${a.method}"`)))}}loadKeyEME(t,e){const s={frag:e,keyInfo:t};if(this.emeController&&this.config.emeEnabled){var r;if(!t.decryptdata.keyId&&(r=e.initSegment)!=null&&r.data){const o=dx(e.initSegment.data);if(o.length){let f=o[0];f.some(h=>h!==0)?(this.log(`Using keyId found in init segment ${Re(f)}`),Ps.setKeyIdForUri(t.decryptdata.uri,f)):(f=Ps.addKeyIdForUri(t.decryptdata.uri),this.log(`Generating keyId to patch media ${Re(f)}`)),t.decryptdata.keyId=f}}if(!t.decryptdata.keyId&&!le(e))return Promise.resolve(s);const a=this.emeController.loadKey(s);return(t.keyLoadPromise=a.then(o=>(t.mediaKeySessionContext=o,s))).catch(o=>{throw t.keyLoadPromise=null,"data"in o&&(o.data.frag=e),o})}return Promise.resolve(s)}loadKeyHTTP(t,e){const s=this.config,r=s.loader,a=new r(s);return e.keyLoader=t.loader=a,t.keyLoadPromise=new Promise((o,f)=>{const h={keyInfo:t,frag:e,responseType:"arraybuffer",url:t.decryptdata.uri},d=s.keyLoadPolicy.default,g={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(v,E,S,A)=>{const{frag:b,keyInfo:L}=S,_=ff(L.decryptdata);if(!b.decryptdata||L!==this.keyIdToKeyInfo[_])return f(this.createKeyLoadError(b,z.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),A));L.decryptdata.key=b.decryptdata.key=new Uint8Array(v.data),b.keyLoader=null,L.loader=null,o({frag:b,keyInfo:L})},onError:(v,E,S,A)=>{this.resetLoader(E),f(this.createKeyLoadError(e,z.KEY_LOAD_ERROR,new Error(`HTTP Error ${v.code} loading key ${v.text}`),S,$t({url:h.url,data:void 0},v)))},onTimeout:(v,E,S)=>{this.resetLoader(E),f(this.createKeyLoadError(e,z.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),S))},onAbort:(v,E,S)=>{this.resetLoader(E),f(this.createKeyLoadError(e,z.INTERNAL_ABORTED,new Error("key loading aborted"),S))}};a.load(h,g,p)})}resetLoader(t){const{frag:e,keyInfo:s,url:r}=t,a=s.loader;e.keyLoader===a&&(e.keyLoader=null,s.loader=null);const o=ff(s.decryptdata)||r;delete this.keyIdToKeyInfo[o],a&&a.destroy()}}function ff(u){if(u.keyFormat!==_e.FAIRPLAY){const t=u.keyId;if(t)return Re(t)}return u.uri}function Dp(u){const{type:t}=u;switch(t){case Rt.AUDIO_TRACK:return ht.AUDIO;case Rt.SUBTITLE_TRACK:return ht.SUBTITLE;default:return ht.MAIN}}function df(u,t){let e=u.url;return(e===void 0||e.indexOf("data:")===0)&&(e=t.url),e}class qL{constructor(t){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=t,this.registerListeners()}startLoad(t){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:t}=this;t.on(x.MANIFEST_LOADING,this.onManifestLoading,this),t.on(x.LEVEL_LOADING,this.onLevelLoading,this),t.on(x.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(x.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),t.on(x.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:t}=this;t.off(x.MANIFEST_LOADING,this.onManifestLoading,this),t.off(x.LEVEL_LOADING,this.onLevelLoading,this),t.off(x.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(x.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),t.off(x.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(t){const e=this.hls.config,s=e.pLoader,r=e.loader,a=s||r,o=new a(e);return this.loaders[t.type]=o,o}getInternalLoader(t){return this.loaders[t.type]}resetInternalLoader(t){this.loaders[t]&&delete this.loaders[t]}destroyInternalLoaders(){for(const t in this.loaders){const e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(t,e){const{url:s}=e;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Rt.MANIFEST,url:s,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(t,e){const{id:s,level:r,pathwayId:a,url:o,deliveryDirectives:f,levelInfo:h}=e;this.load({id:s,level:r,pathwayId:a,responseType:"text",type:Rt.LEVEL,url:o,deliveryDirectives:f,levelOrTrack:h})}onAudioTrackLoading(t,e){const{id:s,groupId:r,url:a,deliveryDirectives:o,track:f}=e;this.load({id:s,groupId:r,level:null,responseType:"text",type:Rt.AUDIO_TRACK,url:a,deliveryDirectives:o,levelOrTrack:f})}onSubtitleTrackLoading(t,e){const{id:s,groupId:r,url:a,deliveryDirectives:o,track:f}=e;this.load({id:s,groupId:r,level:null,responseType:"text",type:Rt.SUBTITLE_TRACK,url:a,deliveryDirectives:o,levelOrTrack:f})}onLevelsUpdated(t,e){const s=this.loaders[Rt.LEVEL];if(s){const r=s.context;r&&!e.levels.some(a=>a===r.levelOrTrack)&&(s.abort(),delete this.loaders[Rt.LEVEL])}}load(t){var e;const s=this.hls.config;let r=this.getInternalLoader(t);if(r){const d=this.hls.logger,g=r.context;if(g&&g.levelOrTrack===t.levelOrTrack&&(g.url===t.url||g.deliveryDirectives&&!t.deliveryDirectives)){g.url===t.url?d.log(`[playlist-loader]: ignore ${t.url} ongoing request`):d.log(`[playlist-loader]: ignore ${t.url} in favor of ${g.url}`);return}d.log(`[playlist-loader]: aborting previous loader for type: ${t.type}`),r.abort()}let a;if(t.type===Rt.MANIFEST?a=s.manifestLoadPolicy.default:a=jt({},s.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(t),ct((e=t.deliveryDirectives)==null?void 0:e.part)){let d;if(t.type===Rt.LEVEL&&t.level!==null?d=this.hls.levels[t.level].details:t.type===Rt.AUDIO_TRACK&&t.id!==null?d=this.hls.audioTracks[t.id].details:t.type===Rt.SUBTITLE_TRACK&&t.id!==null&&(d=this.hls.subtitleTracks[t.id].details),d){const g=d.partTarget,p=d.targetduration;if(g&&p){const v=Math.max(g*3,p*.8)*1e3;a=jt({},a,{maxTimeToFirstByteMs:Math.min(v,a.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(v,a.maxTimeToFirstByteMs)})}}}const o=a.errorRetry||a.timeoutRetry||{},f={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},h={onSuccess:(d,g,p,v)=>{const E=this.getInternalLoader(p);this.resetInternalLoader(p.type);const S=d.data;g.parsing.start=performance.now(),wi.isMediaPlaylist(S)||p.type!==Rt.MANIFEST?this.handleTrackOrLevelPlaylist(d,g,p,v||null,E):this.handleMasterPlaylist(d,g,p,v)},onError:(d,g,p,v)=>{this.handleNetworkError(g,p,!1,d,v)},onTimeout:(d,g,p)=>{this.handleNetworkError(g,p,!0,void 0,d)}};r.load(t,f,h)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:t,startPosition:e},forceStartLoad:s}=this.hls;(t||s)&&(this.hls.logger.log(`${t?"auto":"force"} startLoad with configured startPosition ${e}`),this.hls.startLoad(e))}handleMasterPlaylist(t,e,s,r){const a=this.hls,o=t.data,f=df(t,s),h=wi.parseMasterPlaylist(o,f);if(h.playlistParsingError){e.parsing.end=performance.now(),this.handleManifestParsingError(t,s,h.playlistParsingError,r,e);return}const{contentSteering:d,levels:g,sessionData:p,sessionKeys:v,startTimeOffset:E,variableList:S}=h;this.variableList=S,g.forEach(_=>{const{unknownCodecs:D}=_;if(D){const{preferManagedMediaSource:k}=this.hls.config;let{audioCodec:w,videoCodec:V}=_;for(let O=D.length;O--;){const $=D[O];da($,"audio",k)?(_.audioCodec=w=w?`${w},${$}`:$,lr.audio[w.substring(0,4)]=2,D.splice(O,1)):da($,"video",k)&&(_.videoCodec=V=V?`${V},${$}`:$,lr.video[V.substring(0,4)]=2,D.splice(O,1))}}});const{AUDIO:A=[],SUBTITLES:b,"CLOSED-CAPTIONS":L}=wi.parseMasterPlaylistMedia(o,f,h);A.length&&!A.some(D=>!D.url)&&g[0].audioCodec&&!g[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),A.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new te({}),bitrate:0,url:""})),a.trigger(x.MANIFEST_LOADED,{levels:g,audioTracks:A,subtitles:b,captions:L,contentSteering:d,url:f,stats:e,networkDetails:r,sessionData:p,sessionKeys:v,startTimeOffset:E,variableList:S})}handleTrackOrLevelPlaylist(t,e,s,r,a){const o=this.hls,{id:f,level:h,type:d}=s,g=df(t,s),p=ct(h)?h:ct(f)?f:0,v=Dp(s),E=wi.parseLevelPlaylist(t.data,g,p,v,0,this.variableList);if(d===Rt.MANIFEST){const S={attrs:new te({}),bitrate:0,details:E,name:"",url:g};E.requestScheduled=e.loading.start+fy(E,0),o.trigger(x.MANIFEST_LOADED,{levels:[S],audioTracks:[],url:g,stats:e,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}e.parsing.end=performance.now(),s.levelDetails=E,this.handlePlaylistLoaded(E,t,e,s,r,a)}handleManifestParsingError(t,e,s,r,a){this.hls.trigger(x.ERROR,{type:pt.NETWORK_ERROR,details:z.MANIFEST_PARSING_ERROR,fatal:e.type===Rt.MANIFEST,url:t.url,err:s,error:s,reason:s.message,response:t,context:e,networkDetails:r,stats:a})}handleNetworkError(t,e,s=!1,r,a){let o=`A network ${s?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${t.type}`;t.type===Rt.LEVEL?o+=`: ${t.level} id: ${t.id}`:(t.type===Rt.AUDIO_TRACK||t.type===Rt.SUBTITLE_TRACK)&&(o+=` id: ${t.id} group-id: "${t.groupId}"`);const f=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let h=z.UNKNOWN,d=!1;const g=this.getInternalLoader(t);switch(t.type){case Rt.MANIFEST:h=s?z.MANIFEST_LOAD_TIMEOUT:z.MANIFEST_LOAD_ERROR,d=!0;break;case Rt.LEVEL:h=s?z.LEVEL_LOAD_TIMEOUT:z.LEVEL_LOAD_ERROR,d=!1;break;case Rt.AUDIO_TRACK:h=s?z.AUDIO_TRACK_LOAD_TIMEOUT:z.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case Rt.SUBTITLE_TRACK:h=s?z.SUBTITLE_TRACK_LOAD_TIMEOUT:z.SUBTITLE_LOAD_ERROR,d=!1;break}g&&this.resetInternalLoader(t.type);const p={type:pt.NETWORK_ERROR,details:h,fatal:d,url:t.url,loader:g,context:t,error:f,networkDetails:e,stats:a};if(r){const v=(e==null?void 0:e.url)||t.url;p.response=$t({url:v,data:void 0},r)}this.hls.trigger(x.ERROR,p)}handlePlaylistLoaded(t,e,s,r,a,o){const f=this.hls,{type:h,level:d,levelOrTrack:g,id:p,groupId:v,deliveryDirectives:E}=r,S=df(e,r),A=Dp(r);let b=typeof r.level=="number"&&A===ht.MAIN?d:void 0;const L=t.playlistParsingError;if(L){if(this.hls.logger.warn(`${L} ${t.url}`),!f.config.ignorePlaylistParsingErrors){f.trigger(x.ERROR,{type:pt.NETWORK_ERROR,details:z.LEVEL_PARSING_ERROR,fatal:!1,url:S,error:L,reason:L.message,response:e,context:r,level:b,parent:A,networkDetails:a,stats:s});return}t.playlistParsingError=null}if(!t.fragments.length){const _=t.playlistParsingError=new Error("No Segments found in Playlist");f.trigger(x.ERROR,{type:pt.NETWORK_ERROR,details:z.LEVEL_EMPTY_ERROR,fatal:!1,url:S,error:_,reason:_.message,response:e,context:r,level:b,parent:A,networkDetails:a,stats:s});return}switch(t.live&&o&&(o.getCacheAge&&(t.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(t.ageHeader))&&(t.ageHeader=0)),h){case Rt.MANIFEST:case Rt.LEVEL:if(b){if(!g)b=0;else if(g!==f.levels[b]){const _=f.levels.indexOf(g);_>-1&&(b=_)}}f.trigger(x.LEVEL_LOADED,{details:t,levelInfo:g||f.levels[0],level:b||0,id:p||0,stats:s,networkDetails:a,deliveryDirectives:E,withoutMultiVariant:h===Rt.MANIFEST});break;case Rt.AUDIO_TRACK:f.trigger(x.AUDIO_TRACK_LOADED,{details:t,track:g,id:p||0,groupId:v||"",stats:s,networkDetails:a,deliveryDirectives:E});break;case Rt.SUBTITLE_TRACK:f.trigger(x.SUBTITLE_TRACK_LOADED,{details:t,track:g,id:p||0,groupId:v||"",stats:s,networkDetails:a,deliveryDirectives:E});break}}}class Ai{static get version(){return ma}static isMSESupported(){return cv()}static isSupported(){return zL()}static getMediaSource(){return Us()}static get Events(){return x}static get MetadataSchema(){return ei}static get ErrorTypes(){return pt}static get ErrorDetails(){return z}static get DefaultConfig(){return Ai.defaultConfig?Ai.defaultConfig:kL}static set DefaultConfig(t){Ai.defaultConfig=t}constructor(t={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Kf,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const e=this.logger=tx(t.debug||!1,"Hls instance",t.assetPlayerId),s=this.config=ML(Ai.DefaultConfig,t,e);this.userConfig=t,s.progressive&&wL(s,e);const{abrController:r,bufferController:a,capLevelController:o,errorController:f,fpsController:h}=s,d=new f(this),g=this.abrController=new r(this),p=new Xx(this),v=s.interstitialsController,E=v?this.interstitialsController=new v(this,Ai):null,S=this.bufferController=new a(this,p),A=this.capLevelController=new o(this),b=new h(this),L=new qL(this),_=s.contentSteeringController,D=_?new _(this):null,k=this.levelController=new HL(this,D),w=new $L(this),V=new YL(this.config,this.logger),O=this.streamController=new VL(this,p,V),$=this.gapController=new BL(this,p);A.setStreamController(O),b.setStreamController(O);const G=[L,k,O];E&&G.splice(1,0,E),D&&G.splice(1,0,D),this.networkControllers=G;const B=[g,S,$,A,b,w,p];this.audioTrackController=this.createController(s.audioTrackController,G);const Q=s.audioStreamController;Q&&G.push(this.audioStreamController=new Q(this,p,V)),this.subtitleTrackController=this.createController(s.subtitleTrackController,G);const st=s.subtitleStreamController;st&&G.push(this.subtititleStreamController=new st(this,p,V)),this.createController(s.timelineController,B),V.emeController=this.emeController=this.createController(s.emeController,B),this.cmcdController=this.createController(s.cmcdController,B),this.latencyController=this.createController(GL,B),this.coreComponents=B,G.push(d);const ut=d.onErrorOut;typeof ut=="function"&&this.on(x.ERROR,ut,d),this.on(x.MANIFEST_LOADED,L.onManifestLoaded,L)}createController(t,e){if(t){const s=new t(this);return e&&e.push(s),s}return null}on(t,e,s=this){this._emitter.on(t,e,s)}once(t,e,s=this){this._emitter.once(t,e,s)}removeAllListeners(t){this._emitter.removeAllListeners(t)}off(t,e,s=this,r){this._emitter.off(t,e,s,r)}listeners(t){return this._emitter.listeners(t)}emit(t,e,s){return this._emitter.emit(t,e,s)}trigger(t,e){if(this.config.debug)return this.emit(t,t,e);try{return this.emit(t,t,e)}catch(s){if(this.logger.error("An internal error happened while handling event "+t+'. Error message: "'+s.message+'". Here is a stacktrace:',s),!this.triggeringException){this.triggeringException=!0;const r=t===x.ERROR;this.trigger(x.ERROR,{type:pt.OTHER_ERROR,details:z.INTERNAL_EXCEPTION,fatal:r,event:t,error:s}),this.triggeringException=!1}}return!1}listenerCount(t){return this._emitter.listenerCount(t)}destroy(){this.logger.log("destroy"),this.trigger(x.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(e=>e.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(e=>e.destroy()),this.coreComponents.length=0;const t=this.config;t.xhrSetup=t.fetchSetup=void 0,this.userConfig=null}attachMedia(t){if(!t||"media"in t&&!t.media){const a=new Error(`attachMedia failed: invalid argument (${t})`);this.trigger(x.ERROR,{type:pt.OTHER_ERROR,details:z.ATTACH_MEDIA_ERROR,fatal:!0,error:a});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const e="media"in t,s=e?t.media:t,r=e?t:{media:s};this._media=s,this.trigger(x.MEDIA_ATTACHING,r)}detachMedia(){this.logger.log("detachMedia"),this.trigger(x.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const t=this.bufferController.transferMedia();return this.trigger(x.MEDIA_DETACHING,{transferMedia:t}),t}loadSource(t){this.stopLoad();const e=this.media,s=this._url,r=this._url=Mf.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${r}`),e&&s&&(s!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(e)),this.trigger(x.MANIFEST_LOADING,{url:t})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(t=-1,e){this.logger.log(`startLoad(${t+(e?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let s=0;s<this.networkControllers.length&&(this.networkControllers[s].startLoad(t,e),!(!this.started||!this.networkControllers));s++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let t=0;t<this.networkControllers.length&&(this.networkControllers[t].stopLoad(),!(this.started||!this.networkControllers));t++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(t=>{t.resumeBuffering&&t.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(t=>{t.pauseBuffering&&t.pauseBuffering()}))}get inFlightFragments(){const t={[ht.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(t[ht.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(t[ht.SUBTITLE]=this.subtititleStreamController.inFlightFrag),t}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const t=this._media,e=t==null?void 0:t.currentTime;this.detachMedia(),t&&(this.attachMedia(t),e&&this.startLoad(e))}removeLevel(t){this.levelController.removeLevel(t)}get sessionId(){let t=this._sessionId;return t||(t=this._sessionId=B1()),t}get levels(){const t=this.levelController.levels;return t||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(t){this.logger.log(`set currentLevel:${t}`),this.levelController.manualLevel=t,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(t){this.logger.log(`set nextLevel:${t}`),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(t){this.logger.log(`set loadLevel:${t}`),this.levelController.manualLevel=t}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(t){this.levelController.nextLoadLevel=t}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(t){this.logger.log(`set firstLevel:${t}`),this.levelController.firstLevel=t}get startLevel(){const t=this.levelController.startLevel;return t===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:t}set startLevel(t){this.logger.log(`set startLevel:${t}`),t!==-1&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(t){const e=!!t;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimate():NaN}set bandwidthEstimate(t){this.abrController.resetEstimator(t)}get abrEwmaDefaultEstimate(){const{bwEstimator:t}=this.abrController;return t?t.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:t}=this.abrController;return t?t.getEstimateTTFB():NaN}set autoLevelCapping(t){this._autoLevelCapping!==t&&(this.logger.log(`set autoLevelCapping:${t}`),this._autoLevelCapping=t,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(t){Mx(t)&&this._maxHdcpLevel!==t&&(this._maxHdcpLevel=t,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:t,config:{minAutoBitrate:e}}=this;if(!t)return 0;const s=t.length;for(let r=0;r<s;r++)if(t[r].maxBitrate>=e)return r;return 0}get maxAutoLevel(){const{levels:t,autoLevelCapping:e,maxHdcpLevel:s}=this;let r;if(e===-1&&t!=null&&t.length?r=t.length-1:r=e,s)for(let a=r;a--;){const o=t[a].attrs["HDCP-LEVEL"];if(o&&o<=s)return a}return r}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(t){this.abrController.nextAutoLevel=t}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(t){var e;return((e=this.audioTrackController)==null?void 0:e.setAudioOption(t))||null}setSubtitleOption(t){var e;return((e=this.subtitleTrackController)==null?void 0:e.setSubtitleOption(t))||null}get allAudioTracks(){const t=this.audioTrackController;return t?t.allAudioTracks:[]}get audioTracks(){const t=this.audioTrackController;return t?t.audioTracks:[]}get audioTrack(){const t=this.audioTrackController;return t?t.audioTrack:-1}set audioTrack(t){const e=this.audioTrackController;e&&(e.audioTrack=t)}get allSubtitleTracks(){const t=this.subtitleTrackController;return t?t.allSubtitleTracks:[]}get subtitleTracks(){const t=this.subtitleTrackController;return t?t.subtitleTracks:[]}get subtitleTrack(){const t=this.subtitleTrackController;return t?t.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(t){const e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}get subtitleDisplay(){const t=this.subtitleTrackController;return t?t.subtitleDisplay:!1}set subtitleDisplay(t){const e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(t){this.config.lowLatencyMode=t}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(t){this.latencyController.targetLatency=t}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(t){this.levelController.pathwayPriority=t}get bufferedToEnd(){var t;return!!((t=this.bufferController)!=null&&t.bufferedToEnd)}get interstitialsManager(){var t;return((t=this.interstitialsController)==null?void 0:t.interstitialsManager)||null}getMediaDecodingInfo(t,e=this.allAudioTracks){const s=Qp(e);return qp(t,s,navigator.mediaCapabilities)}}Ai.defaultConfig=void 0;const XL=({item:u,onClose:t})=>{const e=Qt.useRef(null),[s,r]=Qt.useState(!1),[a,o]=Qt.useState(!1),[f,h]=Qt.useState(0),[d,g]=Qt.useState(!0),p=Qt.useRef(null),v=Qt.useRef(null);Qt.useEffect(()=>{const b=e.current;if(!b)return;let L=u.sourceUrl;if(L||(L="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"),Ai.isSupported()&&L.includes(".m3u8")){const D=new Ai;D.loadSource(L),D.attachMedia(b),v.current=D,D.on(Ai.Events.MANIFEST_PARSED,()=>{b.play().then(()=>r(!0)).catch(()=>r(!1))}),D.on(Ai.Events.ERROR,function(k,w){w.fatal&&console.error("HLS Error",w)})}else b.canPlayType("application/vnd.apple.mpegurl")?(b.src=L,b.play().then(()=>r(!0)).catch(()=>r(!1))):(b.src=L,b.play().then(()=>r(!0)).catch(()=>r(!1)));const _=()=>{g(!0),p.current&&window.clearTimeout(p.current),p.current=window.setTimeout(()=>{s&&g(!1)},3e3)};return window.addEventListener("mousemove",_),()=>{window.removeEventListener("mousemove",_),p.current&&window.clearTimeout(p.current),v.current&&v.current.destroy()}},[u]);const E=()=>{e.current&&(s?e.current.pause():e.current.play(),r(!s))},S=()=>{e.current&&(e.current.muted=!a,o(!a))},A=()=>{if(e.current){const b=e.current.currentTime,L=e.current.duration;L>0&&h(b/L*100)}};return C.jsx("div",{className:"fixed inset-0 z-[100] bg-black flex items-center justify-center",children:C.jsxs("div",{className:"relative w-full h-full max-w-7xl max-h-screen bg-black overflow-hidden group",children:[C.jsx("video",{ref:e,className:"w-full h-full object-contain",onTimeUpdate:A,onEnded:()=>r(!1),loop:!1}),C.jsxs("div",{className:`absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-black/40 transition-opacity duration-300 ${d?"opacity-100":"opacity-0"}`,children:[C.jsxs("div",{className:"absolute top-0 left-0 right-0 p-6 flex justify-between items-start",children:[C.jsxs("div",{children:[C.jsx("h2",{className:"text-white text-2xl font-bold tracking-tight",children:u.title||u.name}),C.jsx("p",{className:"text-slate-300 text-sm mt-1",children:u.category?`Live  ${u.category}`:"VOD"})]}),C.jsx("button",{onClick:t,className:"p-2 bg-slate-800/50 hover:bg-slate-700/80 rounded-full text-white backdrop-blur-md transition-colors",children:C.jsx(HT,{size:24})})]}),!s&&C.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:C.jsx("div",{className:"p-6 bg-blue-600/90 rounded-full backdrop-blur-xl shadow-[0_0_30px_rgba(37,99,235,0.4)]",children:C.jsx(fa,{size:48,className:"text-white ml-2",fill:"currentColor"})})}),C.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-6 pb-8 space-y-4",children:[C.jsx("div",{className:"group/progress relative h-1.5 w-full bg-slate-700/50 rounded-full cursor-pointer overflow-hidden",children:C.jsx("div",{className:"absolute top-0 left-0 h-full bg-blue-500 transition-all duration-100 ease-out",style:{width:`${f}%`}})}),C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{className:"flex items-center gap-6",children:[C.jsx("button",{onClick:E,className:"text-white hover:text-blue-400 transition-colors",children:s?C.jsx(mT,{size:28,fill:"currentColor"}):C.jsx(fa,{size:28,fill:"currentColor"})}),C.jsx("div",{className:"flex items-center gap-2 group/vol",children:C.jsx("button",{onClick:S,className:"text-slate-300 hover:text-white transition-colors",children:a?C.jsx($T,{size:22}):C.jsx(BT,{size:22})})})]}),C.jsxs("div",{className:"flex items-center gap-4",children:[C.jsx("button",{className:"text-slate-300 hover:text-white transition-colors",children:C.jsx(Mp,{size:20})}),C.jsx("button",{className:"text-slate-300 hover:text-white transition-colors",children:C.jsx(lT,{size:20})})]})]})]})]})]})})},QL=({channels:u,onPlay:t})=>C.jsxs("div",{className:"p-8 pb-20",children:[C.jsxs("div",{className:"flex items-center justify-between mb-6",children:[C.jsxs("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-3",children:[C.jsx("span",{className:"w-2 h-8 bg-red-600 rounded-full inline-block animate-pulse"}),"Chanes en Direct"]}),C.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-500",children:[C.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"}),u.length," chanes actives"]})]}),C.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:u.map(e=>C.jsxs("div",{onClick:()=>t(e),className:"group relative aspect-video bg-slate-900 rounded-xl overflow-hidden cursor-pointer shadow-md hover:shadow-2xl dark:hover:shadow-[0_0_25px_rgba(37,99,235,0.2)] transition-all duration-300 transform hover:scale-[1.03] border border-slate-200 dark:border-slate-800",children:[C.jsx("img",{src:e.preview,alt:e.currentProgram,className:"absolute inset-0 w-full h-full object-cover opacity-90 group-hover:opacity-100 transition-opacity"}),C.jsxs("div",{className:"absolute top-3 left-3 z-20 flex items-center gap-1.5 px-2.5 py-1 bg-red-600/90 backdrop-blur-sm rounded text-[10px] font-bold text-white uppercase tracking-wider shadow-lg",children:[C.jsx(xT,{size:10,className:"animate-pulse"}),"Direct"]}),C.jsx("div",{className:"absolute top-3 right-3 z-20 w-10 h-10 rounded-full bg-white/10 backdrop-blur-md border border-white/20 flex items-center justify-center text-white font-bold text-xs shadow-lg",children:e.logo}),C.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/95 via-black/40 to-transparent opacity-80 group-hover:opacity-90 transition-opacity"}),C.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4 z-20",children:[C.jsx("div",{className:"w-full h-1 bg-white/20 rounded-full mb-3 overflow-hidden",children:C.jsx("div",{className:"h-full bg-red-600 w-2/3",style:{width:`${Math.floor(Math.random()*60)+20}%`}})}),C.jsx("h3",{className:"text-white font-bold text-lg leading-tight mb-1 drop-shadow-md line-clamp-1 group-hover:text-blue-400 transition-colors",children:e.currentProgram}),C.jsxs("div",{className:"flex items-center justify-between text-slate-300 text-xs font-medium",children:[C.jsx("span",{children:e.name}),C.jsx("span",{className:"px-1.5 py-0.5 border border-slate-500 rounded bg-black/40 text-[10px]",children:"HD"})]})]}),C.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all duration-300 z-30 bg-black/20 backdrop-blur-[1px]",children:C.jsx("div",{className:"w-14 h-14 rounded-full bg-blue-600/90 text-white flex items-center justify-center shadow-[0_0_20px_rgba(37,99,235,0.5)] transform scale-50 group-hover:scale-100 transition-transform duration-300",children:C.jsx(fa,{size:28,fill:"currentColor",className:"ml-1"})})})]},e.id))})]}),WL=u=>{const t=u.split(`
`),e=[],s=[],r=[];let a={};return t.forEach(o=>{if(o=o.trim(),o.startsWith("#EXTINF:")){const f=o.substring(8),h=f.match(/([a-zA-Z0-9-]+)="([^"]*)"/g)||[],d={};h.forEach(v=>{const[E,S]=v.split("=");d[E.replace(/"/g,"")]=S.replace(/"/g,"")});const g=f.split(","),p=g[g.length-1].trim();a={id:Date.now()+Math.random(),name:p,logo:d["tvg-logo"]||"",group:d["group-title"]||"General",tvgId:d["tvg-id"]}}else if(o.startsWith("http")&&a.name){const f=(a.group||"").toLowerCase();f.includes("movie")||f.includes("film")||f.includes("vod")?s.push({id:a.id,title:a.name,description:`Catgorie: ${a.group}`,poster:a.logo||"https://via.placeholder.com/300x450?text=No+Poster",backdrop:"https://via.placeholder.com/1920x1080?text=Cinema",type:"movie",rating:0,year:new Date().getFullYear(),sourceUrl:o}):f.includes("series")||f.includes("srie")?r.push({id:a.id,title:a.name,description:`Catgorie: ${a.group}`,poster:a.logo||"https://via.placeholder.com/300x450?text=No+Poster",backdrop:"https://via.placeholder.com/1920x1080?text=Series",type:"series",rating:0,year:new Date().getFullYear(),sourceUrl:o}):e.push({id:a.id,name:a.name,logo:a.logo||"TV",category:a.group,currentProgram:"Programme en cours",preview:"https://via.placeholder.com/600x340?text=Live+TV",sourceUrl:o}),a={}}}),{channels:e,movies:s,series:r}},ZL=({settings:u,onSave:t,onPlaylistLoaded:e})=>{const[s,r]=Qt.useState(u),[a,o]=Qt.useState(u.streamMode),[f,h]=Qt.useState(!1),[d,g]=Qt.useState("idle"),[p,v]=Qt.useState(""),E=(A,b)=>{const L={...s,[A]:b};r(L),A==="darkMode"&&t(L)},S=async()=>{if(!(!s.m3uUrl&&a==="m3u")){h(!0),g("idle"),v("");try{let A=s.m3uUrl;s.useProxy&&(A=`https://api.allorigins.win/raw?url=${encodeURIComponent(s.m3uUrl)}`);const b=await fetch(A);if(!b.ok)throw new Error(`Erreur HTTP: ${b.status}`);const L=await b.text();if(!L.includes("#EXTM3U"))throw new Error("Ce n'est pas un fichier M3U valide (#EXTM3U manquant).");const _=WL(L);if(_.channels.length===0&&_.movies.length===0)throw new Error("Aucun contenu trouv dans la playlist.");e(_),t({...s,streamMode:a}),g("success")}catch(A){console.error(A),g("error"),v(A.message||"Erreur de connexion. Essayez d'activer le mode Proxy.")}finally{h(!1)}}};return C.jsxs("div",{className:"max-w-4xl mx-auto py-10 px-6",children:[C.jsx("h2",{className:"text-3xl font-bold text-slate-900 dark:text-white mb-2",children:"Paramtres Gnral"}),C.jsx("p",{className:"text-slate-500 dark:text-slate-400 mb-8",children:"Configurez votre source de contenu IPTV."}),C.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[C.jsxs("div",{className:"space-y-4",children:[C.jsxs("div",{className:"bg-white dark:bg-[#0f172a] rounded-xl p-2 border border-slate-200 dark:border-slate-800 shadow-sm",children:[C.jsxs("button",{onClick:()=>o("m3u"),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${a==="m3u"?"bg-blue-600 text-white shadow-lg shadow-blue-900/20":"text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white"}`,children:[C.jsx(cm,{size:18}),C.jsxs("div",{className:"text-left",children:[C.jsx("span",{className:"block font-semibold text-sm",children:"Playlist M3U"}),C.jsx("span",{className:"block text-[10px] opacity-70",children:"URL directe"})]})]}),C.jsxs("button",{onClick:()=>o("xtream"),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg mt-2 transition-all ${a==="xtream"?"bg-blue-600 text-white shadow-lg shadow-blue-900/20":"text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white"}`,children:[C.jsx(fm,{size:18}),C.jsxs("div",{className:"text-left",children:[C.jsx("span",{className:"block font-semibold text-sm",children:"Xtream Codes"}),C.jsx("span",{className:"block text-[10px] opacity-70",children:"API Login"})]})]})]}),C.jsx("div",{className:"bg-white dark:bg-[#0f172a] p-4 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm",children:C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{className:"flex items-center gap-2",children:[s.darkMode?C.jsx(hT,{size:16,className:"text-blue-500"}):C.jsx(OT,{size:16,className:"text-orange-500"}),C.jsx("span",{className:"text-slate-700 dark:text-slate-300 text-sm font-medium",children:"Dark Mode"})]}),C.jsx("button",{className:`w-12 h-6 rounded-full transition-colors duration-200 ease-in-out relative ${s.darkMode?"bg-blue-600":"bg-slate-300"}`,onClick:()=>E("darkMode",!s.darkMode),children:C.jsx("span",{className:`absolute top-1 left-1 bg-white w-4 h-4 rounded-full transition-transform duration-200 shadow-md ${s.darkMode?"translate-x-6":"translate-x-0"}`})})]})})]}),C.jsx("div",{className:"md:col-span-2",children:C.jsxs("div",{className:"bg-white dark:bg-[#0f172a] p-8 rounded-xl border border-slate-200 dark:border-slate-800 relative overflow-hidden shadow-sm",children:[C.jsx("div",{className:"absolute top-0 right-0 -mt-16 -mr-16 w-64 h-64 bg-blue-600/5 rounded-full blur-3xl pointer-events-none"}),a==="m3u"?C.jsxs("div",{className:"space-y-6 relative z-10",children:[C.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[C.jsx("div",{className:"p-3 bg-blue-600/10 rounded-lg text-blue-600 dark:text-blue-500",children:C.jsx(cm,{size:24})}),C.jsxs("div",{children:[C.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Connexion M3U"}),C.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Collez le lien de votre playlist ci-dessous."})]})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx("label",{className:"text-xs uppercase font-bold text-slate-500 tracking-wider",children:"URL de la Playlist"}),C.jsx("input",{type:"text",value:s.m3uUrl,onChange:A=>E("m3uUrl",A.target.value),placeholder:"http://example.com/playlist.m3u",className:"w-full bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-slate-900 dark:text-white px-4 py-3 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all placeholder-slate-400 dark:placeholder-slate-600"}),C.jsx("div",{className:"flex justify-between items-start",children:C.jsxs("p",{className:"text-xs text-slate-500 flex items-center gap-1 mt-1",children:[C.jsx(XS,{size:12,className:"text-emerald-500"}),"Formats supports: .m3u, .m3u8"]})})]}),C.jsxs("div",{className:"flex items-center gap-3 p-3 bg-yellow-50 dark:bg-yellow-900/10 border border-yellow-200 dark:border-yellow-900/30 rounded-lg",children:[C.jsx(CT,{className:"text-yellow-600 dark:text-yellow-500 shrink-0",size:20}),C.jsxs("div",{className:"flex-1",children:[C.jsx("p",{className:"text-sm font-semibold text-yellow-800 dark:text-yellow-500",children:"Mode Proxy (Anti-CORS)"}),C.jsx("p",{className:"text-[10px] text-yellow-700 dark:text-yellow-400 opacity-80",children:"Activez si le chargement choue ou reste bloqu."})]}),C.jsx("button",{className:`w-10 h-5 rounded-full transition-colors duration-200 ease-in-out relative ${s.useProxy?"bg-yellow-500":"bg-slate-300"}`,onClick:()=>E("useProxy",!s.useProxy),children:C.jsx("span",{className:`absolute top-1 left-1 bg-white w-3 h-3 rounded-full transition-transform duration-200 shadow-sm ${s.useProxy?"translate-x-5":"translate-x-0"}`})})]})]}):C.jsxs("div",{className:"space-y-6 relative z-10",children:[C.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[C.jsx("div",{className:"p-3 bg-blue-600/10 rounded-lg text-blue-600 dark:text-blue-500",children:C.jsx(fm,{size:24})}),C.jsxs("div",{children:[C.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white",children:"Xtream Codes API"}),C.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Connectez-vous via votre fournisseur."})]})]}),C.jsx("div",{className:"p-4 bg-slate-100 dark:bg-slate-800 rounded text-sm text-center text-slate-500",children:"Bientt disponible dans cette dmo. Utilisez M3U pour l'instant."})]}),d==="error"&&C.jsx("div",{className:"mt-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-900/50 rounded-lg text-red-600 dark:text-red-400 text-sm",children:p}),C.jsxs("div",{className:"mt-8 pt-6 border-t border-slate-200 dark:border-slate-800 flex items-center justify-between",children:[C.jsx("div",{className:"text-sm",children:d==="success"&&C.jsx("span",{className:"text-emerald-500 font-medium animate-pulse",children:"Playlist charge avec succs !"})}),C.jsx("button",{onClick:S,disabled:f,className:`
                    flex items-center gap-2 px-8 py-3 rounded-lg font-bold text-white transition-all
                    ${f?"bg-slate-400 dark:bg-slate-700 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 hover:shadow-lg hover:shadow-blue-600/20 hover:scale-105 active:scale-95"}
                  `,children:f?C.jsxs(C.Fragment,{children:[C.jsx(bT,{size:20,className:"animate-spin"}),"Chargement..."]}):C.jsxs(C.Fragment,{children:[C.jsx(ST,{size:20}),"Charger la Playlist"]})})]})]})})]})]})},JL=()=>C.jsxs("div",{className:"flex flex-col items-center justify-center h-[80vh] text-center px-4",children:[C.jsx("h1",{className:"text-4xl font-bold text-slate-900 dark:text-white mb-4",children:" Propos"}),C.jsxs("div",{className:"bg-white dark:bg-[#0f172a] p-8 rounded-2xl border border-slate-200 dark:border-slate-800 max-w-lg w-full shadow-xl dark:shadow-2xl",children:[C.jsxs("div",{className:"mb-6",children:[C.jsx("span",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-blue-800 dark:from-blue-400 dark:to-blue-600 bg-clip-text text-transparent",children:"SEFINITY"}),C.jsx("span",{className:"ml-2 px-2 py-0.5 bg-blue-50 dark:bg-blue-900/50 text-blue-600 dark:text-blue-300 text-xs rounded border border-blue-200 dark:border-blue-800",children:"v2.0.1"})]}),C.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6 leading-relaxed",children:"Sefinity est une interface de dmonstration moderne pour les services IPTV, conue avec les dernires technologies Web pour offrir une exprience utilisateur fluide et cinmatographique."}),C.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-800 pt-6 space-y-2 text-sm text-slate-500",children:[C.jsx("p",{children:" 2024 Sefinity Technologies."}),C.jsx("p",{children:"Dvelopp avec React, TypeScript & Tailwind CSS."}),C.jsx("p",{className:"text-xs mt-4 opacity-50",children:"Ceci est une dmo. Aucun contenu rel n'est hberg."})]})]})]}),tR="https://iptv-demo.example.com/playlist.m3u",Ip=[{id:1,title:"Cyber Horizon",description:"In a future where humanity has merged with machines, one detective must solve the ultimate crime.",poster:"https://picsum.photos/300/450?random=1",backdrop:"https://picsum.photos/1920/1080?random=1",type:"movie",rating:4.8,year:2024,duration:"2h 15m"},{id:2,title:"The Deep Blue",description:"An expedition to the mariana trench reveals secrets that should have stayed buried.",poster:"https://picsum.photos/300/450?random=2",backdrop:"https://picsum.photos/1920/1080?random=2",type:"movie",rating:4.5,year:2023,duration:"1h 50m"},{id:3,title:"Velocity",description:"High stakes racing on the streets of Tokyo.",poster:"https://picsum.photos/300/450?random=3",backdrop:"https://picsum.photos/1920/1080?random=3",type:"movie",rating:4.2,year:2023,duration:"2h 05m"},{id:4,title:"Shadows of Past",description:"A psychological thriller that twists reality.",poster:"https://picsum.photos/300/450?random=4",backdrop:"https://picsum.photos/1920/1080?random=4",type:"movie",rating:4.9,year:2022,duration:"1h 45m"},{id:5,title:"Infinite Loop",description:"Trapped in time, they must save the world.",poster:"https://picsum.photos/300/450?random=5",backdrop:"https://picsum.photos/1920/1080?random=5",type:"movie",rating:4.1,year:2024,duration:"1h 55m"}],eR=[{id:101,title:"Code Red",description:"A team of elite hackers fights global corruption.",poster:"https://picsum.photos/300/450?random=10",backdrop:"https://picsum.photos/1920/1080?random=10",type:"series",rating:4.7,year:2023},{id:102,title:"Dynasty",description:"The rise and fall of a futuristic empire.",poster:"https://picsum.photos/300/450?random=11",backdrop:"https://picsum.photos/1920/1080?random=11",type:"series",rating:4.6,year:2022},{id:103,title:"Lost Signal",description:"Astronauts stranded on a distant planet.",poster:"https://picsum.photos/300/450?random=12",backdrop:"https://picsum.photos/1920/1080?random=12",type:"series",rating:4.3,year:2024},{id:104,title:"The Chef",description:"Culinary chaos in a high-pressure kitchen.",poster:"https://picsum.photos/300/450?random=13",backdrop:"https://picsum.photos/1920/1080?random=13",type:"series",rating:4.8,year:2023}],iR=[{id:1,name:"News 24",logo:"N24",category:"News",currentProgram:"World Report",preview:"https://picsum.photos/600/340?random=20"},{id:2,name:"Sports 1",logo:"S1",category:"Sports",currentProgram:"Live: Football Final",preview:"https://picsum.photos/600/340?random=21"},{id:3,name:"Cinema HD",logo:"CHD",category:"Movies",currentProgram:"The Godfather",preview:"https://picsum.photos/600/340?random=22"},{id:4,name:"Discovery",logo:"DSC",category:"Documentary",currentProgram:"Planet Earth III",preview:"https://picsum.photos/600/340?random=23"},{id:5,name:"Music Hits",logo:"MTV",category:"Music",currentProgram:"Top 40 Countdown",preview:"https://picsum.photos/600/340?random=24"},{id:6,name:"Kids TV",logo:"KDS",category:"Kids",currentProgram:"Morning Cartoons",preview:"https://picsum.photos/600/340?random=25"},{id:7,name:"History",logo:"HIS",category:"Documentary",currentProgram:"WWII in Color",preview:"https://picsum.photos/600/340?random=26"},{id:8,name:"Action Max",logo:"MAX",category:"Movies",currentProgram:"John Wick: Chapter 4",preview:"https://picsum.photos/600/340?random=27"}],sR=()=>{const[u,t]=Qt.useState("home"),[e,s]=Qt.useState(!1),[r,a]=Qt.useState(null),[o,f]=Qt.useState(Ip),[h,d]=Qt.useState(eR),[g,p]=Qt.useState(iR),[v,E]=Qt.useState({streamMode:"m3u",m3uUrl:tR,xtreamUrl:"",xtreamUser:"",xtreamPass:"",darkMode:!0,useProxy:!1}),S=L=>{a(L)},A=L=>{p(L.channels),f(L.movies),d(L.series),t("home")},b=()=>{switch(u){case"home":return C.jsxs("div",{className:"pb-20",children:[C.jsx(jT,{item:o.length>0?o[0]:Ip[0],onPlay:S}),C.jsxs("div",{className:"px-8 mt-[-4rem] relative z-10 space-y-12",children:[C.jsxs("section",{children:[C.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white mb-4 pl-1 border-l-4 border-blue-600 dark:border-blue-500",children:o.length>5?"Films Rcents":"Rcemment Ajouts"}),C.jsxs("div",{className:"flex gap-4 overflow-x-auto pb-8 pt-2 scrollbar-hide",children:[o.slice(0,20).map(L=>C.jsx(Fl,{item:L,onPlay:S},L.id)),o.length===0&&C.jsx("p",{className:"text-slate-500",children:"Aucun film charg."})]})]}),C.jsxs("section",{children:[C.jsx("h3",{className:"text-xl font-bold text-slate-900 dark:text-white mb-4 pl-1 border-l-4 border-blue-600 dark:border-blue-500",children:h.length>5?"Sries Populaires":"Sries"}),C.jsxs("div",{className:"flex gap-4 overflow-x-auto pb-8 pt-2 scrollbar-hide",children:[h.slice(0,20).map(L=>C.jsx(Fl,{item:L,onPlay:S},L.id)),h.length===0&&C.jsx("p",{className:"text-slate-500",children:"Aucune srie charge."})]})]})]})]});case"live":return C.jsx(QL,{channels:g,onPlay:S});case"movies":return C.jsxs("div",{className:"p-8 pb-20",children:[C.jsxs("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-6",children:["Films (",o.length,")"]}),C.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6",children:o.map(L=>C.jsx("div",{className:"w-full",children:C.jsx(Fl,{item:L,onPlay:S})},L.id))})]});case"series":return C.jsxs("div",{className:"p-8 pb-20",children:[C.jsxs("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-6",children:["Sries TV (",h.length,")"]}),C.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6",children:h.map(L=>C.jsx("div",{className:"w-full",children:C.jsx(Fl,{item:L,onPlay:S})},L.id))})]});case"favorites":return C.jsxs("div",{className:"flex flex-col items-center justify-center h-[60vh] text-slate-500",children:[C.jsx("div",{className:"p-6 bg-slate-100 dark:bg-slate-900 rounded-full mb-4",children:C.jsx("span",{className:"text-4xl",children:""})}),C.jsx("p",{className:"text-xl",children:"Aucun favori pour le moment."})]});case"settings":return C.jsx(ZL,{settings:v,onSave:E,onPlaylistLoaded:A});case"about":return C.jsx(JL,{});default:return null}};return C.jsxs("div",{className:`flex h-screen overflow-hidden text-slate-900 dark:text-white selection:bg-blue-500 selection:text-white font-sans ${v.darkMode?"dark":""}`,children:[C.jsx(zT,{currentView:u,onChangeView:t,isMobileMenuOpen:e,setIsMobileMenuOpen:s}),C.jsxs("div",{className:"flex-1 flex flex-col min-w-0 bg-slate-50 dark:bg-[#020617] transition-colors duration-300",children:[C.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-slate-50 to-slate-200 dark:from-[#020617] dark:to-[#0f172a] -z-10"}),C.jsx(KT,{toggleMobileMenu:()=>s(!0)}),C.jsx("main",{className:"flex-1 overflow-y-auto overflow-x-hidden scroll-smooth scrollbar-thin scrollbar-thumb-slate-300 dark:scrollbar-thumb-blue-900 scrollbar-track-transparent",children:b()})]}),r&&C.jsx(XL,{item:r,onClose:()=>a(null)})]})},fv=document.getElementById("root");if(!fv)throw new Error("Could not find root element to mount to");const nR=$S.createRoot(fv);nR.render(C.jsx(OS.StrictMode,{children:C.jsx(sR,{})}));
